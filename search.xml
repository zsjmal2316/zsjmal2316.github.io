<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>rsync全网备份</title>
      <link href="2021/01/17/rsync%E5%85%A8%E7%BD%91%E5%A4%87%E4%BB%BD/"/>
      <url>2021/01/17/rsync%E5%85%A8%E7%BD%91%E5%A4%87%E4%BB%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="全网备份"><a href="#全网备份" class="headerlink" title="全网备份"></a>全网备份</h1><h2 id="项目环境准备"><a href="#项目环境准备" class="headerlink" title="项目环境准备"></a>项目环境准备</h2><table><thead><tr><th>主机名</th><th>外网IP</th><th>内网IP</th><th>服务器</th></tr></thead><tbody><tr><td>backup</td><td>10.0.0.203</td><td>172.16.1.203</td><td>rsync服务器</td></tr><tr><td>nfs-1</td><td>10.0.0.204</td><td>172.16.1.204</td><td>nfs服务器</td></tr><tr><td>web-1</td><td>10.0.0.205</td><td>172.16.1.205</td><td>web服务器</td></tr></tbody></table><h2 id="项目需求"><a href="#项目需求" class="headerlink" title="项目需求"></a>项目需求</h2><p><strong>公司中的web集群和nfs服务器都需要进行备份，防止宕机和磁盘损坏，如果一旦服务器和磁盘损坏，后果不堪设想，</strong></p><blockquote><ol><li>规范统一，所有服务器的备份目录必须都为/backup   </li><li>需要备份的系统配置文件<br>a. 定时任务服务的配置文件（/var/spool/cron/root)<br>b. 开机自启动配置文件（/etc/rc.local)<br>c. 日常脚本目录（/server/scripts)<br>d. 防火墙iptables配置文件（/etc/sysconfig/iptables-config)<br>e. web的站点目录和日志目录（/var/www/html/ /app/log/)</li><li>web服务器保留打包后7天后的备份数据 </li><li>备份服务器上，保留每周日的所有数据副本，其他要保留180天的数据</li><li>备份的数据服务器按IP地址为目录保存，备份的文件使用时间名字保存</li><li>确保备份的数据完整性，在备份服务器上对备份的数据每天检查，并将备份成功及失败的结果发到邮箱</li></ol></blockquote><h2 id="项目步骤"><a href="#项目步骤" class="headerlink" title="项目步骤"></a>项目步骤</h2><h3 id="创建项目所需的目录"><a href="#创建项目所需的目录" class="headerlink" title="创建项目所需的目录"></a>创建项目所需的目录</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /backup        //所有服务器</span><br><span class="line">mkdir /server/scripts   //nfs服务和web服务器</span><br></pre></td></tr></table></figure><h3 id="客户端需要压缩的数据信息"><a href="#客户端需要压缩的数据信息" class="headerlink" title="客户端需要压缩的数据信息"></a>客户端需要压缩的数据信息</h3><p><strong>压缩nfs和web服务</strong></p><blockquote><p>//nfs服务器</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zcvPhf /backup/data_backup.tar.gz_$(date +%F-week%w) /var/spool/cron/root /etc/rc.local /server/scripts</span><br></pre></td></tr></table></figure><p>//web服务器</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zcvPhf /backup/web_backup.tar.gz_$(date +%F-week%w) /var/www/html </span><br><span class="line">$ tar -zcvPhf /backup/web_backup.tar.gz_$(date +%F-week%w) /app/log/</span><br><span class="line">$ tar -zcvPhf /backup/file_backup.tar.gz_$(date +%F-week%w) /etc/sysconfig/iptables-config /server/scripts</span><br></pre></td></tr></table></figure><p><strong><code>PS：建议web的站点目录和log目录分开打包，因为不管是哪个目录数据都会很大，打包的时候会很慢，一个一个打包可以提升打包的速率。</code></strong></p></blockquote><p>//tar查看并解压确定</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar tf /backup/data_backup.tar.gz_2020-12-22-weeek2</span><br><span class="line">$ tar tf /backup/web_backup.tar.gz_2020-12-22-weeek2</span><br><span class="line"></span><br><span class="line">$ tar xf  /backup/data_backup.tar.gz_2020-12-22-weeek2</span><br><span class="line">$ tar xf /backup/web_backup.tar.gz_2020-12-22-weeek2</span><br></pre></td></tr></table></figure><h3 id="web服务器创建7天前的数据并删除"><a href="#web服务器创建7天前的数据并删除" class="headerlink" title="web服务器创建7天前的数据并删除"></a>web服务器创建7天前的数据并删除</h3><p><strong>创建7天前数据</strong></p><blockquote><p>//创建日期自己设定</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ date -s &quot;20200430&quot;</span><br><span class="line">$ cd /backup</span><br><span class="line">$ ll</span><br><span class="line">total 144</span><br><span class="line">-rw-r--r-- 1 root root 12435 Dec  2 16:<span class="number">55</span> web_backup.tar.gz_2020-<span class="number">12</span>-<span class="number">02</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">12435</span> Dec  <span class="number">2</span> <span class="number">16</span>:<span class="number">55</span> web_backup.tar.gz_2020-<span class="number">12</span>-<span class="number">03</span></span><br><span class="line">.....略.....</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">12435</span> Dec  <span class="number">2</span> <span class="number">16</span>:<span class="number">55</span> web_backup.tar.gz_2020-<span class="number">12</span>-<span class="number">09</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">12435</span> Dec  <span class="number">2</span> <span class="number">16</span>:<span class="number">55</span> web_backup.tar.gz_2020-<span class="number">12</span>-<span class="number">10</span></span><br></pre></td></tr></table></figure><p><strong>找出七天前的数据，并删除</strong></p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /backup -type f -mtime +7 |xargs rm -f</span><br></pre></td></tr></table></figure><p><strong>rsync的配置文件</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/rsyncd.conf </span><br><span class="line">uid = rsync </span><br><span class="line">gid = rsync</span><br><span class="line">port = 873</span><br><span class="line">fake super = yes</span><br><span class="line">use chroot = no</span><br><span class="line">max connections = 200</span><br><span class="line">timeout = 300</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line">ignore errors</span><br><span class="line">read only = false</span><br><span class="line">#list = false</span><br><span class="line">hosts allow = 172.16.1/24</span><br><span class="line">hosts deny = 0.0.0.0/24</span><br><span class="line">auth users = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.password</span><br><span class="line"><span class="selector-attr">[backup]</span></span><br><span class="line">comment = &quot;backup dir by other&quot;</span><br><span class="line">path = /backup</span><br></pre></td></tr></table></figure><p><strong>使用rsync传输到备份服务端</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avz /backup/ rsync_backup@172.16.1.203::backup --password-file=/etc/rsync_password</span><br></pre></td></tr></table></figure><h3 id="备份服务端删除180天的数据，并保留每周日的数据"><a href="#备份服务端删除180天的数据，并保留每周日的数据" class="headerlink" title="备份服务端删除180天的数据，并保留每周日的数据"></a>备份服务端删除180天的数据，并保留每周日的数据</h3><p><strong>设置服务器时间为180天后，在服务端找出180天前的数据并删除，并保留每周日的数据</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ date -s &quot;202105010&quot;</span><br><span class="line">$ find /backup -type f -mtime +180 ! -name &quot;*week7&quot;|xargs rm -f</span><br><span class="line">$ ll /backup/</span><br><span class="line">-rw-r--r-- 1 rsync rsync 12435 Mar  5  2021 web_backup<span class="selector-class">.tar</span><span class="selector-class">.gz_2021-03-08-week7</span></span><br></pre></td></tr></table></figure><h3 id="备份服务端以IP地址目录保存数据，并验证数据完整性"><a href="#备份服务端以IP地址目录保存数据，并验证数据完整性" class="headerlink" title="备份服务端以IP地址目录保存数据，并验证数据完整性"></a>备份服务端以IP地址目录保存数据，并验证数据完整性</h3><p><strong>创建IP地址目录(web和nfs创建)，这里创建web来演示</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /backup/172.16.1.205</span><br><span class="line">$ cd /backup/</span><br><span class="line">$ ll</span><br><span class="line">drwxr-xr-x 2 root root 6 Oct 20 00:<span class="number">07</span> <span class="number">172.16</span>.<span class="number">1.205</span></span><br></pre></td></tr></table></figure><p><strong>分开打包web服务的文件(nfs服务雷同）</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /backup/172.16.1.205</span><br><span class="line">$ tar -zcvPhf /backup/web_backup.tar.gz_$(date +%F-week%w) /var/www/html</span><br><span class="line">$ tar -zcvPhf /backup/log_backup.tar.gz_$(date +%F-week%w) /app/log</span><br></pre></td></tr></table></figure><p><strong>通过md5sum命令进行校验</strong></p><blockquote><p>//将校验码导入到指纹文件finger.txt（绝对路径）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ md5sum /backup/10.0.0.203/web_backup.tar.gz_2021-03-05-week5 &gt;finger.txt</span><br><span class="line">$ md5sum /backup/10.0.0.203/web_backup.tar.gz_2021-03-05-week5 &gt;&gt;finger.txt</span><br></pre></td></tr></table></figure><p>//查看校验码文件</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat finger<span class="selector-class">.txt</span></span><br><span class="line">4c570d961fd6c7790e0a2f3f576a8681  /backup/10.0.0.203/web_backup.tar.gz_2021-03-05-week5</span><br><span class="line">4c570d961fd6c7790e0a2f3f576a8681  /backup/10.0.0.203/web_backup.tar.gz_2021-03-05-week5</span><br></pre></td></tr></table></figure><p>//将压缩包和指纹文件发送到备份服务器</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avz /backup/172.16.1.205 rsync_backup@172.16.1.203::backup --password-file=/etc/rsync_password  </span><br></pre></td></tr></table></figure><p><strong><code>注意：172.16.1.205后面不要加斜杠，否则只有文件传输过去，目录没有传输</code></strong></p></blockquote><blockquote><p>//进入目录对比指纹文件的校验码（服务端）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ md5sum -c /backup/172.16.1.205/finger.txt  //绝对路径</span><br><span class="line">/backup/172.16.1.205/web_backup.tar.gz_2021-03-05-week5: OK</span><br><span class="line">/backup/172.16.1.205/web_backup.tar.gz_2021-03-05-week5: OK</span><br><span class="line"></span><br><span class="line">$ md5sum -c finger<span class="selector-class">.txt</span>                      <span class="comment">//相对路径</span></span><br><span class="line">&gt;/backup/172.16.1.205/web_backup.tar.gz_2021-03-05-week5: OK</span><br><span class="line">/backup/172.16.1.205/web_backup.tar.gz_2021-03-05-week5: OK</span><br></pre></td></tr></table></figure></blockquote><h3 id="实现发送邮件"><a href="#实现发送邮件" class="headerlink" title="实现发送邮件"></a>实现发送邮件</h3><p><strong>邮件发送流程</strong><br><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117223933.png"></p><p><strong>开启163邮件代理</strong><br><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117223950.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117223950.png"></p><p><strong>编辑邮箱配置文件，添加配置</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tail -2 /etc/mail.rc             </span><br><span class="line">set from=163邮箱账户 smtp=smtp.163.com</span><br><span class="line">set smtp-auth-user=163邮箱账户 smtp-auth-password=上述截图的授权码 smtp-auth=login</span><br></pre></td></tr></table></figure><p><strong>发送邮件</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;邮件发送测试&quot; |mail -s &quot;mail check&quot; qq邮箱账户</span><br><span class="line">$ mail -s  &quot;邮箱测试&quot; qq邮箱账户 &lt; 文件</span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find /backup/ -type f -name &quot;finger.txt&quot;|xargs md5sum -c &amp;&gt;/tmp/check.txt</span><br><span class="line">$ echo &quot;邮件发送测试&quot; |mail -s &quot;邮箱测试&quot; qq邮箱账户 &lt;/tmp/check.txt </span><br></pre></td></tr></table></figure><p><strong><code>PS：使用find命令找到指纹文件，通过xargs将给md5sum处理，&#39;&amp;&#39;代表也将错误信息一起写入到文件</code></strong></p><p><strong>收到的邮件</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117224013.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117224021.png"></p><h2 id="编写全网备份脚本"><a href="#编写全网备份脚本" class="headerlink" title="编写全网备份脚本"></a>编写全网备份脚本</h2><h3 id="客户端脚本（nfs服务器备份脚本）"><a href="#客户端脚本（nfs服务器备份脚本）" class="headerlink" title="客户端脚本（nfs服务器备份脚本）"></a>客户端脚本（nfs服务器备份脚本）</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@nfs /server/scripts]</span># cat bak<span class="selector-class">.sh</span> </span><br><span class="line">#!/bin/bash</span><br><span class="line">                                   <span class="comment">//设置目录和IP地址的变量</span></span><br><span class="line">Bak_dir=&quot;/backup&quot;             </span><br><span class="line">Ip_info=$(hostname -i)</span><br><span class="line"></span><br><span class="line"># create dir                  <span class="comment">//创建相应的目录</span></span><br><span class="line">mkdir -p $Bak_dir/$Ip_info</span><br><span class="line"> </span><br><span class="line"># tar system file             <span class="comment">//打包系统的文件</span></span><br><span class="line">tar -cPhf /$Bak_dir/$Ip_info/data_backup.tar.gz_$(date +F%-weeek%w) /var/spool/cron/root /etc/rc.local /server/scripts </span><br><span class="line"></span><br><span class="line"># <span class="selector-tag">del</span> 7 ago data info        <span class="comment">//删除7天的数据</span></span><br><span class="line">find /$Bak_dir/$Ip_info -type f -mtime +7|xargs rm -f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"># create finger file         <span class="comment">//创建指纹文件</span></span><br><span class="line">find /$Bak_dir/$Ip_info -type f -mtime -1 ! -name &quot;finger*&quot;|xargs md5sum &gt;/$Bak_dir/$Ip_info/finger.txt</span><br><span class="line"></span><br><span class="line"># rsync backup push data info       <span class="comment">//rsync推送数据到服务端</span></span><br><span class="line">rsync -az /$Bak_dir/$Ip_info rsync_backup@172.16.1.203::backup --password-file=/etc/rsync.password</span><br></pre></td></tr></table></figure><h3 id="客户端脚本（web服务器备份脚本）"><a href="#客户端脚本（web服务器备份脚本）" class="headerlink" title="客户端脚本（web服务器备份脚本）"></a>客户端脚本（web服务器备份脚本）</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@nginx scritps]</span># cat web_bak<span class="selector-class">.sh</span></span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">Bak_dir=&quot;/backup&quot;</span><br><span class="line">Ip_info=$(hostname -i)</span><br><span class="line"></span><br><span class="line"># create dir </span><br><span class="line">mkdir -p $Bak_dir/$Ip_info</span><br><span class="line"></span><br><span class="line"># tar system file</span><br><span class="line">cd /</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">Bak_dir=&quot;/backup&quot;</span><br><span class="line">Ip_info=$(hostname -i)</span><br><span class="line"></span><br><span class="line"># create dir </span><br><span class="line">mkdir -p $Bak_dir/$Ip_info</span><br><span class="line"></span><br><span class="line"># tar system file</span><br><span class="line">tar -cPhf /$Bak_dir/$Ip_info/web_backup.tar.gz_$(date +%F-week%w) /usr/share/nginx/html</span><br><span class="line">tar -cPhf /$Bak_dir/$Ip_info/log_backup.tar.gz_$(date +%F-week%w) /var/log/nginx</span><br><span class="line"></span><br><span class="line"># <span class="selector-tag">del</span> 7 ago data info</span><br><span class="line">find /$Bak_dir/$Ip_info -type f -mtime +7|xargs rm -f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"># create finger file</span><br><span class="line">find /$Bak_dir/$Ip_info -type f -mtime -1 ! -name &quot;finger*&quot;|xargs md5sum &gt;/$Bak_dir/$Ip_info/finger.txt</span><br><span class="line"></span><br><span class="line"># rsync backup push data info</span><br><span class="line">rsync -az /$Bak_dir/$Ip_info rsync_backup@172.16.1.203::backup --password-file=/etc/rsync.password</span><br></pre></td></tr></table></figure><h3 id="备份服务器端脚本"><a href="#备份服务器端脚本" class="headerlink" title="备份服务器端脚本"></a>备份服务器端脚本</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@rsync /server/scripts]</span># cat server<span class="selector-class">.sh</span> </span><br><span class="line">#!/bin/bash</span><br><span class="line"><span class="comment">//保留每个星期天的数据，将180天以前的数据删除</span></span><br><span class="line"># The server hold back each week 7 data info and hold back 6 months data info</span><br><span class="line">find /backup -type f -mtime +180 ! -name &quot;*week7&quot; 2&gt;/dev/null </span><br><span class="line"></span><br><span class="line"># check finger info      <span class="comment">//校验指纹信息</span></span><br><span class="line">find /backup -type f -name &quot;finger*&quot;|xargs md5sum -c &amp;&gt;/tmp/check.txt</span><br><span class="line"></span><br><span class="line"># send mail in for myself qq-mail <span class="comment">//发送邮件到自己邮箱</span></span><br><span class="line">mail -s &quot;check backup info for $(date +%F)&quot; QQ邮箱账号 &lt;/tmp/check.txt</span><br></pre></td></tr></table></figure><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117224002.png"></p><h2 id="实现定时全网数据备份（定制任务）"><a href="#实现定时全网数据备份（定制任务）" class="headerlink" title="实现定时全网数据备份（定制任务）"></a>实现定时全网数据备份（定制任务）</h2><h3 id="客户端定时任务"><a href="#客户端定时任务" class="headerlink" title="客户端定时任务"></a>客户端定时任务</h3><blockquote><p>//nfs服务器</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;$ crontab -e</span><br><span class="line">&gt;# backup data</span><br><span class="line">&gt;0 0 * * * /bin/sh /server/scripts/bak.sh</span><br></pre></td></tr></table></figure><p>//web服务器</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;$ crontab -e</span><br><span class="line">&gt;# backup data</span><br><span class="line">&gt;0 0 * * * /bin/sh /server/scripts/web_bak.sh</span><br></pre></td></tr></table></figure></blockquote><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -e</span><br><span class="line"># check backup data</span><br><span class="line">0 5 * * * /bin/sh /server/scripts/server.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsync </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos6克隆问题</title>
      <link href="2021/01/17/Centos6%E5%85%8B%E9%9A%86%E9%97%AE%E9%A2%98/"/>
      <url>2021/01/17/Centos6%E5%85%8B%E9%9A%86%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS6的克隆问题"><a href="#CentOS6的克隆问题" class="headerlink" title="CentOS6的克隆问题"></a>CentOS6的克隆问题</h1><h2 id="使用VMware克隆新的虚拟机，网络无法访问"><a href="#使用VMware克隆新的虚拟机，网络无法访问" class="headerlink" title="使用VMware克隆新的虚拟机，网络无法访问"></a>使用VMware克隆新的虚拟机，网络无法访问</h2><p><strong>使用VMware软件对Centos6进行克隆虚拟机后，网络无法访问和启动，Centos7中不会出现这种情况</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214941.png"></p><blockquote><p><strong>主要原因是：克隆后产生了重复的网卡信息</strong></p></blockquote><h2 id="解决的办法"><a href="#解决的办法" class="headerlink" title="解决的办法"></a>解决的办法</h2><p><strong>1. 使用ip address查看克隆后的网卡名称，这里显示的是eth2</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215005.png"></p><p><strong>2. 修改/etc/udev/rules.d/70-persistent-net.rules文件内容</strong></p><blockquote><ol><li>克隆后会在/etc/udev/rules.d/70-persistent-net.rules文件中会多出1行网卡信</li><li>先查看没有克隆的70-persistent-net.rules文件，会有两个网卡名称，eth0和eth1</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117220734.png"></p><p><strong>再查看克隆过后的70-persistent-net.rules文件，多出了一个eth2</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215057.png"></p><p><strong>在克隆的虚拟机上删除名称为eth0的行，然后将名称为eth2行修改eth0,保存并退出<br> 名称为eth1行的继续保留</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215106.png"></p><p><strong>3. 修改配置文件/etc/sysconfig/network-scripts/ifcfg-eth0</strong></p><blockquote><p>修改的物理(MAC)地址要于之前在70-persistent-net.rules文件修改为eth0地址物理(MAC)地址一致. ip地址也要改变，其余可以默认不设置</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215138.png"></p><p><strong>4. reboot重启Linux服务让其加载修改的文件，之后重启network</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ reboot</span><br><span class="line">$ systemctl restart network</span><br></pre></td></tr></table></figure><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215200.png"></p><blockquote><p><strong>获取ip地址成功</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7安装</title>
      <link href="2021/01/17/Centos7%E5%AE%89%E8%A3%85/"/>
      <url>2021/01/17/Centos7%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS7安装"><a href="#CentOS7安装" class="headerlink" title="CentOS7安装"></a>CentOS7安装</h1><h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213949.png"></p><h2 id="VMware软件安装"><a href="#VMware软件安装" class="headerlink" title="VMware软件安装"></a>VMware软件安装</h2><p><strong>1. 第一步新建一个虚拟机</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214040.png"></p><p><strong>2. 选择自定模式</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214051.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214059.png"></p><p><strong>3. 选择稍后安装操作系统</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214111.png"></p><p><strong>4. 选择Linux操作系统，CentOS7版本</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214122.png"></p><p><strong>5. 设置名称及路径</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214132.png"></p><p><strong>6. 设置CPU，内存，网络，I/O类型，磁盘类型，创建磁盘，磁盘容量，指定磁盘文件（全部选择默认下一步）</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214141.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117221704.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117221657.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214156.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214204.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214209.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214215.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214222.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214227.png"></p><h2 id="创建之后，选择编辑虚拟机设置，放置ISO镜像"><a href="#创建之后，选择编辑虚拟机设置，放置ISO镜像" class="headerlink" title="创建之后，选择编辑虚拟机设置，放置ISO镜像"></a>创建之后，选择编辑虚拟机设置，放置ISO镜像</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214240.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214244.png"></p><h2 id="开启虚拟机安装"><a href="#开启虚拟机安装" class="headerlink" title="开启虚拟机安装"></a>开启虚拟机安装</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214256.png"></p><p><strong>1. 进入到第一个安装页面</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214305.png"></p><blockquote><ul><li>第一行表示：安装CentOS7，选择第一个即可</li><li>第二行表示：测试光盘镜像并安装系统（这个我们都不用光盘了，所以不会选择这个）</li><li>第三行表示：排错模式（修复系统，比如重置系统密码）</li></ul><ul><li>补充：CentOS7的网卡名称和之前CentOS6的网卡名称不一致，（CentOS6网卡名称为eth0开头）CentOS7为ens33开头。而大部分企业服务器都是eth0开头，如果想早点适应企业服务器使用的网卡名称，可该名为eth0(按键盘上tab键—&gt;把光标移到下面一行—&gt;输入命令：net.ifnames=0 bisodevname-0，然后回车，进入安装</li></ul></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214419.png"></p><p><strong>2. 第二个页面，选择语言，默认选择英文，也可选择中文（建议选择英文）</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214431.png"></p><p><strong>3. 第三个页面</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214440.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214446.png"></p><p><strong>4. 设置网络和主机名（NETWORK&amp;HOSTNAME）</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117222532.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214504.png"></p><p><strong>5. 选择Ipv4 Settings进行设置地址</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214513.png"></p><p><strong>6. 设置KDUMP</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214525.png"></p><p><strong>7. 设置SECURITY POLICY</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214534.png"></p><p><strong>8. 设置分区（INSTALLA TION DESTINA TION）</strong></p><blockquote><p><strong>如果懒的分区，可以直接选择自动分区（则忽略下面手动分区的内容），如果对分区有要求的可以看下面的手动分区</strong></p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214608.png"></p><p><strong>9. 手动分区</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214616.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214620.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214625.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214630.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214634.png"></p><p><strong>10. 设置软件选择(SOFTWARE SELECTION)</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214646.png"></p><p><strong>11. 设置时钟（DATE&amp;TIME）</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214654.png"></p><p><strong>12. 全部完成，点击下一步</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214701.png"></p><p><strong>13. 第四个画面，设置root密码和普通用户账户密码</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214709.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214713.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214719.png"></p><p><strong>14. 等待安装完成之后点击重启</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214727.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214731.png"></p><p><strong>15. 进入到centos7最小化安装画面（不带桌面），如果选择桌面版，则在第10步选择带桌面的安装，现在输入账户密码就可以操作系统了</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117214741.png"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SecureCRT安装与配置方案</title>
      <link href="2021/01/17/SecureCRT%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88/"/>
      <url>2021/01/17/SecureCRT%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="SecureCRT加载配色方案"><a href="#SecureCRT加载配色方案" class="headerlink" title="SecureCRT加载配色方案"></a>SecureCRT加载配色方案</h1><h2 id="SecureCRT工具包"><a href="#SecureCRT工具包" class="headerlink" title="SecureCRT工具包"></a>SecureCRT工具包</h2><p>链接：<a href="https://pan.baidu.com/s/15QQSfZyknRga7F2uN3i3ww">https://pan.baidu.com/s/15QQSfZyknRga7F2uN3i3ww</a><br>提取码：n13b</p><h2 id="安装CRT软件"><a href="#安装CRT软件" class="headerlink" title="安装CRT软件"></a>安装CRT软件</h2><p><strong>注意:需要关闭主机上安全措施或其他安全软件，如360等</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212535.png"></p><p><strong>开始安装</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212634.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117221253.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117221258.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212651.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212717.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212722.png"></p><p><strong>等待</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212736.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212742.png"></p><h2 id="打开密钥生成器keygen"><a href="#打开密钥生成器keygen" class="headerlink" title="打开密钥生成器keygen"></a>打开密钥生成器keygen</h2><blockquote><p><strong>注意：打开密钥生成器，需要右键使用管理员的身份打开，否则不能成功</strong></p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117212947.png"></p><p><strong>找到自己安装CRT的路径</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213003.png"></p><p><strong>复制到之前点击Patch打开的窗口</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213040.png"></p><p><strong>要显示出Patch has been done successfuily!，才算成功</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213058.png"></p><p><strong>点击确定之后，选择LicenseHelper，然后打开</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213113.png"></p><p><strong>再次显示出Patch has been done successfuily!，表示成功</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213128.png"></p><p><strong>打开安装好的CRT软件</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213158.png"></p><p><strong>点击ok</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213214.png"></p><p><strong>选择Enter License Data</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213229.png"></p><p><strong>选择Enter License Manually</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213251.png"></p><p><strong>将keygen中的值粘贴过去，然后点击下一步</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213308.png"></p><p><strong>同样粘贴过去，然后点击下一步</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213358.png"></p><p><strong>完成</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213358.png"></p><p><strong>会自动打开CRT界面</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213413.png"></p><h2 id="设置配色方案"><a href="#设置配色方案" class="headerlink" title="设置配色方案"></a>设置配色方案</h2><p><strong>点击Options–&gt;Global Options</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213444.png"></p><p><strong>复制CRT的配置文件路径，进入到配置文件路径</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213550.png"></p><p><strong>新建一个目录，为keywords,不能选择其他名字，否则不能成功</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213601.png"></p><p><strong>将配色脚本文件colorful-network.ini移动到keywords目录中，回到CRT的设置窗口，点击Default Session</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213619.png"></p><p><strong>点击Appearance，选择上述移动到keywords目录的配色脚本文件colorful-network</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213634.png"></p><p><strong>选择改变所有会话</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213644.png"></p><h2 id="连接一个主机"><a href="#连接一个主机" class="headerlink" title="连接一个主机"></a>连接一个主机</h2><p><strong>快速连接一个设备，连接一个主机，填写IP地址和用户</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213714.png"></p><p><strong>选择接受并保存</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213724.png"></p><p><strong>查看效果</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117213734.png"></p>]]></content>
      
      
      <categories>
          
          <category> 连接工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>xshell颜色方案</title>
      <link href="2021/01/17/xshell%E9%A2%9C%E8%89%B2%E6%96%B9%E6%A1%88/"/>
      <url>2021/01/17/xshell%E9%A2%9C%E8%89%B2%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="xshell的配置颜色方案"><a href="#xshell的配置颜色方案" class="headerlink" title="xshell的配置颜色方案"></a>xshell的配置颜色方案</h1><h2 id="xshell配置颜色设置"><a href="#xshell配置颜色设置" class="headerlink" title="xshell配置颜色设置"></a>xshell配置颜色设置</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211332.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211337.png"></p><blockquote><ol><li>将下面配色代码写入到txt文件中，保存修改后缀为.xcs<br>如：ColorForMe.xcs，然后导入到xshell中。</li></ol></blockquote><h2 id="ColorForMe配色"><a href="#ColorForMe配色" class="headerlink" title="ColorForMe配色"></a>ColorForMe配色</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[ColorForMe]</span></span><br><span class="line">text=BDB76B</span><br><span class="line">text(bold)=FFD700</span><br><span class="line">background=002B36</span><br><span class="line">red=CB4B16</span><br><span class="line">red(bold)=E14B16</span><br><span class="line">magenta=6C71C4</span><br><span class="line">magenta(bold)=7684D8</span><br><span class="line">yellow=B58900</span><br><span class="line">yellow(bold)=C99D00</span><br><span class="line">blue=268BD2</span><br><span class="line">blue(bold)=26A0D2</span><br><span class="line">cyan=2AA198</span><br><span class="line">cyan(bold)=2AB5AC</span><br><span class="line">green=639A07</span><br><span class="line">green(bold)=77AE1B</span><br><span class="line">white=eee8d5</span><br><span class="line">white(bold)=F8F2DF</span><br><span class="line">black=143F4A</span><br><span class="line">black(bold)=004954</span><br><span class="line"><span class="selector-attr">[Names]</span></span><br><span class="line">name0=ColorForMe</span><br><span class="line">count=1</span><br></pre></td></tr></table></figure><p><strong>效果展示</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211417.png"></p><h2 id="isayme配色"><a href="#isayme配色" class="headerlink" title="isayme配色"></a>isayme配色</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[isayme]</span></span><br><span class="line">text(bold)=eaeaea</span><br><span class="line">magenta(bold)=ff00ff</span><br><span class="line">text=ffffff</span><br><span class="line">white(bold)=eaeaea</span><br><span class="line">green=00c000</span><br><span class="line">red(bold)=d20000</span><br><span class="line">green(bold)=00ff00</span><br><span class="line">black(bold)=808080</span><br><span class="line">red=c00000</span><br><span class="line">blue=113fcc</span><br><span class="line">black=000000</span><br><span class="line">blue(bold)=0080ff</span><br><span class="line">yellow(bold)=ffff00</span><br><span class="line">cyan(bold)=00ffff</span><br><span class="line">yellow=c0c000</span><br><span class="line">magenta=c000c0</span><br><span class="line">background=222222</span><br><span class="line">white=c0c0c0</span><br><span class="line">cyan=00c0c0</span><br><span class="line"><span class="selector-attr">[Names]</span></span><br><span class="line">count=1</span><br><span class="line">name0=isayme</span><br></pre></td></tr></table></figure><p><strong>效果展示</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211436.png"></p><h2 id="Solarized-Dark配色"><a href="#Solarized-Dark配色" class="headerlink" title="Solarized Dark配色"></a>Solarized Dark配色</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[Solarized Dark]</span></span><br><span class="line">text=839496</span><br><span class="line">cyan(bold)=93a1a1</span><br><span class="line">text(bold)=408080</span><br><span class="line">magenta=dd3682</span><br><span class="line">green=859900</span><br><span class="line">green(bold)=586e75</span><br><span class="line">background=042028</span><br><span class="line">cyan=2aa198</span><br><span class="line">red(bold)=cb4b16</span><br><span class="line">yellow=b58900</span><br><span class="line">magenta(bold)=6c71c4</span><br><span class="line">yellow(bold)=657b83</span><br><span class="line">red=808000</span><br><span class="line">white=eee8d5</span><br><span class="line">blue(bold)=8080ff</span><br><span class="line">white(bold)=fdf6e3</span><br><span class="line">black=002b36</span><br><span class="line">blue=268bd2</span><br><span class="line">black(bold)=073642</span><br><span class="line"><span class="selector-attr">[Names]</span></span><br><span class="line">name0=Solarized Dark</span><br><span class="line">count=1</span><br></pre></td></tr></table></figure><p><strong>效果展示</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211458.png"></p><h2 id="SolarizedDarkModify配色"><a href="#SolarizedDarkModify配色" class="headerlink" title="SolarizedDarkModify配色"></a>SolarizedDarkModify配色</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[SolarizedDarkModify]</span></span><br><span class="line">text=839496</span><br><span class="line">cyan(bold)=00ffff</span><br><span class="line">text(bold)=e9e9e9</span><br><span class="line">magenta=c000c0</span><br><span class="line">green=80ff00</span><br><span class="line">green(bold)=3c5a38</span><br><span class="line">background=042028</span><br><span class="line">cyan=00c0c0</span><br><span class="line">red(bold)=ff0000</span><br><span class="line">yellow=c0c000</span><br><span class="line">magenta(bold)=ff00ff</span><br><span class="line">yellow(bold)=ffff00</span><br><span class="line">red=ff4500</span><br><span class="line">white=c0c0c0</span><br><span class="line">blue(bold)=1e90ff</span><br><span class="line">white(bold)=fdf6e3</span><br><span class="line">black=000000</span><br><span class="line">blue=00bfff</span><br><span class="line">black(bold)=808080</span><br><span class="line"><span class="selector-attr">[Names]</span></span><br><span class="line">name0=SolarizedDarkModify</span><br><span class="line">count=1</span><br></pre></td></tr></table></figure><p><strong>效果展示</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211518.png"></p>]]></content>
      
      
      <categories>
          
          <category> 连接工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xshell设置</title>
      <link href="2021/01/17/xshell%E8%AE%BE%E7%BD%AE/"/>
      <url>2021/01/17/xshell%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="xshell安装及优化"><a href="#xshell安装及优化" class="headerlink" title="xshell安装及优化"></a>xshell安装及优化</h1><h2 id="xshll版本说明"><a href="#xshll版本说明" class="headerlink" title="xshll版本说明"></a>xshll版本说明</h2><p><strong>xshell5：</strong>一个进程可以打开多个窗口，没有背景设置<br><strong>xshell6：</strong>一个进程只能打开四个窗口，有背景设置</p><h2 id="xshell安装步骤"><a href="#xshell安装步骤" class="headerlink" title="xshell安装步骤"></a>xshell安装步骤</h2><p>…………..省略</p><h2 id="xshell配置"><a href="#xshell配置" class="headerlink" title="xshell配置"></a>xshell配置</h2><h3 id="xshell属性设置"><a href="#xshell属性设置" class="headerlink" title="xshell属性设置"></a>xshell属性设置</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210251.jpeg"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210431.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210443.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210454.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210503.png"></p><h3 id="xshell选项设置"><a href="#xshell选项设置" class="headerlink" title="xshell选项设置"></a>xshell选项设置</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210517.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210601.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210615.png"></p><h3 id="xshell新建连接"><a href="#xshell新建连接" class="headerlink" title="xshell新建连接"></a>xshell新建连接</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210627.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210642.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210650.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210702.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117220916.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117215948.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211051.jpeg"></p><h3 id="xhsell的透明模式设置"><a href="#xhsell的透明模式设置" class="headerlink" title="xhsell的透明模式设置"></a>xhsell的透明模式设置</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211056.jpeg"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211102.jpeg"></p><h3 id="xshell-6设置背景图片"><a href="#xshell-6设置背景图片" class="headerlink" title="xshell-6设置背景图片"></a>xshell-6设置背景图片</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117210251.jpeg"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117211115.jpeg"></p>]]></content>
      
      
      <categories>
          
          <category> 连接工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据通信基本原理</title>
      <link href="2021/01/17/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="数据通信基本原理"><a href="#数据通信基本原理" class="headerlink" title="数据通信基本原理"></a>数据通信基本原理</h1><h2 id="什么是网络协议？"><a href="#什么是网络协议？" class="headerlink" title="什么是网络协议？"></a>什么是网络协议？</h2><blockquote><ol><li>网络协议为计算机网络中进行数据交换而建立的规则\标准或约定的集合,它规定了通信时信息必须采用的格式和这些格式所代表的意义. 网络协议使网络上各种设备能够相互交换信息</li><li>网络中存在着许多协议,接收方和发送方使用的协议必须一致,否则一方将无法识别一方发出的信息</li></ol></blockquote><h2 id="OSI参考模型"><a href="#OSI参考模型" class="headerlink" title="OSI参考模型"></a>OSI参考模型</h2><blockquote><ol><li>ISO：国际标准化组织（International Organization for Standardization）</li><li>OSI：开放系统互联（open system interconnection）20世纪70年代后期,ISO创建OSI参考模型,希望不同供应商的网络能够相互协同工作</li><li>OSI：模型分为七层,由下到上分别为物理层,数据链路层,网络层,传输层,会话层,表示层和应用层</li><li>OSI：模型目的是为了使两个不同的系统能够较容易地通信,而不需要改变底层的硬件或软件的逻辑. 5. OSI模型并不是协议,它是个灵活的\稳健的和可互操作的模型,用来了解和设计网络体系结构.</li></ol></blockquote><h2 id="OSI参考模型体系结构"><a href="#OSI参考模型体系结构" class="headerlink" title="OSI参考模型体系结构"></a>OSI参考模型体系结构</h2><blockquote><ol><li>OSI模型每层都有自己的功能集</li><li>层与层之间相互独立又相互依靠</li><li>上层依赖于下层,下层为上层提供服务</li></ol></blockquote><blockquote><ol><li>应用层作用：<br>  为应用软件提供接口,是应用程序能够使用网络服务<br>  常见的应用层协议：HTTP（80）,FTP（20,21）,SMTP（25）,POP3（110）,Telnet（23）.SSH（22）,DNS（53）等等.</li><li>表示层的作用：<br>  数据的解码和编码<br>  数据的加密和解密<br>  数据的压缩和解压缩</li><li>会话层的作用：<br>  建立\维护\管理应用程序之间的会话</li><li>传出层的作用：<br>  负责建立端到端的连接,保证报文在端到端之间的传输.<br>  功能：服务端编址\分段与重组\连接控制\流量控制\差错控制</li><li>网络层的作用：<br>  负责将分组数据从源端传到到目的端<br>  功能：为网络设备提供逻辑地址（IP）进行路由选路,分组转发</li><li>数据链路层的作用：<br>  在不可靠的物理链路上,提供可靠的数据传输服务,把帧从一跳（结点）移动到另一跳（结点）<br>  功能：组帧\物理编址\流量控制\差错控制\接入控制</li><li>物理层的作用：<br>  负责把逐个比特流从一跳（结点）移动另一端（结点）<br>  功能：定义接口和媒体的物理特性; 定义比特的表示\数据传输速率\信号传输模式（单工\半双工\全双工）; 定义网络物理拓扑（网状\星型\环型\总线型等拓扑）</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204940.png"></p><h2 id="OSI七层通讯原理"><a href="#OSI七层通讯原理" class="headerlink" title="OSI七层通讯原理"></a>OSI七层通讯原理</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204951.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204956.png"></p><p><strong>封装每一层都把上层的协议包当成数据部分,加上自己的协议头部,组成自己的协议包</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205101.png"></p><h2 id="PDU（协议数据单元）"><a href="#PDU（协议数据单元）" class="headerlink" title="PDU（协议数据单元）"></a>PDU（协议数据单元）</h2><blockquote><ol><li>PDU(protocol data unit):每一层使用自己层的协议和别的系统对应层相互通信,协议层的协议在对等层之间交换的信息叫协议数据单元<ul><li>上层：message（数据）</li><li>Transport layer：segment（段）</li><li>Network layer：packet（包）</li><li>Data-link layer：Frame（帧）</li><li>Physical layer：bit（比特）</li></ul></li></ol></blockquote><h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><p><strong>物理层标准规定了信号\连接器和电缆要求</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205236.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205242.png"></p><h3 id="物理层设备"><a href="#物理层设备" class="headerlink" title="物理层设备"></a>物理层设备</h3><p><strong>物理层设备-集线器</strong></p><blockquote><ol><li>所有的设备在同一冲突域（collision domain）</li><li>所有的设备都在同一广播域（broadcast domain）</li><li>设备共享宽带</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205301.png"></p><p><strong>终端越多冲突（域）就越大</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205324.png"></p><p><strong>冲突过程</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205333.png"></p><blockquote><p>情况是PCA和PCC都要发送数据,两个刚才都检测到HUB上是空闲的,所以都发送了数据,结果产生了冲突,两人都同时启动BACK OFF（让步）动作,随机的生成一个秒数,等待再发数据包,如果再与其他PC发送的数据包冲突,那么再次进入BACK OFF,BACK OFF一共可以进行15次</p></blockquote><h3 id="CSMA-CD技术"><a href="#CSMA-CD技术" class="headerlink" title="CSMA/CD技术"></a>CSMA/CD技术</h3><blockquote><p>载波侦听多路访问/冲突检测CSMA/CD（carrier sense multiple access/collision detect）:一种介质访问的控制方法,当在同一共享网络中的不同结点同时传送数据包时,不可避免的会产生冲突,而CSMA/CD机制就是用来解决这种中途问题</p></blockquote><p><strong>CSMA/CD工作原理</strong></p><blockquote><p>当一个节点在网络中发送数据时,它首先检查线路上是否有其他主机的信号在传送：如果有,说明其他主机在发送数据,自己则利用退避算法等一会在试图发送；如果线路上没有其他主机的信号,将把自己的数据发送出去,同时不停的监听线路,已确信其他主机没有发送数据,如果检测到有其他信息,自己就发送一个JAM(阻塞)信号,通知网段上的其他节点停止发送数据,这使,其他节点也必须采用退避算法等一会再试图发送</p><p><strong><code>总结:先听后发，边听边发，冲突停发，随机延迟后重发</code></strong></p></blockquote><p><strong>CSMA/CD重要特性</strong></p><blockquote><ul><li>使用CSMA/CD协议的以太网不能进行全双工通信而只能进行双向交替通信（半双工通信）每个站在发送数据之后的一小段时间内,存在着遭遇碰撞的可能性</li><li>集线器（HUB）–10M以太网：半双工通信</li><li>交换机—100M以太网：全双工通信</li></ul></blockquote><h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h2><p><strong>数据链路层功能</strong></p><blockquote><p>数据链路层通常拆分成两个子层：上子层和下子层</p><ol><li>逻辑链路层</li><li>介质访问控制</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205529.png"></p><p><strong>数据链路层-创建帧</strong></p><blockquote><p>数据链路层帧格式：</p><ol><li>IEEE assigned：电气和电子工程师协会分配前32位</li><li>供应商 assigned：其余的32位由供应商分配</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205555.png"></p><p><strong>数据链路层设备–网络适配器</strong></p><blockquote><ol><li>网络适配器（网卡）<ul><li>网络适配器属于数据链路层设备</li></ul></li><li>MAC地址<ul><li>每个网卡芯片都会烧录一个全球唯一的MAC地址</li></ul></li><li>网卡速率<ul><li> 10\100\1000M自适应</li></ul></li><li>双工模式<ul><li>支持全双工\半双工\自适应</li></ul></li><li>每个接口都有自己的冲突域</li><li>所有的接口都在同一个广播域</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205655.png"></p><h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><p><strong>网络层数功能</strong></p><blockquote><p>网络层（从主机到主机的通信）</p><ol><li>为每个终端设备之间通过网络交换数据的片段提供服务</li><li>基本工程：编址，封装，路由，解封装</li><li>协议：IPv4，IPv6，AppleTalk，IPX等.</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205734.png"></p><h3 id="IP报文"><a href="#IP报文" class="headerlink" title="IP报文"></a>IP报文</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117205813.png"></p><blockquote><ol><li>版本：IP协议的版本，目前的IP协议版本号为4，下一代IP协议版本号为6。</li><li>首部长度：IP报头的长度。固定部分的长度（20字节）和可变部分的长度之和。共占4位。最大为1111，即10进制的15，代表IP报头的最大长度可以为15个32bits（4字节），也就是最长可为15*4=60字节，除去固定部分的长度20字节，可变部分的长度最大为40字节。</li><li>服务类型（TOS）：Type Of Service,只有在有QoS差分服务要求时这个字段才起作用。</li><li>总长度：IP报文的总长度。报头的长度和数据部分的长度之和。</li><li>身份标识：唯一的标识主机发送的每一分数据报。通常每发送一个报文，它的值加一。当IP报文长度超过传输网络的MTU（最大传输单元）时必须分片，这个标识字段的值被复制到所有数据分片的标识字段中，使得这些分片在达到最终目的地时可以依照标识字段的内容重新组成原先的数据。</li><li>标志：共3位。R、DF、MF三位。目前只有后两位有效，DF位：为1表示不分片，为0表示分片。MF：为1表示“更多的片”，为0表示这是最后一片。</li><li>片位移：本分片在原先数据报文中相对首位的偏移位。（需要再乘以8）</li><li>生存时间（TTL）：IP报文所允许通过的路由器的最大数量。每经过一个路由器，TTL减1，当为0时，路由器将该数据报丢弃。TTL 字段是由发送端初始设置一个 8 bit字段.推荐的初始值由分配数字 RFC 指定，当前值为 64。发送 ICMP 回显应答时经常把 TTL 设为最大值 255。</li><li>协议号：指出IP报文携带的数据使用的是那种协议，以便目的主机的IP层能知道要将数据报上交到哪个进程（不同的协议有专门不同的进程处理）。和端口号类似，此处采用协议号，TCP的协议号为6，UDP的协议号为17。ICMP的协议号为1，IGMP的协议号为2.</li><li>校验和：计算IP头部的校验和，检查IP报头的完整性。</li><li>源IP地址：标识IP数据报的源端设备。</li><li>目的IP地址：标识IP数据报的目的地址。</li><li>Options (其他参数)，这个是额外的功能，提供包括安全处理机制、路由纪录、时间戳、严格与宽松之来源路由等。</li><li>Padding(补齐项目)Options和Padding一共有32位，由于Options字段不是固定的，所以需要Padding 字段来加以补齐</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ARP实验</title>
      <link href="2021/01/17/ARP%E5%AE%9E%E9%AA%8C/"/>
      <url>2021/01/17/ARP%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="ARP实验"><a href="#ARP实验" class="headerlink" title="ARP实验"></a>ARP实验</h1><h2 id="ARP代理"><a href="#ARP代理" class="headerlink" title="ARP代理"></a>ARP代理</h2><p>proxy ARP就是通过使用一个主机（通常为router），来作为指定的设备对另一设备的ARP请求作出应答</p><h2 id="ARP代理实验"><a href="#ARP代理实验" class="headerlink" title="ARP代理实验"></a>ARP代理实验</h2><p><strong>如图</strong>：有三台路由器，其中两台路由器充当主机，R5不设置网关，通过R6的代理ARP实现能够访问R7</p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203248.png"></p><h3 id="路由器充当主机的命令为"><a href="#路由器充当主机的命令为" class="headerlink" title="路由器充当主机的命令为"></a>路由器充当主机的命令为</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">R5：</span><br><span class="line">  R5(config)<span class="selector-id">#no</span> ip routing <span class="comment">//关闭路由功能</span></span><br><span class="line"></span><br><span class="line">R7：</span><br><span class="line">  R7(config)<span class="selector-id">#no</span> ip routing <span class="comment">//关闭路由功能</span></span><br><span class="line">  R7(config)<span class="selector-id">#ip</span> default-gateway 172<span class="selector-class">.16</span><span class="selector-class">.2</span><span class="selector-class">.254</span>  <span class="comment">//设置网关</span></span><br></pre></td></tr></table></figure><h3 id="配置完之后，查看是没有路由的"><a href="#配置完之后，查看是没有路由的" class="headerlink" title="配置完之后，查看是没有路由的"></a>配置完之后，查看是没有路由的</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203316.png"></p><h3 id="R6配置"><a href="#R6配置" class="headerlink" title="R6配置"></a>R6配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/0</span><br><span class="line"> ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.2</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"><span class="comment">//默认情况下，路由器是开启代理ARP的，所以R6无须设置其他命令，只需要配置IP地址</span></span><br><span class="line"> #开启ARP命令为R6(config-if)<span class="selector-id">#ip</span> proxy-arp</span><br><span class="line"> #关闭ARP命令为R6(config-if)<span class="selector-id">#no</span> ip proxy-arp</span><br></pre></td></tr></table></figure><h3 id="使用wireshark抓包查看"><a href="#使用wireshark抓包查看" class="headerlink" title="使用wireshark抓包查看"></a>使用wireshark抓包查看</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203354.png"></p><p><strong>请求过程</strong></p><blockquote><p>以自己的源地址172.16.1.2和源MAC地址aa:bb:cc:00:50:00，目的地址为172.16.2.1，MAC地址为00:00:00:00:00:00的ARP广播请求发送给路由器，路由收到了该广播ARP，但是路由器默认不会转发广播的，所以该ARP请求仍然到达不了R7，但是路由器却知道R7位于另外一个子网172.16.2.0，于是路由器应答自己的MAC地址给R5</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203414.png"></p><p><strong>响应过程</strong></p><blockquote><p>包含了源地址地址172.16.2.1，源MAC地址是路由器aa:bb:cc:00:60:00，目的地址172.16.1.1，MAC地址aa:bb:cc:00:50:00，R5接受这个包之后，会将R7的MAC地址缓存在自己的ARP表中，如果再次发送请求，就不需要路由器进行转发，因为R5知道了怎么到达R7。</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203428.png"></p><h3 id="代理ARP的优点"><a href="#代理ARP的优点" class="headerlink" title="代理ARP的优点"></a>代理ARP的优点</h3><blockquote><ol><li>代理ARP的主要优点是它可以添加到网络上的单个路由器，而不会干扰网络上其他路由器的路由表</li><li>如果IP主机没有配置默认网关，或者没有任何路由智能功能，则必须在网络中使用代理ARP。</li></ol></blockquote><h3 id="代理ARP的缺点"><a href="#代理ARP的缺点" class="headerlink" title="代理ARP的缺点"></a>代理ARP的缺点</h3><blockquote><ol><li>它增加了网段中的ARP流量</li><li>主机需要更大的ARP表才能处理IP到MAC地址的映射</li><li>安全性可能遭到破坏。比如APR欺骗</li><li>它不适用于不使用 ARP 进行地址解析的网络。</li><li>不能够概括和推广网络拓扑</li></ol></blockquote><h2 id="免费ARP"><a href="#免费ARP" class="headerlink" title="免费ARP"></a>免费ARP</h2><h3 id="免费ARP基本概念"><a href="#免费ARP基本概念" class="headerlink" title="免费ARP基本概念"></a>免费ARP基本概念</h3><blockquote><ol><li>免费ARP，也叫Gratutious ARP,无故ARP。这种ARP不同于一般的ARP请求，它的Sender IP和Target IP字段是相同的，相当于是请求自己的IP地址对应的MAC地址</li><li>发送免费ARP的主机或者设备，往往并不希望收到一个ARP应答，因为若是收到了，说明网络上有人使用相同的IP，这回照成IP冲突。</li></ol></blockquote><h3 id="免费ARP的作用"><a href="#免费ARP的作用" class="headerlink" title="免费ARP的作用"></a>免费ARP的作用</h3><blockquote><p>免费ARP数据包有以下3个作用：</p><ol><li>该类型报文起到一个宣告作用， 它以广播的形式将数据包发送出去，不需要得到回应，只为了告诉其他计算机自己的IP地址和MAC地址。</li><li>可用于检测IP地址冲突。 当一台主机发送了免费ARP请求报文后，如果收到了ARP响应，则说明网络已经存在使用该IP地址的主机。</li><li>可用于更新其他主机的ARP缓存。 如果该主机更换了网卡，而其他主机的ARP缓存表仍然保留着原来的MAC地址，这时，可以发送免费ARP数据包。其他主机收到该数据包后，将更新ARP缓存表，将原来的MAC地址天魂为新的MAC地址。</li></ol></blockquote><h2 id="免费APR实验"><a href="#免费APR实验" class="headerlink" title="免费APR实验"></a>免费APR实验</h2><p><strong>如图</strong>：核心交换机搭建了一个DHCP服务，接入层交换机作为中继，主机win-xp和主机（路由器）通过中继获取DHCP参数（IP地址，网关，DNS）</p><blockquote><p><strong>注：该实验需要懂DHCP原理</strong></p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203612.png"></p><h3 id="核心层配置"><a href="#核心层配置" class="headerlink" title="核心层配置"></a>核心层配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启DHCP服务功能</span></span><br><span class="line">Switch1(config)<span class="selector-id">#service</span> dhcp</span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置dhcp地址池</span></span><br><span class="line">ip dhcp pool vlan10</span><br><span class="line"> network 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> default-router 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> dns-server 8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置核心层与汇聚层互连ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置核心层至汇聚设备用户网段的静态路由</span></span><br><span class="line">ip route 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure><h3 id="汇聚层配置"><a href="#汇聚层配置" class="headerlink" title="汇聚层配置"></a>汇聚层配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启汇聚交换机的DHCP服务功能</span></span><br><span class="line">S2(config)<span class="selector-id">#service</span> dhcp</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置vlan及vlan 10的ip地址（用户网关的地址）</span></span><br><span class="line">Switch1(config-if)<span class="selector-id">#vlan</span> 10</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置汇聚层与核心层互连的ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//划分两台终端至vlan10</span></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/2</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置汇聚层到外网的默认路由</span></span><br><span class="line">ip route 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span> 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//开启汇聚层DHCP relay功能,该地址需要是核心交换机的IP地址，并且路由可达.</span></span><br><span class="line">S2(config)<span class="selector-id">#in</span> vlan 10</span><br><span class="line">S2(config-if)<span class="selector-id">#ip</span> helper-<span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> #接口下开启（推荐）</span><br><span class="line">S2(config)<span class="selector-id">#ip</span> helper-<span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> #全局下开启</span><br></pre></td></tr></table></figure><h3 id="配置win-xp主机地址自动获取"><a href="#配置win-xp主机地址自动获取" class="headerlink" title="配置win-xp主机地址自动获取"></a>配置win-xp主机地址自动获取</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203711.png"></p><h3 id="使用wireshark抓取获取免费ARP包"><a href="#使用wireshark抓取获取免费ARP包" class="headerlink" title="使用wireshark抓取获取免费ARP包"></a>使用wireshark抓取获取免费ARP包</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203736.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203740.png"></p><blockquote><ol><li>当主机win-xp通过收到DHCP回复的ACK，还不会立即拥有地址，而是等DHCP服务通过发送免费ARP广播给其他主机，确定这个IP是否在其他主机上使用，如果没有人回复免费ARP，则win-xp主机才能拥有这个地址。免费ARP不会连续发送，而是发送一个之后，没有人回复才会继续发送免费ARP，默认请求发送完4个免费ARP报文则说明这个ip地址是有效的。</li><li>当DHCP发送免费ARP时，如果有人立刻回复了免费ARP报文，则判断这个IP地址是冲突的，如下图显示</li></ol></blockquote><h3 id="win-xp和主机（路由器）冲突现象"><a href="#win-xp和主机（路由器）冲突现象" class="headerlink" title="win-xp和主机（路由器）冲突现象"></a>win-xp和主机（路由器）冲突现象</h3><p><strong>查看主机获取了什么ip地址</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203813.png"></p><p><strong>win-xp获取了192.168.1.4，我们在路由器上也配置192.168.1.4的地址，然后查看现象</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R1(config-if)<span class="selector-id">#ip</span> add 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.4</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br></pre></td></tr></table></figure><p><strong>win-xp显示ip地址冲突</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203844.png"></p><blockquote><p><strong>当路由器配置完地址之后，立即回复ARP响应，说明ARP地址已经冲突</strong></p></blockquote><p><strong>wireshark抓取的免费ARP</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203909.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117203914.png"></p><h3 id="免费ARP问题"><a href="#免费ARP问题" class="headerlink" title="免费ARP问题"></a>免费ARP问题</h3><blockquote><p>问题1：如何判断一个ARP报文是一个免费ARP报文？<br>问题2：免费ARP如何判断冲突？<br>问题3：免费ARP如何判断不冲突？<br>问题4：为什么要广播回复免费ARP报文？</p><p>答1：查看ARP报文中的目的ip地址和源IP地址相同时，则为免费ARP报文<br>答2：当发送完免费ARP报文后收到免费ARP报文，则判断IP地址冲突，无效<br>答3：默认情况下发送4个免费ARP报文，发送完之后伟收到ARP报文，则ip地址生效<br>答4：为了刷新网络中其他主机的ARP缓存表，使其回复到正确的IP地址与MAC地址映射关系</p></blockquote><h2 id="ARP欺骗"><a href="#ARP欺骗" class="headerlink" title="ARP欺骗"></a>ARP欺骗</h2><h3 id="什么是ARP欺骗"><a href="#什么是ARP欺骗" class="headerlink" title="什么是ARP欺骗"></a>什么是ARP欺骗</h3><p>每台主机上都有一个ARP缓存表，缓存表中记录了局域网主机IP地址与MAC地址的对应关系，而局域网数据传输依靠的是MAC地址。但是并不是想象中的那么安全，在ARP缓存表机制存在一个缺陷，当请求主机win-xp收到linux-kail的ARP应答包后，就直接把这个返回包中的IP地址与MAC地址的对应关系保存到ARP缓存表中，如果原有相同IP对应关系，原有的则会被替换。</p><h2 id="实验-单向ARP欺骗"><a href="#实验-单向ARP欺骗" class="headerlink" title="实验(单向ARP欺骗)"></a>实验(单向ARP欺骗)</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204029.png"></p><p><strong>windows-xp配置IP</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204050.png"></p><p><strong>Centos6配置IP</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204103.png"></p><p><strong>kail配置IP</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204114.png"><strong>kail使用arpspoof进行攻击命令</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="keyword">@kali</span>:~# arpspoof -i eth0 -t <span class="number">10.0</span>.<span class="number">0.10</span> <span class="number">10.0</span>.<span class="number">0.2</span> </span><br><span class="line">//欺骗windows-xp主机说自己是网关，要求把数据发送给kail，然后从eth转发出去</span><br></pre></td></tr></table></figure><p><strong>kail打开多一个窗口，使用tcpdump抓取windows-xp发送过来的流量</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root<span class="keyword">@kali</span>:~# tcpdump tcp src port <span class="number">80</span> <span class="keyword">or</span> src <span class="number">10.0</span>.<span class="number">0.10</span> -i eth0 -n</span><br><span class="line">//抓取tcp协议，源端口为<span class="number">80</span>，源地址<span class="number">10.0</span>.<span class="number">0.10</span>，-i指定要侦听的网卡接口，-n不进行DNS解析</span><br><span class="line">//清楚centos的arp缓存arp -d host(主机)</span><br></pre></td></tr></table></figure><p><strong>windows-xp的http请求</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204215.png"></p><p><strong>kail抓取的流量显示</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204240.png"></p><h2 id="实验4（通过EVE-NG搭建）"><a href="#实验4（通过EVE-NG搭建）" class="headerlink" title="实验4（通过EVE-NG搭建）"></a>实验4（通过EVE-NG搭建）</h2><p><strong>如图</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204325.png"></p><p><strong>Linux以及kail创建IP地址的命令</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一种方法:</span><br><span class="line">添加命令：ip addr add <span class="number">172.16</span>.<span class="number">1</span>.x/<span class="number">24</span> dev eth0</span><br><span class="line">删除命令：ip addr add <span class="number">172.16</span>.<span class="number">1</span>.x/<span class="number">24</span> dev eth0</span><br><span class="line"></span><br><span class="line">第二种方法:</span><br><span class="line">添加命令：ifconfig eth0 <span class="number">172.16</span>.<span class="number">1</span>.x/<span class="number">24</span></span><br><span class="line">删除命令：ifconfig eth0 del <span class="number">172.16</span>.<span class="number">1.1</span> netmask <span class="number">255.255</span>.<span class="number">255.0</span></span><br></pre></td></tr></table></figure><p><strong>Linux以及kail添加路由的命令</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一种方法:</span><br><span class="line">添加路由：ip route add <span class="number">172.16</span>.<span class="number">1.1</span>/<span class="number">24</span> via <span class="number">172.16</span>.<span class="number">1.254</span> dev eth0</span><br><span class="line">删除路由：ip route del <span class="number">172.16</span>.<span class="number">1.1</span>/<span class="number">24</span> via <span class="number">172.16</span>.<span class="number">1.254</span> dev eth0</span><br><span class="line"></span><br><span class="line">第二种方法：</span><br><span class="line">添加路由：ip add -net <span class="number">172.16</span>.<span class="number">1.1</span>/<span class="number">24</span> gw <span class="number">172.16</span>.<span class="number">1.254</span></span><br><span class="line">删除路由：ip del -net <span class="number">172.16</span>.<span class="number">1.1</span>/<span class="number">24</span> gw <span class="number">172.16</span>.<span class="number">1.254</span></span><br></pre></td></tr></table></figure><p><strong>Linux-kail抓取的伪造包</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117204356.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ARP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARP协议与原理</title>
      <link href="2021/01/17/ARP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/ARP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ARP协议与原理"><a href="#ARP协议与原理" class="headerlink" title="ARP协议与原理"></a>ARP协议与原理</h1><h2 id="ARP概述"><a href="#ARP概述" class="headerlink" title="ARP概述"></a>ARP概述</h2><blockquote><ol><li>ARP是”Address Resolution Protocol”的缩写，译为”地址解析协议”，它是根据IP地址获取物理（MAC）地址的一个TCP/IP协议.</li><li>由于IP地址和MAC地址定位方式不同，ARP协议成为数据传输的必备协议，主机发送信息前，需要通过ARP协议获取目标IP地址对应的MAC地址，从而现实报文的正常封装与转发.</li></ol></blockquote><h2 id="为什么需要ARP协议"><a href="#为什么需要ARP协议" class="headerlink" title="为什么需要ARP协议"></a>为什么需要ARP协议</h2><blockquote><p>当一台网络设备要与另外一台网络通信时，必须要知道对方的IP地址。但是，仅有IP地址是不够的，因为IP数据报文必须封装成帧才能通过数据链路层进行发送，而数据帧必须要包含目的MAC地址，因此发送端还必须获取到目的MAC地址。每一个网络设备在数据封装前都需要获取下一跳的MAC地址。IP地址由网络层来提供，MAC地址数据链路层提供，通过ARP协议来获取目标设备的MAC地址，将IP地址与MAC地址进行映射，从而实现数据的可达性</p></blockquote><h2 id="ARP工作机制"><a href="#ARP工作机制" class="headerlink" title="ARP工作机制"></a>ARP工作机制</h2><p><strong>ARP工作流程分为两个阶段，一个是ARP请求过程，另一个是ARP响应过程，如图：</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117202737.png"></p><blockquote><ol><li>初始情况下，没有ARP缓存，当VPC1去pingVPC2是会广播发送一个ARP请求报文，ARP请求报文包含了VPC1的IP地址和MAC地址，目标IP地址和目标MAC地址，其中MAC地址为FF:FF:FF:FF:FF:FF</li><li>VPC2会响应这个请求，并回复给VPC1，其目的IP地址和目的MAC地址为VPC1，源地址和源MAC地址是自己</li><li>VPC1收到回复报文，会将VPC2的MAC地址缓存在自己ARP缓存表中。（默认是动态缓存，会老化）</li></ol></blockquote><p><strong>wireshark抓取的请求报文</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201908.png"></p><p><strong>wireshark抓取的响应报文</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201913.png"></p><h2 id="ARP协议报文格式"><a href="#ARP协议报文格式" class="headerlink" title="ARP协议报文格式"></a>ARP协议报文格式</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201926.png"></p><blockquote><ul><li>硬件类型字段：指明了发送方想知道的硬件接口类型，以太网的值为1；</li><li>协议类型字段：指明了发送方提供的高层协议类型，IP为0800（16进制）；</li><li>硬件地址长度和协议长度：指明了硬件地址和高层协议地址的长度，这样ARP报文就可以在任意硬件和任# # 意协议的网络中使用；</li><li>操作字段：用来表示这个报文的类型，ARP请求为1，ARP响应为2，RARP请求为3，RARP响应为4；</li><li>发送方的硬件地址（0-2字节）：源主机硬件地址的前3个字节；</li><li>发送方的硬件地址（3-5字节）：源主机硬件地址的后3个字节；</li><li>发送方IP（0-1字节）：源主机硬件地址的前2个字节；</li><li>发送方IP（2-3字节）：源主机硬件地址的后2个字节；</li><li>目的硬件地址（0-1字节）：目的主机硬件地址的前2个字节；</li><li>目的硬件地址（2-5字节）：目的主机硬件地址的后4个字节；</li><li>目的IP（0-3字节）：目的主机的IP地址。</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ARP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ICMP——ping工具</title>
      <link href="2021/01/17/ICMP%E2%80%94%E2%80%94ping%E5%B7%A5%E5%85%B7/"/>
      <url>2021/01/17/ICMP%E2%80%94%E2%80%94ping%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="ICMP——ping工具"><a href="#ICMP——ping工具" class="headerlink" title="ICMP——ping工具"></a>ICMP——ping工具</h1><h2 id="tcping工具"><a href="#tcping工具" class="headerlink" title="tcping工具"></a>tcping工具</h2><p><strong>轻便型端口连通性检测软件，方便操作与记录</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201419.png"></p><blockquote><p><strong>使用方法，将tcping.exe文件放入到C:\Windows\System32\目录下</strong></p></blockquote><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>1. tcping 10.0.0.20 3389 #ping 3306端口</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201456.png"></p><p><strong>2. tcping -d 10.0.0.20 3389 #ping3306端口并追加时间</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201506.png"></p><p><strong>3. tcping –tee C:\ping.txt -d -t 10.0.0.20 3389 #ping3306端口并保存记录</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201521.png"></p><h2 id="PinginfoView工具"><a href="#PinginfoView工具" class="headerlink" title="PinginfoView工具"></a>PinginfoView工具</h2><blockquote><p><strong>批量ping包神器，显示直观，结果保存方便</strong></p></blockquote><p><strong>打开页面，添加ip地址</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201551.png"></p><p><strong>点击确定开始ping</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201559.png"></p><p><strong>可以右键生成HTML的报告</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201606.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201611.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ICMP——tracert与traceroute</title>
      <link href="2021/01/17/ICMP%E2%80%94%E2%80%94tracert%E4%B8%8Etraceroute/"/>
      <url>2021/01/17/ICMP%E2%80%94%E2%80%94tracert%E4%B8%8Etraceroute/</url>
      
        <content type="html"><![CDATA[<h1 id="ICMP——tracert与traceroute"><a href="#ICMP——tracert与traceroute" class="headerlink" title="ICMP——tracert与traceroute"></a>ICMP——tracert与traceroute</h1><h2 id="Tracert-Traceroute介绍"><a href="#Tracert-Traceroute介绍" class="headerlink" title="Tracert/Traceroute介绍"></a>Tracert/Traceroute介绍</h2><blockquote><ol><li>Tracert与Traceroute（跟踪路由）是路由跟踪使用程序，用来确定IP数据包访问目标所经过的路径.</li><li>也是一种常用的网络故障诊断工具.</li></ol></blockquote><h2 id="tracert包回应判断故障点"><a href="#tracert包回应判断故障点" class="headerlink" title="tracert包回应判断故障点"></a>tracert包回应判断故障点</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193739.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193745.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193758.png"></p><h2 id="Tracert-Traceroute区别"><a href="#Tracert-Traceroute区别" class="headerlink" title="Tracert/Traceroute区别"></a>Tracert/Traceroute区别</h2><h3 id="traceroute是基于UDP协议"><a href="#traceroute是基于UDP协议" class="headerlink" title="traceroute是基于UDP协议"></a>traceroute是基于UDP协议</h3><blockquote><p>traceroute是向目的地址的某个端口（大于30000）发送UDP数据报文，典型的源有Linux服务器，macOS，网络设备等</p></blockquote><h4 id="traceroute通讯过程"><a href="#traceroute通讯过程" class="headerlink" title="traceroute通讯过程"></a>traceroute通讯过程</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193847.png"></p><h4 id="tracerout请求报文"><a href="#tracerout请求报文" class="headerlink" title="tracerout请求报文"></a>tracerout请求报文</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193900.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193907.png"></p><h4 id="traceroute响应报文报文"><a href="#traceroute响应报文报文" class="headerlink" title="traceroute响应报文报文"></a>traceroute响应报文报文</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193926.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117193931.png"></p><h4 id="traceroute抓取的报文"><a href="#traceroute抓取的报文" class="headerlink" title="traceroute抓取的报文"></a>traceroute抓取的报文</h4><p><strong>每个请求包会发送三次，回也是三次，所以请求和响应一共有24个包</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194017.png"></p><h3 id="Tracert是基于ICMP协议"><a href="#Tracert是基于ICMP协议" class="headerlink" title="Tracert是基于ICMP协议"></a>Tracert是基于ICMP协议</h3><blockquote><p>tracert向目的地址发送ICMP请求回显数据包，典型的代表是Windows设备</p></blockquote><h4 id="tracert通讯过程"><a href="#tracert通讯过程" class="headerlink" title="tracert通讯过程"></a>tracert通讯过程</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194138.png"></p><h4 id="tracert请求报文"><a href="#tracert请求报文" class="headerlink" title="tracert请求报文"></a>tracert请求报文</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194152.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194200.png"></p><h4 id="tracert响应报文"><a href="#tracert响应报文" class="headerlink" title="tracert响应报文"></a>tracert响应报文</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194214.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194220.png"></p><h4 id="tracert抓取的报文"><a href="#tracert抓取的报文" class="headerlink" title="tracert抓取的报文"></a>tracert抓取的报文</h4><p><strong>每个请求包会发送三次，回也是三次，所以请求和响应一共有24个包</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117194244.png"></p><h2 id="traceroute实验"><a href="#traceroute实验" class="headerlink" title="traceroute实验"></a>traceroute实验</h2><blockquote><ol><li>配置静态路由，使全网互通</li><li>地址按路由器的序号规划</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201038.png"></p><p><strong>1. 中间路由器没有去往目标路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除R4去往目标R1的静态路由</span></span><br><span class="line">no ip route 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 34<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.3</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>显示的结果：中途路径终端并提示！H! H! H!</strong></p></blockquote><p><strong>2. 中间路由器没有返回源的路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除R4往返R6的静态路由</span><br><span class="line">no ip route 56<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 45<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.5</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>显示的结果：中途路径全部超时</strong></p></blockquote><p><strong>3. 中间路由器过滤所有收到的ICMP ttl-exceeded报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp any any ttl-exceeded</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/0  //注意调用的接口（e0/1是没有效果的，因为是UDP报文）</span><br><span class="line"> ip access-group 100 in</span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中途路径全部超时，知道最后一跳恢复</strong></p></blockquote><p><strong>4. 中途路由器过滤指定的地址ICMP ttl-exceeded报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp 34<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.255</span> any ttl-exceeded</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/0  #注意调用的接口（e0/1是没有效果的，因为是UDP报文）</span><br><span class="line"> ip access-group 100 in</span><br><span class="line"><span class="comment">//也可以使用精确控制</span></span><br><span class="line">access-list 100 deny icmp 34<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.3</span> 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.255</span> any ttl-exceeded</span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中途指定的路径超时，其余正常</strong></p></blockquote><p><strong>5. 中间路由器过滤ICMP port-unreachable报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp any any port-unreachable</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/0  #注意调用的接口</span><br><span class="line"> ip access-group 100 in</span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：倒数第二跳开始后面所有路经超时</strong></p></blockquote><p><strong>6. 中间路由器过滤所有的ICMP报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp any any</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/0  #注意调用的接口</span><br><span class="line"> ip access-group 100 in</span><br></pre></td></tr></table></figure><blockquote><p><strong>从调用ACL路由器开始，所有路径超时，同时也无法ping通目标以及沿途任何设备</strong></p></blockquote><p><strong>7. 中间路由器过滤本网段的ICMP报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp host 34<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.3</span> any</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/0  #注意调用的接口</span><br><span class="line"> ip access-group 100 in</span><br></pre></td></tr></table></figure><blockquote><p><strong>中间一跳超时，同时不能ping通这一跳</strong></p></blockquote><p><strong>8. 中间路由器过滤UDP端口33434-33464端口的报文</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny   udp any any range 33434 33464</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip access-group 100 in #注意接口是e0/1，因为是过滤UDP端口</span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中途路径终端提示! A! A! A</strong></p></blockquote><h2 id="tracert实验"><a href="#tracert实验" class="headerlink" title="tracert实验"></a>tracert实验</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117201052.png"></p><blockquote><ol><li>配置静态路由，使全网互通</li><li>地址按路由器的序号规划</li><li>win-xp使用桥接连接</li></ol></blockquote><p><strong>1. 中间路由器没有去往目标路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除去往目标R6的路由</span><br><span class="line">no ip route 56<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 34<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.4</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中间的路径显示目标不可达</strong></p></blockquote><p><strong>2. 中间路由器没有往返源的路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除往返win-xp的路由</span><br><span class="line">no ip route 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 23<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中间的路径至最后都是显示超时</strong></p></blockquote><p><strong>3. 中间路由器过滤所有收到的ICMP ttl-exceeded报文</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">access-list 100 deny icmp any any ttl-exceeded</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">!</span><br><span class="line">interface  e0/1  #注意调用的接口</span><br><span class="line"> ip access-group 100 in</span><br></pre></td></tr></table></figure><blockquote><p><strong>显示结果：中间的路径全部超时，直到最后一跳恢复</strong></p></blockquote><p><strong>4. 中间路由器过滤所有收到ICMP报文</strong></p><blockquote><p><strong>显示的结果和traceroute是一样的，中间的路径全部超时，而且ping不通目标</strong></p></blockquote><h2 id="超时分析"><a href="#超时分析" class="headerlink" title="超时分析"></a>超时分析</h2><blockquote><ol><li>当我们使用tracert命令追踪一个目标时，到中途请求超时，然后恢复，又超时，这种一般是过滤了ICMMP ttl-exceeded报文或者是过滤ICMP包指定的网段.</li><li>当我们使用tracert命令追踪一个目标时，到中途请求超时，直到30跳都没有追踪到，这种一般是过滤了any any的ICMP报文</li></ol></blockquote><h2 id="MPLS-隐藏traceroute路径"><a href="#MPLS-隐藏traceroute路径" class="headerlink" title="MPLS 隐藏traceroute路径"></a>MPLS 隐藏traceroute路径</h2><p>略……………………………………</p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EVE-NG镜像转换</title>
      <link href="2021/01/17/EVE-NG%E9%95%9C%E5%83%8F%E8%BD%AC%E6%8D%A2/"/>
      <url>2021/01/17/EVE-NG%E9%95%9C%E5%83%8F%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="EVE-NG镜像转换"><a href="#EVE-NG镜像转换" class="headerlink" title="EVE-NG镜像转换"></a>EVE-NG镜像转换</h1><h2 id="Linux-iso转换为QEMU-qcow2格式"><a href="#Linux-iso转换为QEMU-qcow2格式" class="headerlink" title="Linux.iso转换为QEMU.qcow2格式"></a>Linux.iso转换为QEMU.qcow2格式</h2><h3 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h3><p><strong>第一个步骤：上传ISO文件到qemu目录</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进入目录</span></span><br><span class="line">  /opt/unetlab/addons/qemu</span><br><span class="line"><span class="comment">//新建目录</span></span><br><span class="line">  mkdir linux-Centos7  <span class="selector-id">#--</span>&gt;注意前面linux-是固定的，后面的Centos7可以随意写</span><br><span class="line"><span class="comment">//上传CentOS-7-x86_64-DVD-1708.iso镜像至新创建的linux-Centos7目录，并改名为cdrom.iso</span></span><br><span class="line">  上传使用winscp <span class="selector-id">#--</span>&gt;这里忽略</span><br><span class="line"><span class="comment">//查看镜像是否上传</span></span><br><span class="line">  ls CentOS-7-x86_64-DVD-1708<span class="selector-class">.iso</span></span><br><span class="line"><span class="comment">//修改名称</span></span><br><span class="line">  cp CentOS-7-x86_64-DVD-1708<span class="selector-class">.iso</span> cdrom<span class="selector-class">.iso</span></span><br></pre></td></tr></table></figure><p><strong>第二个步骤：新建hda.qcow2虚拟磁盘</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在linux-Centos7目录下创建一块虚拟磁盘，名称为hda.qcow2，大小为40G（根据实际情况判定，不一定要40G）</span></span><br><span class="line">/opt/qemu/bin/qemu-img create -f qcow2 hda.qcow2 40G</span><br></pre></td></tr></table></figure><p><strong>第三个步骤：安装Centos7.0操作系统</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117190826.png"></p><blockquote><ol><li>下面的操作需要自行去完成，这里只写入了步骤<ul><li>在LAB中新增加linux节点</li><li>开机运行，并根据系统安装提示安装操作系统</li><li>安装完成后，系统提示重启之前，停止运行服务器，删掉安装镜像cdrom.iso，因为如果该文件还存在，系统开机后又会自动进行安装界面<br>rm cdrom.iso #–&gt;在linux-Centos目录下删除</li><li>）重新开启linux节点，并在根目录写入一个文件，以做标识 #–&gt;这步可以忽略</li></ul></li></ol></blockquote><p><strong>第四个步骤：压缩并移动had.qcow2镜像</strong></p><blockquote><p>点击自己创建的LAB找到UUID编号</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117190953.png"></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在/opt/unetlab/temp/0找到上面对应的UUID编号，进入1目录（1目录就是在LAB标签中创建的第一台linux服务，ID值为1），然后找到hda.qcow2文件</span></span><br><span class="line">  路径：/opt/unetlab/tmp/0/97c93af0-853e-46e5-8bca-60c47f47bd5d/1</span><br><span class="line"><span class="comment">//查看文件是否存在</span></span><br><span class="line">  ls hda<span class="selector-class">.qcow2</span></span><br><span class="line"><span class="comment">//重建hda.qcow2镜像文件并移动到qemu的linux-Centos7目录中</span></span><br><span class="line">  /opt/qemu/bin/qemu-img convert -c –p -O qcow2 hda.qcow2 /opt/unetlab/addons/qemu/linux-Centos7/hda.qcow2 #--&gt;这是一整条命令</span><br><span class="line"><span class="comment">//压缩had.qcow2文件（优化）</span></span><br><span class="line">  路径：/opt/unetlab/addons/qemu/linux-Centos7</span><br><span class="line">  压缩：virt-sparsify --compress hda<span class="selector-class">.qcow2</span> linux<span class="selector-class">.qcow2</span> <span class="selector-id">#--</span>&gt;先随便起一个名字</span><br><span class="line">  移动：mv linux<span class="selector-class">.qcow2</span> had<span class="selector-class">.qcow2</span> <span class="selector-id">#--</span>&gt;在修改名称回来</span><br></pre></td></tr></table></figure><p><strong>第五个步骤：新增一台Linux服务器，并查看优化结果：</strong></p><p>略………………………..</p><h2 id="第二种方式（推荐）"><a href="#第二种方式（推荐）" class="headerlink" title="第二种方式（推荐）"></a>第二种方式（推荐）</h2><h3 id="将VMware中运行的虚拟机转移到EVE中运行"><a href="#将VMware中运行的虚拟机转移到EVE中运行" class="headerlink" title="将VMware中运行的虚拟机转移到EVE中运行"></a>将VMware中运行的虚拟机转移到EVE中运行</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117191038.png"></p><p><strong>第一个步骤：创建一个linux-vmdk目录并在window找到安装虚拟机目录下的.vmdk文件上传至创建的目录中</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建目录并上传文件</span></span><br><span class="line">  路径：/opt/unetlab/addons/qemu</span><br><span class="line">  创建：mkdir linux-vmdk</span><br><span class="line">  上传：使用winscp工具 <span class="selector-id">#--</span>&gt;这里忽略</span><br></pre></td></tr></table></figure><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117191055.png"></p><blockquote><p><strong><code>注意一点：这台虚拟机使用的磁盘存储是在单个文件上，而不是多个文件上，如果是多个文件上，需要使用工具合成一个。</code></strong></p></blockquote><p><strong>第二个步骤：将.vmdk的文件转换为qcow2文件</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">转换：/opt/qemu/bin/qemu-img convert -f vmdk -O qcow2 CentOS1106.vmdk hda.qcow2</span><br></pre></td></tr></table></figure><p><strong>第三个步骤：压缩并移动hda.qcow2</strong></p><blockquote><ol><li>压缩had.qcow2文件（优化）<ul><li>路径：/opt/unetlab/addons/qemu/linux-vmdk</li><li>压缩：virt-sparsify –compress hda.qcow2 linux.qcow2 #–&gt;先随便起一个名字</li><li> 移动：mv linux.qcow2 had.qcow2 #–&gt;在修改名称回来</li></ul></li></ol></blockquote><p><strong>第四个步骤：查看优化结果</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117191502.png"></p><p><strong>第五个步骤：新建节点，开机测试</strong></p><blockquote><p>使用第二方法好处是，不需要重新安装系统</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117191601.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117191532.png"></p><h2 id="其他类型文件转换为qcow2格式"><a href="#其他类型文件转换为qcow2格式" class="headerlink" title="其他类型文件转换为qcow2格式"></a>其他类型文件转换为qcow2格式</h2><h3 id="img类型文件转换为qcow2"><a href="#img类型文件转换为qcow2" class="headerlink" title="img类型文件转换为qcow2"></a>img类型文件转换为qcow2</h3><blockquote><p>//注意：img使用的raw参数转换<br>/opt/qemu/bin/qemu-img convert -f  raw -O qcow2 win2003.img hda.qcow2</p></blockquote><h3 id="ova类型文件转换为qcow2"><a href="#ova类型文件转换为qcow2" class="headerlink" title="ova类型文件转换为qcow2"></a>ova类型文件转换为qcow2</h3><blockquote><p>使用WinRAR等解压工具打开ova文件，最后会看到.vmdk文件，将vmdk文件转换为qcow2格式文件. 参考第二种方式</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EVE-NG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EVE-NG配置固定ip地址</title>
      <link href="2021/01/17/EVE-NG%E9%85%8D%E7%BD%AE%E5%9B%BA%E5%AE%9Aip%E5%9C%B0%E5%9D%80/"/>
      <url>2021/01/17/EVE-NG%E9%85%8D%E7%BD%AE%E5%9B%BA%E5%AE%9Aip%E5%9C%B0%E5%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="EVH-NG配置固定IP地址"><a href="#EVH-NG配置固定IP地址" class="headerlink" title="EVH-NG配置固定IP地址"></a>EVH-NG配置固定IP地址</h1><h2 id="编辑配置文件-etc-network-interfaces"><a href="#编辑配置文件-etc-network-interfaces" class="headerlink" title="编辑配置文件/etc/network/interfaces"></a>编辑配置文件/etc/network/interfaces</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root<span class="keyword">@eve-ng</span>:~# vi /etc/network/interfaces</span><br><span class="line">#修改以下内容</span><br><span class="line"></span><br><span class="line"># The primary network interface</span><br><span class="line">iface eth0 inet manual</span><br><span class="line">auto pnet0</span><br><span class="line">iface pnet0 inet static</span><br><span class="line">    bridge_ports eth0</span><br><span class="line">    bridge_stp off</span><br><span class="line">    address <span class="number">10.0</span>.<span class="number">0.200</span></span><br><span class="line">    netmask <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">    gateway <span class="number">10.0</span>.<span class="number">0.2</span></span><br><span class="line">    dns-nameserver <span class="number">223.5</span>.<span class="number">5.5</span></span><br><span class="line">#注意自己VMware使用模式，配置正确的网关</span><br></pre></td></tr></table></figure><h2 id="重启网卡生效"><a href="#重启网卡生效" class="headerlink" title="重启网卡生效"></a>重启网卡生效</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/networking restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EVE-NG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ICMP——Ping</title>
      <link href="2021/01/17/ICMP%E2%80%94%E2%80%94Ping/"/>
      <url>2021/01/17/ICMP%E2%80%94%E2%80%94Ping/</url>
      
        <content type="html"><![CDATA[<h1 id="ICMP之——ping"><a href="#ICMP之——ping" class="headerlink" title="ICMP之——ping"></a>ICMP之——ping</h1><h2 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h2><p><strong>用法：ping 地址或域名</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117184802.png"></p><h2 id="ping命令的功能"><a href="#ping命令的功能" class="headerlink" title="ping命令的功能"></a>ping命令的功能</h2><blockquote><ol><li>能验证网络是否连通</li><li>会统计响应时间和TTL（ip包中的Time To Live，生成生存周期）</li></ol></blockquote><h2 id="如何验证？"><a href="#如何验证？" class="headerlink" title="如何验证？"></a>如何验证？</h2><blockquote><ol><li>ping命令会先发送一个ICMP Echo Request请求报文给对端</li><li>对端接收到之后，回送一个ICMP Echo Reply响应报文</li><li>如果没有返回，可能会显示超时或目标不可达.</li></ol></blockquote><h2 id="使用wireshark抓取的ICMP报文，如下图"><a href="#使用wireshark抓取的ICMP报文，如下图" class="headerlink" title="使用wireshark抓取的ICMP报文，如下图"></a>使用wireshark抓取的ICMP报文，如下图</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185416.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185428.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185436.png"></p><h2 id="ping包回应判断故障点"><a href="#ping包回应判断故障点" class="headerlink" title="ping包回应判断故障点"></a>ping包回应判断故障点</h2><h3 id="传输失败-常见故障"><a href="#传输失败-常见故障" class="headerlink" title="传输失败. 常见故障"></a>传输失败. 常见故障</h3><p><strong>物理故障居多，如无本地连接，也可能是未获取ip，没有网关等问题</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185515.png"></p><h3 id="目标不可达"><a href="#目标不可达" class="headerlink" title="目标不可达"></a>目标不可达</h3><p><strong>数据包没有发往到目的地，如中间设备没有去往的路由，或者在去往的过程被过滤掉等</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185542.png"></p><h3 id="请求超时"><a href="#请求超时" class="headerlink" title="请求超时"></a>请求超时</h3><p><strong>数据包有发往的目的地，但是返回的途中出现问题，如主机关机，没有返回路由，数据包被过滤掉等</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185602.png"></p><h2 id="搭建实验演示故障点"><a href="#搭建实验演示故障点" class="headerlink" title="搭建实验演示故障点"></a>搭建实验演示故障点</h2><blockquote><p>地址按路由器的序号规划<br>部署静态路由，实现两边互通<br>win网关：172.16.1.254<br>Linux网关：100.100.100.254</p><p><strong><code>地址：需要自行配置</code></strong></p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185629.png"></p><h3 id="测试是否连通"><a href="#测试是否连通" class="headerlink" title="测试是否连通"></a>测试是否连通</h3><p><strong>Linux主机ping</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185656.png"></p><p><strong>win-xp主机ping</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185707.png"></p><h3 id="故障点ping服务器目标不可达"><a href="#故障点ping服务器目标不可达" class="headerlink" title="故障点ping服务器目标不可达"></a>故障点ping服务器目标不可达</h3><p><strong>方法一：配置ACL策略</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置ACL策略</span></span><br><span class="line">access-list 100 deny   icmp any host 100<span class="selector-class">.100</span><span class="selector-class">.100</span><span class="selector-class">.1</span></span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">！</span><br><span class="line"><span class="comment">//调用到e0/0接口，方向为in</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip <span class="selector-tag">address</span> 12<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> ip access-group 100 in #注意，这里是IN方向</span><br></pre></td></tr></table></figure><p><strong>方法二：删除去往服务器的路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no ip route 100<span class="selector-class">.100</span><span class="selector-class">.100</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 13<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.3</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>ping目标不可达</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185918.png"></p><p><strong>但是还可以访问网页，这里只是作为演示，网页配置需要搭建服务才行</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117185939.png"></p><h3 id="故障点ping服务器超时"><a href="#故障点ping服务器超时" class="headerlink" title="故障点ping服务器超时"></a>故障点ping服务器超时</h3><p><strong>方法一：配置ACL策略</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置ACL</span></span><br><span class="line">access-list 100 deny   icmp any any</span><br><span class="line">access-list 100 permit ip any any</span><br><span class="line">！</span><br><span class="line"><span class="comment">//调用到e0/0接口，方向为out</span></span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip <span class="selector-tag">address</span> 12<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> ip access-group 100 out #注意这里out方向</span><br></pre></td></tr></table></figure><p><strong>方法二：和上述的目标可不达一样，没有往返的路由</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no ip route 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 23<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p><strong>ping服务器超时</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117190059.png"></p><h2 id="常见ping包不通的几个问题"><a href="#常见ping包不通的几个问题" class="headerlink" title="常见ping包不通的几个问题"></a>常见ping包不通的几个问题</h2><h3 id="Windows防火墙限制"><a href="#Windows防火墙限制" class="headerlink" title="Windows防火墙限制"></a>Windows防火墙限制</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117190120.png"></p><h3 id="Linux限制"><a href="#Linux限制" class="headerlink" title="Linux限制"></a>Linux限制</h3><p><strong>Linux默认是允许ping响应的，系统是否允许ping由2个因数决定的. A：内核参数 B：防火墙</strong></p><p><strong>A：内核参数设置</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//临时设置：</span></span><br><span class="line">echo 0 &gt;/proc/sys/net/ipv4/icmp_echo_ignore_all #--&gt;（0表示允许，1表示禁止）</span><br><span class="line">echo 1 &gt;/proc/sys/net/ipv4/icmp_echo_ignore_all #--&gt;（0表示允许，1表示禁止）</span><br><span class="line"><span class="comment">//永久设置：</span></span><br><span class="line">echo &quot;net.ipv4.icmp_echo_ignore_all=1&quot; &gt;&gt;/etc/sysctl.conf （0表示允许，1表示禁止）</span><br><span class="line">echo &quot;net.ipv4.icmp_echo_ignore_all=0&quot; &gt;&gt;/etc/sysctl.conf （0表示允许，1表示禁止）</span><br><span class="line"><span class="comment">//永久设置需要执行sysctl -p使配置生效</span></span><br><span class="line"><span class="selector-attr">[root@shell-2 ~]</span># sysctl -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure><p><strong>B：防火墙</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#PS1</span>：此处的方法的前提是内核配置是默认值，也就是没有禁止ping</span><br><span class="line"><span class="selector-id">#PS2</span>：linux防火墙默认是允许ping通过的，</span><br><span class="line"><span class="comment">//禁止ping设置</span></span><br><span class="line"><span class="selector-id">#--</span>&gt;Centos6版本</span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> icmp --icmp-type 8 -J DROP</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#--</span>&gt;Centos7版本</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule protocol value=icmp drop&quot;</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h3 id="云主机限制"><a href="#云主机限制" class="headerlink" title="云主机限制"></a>云主机限制</h3><p><strong>云主机默认是禁止ping包的</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117190230.png"></p><h3 id="网络设备限制"><a href="#网络设备限制" class="headerlink" title="网络设备限制"></a>网络设备限制</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R1(config)<span class="selector-id">#access-list</span> 100 deny icmp any host 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.10</span></span><br><span class="line">R1(config)<span class="selector-id">#access-list</span> 100 permit ip any any</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ICMP协议与原理</title>
      <link href="2021/01/17/ICMP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/ICMP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ICMP协议与原理"><a href="#ICMP协议与原理" class="headerlink" title="ICMP协议与原理"></a>ICMP协议与原理</h1><h2 id="ICMP协议是什么？"><a href="#ICMP协议是什么？" class="headerlink" title="ICMP协议是什么？"></a>ICMP协议是什么？</h2><blockquote><ol><li>控制报文协议（Internet Control Message Protocol，ICMP）是TCP/IP协议族的一个子协议，ICMP协议用于在IP主机和路由器之间传递控制消息，描述网络是否通畅，主机是否可达或超时，路由器是否可用等网络状态</li><li>ICMP报文是基于在IP数据包中，IP报头在ICMP报文的最前面. 一个ICMP报文包括IP报头（至少20字节），ICMP报头（至少八字节）和ICMP报文（属于ICMP报文的数据部分），当IP报头中的协议字段值为<strong>1</strong>时，就说明这个一个ICMP报文. ICMP报头如下图所示</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117175257.png"></p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>类型</td><td>占一字节，表示ICMP报文的类型，从类型值来看ICMP报文可以分为两大类. 第一类是取值为1-127的差错报文，第二类是取值128以上的信息报文</td></tr><tr><td>代码</td><td>占一字节，标识对应ICMP报文的代码. 它与类型字段一起共同标识了ICMP报文的详细类型</td></tr><tr><td>校验和</td><td>这是对包括ICMP报文数据部分在内的整个ICMP数据包的校验和. 以检验报文在传输过程中是否出现了差错</td></tr></tbody></table><h2 id="ICMP类型的代码及含义"><a href="#ICMP类型的代码及含义" class="headerlink" title="ICMP类型的代码及含义"></a>ICMP类型的代码及含义</h2><p><strong>在ICMP报文中，如果类型和代码不同，ICMP数据包报告的消息含义也会不同. 常见的类型和代码的ICMP含义如表所示</strong></p><table><thead><tr><th>类型</th><th>代码</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>回显应答（ping应答）</td></tr><tr><td>3</td><td>0</td><td>网络不可达</td></tr><tr><td>3</td><td>1</td><td>主机不可达</td></tr><tr><td>3</td><td>2</td><td>协议不可达</td></tr><tr><td>3</td><td>3</td><td>端口不可达</td></tr><tr><td>3</td><td>4</td><td>需要进行分片，但设置不分片位</td></tr><tr><td>3</td><td>5</td><td>源站选路失败</td></tr><tr><td>3</td><td>6</td><td>目的网络未知</td></tr><tr><td>3</td><td>7</td><td>目的主机未知</td></tr><tr><td>3</td><td>9</td><td>目的网络被强制禁止</td></tr><tr><td>3</td><td>10</td><td>目的主机被强制禁止</td></tr><tr><td>3</td><td>11</td><td>由于服务类型TOS，网络不可</td></tr><tr><td>3</td><td>12</td><td>由于服务类型TOS，主机不可达</td></tr><tr><td>3</td><td>13</td><td>由于过滤，通信被强制禁止</td></tr><tr><td>3</td><td>14</td><td>主机越权</td></tr><tr><td>3</td><td>15</td><td>优先中止失效</td></tr><tr><td>4</td><td>0</td><td>源端被关闭（基本流控制）</td></tr><tr><td>5</td><td>0</td><td>对网络重定向</td></tr><tr><td>5</td><td>1</td><td>对主机重定向</td></tr><tr><td>5</td><td>2</td><td>对服务类型和网络重定向</td></tr><tr><td>5</td><td>3</td><td>对服务类型和主机重定向</td></tr><tr><td>8</td><td>0</td><td>回显请求（ping请求）</td></tr><tr><td>9</td><td>0</td><td>路由器通告</td></tr><tr><td>10</td><td>0</td><td>路由器请求</td></tr><tr><td>11</td><td>0</td><td>在数据报组装期间生存时间为0</td></tr><tr><td>12</td><td>1</td><td>坏的IP首部</td></tr><tr><td>13</td><td>0</td><td>时间戳请求</td></tr><tr><td>14</td><td>0</td><td>时间戳应答</td></tr><tr><td>17</td><td>0</td><td>地址掩码请求</td></tr><tr><td>18</td><td>0</td><td>地址掩码应答</td></tr></tbody></table><h2 id="常见的请求与应答"><a href="#常见的请求与应答" class="headerlink" title="常见的请求与应答"></a>常见的请求与应答</h2><h3 id="ping请求"><a href="#ping请求" class="headerlink" title="ping请求"></a>ping请求</h3><blockquote><ol><li>我们在操作过程中，用的最多就是ping操作，该操作中包括了相应请求（类型字段为8）和应答（类型字段值为0）ICMP报文.</li><li>如：一台主机向一个节点发送一个类型字段为8的ICMP报文，如果途中（没有异常，路由丢弃，被过滤，目标不回应ICMP或者传输失败等等）.则目标返回类型字段为0的IMCP报文，说明这台主机存在.</li></ol></blockquote><h3 id="时间戳请求"><a href="#时间戳请求" class="headerlink" title="时间戳请求"></a>时间戳请求</h3><blockquote><ol><li>时间戳请求报文（类型值字段13）和时间戳应答报文（类型字段14）用于测试两台主机之间数据包来回一次的传输时间. 传输时，主机填充原始时间戳，接收方收到请求后填充接收时间戳后以类型值字段14的报文格式返回，发送方计算这个时间差</li></ol></blockquote><h3 id="（网络，主机，端口，协议）不可达回应"><a href="#（网络，主机，端口，协议）不可达回应" class="headerlink" title="（网络，主机，端口，协议）不可达回应"></a>（网络，主机，端口，协议）不可达回应</h3><blockquote><ol><li><p>目标不可达报文（类型字段为3）在路由器或者主机不能传递数据时使用.</p></li><li><p>如1：ping一个不存在的主机或者没有该路由，则返回类型字段3，代码字段为0的ICMP报文.</p></li><li><p>如2：连接对方一个不存在的系统端口（端口号小于1024）时，则返回类型字段值3，代码字段值为3的ICMP报文</p></li></ol></blockquote><h3 id="源抑制报文回应"><a href="#源抑制报文回应" class="headerlink" title="源抑制报文回应"></a>源抑制报文回应</h3><blockquote><ol><li>源抑制报文（类型字段值为4，代码字段值为0）则充当一个控制流量的角色，通知主机减少数据包流量. 由于TCP/IP没有回复传输的报文，所以只要停止该报文，主机就会逐渐恢复传输速率.</li></ol></blockquote><h3 id="超时报文回应"><a href="#超时报文回应" class="headerlink" title="超时报文回应"></a>超时报文回应</h3><blockquote><ol><li>长时间在网络游荡而找不到目标，或者拥塞导致主机在规定的时间内无法重组数据报文段，这时就要触发ICMP超时报文的产生. 超时报文（类型字段为11），代码域有两种取值：代码字段值为0表示传输超时，代码字段值为1表示分段重组超时</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHCP协议与原理</title>
      <link href="2021/01/17/DHCP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/DHCP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="DHCP协议与原理"><a href="#DHCP协议与原理" class="headerlink" title="DHCP协议与原理"></a>DHCP协议与原理</h1><h2 id="DHCP介绍"><a href="#DHCP介绍" class="headerlink" title="DHCP介绍"></a>DHCP介绍</h2><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议），是一个工作在应用层的局域网网络协议，数据传输时使用UTP不可靠传输协议工作，通常被应用在大型的局域网络环境中，主要作用是集中的管理，分配网络资源. 使网络环境中的主机能够动态获取IP地址，Gateway地址，DNS服务器地址等信息，并能够提升地址的使用率.</p><h2 id="DHCP工作原理（租约四部曲-续租）"><a href="#DHCP工作原理（租约四部曲-续租）" class="headerlink" title="   DHCP工作原理（租约四部曲+续租）"></a>   DHCP工作原理（租约四部曲+续租）</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174418.png"></p><h2 id="DHCP客户机进行IP请求"><a href="#DHCP客户机进行IP请求" class="headerlink" title="DHCP客户机进行IP请求"></a>DHCP客户机进行IP请求</h2><blockquote><p>当一个DHCP客户机启动时，会自动将自己的IP地址配置成0.0.0.0，由于使用0.0.0.0不能进行正常通信，所以客户机就必须通过DHCP服务器来获取一个合法的地址. 由于客户机不知道DHCP服务器的IP地址，所以使用0.0.0.0的地址作为源地址，使用255.255.255.255作为目标地址，使用UDP67端口作为目的端口来广播请求ip地址信息. 广播信息DHCP Discover中包含了DHCP客户机的MAC地址和计算机名，以便使DHCP服务能够确定是哪个客户机发送的请求</p></blockquote><h2 id="DHCP服务器响应请求"><a href="#DHCP服务器响应请求" class="headerlink" title=" DHCP服务器响应请求"></a> DHCP服务器响应请求</h2><blockquote><ol><li>当DHCP 服务器收到客户机请求ip地址的信息时，它就在自己的ip地址池中查找是否有合法的ip地址提供给客户机. 如果有，DHCP服务器就将此ip地址坐上标记，加入到DHCP Offer的报文中，然后DHCP服务器还是以广播发送DHCP Offer报文.</li><li>DHCP客户机的MAC地址；DHCP服务器提供的合法IP地址：子网掩码；默认网关；DNS地址；租约的期限；DHCP服务器的ip地址-MAC.</li><li>因为DHCP客户端还没有IP地址，所以DHCP服务器使用自己的IP地址作为源地址，使用255.255.255.255作为目标地使用UDP 68端口作为源端口来广播DHCP Offer报文</li></ol></blockquote><h2 id="DHCP客户机选择IP"><a href="#DHCP客户机选择IP" class="headerlink" title="DHCP客户机选择IP"></a>DHCP客户机选择IP</h2><blockquote><ol><li>DHCP客户机从接收到的第一个DHCP Offer报文中选择ip地址，发送ip地址的DHCP服务器将该地址保留，这样该地址就不能提供给另一个DHCP客户机. 当客户机从第一个DHCP服务器接收DHCP Offer并选择ip地址后，DHCP租约的第三过程发送. 客户机将DHCP Request报文广播到所有的DHCP服务器，表明它接受提供的内容. DHCP Request报文包括为该客户机提供ip配置的服务器的服务标志符（ip地址），DHCP服务器查看服务器标识符字段，以确定自己是否被选择为指定的客户机提供ip地址，如果哪些DHCP Offer被拒绝，则DHCP服务器会取消提供保留其ip地址以用于下一个ip租约请求.</li><li>在客户机选择ip的过程中，虽然客户机选择了ip地址，但是还没有配置ip地址，而在一个网络中可能有几个DHCP服务器，所以客户机仍然使用0.0.0.0的地址作为源地址，使用255.255.255.255.作为目标地址，使用UDP 67端口作为目的端口来广播DHCP Request报文</li></ol></blockquote><h2 id="DHCP服务器确认租约"><a href="#DHCP服务器确认租约" class="headerlink" title="DHCP服务器确认租约"></a>DHCP服务器确认租约</h2><blockquote><ol><li><p>服务器确认租约：DHCP ACK</p><ul><li>DHCP服务器接收到DHCP Request报文后，以DHCP ACK报文的形式向客户机广播成功的确认，该消息包含有ip地址的有效租约和其他可能配置的信息. 虽然服务器确认了客户机的租约请求，但是客户机还没有收到服务器的DHCP ACK报文，所以服务器仍然使用自己的ip地址作为源地址， 使用255.255.255.255作为目标地址，使用UDP 68端口作为源端口来广播DHCP ACK报文. 当客户机收到DHCP ACK消息时，它就配置了ip地址，完成了TCP/IP的初始化</li></ul></li><li><p>服务器拒绝租约：DHCP NACK（DHCP NAK）</p><ul><li>如果DHCP Request不成功，例如客户机试图租约先前的IP地址，但该ip地址不在可用，或者因为客户机移到其他子网，该ip无效时，DHCP服务器将广播否定确定报文DCHP NACK. 当客户端接收到不成功的确认时，它讲重新开始DHCP 租约过程.</li></ul></li></ol><ul><li><p>PS1：如果DHCP客户机无法找到DHCP服务器，它将从TCP/IP的B类网络169.254.0.0/16挑选一个IP地址作为自己的ip地址，继续每个5分钟尝试与DHCP服务器进行通讯，一旦与DHCP服务器通信成功，则客户机放弃自动配置的ip地址，而使用DHCP服务器分配的ip地址.</p></li><li><p>PS2：DHCP客户机收到DHCP服务器回应的ACK报文后，通过地址冲突检测（ARP）发现服务器分配的地址冲突或者由于其他原因导致不能使用，则发送DECLINE报文，通知服务器所分配至的ip地址不可用</p></li></ul></blockquote><h2 id="DHCP客户机续租"><a href="#DHCP客户机续租" class="headerlink" title="DHCP客户机续租"></a>DHCP客户机续租</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174844.png"></p><blockquote><ol><li>DHCP客户机会在租期过去50%的时候，直接向为其提供ip地址的DHCP服务器发送DHCP Request报文，如果客户机接收到该服务器回应的DHCP ACK报文，则客户机就根据数据包中所提供的新的租期以及其他已经更新的TCP/IP参数，更新自己的配置，IP租用更新完成. 如果没有收到该服务器的回复，则客户机继续使用现有的IP地址，因为当前租期还有50%</li><li>如果在租期过去50%的时候没有更新，则DHCP客户机将在租期过去87.5%的时候再次向为其提供IP地址的DHCP服务器联系，如果还不成功，到租约的100%时候，DHCP客户机必须放弃这个IP地址，重新申请，如果此时无DHCP服务区可用，DHCP客户机使用169.254.0.0/16中随机的一个地址，并且每个5分钟再进行尝试.</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DHCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHCP实验</title>
      <link href="2021/01/17/DHCP%E5%AE%9E%E9%AA%8C/"/>
      <url>2021/01/17/DHCP%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="DHCP实验"><a href="#DHCP实验" class="headerlink" title="DHCP实验"></a>DHCP实验</h1><h2 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h2><blockquote><p>  在核心交换机上开启DHCP Server功能并配置DHCP地址池，配置网关:192.168.1.254、DNS:8.8.8.8、租约（默认为24小时，可无需配置）</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117173651.png"></p><h3 id="核心交换机配置"><a href="#核心交换机配置" class="headerlink" title="核心交换机配置"></a>核心交换机配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启DHCP服务功能</span></span><br><span class="line">Switch1(config)<span class="selector-id">#service</span> dhcp</span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置vlan及网关地址</span></span><br><span class="line">Switch1(config-if)<span class="selector-id">#vlan</span> 10</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置dhcp地址池</span></span><br><span class="line">ip dhcp pool vlan10</span><br><span class="line"> network 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> default-router 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> dns-server 8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置核心层与接入层互连接口为trunk模式</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br></pre></td></tr></table></figure><h3 id="接入层交换机配置"><a href="#接入层交换机配置" class="headerlink" title="接入层交换机配置"></a>接入层交换机配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置vlan</span></span><br><span class="line">S2(config)<span class="selector-id">#vlan</span> 10</span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置接入层与核心层互连接口为trunk模式</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line"><span class="comment">//划分两台终端至vlan10</span></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/2</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br></pre></td></tr></table></figure><h3 id="配置主机地址自动获取"><a href="#配置主机地址自动获取" class="headerlink" title="配置主机地址自动获取"></a>配置主机地址自动获取</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PC3：VPCS&gt; ip dhcp</span><br><span class="line">PC4：VPCS&gt; ip dhcp</span><br></pre></td></tr></table></figure><h2 id="使用show命令查看配置"><a href="#使用show命令查看配置" class="headerlink" title="使用show命令查看配置"></a>使用show命令查看配置</h2><h3 id="核心交换机"><a href="#核心交换机" class="headerlink" title="核心交换机"></a>核心交换机</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117173804.png"></p><h3 id="PC3"><a href="#PC3" class="headerlink" title="PC3"></a>PC3</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117173825.png"></p><h2 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h2><blockquote><ol><li>在汇聚交换机上开启DHCP relay功能，并且设置用户网关及路由信息，配置网关:192.168.1.254、DNS:8.8.8.8、租约（默认为24小时，可无需配置）</li><li>在核心交换机上开启DHCP Server功能，并且配置DHCP地址池</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117173901.png"></p><h3 id="什么是relay"><a href="#什么是relay" class="headerlink" title="什么是relay?"></a>什么是relay?</h3><blockquote><p> DHCP Relay（DHCPR）DHCP中继是一个小程序（代理），可以实现在不同子网和物理网段之间处理和转发dhcp信息的功能</p></blockquote><h3 id="核心层配置"><a href="#核心层配置" class="headerlink" title="核心层配置"></a>核心层配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启DHCP服务功能</span></span><br><span class="line">Switch1(config)<span class="selector-id">#service</span> dhcp</span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置dhcp地址池</span></span><br><span class="line">ip dhcp pool vlan10</span><br><span class="line"> network 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> default-router 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> dns-server 8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置核心层与汇聚层互连ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置核心层至汇聚设备用户网段的静态路由</span></span><br><span class="line">ip route 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure><h3 id="汇聚层配置"><a href="#汇聚层配置" class="headerlink" title="汇聚层配置"></a>汇聚层配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启汇聚交换机的DHCP服务功能</span></span><br><span class="line">S2(config)<span class="selector-id">#service</span> dhcp</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置vlan及vlan 10的ip地址（用户网关的地址）</span></span><br><span class="line">Switch1(config-if)<span class="selector-id">#vlan</span> 10</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置汇聚层与核心层互连的ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//划分两台终端至vlan10</span></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/2</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置汇聚层到外网的默认路由</span></span><br><span class="line">ip route 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span> 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//开启汇聚层DHCP relay功能,该地址需要是核心交换机的IP地址，并且路由可达.</span></span><br><span class="line">S2(config)<span class="selector-id">#in</span> vlan 10</span><br><span class="line">S2(config-if)<span class="selector-id">#ip</span> helper-<span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> #接口下开启（推荐）</span><br><span class="line">S2(config)<span class="selector-id">#ip</span> helper-<span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> #全局下开启</span><br></pre></td></tr></table></figure><h3 id="配置主机地址自动获取-1"><a href="#配置主机地址自动获取-1" class="headerlink" title="配置主机地址自动获取"></a>配置主机地址自动获取</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PC3：VPCS&gt; ip dhcp</span><br><span class="line">PC4：VPCS&gt; ip dhcp</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="核心交换机-1"><a href="#核心交换机-1" class="headerlink" title="核心交换机"></a>核心交换机</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174020.png"></p><h3 id="win-xp"><a href="#win-xp" class="headerlink" title="win-xp"></a>win-xp</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174033.png"></p><h2 id="实验3"><a href="#实验3" class="headerlink" title="实验3"></a>实验3</h2><p><strong>在交换机S3上配置DHCP中继，对VLAN10内的用户进行中继，使得PC1和PC2用户使用DHCP Relay方式获取IP地址。具体要求如下：</strong></p><blockquote><ol><li>DHCP服务器搭建于EG上，地址池命名为VLAN10，DHCP对外服务使用loopback 0地址</li><li>S3 配置网关:192.168.1.254、DNS:8.8.8.8、租约（默认为24小时，可无需配置）</li><li>为了防御动态环境局域网伪DHCP服务欺骗，在S1、S2交换机部署DHCP Snooping功能；</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174113.png"></p><h3 id="EG配置"><a href="#EG配置" class="headerlink" title="EG配置"></a>EG配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启DHCP服务功能</span></span><br><span class="line">EG(config)<span class="selector-id">#service</span> dhcp #默认不开启，一定要开启此功能</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置lookback0地址</span></span><br><span class="line">interface Loopback0</span><br><span class="line"> ip <span class="selector-tag">address</span> 1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.255</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置EG与S3互连的ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.252</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置DHCP地址池</span></span><br><span class="line">ip dhcp pool vlan10</span><br><span class="line"> network 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> default-router 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> dns-server 8<span class="selector-class">.8</span><span class="selector-class">.8</span><span class="selector-class">.8</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置静态路由指向用户网段</span></span><br><span class="line">ip route 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.0</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span></span><br></pre></td></tr></table></figure><h3 id="S3配置"><a href="#S3配置" class="headerlink" title="S3配置"></a>S3配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启DHCP服务功能</span></span><br><span class="line">EG(config)<span class="selector-id">#service</span> dhcp #默认不开启，一定要开启此功能</span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置S3与EG互连的ip地址</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> ip <span class="selector-tag">address</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.252</span></span><br><span class="line">！</span><br><span class="line"><span class="comment">//配置vlan及vlan 10的ip地址</span></span><br><span class="line">S3(config)<span class="selector-id">#vlan</span> 10</span><br><span class="line">！</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置S3与S1互连的接口为trunk模式</span></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line"><span class="comment">//配置静态路由指向EG网关的lookback地址</span></span><br><span class="line">ip route 1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span> 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.2</span></span><br><span class="line">!</span><br><span class="line"><span class="comment">//开启汇聚层DHCP relay功能,该地址需要是核心交换机的IP地址，并且路由可达.</span></span><br><span class="line">S2(config)<span class="selector-id">#in</span> vlan 10</span><br><span class="line">S2(config-if)<span class="selector-id">#ip</span> helper-<span class="selector-tag">address</span> 1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span></span><br></pre></td></tr></table></figure><h3 id="S1配置"><a href="#S1配置" class="headerlink" title="S1配置"></a>S1配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置S1与S3互连的接口为trunk模式</span></span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line"><span class="comment">//划分两台终端至vlan10</span></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/2</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">！</span><br><span class="line"><span class="comment">//开启DHCP snooping</span></span><br><span class="line">S1(config)<span class="selector-id">#ip</span> dhcp snooping</span><br><span class="line">S1(config)<span class="selector-id">#ip</span> dhcp snooping trust</span><br><span class="line"><span class="comment">//开启DHCP snooping的交换机所有接口缺省为untrust口，交换机只转发从trust口收到的DHCP响应报文（offer、ACK）</span></span><br></pre></td></tr></table></figure><h2 id="使用show查看配置-1"><a href="#使用show查看配置-1" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="EG"><a href="#EG" class="headerlink" title="EG"></a>EG</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117180827.png"></p><h3 id="PC1及PC2"><a href="#PC1及PC2" class="headerlink" title="PC1及PC2"></a>PC1及PC2</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174216.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117174225.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DHCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VRRP协议与原理</title>
      <link href="2021/01/17/VRRP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/VRRP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="VRRP协议与原理"><a href="#VRRP协议与原理" class="headerlink" title="VRRP协议与原理"></a>VRRP协议与原理</h1><h2 id="VRRP概述"><a href="#VRRP概述" class="headerlink" title="VRRP概述"></a>VRRP概述</h2><blockquote><ol><li>VRRP（Virtual Route Redundancy Protocol）虚拟路由器冗余协议是一种网关备份冗余解决方案，它对Ethernet上的计算机等终端的默认网关进行冗余备份，实现当其中一台网关设备宕机时，备份网关设备能够快速自动切换并接管转发工作，防止因网关设备故障引发转发数据失败，提高了网络服务质量.</li><li>VRRP通过使用虚拟路由器技术实现了主机默认网关的备份，同时也可以通过VRRP来实现网关的负载均衡.</li></ol></blockquote><h2 id="协议版本：VRRPv2-常用）和VRRPv3："><a href="#协议版本：VRRPv2-常用）和VRRPv3：" class="headerlink" title="协议版本：VRRPv2(常用）和VRRPv3："></a>协议版本：VRRPv2(常用）和VRRPv3：</h2><blockquote><p>VRRPv2仅适用于IPv4网络，VRRPv3适用于IPv4和IPv6两种网络.</p></blockquote><h2 id="VRRP原理"><a href="#VRRP原理" class="headerlink" title="VRRP原理"></a>VRRP原理</h2><p><strong>VRRP将局域网内的一组路由器划分在一起，称为一个备份组。备份组由一个Master路由器和多个Backup路由器组成，功能上相当于一台虚拟路由器。</strong></p><blockquote><p>VRRP备份组具有以下特点：</p><ul><li>虚拟路由器具有IP地址，称为虚拟IP地址。局域网内的主机仅需要知道这个虚拟路由器的IP地址，并将其设置为缺省路由的下一跳地址。</li><li>网络内的主机通过这个虚拟路由器与外部网络进行通信。</li><li>备份组内的路由器根据优先级，选举出Master路由器，承担网关功能。其他路由器作为Backup路由器，当Master路由器发生故障时，取代Master继续履行网关职责，从而保证网络内的主机不间断地与外部网络进行通信。</li></ul></blockquote><h2 id="VRRP组"><a href="#VRRP组" class="headerlink" title="VRRP组"></a>VRRP组</h2><blockquote><ol><li>一个VRRP组由多台协同工作的路由器组成，使用相同的VRID（虚拟路由器标识符）进行标识，属于同一个VRRP组的路由器之间交互VRRP协议报文并产生一台虚拟路由器。</li><li>一个VRRP组中只能出现一台Master路由器。</li><li>一个接口可以加入单个VRRP组，也可以加入多个VRRP组。不同的VRRP组需使用不同的VRID进行区分。</li></ol></blockquote><h2 id="虚拟-（路由器-IP-MAC）"><a href="#虚拟-（路由器-IP-MAC）" class="headerlink" title="虚拟 （路由器 IP MAC）"></a>虚拟 （路由器 IP MAC）</h2><blockquote><ol><li><p>虚拟路由器</p><ul><li><p>虚拟路由器的IP地址（虚拟IP地址）由网络管理员在配置VRRP时指定，一台虚拟路由器可以有一个或多个IP地址，而虚拟MAC地址的格式是0000-5e00-01xx”,其中XX为VRID，</p></li><li><p>一个VRRP组只会产生一台虚拟路由器。当Master路由器收到请求虚拟路由器MAC地址的ARP Request时，它在ARP Reply中回应的MAC地址是虚拟MAC地址，而不是其物理接口MAC地址。</p></li><li><p>通常情况下，VRRP路由器接口IP地址不会与虚拟路由器的IP地址重叠，如果使用某个路由器接口的IP地址，则该路由器将无条件的称为Master。</p></li></ul></li><li><p>Ｍaster路由器：</p><ul><li><p>Master路由器是接口处于Master状态，也被称为主路由器。主路由器在一个VRRP组中承担报文转发任务，只有Ｍaster路由器才会响应针对虚拟IP地址的ARP Requeset。</p></li><li><p> Master路由器会以一定的时间间隔周期性地发送VRRP报文，以便通知一个VRRP组中的Backup路由器关于自己的存活情况。</p></li></ul></li><li><p>Backup路由器：</p><ul><li>Backup路由器是接口处于Backup状态，也被称为备份路由器，Backup路由器会实时侦听Master路由器发送出来的VRRP报文，它随时准备接替Master路由器的工作。</li></ul></li><li><p>抢占模式</p><ul><li>VRRP优先级越大的称为主路由器，优先级相同情况下，则接口IP地址最大的成为主路由器。如果Backup激活了抢占功能，当发现Master路由器的优先级比自己更低时，它将立即成为Master状态。而如果Backup路由器没有激活抢占功能，那么即使收到比自己更低的优先级，也只能依然保持Backup状态，直到Master路由器失效。</li></ul></li></ol></blockquote><h2 id="VRRP状态"><a href="#VRRP状态" class="headerlink" title="VRRP状态"></a>VRRP状态</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142114.png"></p><blockquote><ol><li><p>Initialize（初始状态）：</p><ul><li><p>接口配置VRRP后，如果该接口时Down的（例如接口关闭，或者没有连接任何线缆）则该接口的状态停滞在Initialize。</p></li><li><p>当接口UP后，如果其VRRP优先级为255(这种情况发生在接口的实际IP地址是VRRP虚拟IP地址的情况下）那么接口的VRRP状态将由Initialize切换到Master。</p></li><li><p>如果优先级不是255，则进入Backup状态。</p></li></ul></li><li><p>Backup状态：</p><ul><li><p>它会实时监控当前Master路由器的状态，并随时接替工作。</p><p>a. 对关于VRRP虚拟IP地址的ARP请求不响应。</p><p>b. 丢弃目的MAC地址为VRRP虚拟MAC地址的数据帧。</p><p>c. 不接受目的IP地址为VRRP虚拟IP地址的数据包</p><p>d. 实时侦听Master路由器发送的报文。若该VRRP报文的优先级为0（这意味着当前Master路由器希望主动放弃Master状态）</p></li></ul></li><li><p>Master状态：</p><ul><li><p>它承担着数据转发任务</p><p>a. 当收到关于虚拟IP地址的ARP请求时，以虚拟MAC地址进行回应。</p><p>b. 转发目的MAC地址为虚拟MAC地址。</p><p>c. 周期性地发送VRRP报文，时间间隔缺省为1S。</p><p>d. 当收到一个VRRP报文时，若该优先级为０，则继续发送自己的报文，若该VRRP报文优先级不为０，并比本接口的VRRP优先级值更大，或者VRRP优先级相等但是VRRP报文的源IP地址比本接口大，则将接口切换成Backuo状态。若该VRRP报文不为0，并且比本接口优先级更小，则忽略该报文。</p></li></ul></li></ol></blockquote><h2 id="VRRP定时器"><a href="#VRRP定时器" class="headerlink" title="VRRP定时器"></a>VRRP定时器</h2><p><strong>VRRP在运行过程中使用两个定时器用来进行状态检测.</strong></p><blockquote><ol><li>通过定时器（adver-timer）:该定时器在主路由器中使用，用来定于通告间隔（adver-interval）.主路由器以该定时器的间隔定期发送VRRP通告报文，用来告知其他备份路由器自己仍在先.通告间隔默认为1秒，可以通过配置进行修改</li><li>主路由器失效时器（master-down-timer）：该定时器在备份路由器中使用，用来定义主路由器失效（mater-down-interval）/主路由器失效间隔指的是备路由器多长时间没有收到主路由器的通告报文后，将认为主路由器一失效，并开始选举新的主路由器.主路由器失效间隔是通告间隔的3倍，默认为3秒</li></ol></blockquote><h2 id="VRRP报文结构"><a href="#VRRP报文结构" class="headerlink" title="VRRP报文结构"></a>VRRP报文结构</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142259.png"></p><blockquote><p>报文格式：VRRP协议的正常工作以来于VRRP报文的正确收发，VRRP之定义了一种报文格式，即通过报文，它被封装在IP报文中，IP头部的协议号字段值为112，报文的目的IP地址是组播地址224.0.0.18.</p><ol><li><p>各个字段的含义如下：</p><ul><li><p>版本（Version）：对于VRRPv2来说，该字段的值恒为2</p></li><li><p>类型（Type）：VRRP之定义了通告报文这一种报文类型.该字段的值恒为1.</p></li><li><p>虚拟路由器ID（VRID）：虚拟路由器的标识符，取值范围是1~255，属于同一个VRRP组的路由器需使用相同的VRID.</p></li><li><p>优先级（Priority）：取值范围0~255，该值越大，则VRRP优先级越高，路由器也就越有可能成为Master</p></li><li><p>IP地址个数（Count IP Address）：VRRP组中虚拟IP地址的个数.这个字段的值指示了改报文后续的”IP地址”字段的个数</p></li><li><p>认证类型（Authentication Type）：VRRP报文的认证烈性，有以下三种情况. </p><p>a. 当该字段为0时，表示无认证（Non Authentication）；</p><p>b. 当该字段为1时，表示明文认证方式（Simple Text Password）；</p><p>c. 当该字段为2时，表示MD5认证方式（IP Authentication Header）；</p></li><li><p>通告间隔（Advertisement Interval）：VRRP报文的发送时间间隔（单位为秒），缺省情况下，VRRP的报文发送时间间隔为1s.</p></li><li><p>校验和（Checksum）：校验和</p></li><li><p>IP地址（IP address）：VRRP虚拟IP地址</p></li><li><p>认证数据（Authentication Data）：VRRP认证数据，当VRRP明文认证或MD5认证被激活时，该字段则填充相应的数据.</p></li></ul></li></ol></blockquote><h2 id="単网关的缺陷"><a href="#単网关的缺陷" class="headerlink" title="単网关的缺陷"></a>単网关的缺陷</h2><p><strong>当网关路由器R-A出现故障时，本网段内以该设备为网关的主机都不能与Internet进行通信.</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142525.png"></p><h2 id="多网关存在的问题"><a href="#多网关存在的问题" class="headerlink" title="多网关存在的问题"></a>多网关存在的问题</h2><blockquote><ol><li>通过部署多网关的方式实现网关的备份</li><li>但多网关可能会出现一些问题：网关间IP地址冲突；主机会频繁切换网络接口</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142608.png"></p><h2 id="VRRP基本结构"><a href="#VRRP基本结构" class="headerlink" title="VRRP基本结构"></a>VRRP基本结构</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142628.png"></p><h2 id="VRRP主备备份工作过程"><a href="#VRRP主备备份工作过程" class="headerlink" title="VRRP主备备份工作过程"></a>VRRP主备备份工作过程</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142642.png"></p><h3 id="VRRP主备路由器切换过程（1）"><a href="#VRRP主备路由器切换过程（1）" class="headerlink" title="VRRP主备路由器切换过程（1）"></a>VRRP主备路由器切换过程（1）</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142706.png"></p><h3 id="VRRP主备路由器切换过程（2）"><a href="#VRRP主备路由器切换过程（2）" class="headerlink" title="VRRP主备路由器切换过程（2）"></a>VRRP主备路由器切换过程（2）</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142726.png"></p><h2 id="VRRP负载分担工作过程"><a href="#VRRP负载分担工作过程" class="headerlink" title="VRRP负载分担工作过程"></a>VRRP负载分担工作过程</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142812.png"></p><h2 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h2><p><strong>如图所示：R1与R2分两个组，组1是由R1为主，组2有R2为主，R1与R2各VRRP组中高优先级设置为150，低优先级设置为120.通过VRRP实现负载分担</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142812.png"></p><h3 id="主机地址配置"><a href="#主机地址配置" class="headerlink" title="主机地址配置"></a>主机地址配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PC2：VPCS&gt; ip 192.168.1.1/24 192.168.1.254</span><br><span class="line">PC3：VPCS&gt; ip 192.168.1.2/24 192.168.1.253</span><br></pre></td></tr></table></figure><h3 id="R1配置"><a href="#R1配置" class="headerlink" title="R1配置"></a>R1配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/1</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.251</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 1 ip 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 1 priority 150</span><br><span class="line"> vrrp 2 ip 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.253</span></span><br><span class="line"> vrrp 2 priority 120</span><br><span class="line">！</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip <span class="selector-tag">address</span> 1<span class="selector-class">.1</span><span class="selector-class">.1</span><span class="selector-class">.1</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.255</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="R2配置"><a href="#R2配置" class="headerlink" title="R2配置"></a>R2配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/1</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.252</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 1 ip 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 1 priority 120</span><br><span class="line"> vrrp 2 ip 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.253</span></span><br><span class="line"> vrrp 2 priority 150</span><br><span class="line">！</span><br><span class="line">interface Loopback0</span><br><span class="line">ip <span class="selector-tag">address</span> 2<span class="selector-class">.2</span><span class="selector-class">.2</span><span class="selector-class">.2</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.255</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="R1"><a href="#R1" class="headerlink" title="R1"></a>R1</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142932.png"></p><h3 id="R2"><a href="#R2" class="headerlink" title="R2"></a>R2</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142946.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117142957.png"></p><h3 id="PC2-通过追踪显然PC2走VRRP组1"><a href="#PC2-通过追踪显然PC2走VRRP组1" class="headerlink" title="PC2:通过追踪显然PC2走VRRP组1"></a>PC2:通过追踪显然PC2走VRRP组1</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143016.png"></p><h3 id="PC3：通过追踪显然PC3走VRRP组2"><a href="#PC3：通过追踪显然PC3走VRRP组2" class="headerlink" title="PC3：通过追踪显然PC3走VRRP组2"></a>PC3：通过追踪显然PC3走VRRP组2</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143029.png"></p><h2 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h2><p><strong>如图所示：在S-A和S-B上配置VRRP，实现主机的网关冗余。所配置的参数.S-A、S-B各VRRP组中高优先级设置为150，低优先级设置为120，并设置抢占功能为5秒</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143047.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143058.png"></p><h3 id="主机地址配置-1"><a href="#主机地址配置-1" class="headerlink" title="主机地址配置"></a>主机地址配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PC1：VPCS&gt; ip 192.168.10.1/24 192.168.10.254</span><br><span class="line">PC2：VPCS&gt; ip 192.168.20.1/24 192.168.20.254</span><br><span class="line">PC3：VPCS&gt; ip 192.168.30.1/24 192.168.30.254</span><br><span class="line">PC4：VPCS&gt; ip 192.168.40.1/24 192.168.40.254</span><br></pre></td></tr></table></figure><h3 id="S-A配置"><a href="#S-A配置" class="headerlink" title="S-A配置"></a>S-A配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vlan</span> 10,20,30,40</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.10</span><span class="selector-class">.252</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 10 ip 192<span class="selector-class">.168</span><span class="selector-class">.10</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 10 preempt delay minimum 5</span><br><span class="line"> vrrp 10 priority 150</span><br><span class="line">!</span><br><span class="line">interface Vlan20</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.20</span><span class="selector-class">.252</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 20 ip 192<span class="selector-class">.168</span><span class="selector-class">.20</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 20 preempt delay minimum 5</span><br><span class="line"> vrrp 20 priority 150</span><br><span class="line">!</span><br><span class="line">interface Vlan30</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.30</span><span class="selector-class">.252</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 30 ip 192<span class="selector-class">.168</span><span class="selector-class">.30</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 30 preempt delay minimum 5</span><br><span class="line"> vrrp 30 priority 120</span><br><span class="line">!</span><br><span class="line">interface Vlan40</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.40</span><span class="selector-class">.252</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 40 ip 192<span class="selector-class">.168</span><span class="selector-class">.40</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 40 preempt delay minimum 5</span><br><span class="line"> vrrp 40 priority 120</span><br><span class="line">!</span><br></pre></td></tr></table></figure><h3 id="S-B配置"><a href="#S-B配置" class="headerlink" title="S-B配置"></a>S-B配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#vlan</span> 10,20,30,40</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.10</span><span class="selector-class">.253</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 10 ip 192<span class="selector-class">.168</span><span class="selector-class">.10</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 10 preempt delay minimum 5</span><br><span class="line"> vrrp 10 priority 120</span><br><span class="line">!</span><br><span class="line">interface Vlan20</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.20</span><span class="selector-class">.253</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 20 ip 192<span class="selector-class">.168</span><span class="selector-class">.20</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 20 preempt delay minimum 5</span><br><span class="line"> vrrp 20 priority 120</span><br><span class="line">!</span><br><span class="line">interface Vlan30</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.30</span><span class="selector-class">.253</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 30 ip 192<span class="selector-class">.168</span><span class="selector-class">.30</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 30 preempt delay minimum 5</span><br><span class="line"> vrrp 30 priority 150</span><br><span class="line">!</span><br><span class="line">interface Vlan40</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.40</span><span class="selector-class">.253</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> vrrp 40 ip 192<span class="selector-class">.168</span><span class="selector-class">.40</span><span class="selector-class">.254</span></span><br><span class="line"> vrrp 40 preempt delay minimum 5</span><br><span class="line"> vrrp 40 priority 150</span><br></pre></td></tr></table></figure><h3 id="S-C配置"><a href="#S-C配置" class="headerlink" title="S-C配置"></a>S-C配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">S-C(config)<span class="selector-id">#vlan</span> 10,20,30,40</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport access vlan 10</span><br><span class="line">switchport mode access</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport access vlan 20</span><br><span class="line">switchport mode access</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line"></span><br><span class="line">S-D：</span><br><span class="line">S-D(config)<span class="selector-id">#vlan</span> 10,20,30,40</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport access vlan 30</span><br><span class="line">switchport mode access</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport access vlan 40</span><br><span class="line">switchport mode access</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置-1"><a href="#使用show查看配置-1" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="S-A"><a href="#S-A" class="headerlink" title="S-A"></a>S-A</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143221.png"></p><h3 id="S-B"><a href="#S-B" class="headerlink" title="S-B"></a>S-B</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143221.png"></p><h3 id="PC1"><a href="#PC1" class="headerlink" title="PC1"></a>PC1</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143234.png"></p><h3 id="PC3"><a href="#PC3" class="headerlink" title="PC3"></a>PC3</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117143244.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VRRP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVLAN</title>
      <link href="2021/01/17/PVLAN/"/>
      <url>2021/01/17/PVLAN/</url>
      
        <content type="html"><![CDATA[<h1 id="PVLAN"><a href="#PVLAN" class="headerlink" title="PVLAN"></a>PVLAN</h1><h2 id="PVLAN应用场景"><a href="#PVLAN应用场景" class="headerlink" title="PVLAN应用场景"></a>PVLAN应用场景</h2><blockquote><ol><li>private vlan的重要功能就是能够实现节约IP地址，隔离广播风暴，病毒攻击，控制端口二层互访.适用于大的二层结构的环境，例如：用户多，vlan多，但是IP地址又是同一个网段，又要实现彼此之间的二层隔离，个别vlan之间又需要访问的情况下，private vlan可以解决上面的问题</li><li>另一种比较典型的PVLAN应用类似于端口隔离功能（switchport protected），即将所有用户端口设置为隔离VLAN(Isolated Port），这样即使同一vlan，同一网段的IP之间的用户也无法访问，可以有效隔离病毒传播。</li></ol></blockquote><h2 id="PVLAN功能介绍"><a href="#PVLAN功能介绍" class="headerlink" title="PVLAN功能介绍"></a>PVLAN功能介绍</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140743.png"></p><blockquote><ol><li>服务提供商如果给每个用户一个VLAN，则由于一台设备支持的VLAN数最大只有4094而限制了服务提供商能支持的用户数；在三层设备上，每个VLAN被分配一个子网地址或一系列地址，这种情况导致IP地址的浪费，对于这个问题我们可以使用private vlan来解决.</li><li>private vlan将一个vlan的二层广播域分成多个子域，每个子域都由一个私有vlan对组成：主vlan（primary vlan）和辅助vlan（secondary vlan）.</li><li>private vlan域中所有的私有vlan共享同一个主vlan</li><li>每个子域的辅助vlan id不同. 一个private vlan域中只有一个主vlan</li></ol></blockquote><p><strong>有两种类型的辅助vlan</strong></p><blockquote><ol><li>隔离vlan（lsolated vlan）：同一个隔离vlan中的端口不可以互相进行二层通信，一个private vlan域中只有一个隔离vlan</li><li>团体vlan（Community vlan）：同一团体vlan中的端口可以互相进行二层通信，但不能与其他群体vlan中的端口进行二层通信，一个private vlan中可以有多个团体vlan</li></ol></blockquote><p><strong>private vlan域内三种常见的端口角色</strong></p><blockquote><ol><li>混杂端口（Promiscuous Port）：混杂端口为主vlan中的端口，可以与任意端口通信，包括同一个Private vlan的隔离端口和团体端口.</li><li>隔离端口（lsolated Port）：隔离vlan中的端口彼此之间不能通信，只能与混杂端口进行通信</li><li>团体端口（Community Port）：属于团体vlan中的端口，同一团体vlan可以进行通信也可以和混杂端口通信，不能与其他团体vlan通信以及隔离端口通信</li><li>只有主vlan可以创建SVI接口，配置IP作为网关使用，辅助vlan不可以创建SVI</li></ol></blockquote><h2 id="SVI接口"><a href="#SVI接口" class="headerlink" title="SVI接口"></a>SVI接口</h2><blockquote><p>SVI（switch virtual interface）交换虚拟接口，即交互三层管理vlan地址，一个由交换端口构成的vlan（其实就是通常所说的vlan接口）用于连接整个vlan。也称为逻辑三层接口. SVI是联系vlan的IP接口，一个SVI只能和一个vlan相联系.</p></blockquote><h2 id="PVLAN实验"><a href="#PVLAN实验" class="headerlink" title="PVLAN实验"></a>PVLAN实验</h2><h3 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h3><p><strong>如图所示：在主vlan中有2个部门，服务器属于主vlan10并配置混杂端口，其中财务部属于隔离vlan20，商务部门属于团体vlan30</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140914.png"></p><h4 id="主机地址配置"><a href="#主机地址配置" class="headerlink" title="主机地址配置"></a>主机地址配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VPC1:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC2:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.2</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC3:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.3</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC4:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.4</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC5:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.5</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br></pre></td></tr></table></figure><h4 id="S1配置"><a href="#S1配置" class="headerlink" title="S1配置"></a>S1配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">vlan 10</span><br><span class="line">  private-vlan primary     <span class="selector-id">#--</span>&gt;设置vlan10为主vlan</span><br><span class="line">  private-vlan association 20,30 <span class="selector-id">#--</span>&gt;关联辅助vlan20和vlan30</span><br><span class="line">!</span><br><span class="line">vlan 20</span><br><span class="line">  private-vlan isolated    <span class="selector-id">#--</span>&gt;设置vlan20为隔离vlan</span><br><span class="line">!</span><br><span class="line">vlan 30</span><br><span class="line">  private-vlan community   <span class="selector-id">#--</span>&gt;设置vlan30为团体vlan</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport private-vlan host-association 10 20</span><br><span class="line">                           #--&gt;将e0/1接口加入到隔离vlan</span><br><span class="line"> switchport mode private-vlan host </span><br><span class="line">                           <span class="selector-id">#--</span>&gt;设置模式为private-vlan</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport private-vlan host-association 10 20 </span><br><span class="line">                           #--&gt;将e0/1接口加入到隔离vlan</span><br><span class="line"> switchport mode private-vlan host </span><br><span class="line">                           <span class="selector-id">#--</span>&gt;设置模式为private-vlan</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport private-vlan host-association 10 30 </span><br><span class="line">                           #--&gt;将e0/1接口加入到团体vlan</span><br><span class="line"> switchport mode private-vlan host </span><br><span class="line">                           <span class="selector-id">#--</span>&gt;设置模式为private-vlan</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line"> switchport private-vlan host-association 10 30 </span><br><span class="line">                           #--&gt;将e0/1接口加入到团体vlan</span><br><span class="line"> switchport mode private-vlan host</span><br><span class="line">                           <span class="selector-id">#--</span>&gt;设置模式为private-vlan</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> private-vlan mapping 20,30  </span><br><span class="line">                           <span class="selector-id">#--</span>&gt;将辅助vlan映射到SVI接口</span><br><span class="line">！</span><br><span class="line">interface  Ethernet1/1</span><br><span class="line">switchport private-vlan mapping 10 11-12</span><br><span class="line">switchport mode private-vlan promiscuous</span><br></pre></td></tr></table></figure><blockquote><ol><li>PC1和PC2隔离vlan不能互相ping通，但是能和主vlan10的PC5ping通</li><li>PC3和PC4团体vlan能互相ping通，也能和主vlan10的PC5ping通</li><li>主vlanPC5能和辅助vlan的全部主机ping通</li></ol></blockquote><h3 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141012.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141019.png"></p><h3 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h3><p><strong>如图所示：三台交换机，一台三层，两台二层，三台交换机分别有主vlan10和辅助vlan11,12，S-A和S-B之间做trunk，S-A和Swith（三层）做混杂端口，Swith（三层）上配置192.168.1.254/24的网关</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141044.png"></p><h4 id="主机地址配置-1"><a href="#主机地址配置-1" class="headerlink" title="主机地址配置"></a>主机地址配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VPC1:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC2:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.2</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC3:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.3</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC4:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.4</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line">VPC5:VPCS&gt; ip <span class="number">192.168</span>.<span class="number">1.5</span>/<span class="number">24</span> <span class="number">192.168</span>.<span class="number">1.254</span></span><br></pre></td></tr></table></figure><h4 id="S-A配置"><a href="#S-A配置" class="headerlink" title="S-A配置"></a>S-A配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">vlan 10</span><br><span class="line">  private-vlan primary</span><br><span class="line">  private-vlan association 11-12</span><br><span class="line">!</span><br><span class="line">vlan 11</span><br><span class="line">  private-vlan community</span><br><span class="line">!</span><br><span class="line">vlan 12</span><br><span class="line">  private-vlan isolated</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport private-vlan host-association 10 11</span><br><span class="line"> switchport mode private-vlan host</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport private-vlan host-association 10 11</span><br><span class="line"> switchport private-vlan mapping 10 11-12</span><br><span class="line"> switchport mode private-vlan promiscuous</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport private-vlan host-association 10 12</span><br><span class="line"> switchport mode private-vlan host</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet1/0</span><br><span class="line"> switchport private-vlan mapping 10 11-12</span><br><span class="line"> switchport mode private-vlan promiscuous</span><br></pre></td></tr></table></figure><h4 id="S-B配置"><a href="#S-B配置" class="headerlink" title="S-B配置"></a>S-B配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vlan 10</span><br><span class="line">  private-vlan primary</span><br><span class="line">  private-vlan association 11-12</span><br><span class="line">!</span><br><span class="line">vlan 11</span><br><span class="line">  private-vlan community</span><br><span class="line">!</span><br><span class="line">vlan 12</span><br><span class="line">  private-vlan isolated</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport private-vlan host-association 10 11</span><br><span class="line"> switchport mode private-vlan host</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport private-vlan host-association 10 12</span><br><span class="line"> switchport mode private-vlan host</span><br></pre></td></tr></table></figure><h4 id="Switch1（三层）配置"><a href="#Switch1（三层）配置" class="headerlink" title="Switch1（三层）配置"></a>Switch1（三层）配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vlan 10</span><br><span class="line">  private-vlan primary</span><br><span class="line">  private-vlan association 11-12</span><br><span class="line">!</span><br><span class="line">vlan 11</span><br><span class="line">  private-vlan community</span><br><span class="line">!</span><br><span class="line">vlan 12</span><br><span class="line">  private-vlan isolated</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line"> private-vlan mapping 11-12</span><br><span class="line">！</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport private-vlan mapping 10 11-12</span><br><span class="line"> switchport mode private-vlan promiscuous</span><br></pre></td></tr></table></figure><blockquote><ol><li>PC3和PC5隔离vlan11不能相通，但是ping通主vlan的SVI接口</li><li>PC1，PC2和PC5团体vlan12可以互相ping通，也可以ping通主vlan的SVI接口</li></ol></blockquote><h4 id="使用show查看配置-1"><a href="#使用show查看配置-1" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h4><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141148.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141202.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117141213.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VLAN实验</title>
      <link href="2021/01/17/VLAN%E5%AE%9E%E9%AA%8C/"/>
      <url>2021/01/17/VLAN%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="VLAN实验"><a href="#VLAN实验" class="headerlink" title="VLAN实验"></a>VLAN实验</h1><h2 id="Access链路应用"><a href="#Access链路应用" class="headerlink" title="Access链路应用"></a>Access链路应用</h2><p><strong>划分了两个VLAN</strong></p><blockquote><p>PC1和PC3网段属于VLAN10<br>PC2和PC4网段属于VLAN20<br>主机地址<br>PC1：192.1.1.1<br>PC2：192.1.1.2<br>PC3：192.1.1.3<br>PC4：192.1.1.4</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135816.png"></p><h3 id="S3配置"><a href="#S3配置" class="headerlink" title="S3配置"></a>S3配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int e0/0</span><br><span class="line">swi mo acc</span><br><span class="line">swi acc vlan 10</span><br><span class="line"></span><br><span class="line">int e0/1</span><br><span class="line">swi mo acc</span><br><span class="line">swi acc vlan 20</span><br><span class="line"></span><br><span class="line">int e0/2</span><br><span class="line">swi mo acc</span><br><span class="line">swi acc vlan 10</span><br><span class="line"></span><br><span class="line">int e0/3</span><br><span class="line">swi mo acc</span><br><span class="line">swi acc vlan 20</span><br></pre></td></tr></table></figure><p><strong>PC1和PC3同属于一个vlan,可以ping通，但是和P2和P4不同vlan不能ping通，换过来说P2和P4也一样不能ping通P1和P3</strong></p><h2 id="Trunk链路应用"><a href="#Trunk链路应用" class="headerlink" title="Trunk链路应用"></a>Trunk链路应用</h2><p><strong>还是根据上面的地址和VLAN划分，添加多了一台交换机</strong></p><h3 id="S1和S2的配置"><a href="#S1和S2的配置" class="headerlink" title="S1和S2的配置"></a>S1和S2的配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">S1：int e0/0</span><br><span class="line">Swi trunk encapsulation dot1q</span><br><span class="line">Swi mode trunk</span><br><span class="line"></span><br><span class="line">S2：int e0/0</span><br><span class="line">Swi trunk encapsulation dot1q</span><br><span class="line">Swi mode trunk</span><br></pre></td></tr></table></figure><p><strong>终端和交换机之间的access接口配置还是一样，两端的交换机需要封装802.1q协议，封装之后，应用trunk模式，同VLAN之间可以通信，不同VLAN还是不能通信</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135919.png"></p><p><strong>使用wireshark抓取的icmp数据包，turnk封装了802.1q，VLAN-id为10</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135937.png"></p><h2 id="交换机不同模式使用出现的问题"><a href="#交换机不同模式使用出现的问题" class="headerlink" title="交换机不同模式使用出现的问题"></a>交换机不同模式使用出现的问题</h2><h3 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h3><p><strong>switch1两个接口都是VLAN10，switch2两个接口都是VLAN20，请问它们可以通信么？</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140005.png"></p><h4 id="switch-1配置"><a href="#switch-1配置" class="headerlink" title="switch 1配置"></a>switch 1配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">S1(config)<span class="selector-id">#vlan</span> 10</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport access vlan 10</span><br><span class="line">switchport mode access</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line">switchport access vlan 10</span><br><span class="line">switchport mode access</span><br></pre></td></tr></table></figure><h4 id="switch-2配置"><a href="#switch-2配置" class="headerlink" title="switch 2配置"></a>switch 2配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">S2(config)<span class="selector-id">#vlan</span> 20</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport access vlan 20</span><br><span class="line">switchport mode access</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line">switchport access vlan 20</span><br><span class="line">switchport mode access</span><br></pre></td></tr></table></figure><p><strong>答：不能通信，因为VLAN需要同步</strong></p><p><strong>修改配置：两者交换机同步既可以通信了</strong></p><blockquote><p>switch 1<br>S1(config)#vlan 10<br>S1(config)#vlan 20</p><p>switch 2<br>S2(config)#vlan 10<br>S2(config)#vlan 20</p></blockquote><p><strong>答：两边VLAN同步，两边的接口都是相同的vlan-id，而access接口发送出去的一定是无标记帧</strong></p><blockquote><p>说明：PC1发送数据包给PC2，进入到switch1中，没有标签的数据包会打上vlan-id标签，发现目标是从自己gi0/1接口出去的，查看自己的gi0/1接口vlan-id标签，发现标签是一致，然后剥开vlan-id标签发送给switch2，接着switch2情况也和switch1一样.最终抵达PC2</p></blockquote><h3 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h3><p><strong>switch2的access-VLAN20接口改成trunk-VLAN20，请问PC1能pingPC2么?</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140148.png"></p><h4 id="switch-2的配置"><a href="#switch-2的配置" class="headerlink" title="switch 2的配置"></a>switch 2的配置</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport trunk native vlan 20</span><br><span class="line">switchport mode trunk</span><br></pre></td></tr></table></figure><p><strong>答：不能ping通，因为模式不一样，一个是没有封装802.1q，一个没有封装了802.1q，匹配不成功，所以数据不可达</strong></p><h3 id="问题3"><a href="#问题3" class="headerlink" title="问题3"></a>问题3</h3><p><strong>switch1的g0/1接口设置成为trunk-VLAN10，switch2还是原来的trunk-VLAN20，PC1能否ping通PC2</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140242.png"></p><p><strong>答：不能ping通</strong></p><blockquote><ol><li>不同vlan不能相通</li><li>如果两台通信的交换机配置的native vlan不一致,就会出现mismatch（不匹配）错误，两端的native vlan不匹配的trunk链路,一端的端口会被block住,而不会转发流量.</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140326.png"></p><h2 id="综合实验"><a href="#综合实验" class="headerlink" title="综合实验"></a>综合实验</h2><blockquote><ol><li>s2两端都为access-vlan10，s3连接终端的接口为access-vlan20，连接三层交换机的接口为trunk-vlan20.</li><li>s1三层交换机gi0/1接口为192.168.1.254,gi0/0接口为172.16.1.254.</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117140354.png"></p><h3 id="主机地址配置"><a href="#主机地址配置" class="headerlink" title="主机地址配置"></a>主机地址配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PC3</span><br><span class="line">VPCS&gt; ip 192.168.1.1/24 192.168.1.25</span><br><span class="line">PC4</span><br><span class="line">VPCS&gt; ip 172.16.1.1/24 172.16.1.254</span><br></pre></td></tr></table></figure><h3 id="S2配置"><a href="#S2配置" class="headerlink" title="S2配置"></a>S2配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br></pre></td></tr></table></figure><h3 id="S3配置-1"><a href="#S3配置-1" class="headerlink" title="S3配置"></a>S3配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport access vlan 20</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport trunk native vlan 20</span><br><span class="line"> switchport mode trunk</span><br></pre></td></tr></table></figure><h3 id="S1配置"><a href="#S1配置" class="headerlink" title="S1配置"></a>S1配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> no switchport</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br></pre></td></tr></table></figure><p><strong>上面的配置配置完，PC3可以ping通PC4，为什么可以相通.</strong></p><blockquote><p>答：PC3发送数据包给PC4，中间的access口都是透明，可以找到自己的网关，发现下一跳的路由是172.16.1.0/24，对应的接口是gi0/0，然后从gi0/0接口转发出去给S3的gi0/1接口，gi0/1接收到没有打标签的包，随即打上native标签20转发给gi0/0接口，gi0/0接口检查发送过来native跟自己的native是否一致，一致则剥开标签转发给PC4，数据包抵达目的.</p><p>如果S3的gi0/1接口没有打上native-id20，那么将不能通信，因为跟access的接口native不对应，所以目标不可达</p><p>S3接口设置了native-id20，那么对应上access的native，则查看允许通过列表是否通过，通过则转发数据，不通过则丢弃</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VLAN原理</title>
      <link href="2021/01/17/VLAN%E5%8E%9F%E7%90%86/"/>
      <url>2021/01/17/VLAN%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="VLAN原理"><a href="#VLAN原理" class="headerlink" title="VLAN原理"></a>VLAN原理</h1><h2 id="广播域过大带来的影响"><a href="#广播域过大带来的影响" class="headerlink" title="广播域过大带来的影响"></a>广播域过大带来的影响</h2><blockquote><ol><li>广播帧泛洪产生大量的数据包（消耗交换机的资源）</li><li>由于都处于一个广播，安全性没有了保障（降低了安全性）</li></ol></blockquote><h2 id="VLAN（虚拟局域网virtual-LAN）"><a href="#VLAN（虚拟局域网virtual-LAN）" class="headerlink" title="VLAN（虚拟局域网virtual LAN）"></a>VLAN（虚拟局域网virtual LAN）</h2><blockquote><ol><li>VLAN的出现减少了广播带来负担，并且提高了安全性</li><li>VLAN号共有4096个，0-4095</li><li>0,4095：这两个号保留，仅限系统使用。用户不能查看。</li><li>CISCO默认VLAN1，不能删除。也同样不能做修改</li><li>2－1001：用于以太网的VLAN，用户可根据这一段号码自己创建VLAN</li><li>1002－1005：用于FDDI和令牌环的默认VLAN，不能删除。</li><li>1006－4094：仅用于以太网的VLAN. 扩展的VLAN，只有3550以上的交换机才能配，且必须将VTP模式设为透明模式。</li></ol></blockquote><h2 id="VLAN的作用"><a href="#VLAN的作用" class="headerlink" title="VLAN的作用"></a>VLAN的作用</h2><blockquote><ol><li>隔离广播域</li><li>VLAN将一个局域网划分成多个虚拟局域网（简单的说把一台交换机划分了多个小型交换机）</li><li>增加了局域网的安全性（不同VLAN之间不能互相通信）</li></ol></blockquote><h2 id="Access接入链路"><a href="#Access接入链路" class="headerlink" title="Access接入链路"></a>Access接入链路</h2><p><strong>Access链路一般应用于终端和交换机之间</strong></p><blockquote><p>一般部署在终端和交换机之间,一个access口属于一个VLAN接收到不带tag的数据帧时会打上接口的native-id后接收</p><ol><li>从access接口发送出去的帧一定是无标记帧</li><li>交换机上接收带tag的数据帧,则对比tag与native-id是否一致,如果相同则接收,如果不同则丢弃.</li><li>交换机发送数据帧与接口的native-id进行对比,一致则剥离tag发送,如果不同,则直接丢弃该数据帧</li></ol></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135130.png"></p><h2 id="Trunk干道链路"><a href="#Trunk干道链路" class="headerlink" title="Trunk干道链路"></a>Trunk干道链路</h2><p><strong>Trunk链路：用于交换机和交换机之间</strong></p><blockquote><ol><li><p>交换机从trunk链路接收数据帧</p><ul><li><p>带Tag,直接对比允许通过列表</p></li><li><p>不带Tag,打上端口的native-id,对比native-id是否在允许通过列表</p></li></ul></li><li><p>交换机将数据帧从trunk链路发送出去</p><ul><li><p>Tag与端口的native-id相同时,剥离Tag后对比允许通过列表</p></li><li><p>Tag与端口的native不同时,则直接将Tag对比允许通过列表</p></li></ul></li><li><p>native（本地vian-id）说明：</p><ul><li>如果两台通信的交换机配置的native vlan不一致,就会出现mismatch（不匹配）错误,两端的native vlan不匹配的trunk链路,一端的端口会被block住,而不会转发流量.</li></ul></li></ol></blockquote><h2 id="802-1Q报文格式"><a href="#802-1Q报文格式" class="headerlink" title="802.1Q报文格式"></a>802.1Q报文格式</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135304.png"></p><p><strong>四个字节的标签头包含了2个字节的标签协议标识（TPID）和2个字节的标签控制信息（TCI）</strong></p><p><strong>TPID（Tag Protocol Identifier）是IEEE定义的新的类型,表明这是一个加了802.1Q标签的帧. TPID包含了一个固定的值0x8100</strong></p><p><strong>TCI是包含的是帧的控制信息,它包含了下面的一些元素：</strong></p><blockquote><ol><li>PRI字段主要用于QOS,默认值为0,范围为0-7,其中数值越大越优先,当交换机发生拥塞时,PRI数据越大的数据帧会达到优先转发</li><li>Canonical Format Indicator(CFI)：CFI值为0说明是规范格式,1为非规范格式,它被用在令牌环/源路由FDDiscard介质访问方法中来指示封装帧中所带地址的比特次序信息</li><li>VLAN的ID,取值范围为0-4095,一共4096个,由于0和4095的协议保留取值,所以VLAN ID的取值范围为1-4094每个支持802.1Q协议的交换机发送出来的数据包都会包含这个域,以指明主机属于哪一个VLAN.</li></ol></blockquote><p><strong><code>注意：终端设备在网卡不支持VLAN id的情况下会直接丢弃携带VLAN Tag的数据帧</code></strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117135436.png"></p><h2 id="Hybrid混合链路"><a href="#Hybrid混合链路" class="headerlink" title="Hybrid混合链路"></a>Hybrid混合链路</h2><p><strong>混合链路：华为默认的交换机的端口类型,同时具有access链路与trunk链路,可以部署在任何的交换机链路上</strong></p><blockquote><ol><li>Hybrid端口既可以连接主机,又可以连接交换机</li><li>Hybrid端口可以以Tagged或Untagged方式加入VLAN</li><li>接收报文的处理与trunk接口处理方式一致</li></ol></blockquote><h3 id="发送报文"><a href="#发送报文" class="headerlink" title="发送报文"></a>发送报文</h3><blockquote><p>Port hybrid tagged vlan x:在发送数据帧时允许VLAN x通过,保持tag发送<br>Port hybrid tagged vlan x:在发送数据帧时允许VLAN x 通过,将tag剥离后再发出</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MSTP</title>
      <link href="2021/01/17/MSTP/"/>
      <url>2021/01/17/MSTP/</url>
      
        <content type="html"><![CDATA[<h1 id="MSTP"><a href="#MSTP" class="headerlink" title="MSTP"></a>MSTP</h1><h2 id="MSTP概述"><a href="#MSTP概述" class="headerlink" title="MSTP概述"></a>MSTP概述</h2><p><strong>多生成树协议（Multi spanning tree protocol）</strong></p><blockquote><ol><li>MSTP（多生成树实例）：MSTP生成树不是基于VLAN运行的，而是基于Instance（实例）运行的。可以把一个或多个VLAN映射到Instance，然后Instance计算生成树。基于Instance的生成树被称为MSTI（多生成树实例）。</li><li>MSTP为每个Instance维护独立的MSTI。映射到同一个Instance的VLAN将共享同一棵生成树。</li><li>每个MSTP引入了域的概念，我们可以将一个大型的交换网络划分成多个MST域（多生成域）一个MST域内可以包含一台或者多台交换机。同属一个域的交换机必须配置相同的域名，相同的修订级别，以及相同的VLNA与Instance的映射关系。</li><li>每个MST域内都存在一棵IST（内部生成树）缺省时，交换机上的所有VLNA属于Instance０，而IST则是MST域内的交换机对Instance０计算出的一棵生成树。</li><li>缺省时，MST域名是交换设备主控板上管理网口的MAC地址。</li></ol></blockquote><h2 id="单生成树的弊端-部分VLAN路径不通"><a href="#单生成树的弊端-部分VLAN路径不通" class="headerlink" title="单生成树的弊端-部分VLAN路径不通"></a>单生成树的弊端-部分VLAN路径不通</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117130807.png"></p><h2 id="单生成树的弊端-无法实现流量分担"><a href="#单生成树的弊端-无法实现流量分担" class="headerlink" title="单生成树的弊端-无法实现流量分担"></a>单生成树的弊端-无法实现流量分担</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117130826.png"></p><h2 id="单生成树的弊端-次优二层路径"><a href="#单生成树的弊端-次优二层路径" class="headerlink" title="单生成树的弊端-次优二层路径"></a>单生成树的弊端-次优二层路径</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117130849.png"></p><h2 id="多生成树实例解决单生成树弊端"><a href="#多生成树实例解决单生成树弊端" class="headerlink" title="多生成树实例解决单生成树弊端"></a>多生成树实例解决单生成树弊端</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117130905.png"></p><h2 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h2><p><strong>如图所示：在数据中心交换机SW1、SW2上配置MSTP防止二层环路；要求VLAN10数据流经过SW1转发，VLAN20数据流经过SW2转发，SW1和SW2其中一台宕机时均可无缝切换至另一台进行转发。switch 是两台PC的网关，所配置的参数要求如下：</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">region-name为cisco；</span><br><span class="line">revision版本为1；</span><br><span class="line">实例1，包含VLAN10</span><br><span class="line">实例2，包含VLAN20</span><br><span class="line">SW1作为实例1中的主根，SW2作为实例1的从根；</span><br><span class="line">SW2作为实例2中的主根，SW1作为实例2的从根；</span><br><span class="line">主根优先级为4096，从根优先级为8192；</span><br><span class="line">网关：PC1-192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> PC2-172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.254</span> </span><br></pre></td></tr></table></figure><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131008.png"></p><h3 id="配置主机地址"><a href="#配置主机地址" class="headerlink" title="配置主机地址"></a>配置主机地址</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PC1：VPCS&gt; ip 192.168.1.1/24 192.168.1.254</span><br><span class="line">PC2：VPCS&gt; ip 172.16.1.1/24 172.16.1.254</span><br></pre></td></tr></table></figure><h3 id="Switch配置"><a href="#Switch配置" class="headerlink" title="Switch配置"></a>Switch配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)<span class="selector-id">#vlan</span> 10,20</span><br><span class="line">interface GigabitEthernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Vlan10</span><br><span class="line"> ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br><span class="line">!</span><br><span class="line">interface Vlan20</span><br><span class="line"> ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.254</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.0</span></span><br></pre></td></tr></table></figure><h3 id="S1配置"><a href="#S1配置" class="headerlink" title="S1配置"></a>S1配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">S1(config)<span class="selector-id">#vlan</span> 10,20</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">！</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line"> name cisco  <span class="selector-id">#--</span>&gt;域名（同一域必须相同）</span><br><span class="line"> revision 1  <span class="selector-id">#--</span>&gt;修订号</span><br><span class="line"> instance 1 vlan 10  <span class="selector-id">#--</span>&gt;实例1关联vlan10</span><br><span class="line"> instance 2 vlan 20  <span class="selector-id">#--</span>&gt;实例2关联vlan20</span><br><span class="line">!</span><br><span class="line">spanning-tree mst 1 priority 4096 <span class="selector-id">#--</span>&gt;设置实例1优先级为4096</span><br><span class="line">spanning-tree mst 2 priority 8192 <span class="selector-id">#--</span>&gt;设置实例2优先级为8192</span><br></pre></td></tr></table></figure><h3 id="S2配置"><a href="#S2配置" class="headerlink" title="S2配置"></a>S2配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">S2(config)<span class="selector-id">#vlan</span> 10,20</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">！</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line"> name cisco</span><br><span class="line"> revision 1</span><br><span class="line"> instance 1 vlan 10</span><br><span class="line"> instance 2 vlan 20</span><br><span class="line">!</span><br><span class="line">spanning-tree mst 1 priority 8192</span><br><span class="line">spanning-tree mst 2 priority 4096</span><br></pre></td></tr></table></figure><h3 id="S3配置"><a href="#S3配置" class="headerlink" title="S3配置"></a>S3配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">S3(config)<span class="selector-id">#vlan</span> 10,20</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> switchport access vlan 10</span><br><span class="line"> switchport mode access</span><br><span class="line"> spanning-tree portfast edge     <span class="selector-id">#--</span>开启边缘端口</span><br><span class="line"> spanning-tree bpduguard enable  <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line"> switchport access vlan 20</span><br><span class="line"> switchport mode access</span><br><span class="line"> spanning-tree portfast edge</span><br><span class="line"> spanning-tree bpduguard enable</span><br><span class="line">！</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line"> name cisco</span><br><span class="line"> revision 1</span><br><span class="line"> instance 1 vlan 10</span><br><span class="line"> instance 2 vlan 20</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="S1配置：实例1关联VLAN10"><a href="#S1配置：实例1关联VLAN10" class="headerlink" title="S1配置：实例1关联VLAN10"></a>S1配置：实例1关联VLAN10</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131142.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131153.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131204.png"></p><h3 id="S2：实例2关联VLAN20"><a href="#S2：实例2关联VLAN20" class="headerlink" title="S2：实例2关联VLAN20"></a>S2：实例2关联VLAN20</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131220.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131233.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131241.png"></p><h3 id="S3：实例1关联着VLAN10，所以E0-1接口是AP口，实例2关联着VLAN20，所以E0-0接口是AP口"><a href="#S3：实例1关联着VLAN10，所以E0-1接口是AP口，实例2关联着VLAN20，所以E0-0接口是AP口" class="headerlink" title="S3：实例1关联着VLAN10，所以E0/1接口是AP口，实例2关联着VLAN20，所以E0/0接口是AP口."></a>S3：实例1关联着VLAN10，所以E0/1接口是AP口，实例2关联着VLAN20，所以E0/0接口是AP口.</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131302.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131332.png"></p><h2 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h2><p><strong>如图所示：某小型办公区域网络由四台电脑，需要将办公区域内的计算机划分成四个区域，分别是vlan10，vlan20，vlan30和vlan40，接入层交换机每个vlan连接一台计算机，要求VLAN10、VLAN20数据流经过S1-1转发，VLAN30、VLAN40数据流经过S1-2转发，S1-1，S1-2其中一台宕机时均可无缝切换至另一台进行转发。所配置的参数要求如下</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">region-name为cisco；</span><br><span class="line">revision版本为1；</span><br><span class="line">实例1，包含VLAN10，VLAN20;</span><br><span class="line">实例2，包含VLAN40，VLAN50;</span><br><span class="line">S1-1作为实例0、1中的主根，S1-2作为实例0、1的从根；</span><br><span class="line">S1-1作为实例2中的主根，S1-2作为实例2的从根；</span><br><span class="line">主根优先级为4096，从根优先级为8192；</span><br><span class="line">地址和网关：</span><br><span class="line">vlan10-192.168.1.1/28，192.168.1.14</span><br><span class="line">vlan20-192.168.1.17/28 ，192.168.1.30</span><br><span class="line">vlan30-172.16.1.1/28，172.16.1.14</span><br><span class="line">vlan40-172.16.1.17/28，172.16.1.30 </span><br></pre></td></tr></table></figure><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131424.png"></p><h3 id="配置主机地址-1"><a href="#配置主机地址-1" class="headerlink" title="配置主机地址"></a>配置主机地址</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PC1：VPCS&gt; ip 192.168.1.1/28 192.168.1.14</span><br><span class="line">PC2：VPCS&gt; ip 192.168.1.17/28 192.168.1.30</span><br><span class="line">PC3：VPCS&gt; ip 172.16.1.1/28 172.16.1.14</span><br><span class="line">PC3：VPCS&gt; ip 172.16.1.17/28 172.16.1.30</span><br></pre></td></tr></table></figure><h3 id="Switch配置-1"><a href="#Switch配置-1" class="headerlink" title="Switch配置"></a>Switch配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface GigabitEthernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">! </span><br><span class="line">interface Vlan10</span><br><span class="line">ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.14</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.240</span></span><br><span class="line">!</span><br><span class="line">interface Vlan20</span><br><span class="line">ip <span class="selector-tag">address</span> 192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.30</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.240</span></span><br><span class="line">!</span><br><span class="line">interface Vlan30</span><br><span class="line">ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.14</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.240</span></span><br><span class="line">!</span><br><span class="line">interface Vlan40</span><br><span class="line">ip <span class="selector-tag">address</span> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.30</span> 255<span class="selector-class">.255</span><span class="selector-class">.255</span><span class="selector-class">.240</span></span><br></pre></td></tr></table></figure><h3 id="S1-1配置"><a href="#S1-1配置" class="headerlink" title="S1-1配置"></a>S1-1配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line">name cisco</span><br><span class="line">revision 1</span><br><span class="line">instance 1 vlan 10, 20</span><br><span class="line">instance 2 vlan 30, 40</span><br><span class="line">!</span><br><span class="line">spanning-tree mst 0-1 priority 4096</span><br><span class="line">spanning-tree mst 2 priority 8192</span><br></pre></td></tr></table></figure><h3 id="S1-2配置"><a href="#S1-2配置" class="headerlink" title="S1-2配置"></a>S1-2配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line">name cisco</span><br><span class="line">revision 1</span><br><span class="line">instance 1 vlan 10, 20</span><br><span class="line">instance 2 vlan 30, 40</span><br><span class="line">!</span><br><span class="line">spanning-tree mst 0-1 priority 8192</span><br><span class="line">spanning-tree mst 2 priority 4096</span><br></pre></td></tr></table></figure><h3 id="S1-3配置"><a href="#S1-3配置" class="headerlink" title="S1-3配置"></a>S1-3配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport access vlan 10</span><br><span class="line">switchport mode access</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>开启边缘端口</span><br><span class="line">spanning-tree bpduguard enable #--&gt;开启BPDU保护&#x27;</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line">switchport access vlan 20</span><br><span class="line">switchport mode access</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>开启边缘端口</span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line">!</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line">name cisco</span><br><span class="line">revision 1</span><br><span class="line">instance 1 vlan 10, 20</span><br><span class="line">instance 2 vlan 30, 40</span><br></pre></td></tr></table></figure><h3 id="S1-4配置"><a href="#S1-4配置" class="headerlink" title="S1-4配置"></a>S1-4配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport access vlan 20</span><br><span class="line">switchport mode access</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>开启边缘端口</span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line">switchport access vlan 10</span><br><span class="line">switchport mode access</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>开启边缘端口</span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line">!</span><br><span class="line">spanning-tree mst configuration</span><br><span class="line">name cisco</span><br><span class="line">revision 1</span><br><span class="line">instance 1 vlan 10, 20</span><br><span class="line">instance 2 vlan 30, 40</span><br></pre></td></tr></table></figure><h3 id="主机互ping测试"><a href="#主机互ping测试" class="headerlink" title="主机互ping测试"></a>主机互ping测试</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117131554.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSTP</title>
      <link href="2021/01/17/RSTP/"/>
      <url>2021/01/17/RSTP/</url>
      
        <content type="html"><![CDATA[<h1 id="RSTP"><a href="#RSTP" class="headerlink" title="RSTP"></a>RSTP</h1><h2 id="RSTP对STP的改进"><a href="#RSTP对STP的改进" class="headerlink" title="RSTP对STP的改进"></a>RSTP对STP的改进</h2><p><strong>端口角色发生变化</strong></p><blockquote><ol><li><p>新增 AP（预备端口）和 BP（备份端口）</p><ul><li><p>AP（预备端口）：</p><p>a. 当交换机的RP端口down掉时，AP端口会立刻成为AP端口，并且立刻进入forwarding状态。</p></li><li><p>BP（备份端口）：</p><p>a. 当交换机从一个接口收到一份BPDU报文，包含的发送者桥ID为本身交换机的桥ID同时BPDU比本地接口的BPDU优时，则接口会被选为BP端口。</p><p>b. 当DP端口down掉时，BP端口需要等待18s的时间才会成为DP端口。</p></li></ul></li><li><p>新增边缘端口：</p><ul><li><p>边缘端口（EP）：由网络管理员手工配置，配置在交换机链接终端设备（电脑，AP，服务器等）</p></li><li><p>特性：</p><p>a. 一旦端口被设置为边缘端口，端口立刻进入forwarding状态。</p><p>b. 边缘端口UP/down不会引起RSTP的网络拓扑变化。</p><p>c. RSTP的网络拓扑不会影响边缘端口的通信。</p></li></ul></li></ol></blockquote><p><strong>RSTP增加的快速机制：</strong></p><blockquote><ol><li>RSTP快速收敛机制一：当交换机的RP端口down掉时，AP端口会立刻成为AP端口，并且立刻进入forwarding状态。</li><li>RSTP快速收敛机制二：当端口设置为边缘端口，会立刻进入forwarding状态</li></ol></blockquote><h2 id="边缘端口的机制："><a href="#边缘端口的机制：" class="headerlink" title="边缘端口的机制："></a>边缘端口的机制：</h2><blockquote><ol><li>边缘端口会每2s向外泛洪BPDU。</li><li>当边缘端口收到BPDU时，会丧失边缘端口的特性，成为普通的RSTP端口执行计算。</li></ol></blockquote><h2 id="开启BPDU保护功能："><a href="#开启BPDU保护功能：" class="headerlink" title="开启BPDU保护功能："></a>开启BPDU保护功能：</h2><blockquote><ol><li>在接口视图下：spanning-tree bpduguard enable</li><li>在全局试图下：spanning-tree portfast edge bpduguard default<ul><li>只针对边缘端口生效，边缘端口收到BPDU报文时直接进入error-down的状态。同时产生一份告警日志通知网络管理员。</li><li>error-down的接口需要网络管理员手动开启，从新开启边缘端口，断电之后在接口模式下no shutdown</li></ul></li></ol></blockquote><h2 id="RSTP端口状态："><a href="#RSTP端口状态：" class="headerlink" title="RSTP端口状态："></a>RSTP端口状态：</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117113730.png"></p><h2 id="针对问题一：P-A机制（1）"><a href="#针对问题一：P-A机制（1）" class="headerlink" title="针对问题一：P/A机制（1）"></a>针对问题一：P/A机制（1）</h2><p><strong><code>P/A（proposa/Agreement）提议/同意</code></strong></p><p><strong>P/A机制的基本原理</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117113837.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114100.png"></p><h2 id="针对问题一：P-A机制（2）"><a href="#针对问题一：P-A机制（2）" class="headerlink" title="针对问题一：P/A机制（2）"></a>针对问题一：P/A机制（2）</h2><p><strong>RSTP选举原理和STP本质上相同：选举根交换机-选举非根交换机上的根端口-选举指定端口-选举预备端口和备份端口</strong></p><blockquote><p>但是RSTP在选举的过程中加入了“发起请求-回复同意”（P/A机制）这种确认机制由于每个步骤有确认就不需要依赖计时器来保证网络拓扑无环才去转发只需要考虑BPDU发送报文并计算无环拓扑的时间（一般都是秒级）。</p></blockquote><h2 id="针对问题二：根端口快速切换机制"><a href="#针对问题二：根端口快速切换机制" class="headerlink" title="针对问题二：根端口快速切换机制"></a>针对问题二：根端口快速切换机制</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114321.png"></p><h2 id="针对问题三：次等BPDU处理机制"><a href="#针对问题三：次等BPDU处理机制" class="headerlink" title="针对问题三：次等BPDU处理机制"></a>针对问题三：次等BPDU处理机制</h2><p><strong>S2与S1的直连链路down掉，SWC的AP端口切换成DP端口并进入转发状态秒级时间内完成.</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114341.png"></p><h2 id="针对问题四：边缘端口的引入"><a href="#针对问题四：边缘端口的引入" class="headerlink" title="针对问题四：边缘端口的引入"></a>针对问题四：边缘端口的引入</h2><p><strong>在RSTP中，交换机连接终端的链路可立即进入转发状态</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114404.png"></p><h2 id="RSTP-BDPU保护"><a href="#RSTP-BDPU保护" class="headerlink" title="RSTP-BDPU保护"></a>RSTP-BDPU保护</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114544.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114558.png"></p><h2 id="RSTP-根保护"><a href="#RSTP-根保护" class="headerlink" title="RSTP-根保护"></a>RSTP-根保护</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114616.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114625.png"></p><h2 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h2><p><strong>如图所示，S1，S2和S3组成一个环型的交换网络，为了消除环路对网络的影响，交换机都运行了RSTP，最终将环形网络结构修剪成无环路的树形网络结构.</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114714.png"></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PC4：VPCS&gt; ip 192.168.1.1/24</span><br><span class="line">PC5：VPCS&gt; ip 192.168.1.2/24</span><br><span class="line"></span><br><span class="line">S1：</span><br><span class="line">S1(config)<span class="selector-id">#spanning-tree</span> mo rapid-pvst <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line"></span><br><span class="line">S2：</span><br><span class="line">S2(config)<span class="selector-id">#spanning-tree</span> mo rapid-pvst <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> spanning-tree portfast edge     <span class="selector-id">#--</span>&gt;开启边缘端口</span><br><span class="line"> spanning-tree bpduguard enable  <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line"></span><br><span class="line">S3：</span><br><span class="line">S3(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst  <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> spanning-tree portfast edge      <span class="selector-id">#--</span>&gt;开启边缘端口</span><br><span class="line"> spanning-tree bpduguard enable   <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><p><strong><code>思科</code>全局下开启BPDU保护（不建议）</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S2(config)<span class="selector-id">#spanning-tree</span> portfast edge bpduguard default</span><br></pre></td></tr></table></figure><h3 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h3><p><strong>在相同优先级情况下，比较MAC地址，S1-MAC地址是三台交换机中最小的，所以S1为根桥，而S3地址最大，它的e0/0接口会成为AP接口</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114837.png"></p><h3 id="S1"><a href="#S1" class="headerlink" title="S1"></a>S1</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114904.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114913.png"></p><h3 id="S2"><a href="#S2" class="headerlink" title="S2"></a>S2</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114938.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114928.png"></p><h3 id="S3"><a href="#S3" class="headerlink" title="S3"></a>S3</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114951.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114959.png"></p><p><strong>当S3关闭e0/1接口，RSTP很快就切换了e0/0端口，PC2:长ping：VPCS&gt; ping 192.168.1.1 -tS3关闭e0/1接口，RSTP很快就切换了e0/0端口，PC2:长ping：VPCS&gt; ping  192.168.1.1 -t</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115022.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115030.png"></p><h2 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h2><p><strong>如图所示，S-A，S-B，S-C，S-D组成一个环型的交换网络，为了消除环路对网络的影响，交换机都运行了RSTP，最终将环形网络结构修剪成无环路的树形网络结构</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115053.png"></p><p><strong>用快速生成树协议实现负载均衡：通过修改桥优先级，控制交换机S-A是人事部的根桥，S-B是人事部的次根桥；控制交换机S-A是研发部的次根桥，S-B是研发部的根桥.</strong></p><p><strong>vlan10-vlan20通过e1/0链路，vlan30-vlan40通过e1/1链路.用快速生成树协议实现负载均衡：通过修改桥优先级，控制交换机S-A是人事部的根桥，S-B是人事部的次根桥；控制交换机S-A是研发部的次根桥，S-B是研发部的根桥，vlan10-vlan20通过e1/0链路，vlan30-vlan40通过e1/1链路.</strong></p><h3 id="开启快速生成树"><a href="#开启快速生成树" class="headerlink" title="开启快速生成树"></a>开启快速生成树</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst <span class="selector-id">#--</span>&gt;配置快速生成树</span><br><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br><span class="line">S-C(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br><span class="line">S-D(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br></pre></td></tr></table></figure><h3 id="S-A"><a href="#S-A" class="headerlink" title="S-A"></a>S-A</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vlan</span> 10,20,30,40   </span><br><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vtp</span> mode server     <span class="selector-id">#--</span>&gt;开启VTP模式为服务器，思科私有</span><br><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vtp</span> domain 123456   <span class="selector-id">#--</span>&gt;配置一个名字</span><br><span class="line">！</span><br><span class="line">spanning-tree vlan 10,20 priority 4096 </span><br><span class="line">spanning-tree vlan 30,40 priority 8192</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">！</span><br><span class="line">interface Ethernet1/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet1/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br></pre></td></tr></table></figure><h3 id="S-B"><a href="#S-B" class="headerlink" title="S-B"></a>S-B</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#vtp</span> mode client          <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">spanning-tree vlan 10,20 priority 8192</span><br><span class="line">spanning-tree vlan 30,40 priority 4096</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!         </span><br><span class="line">interface Ethernet1/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet1/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree vlan 30,40 port-priority 64</span><br></pre></td></tr></table></figure><h3 id="S-C"><a href="#S-C" class="headerlink" title="S-C"></a>S-C</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">S-C(config)<span class="selector-id">#vtp</span> mode client <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-C(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！ </span><br><span class="line">interface Ethernet0/0</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>&gt;开启边缘端口 </span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><h3 id="S-D"><a href="#S-D" class="headerlink" title="S-D"></a>S-D</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">S-D(config)<span class="selector-id">#vtp</span> mode client <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-D(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！ </span><br><span class="line">interface Ethernet0/0</span><br><span class="line">spanning-tree portfast edge    <span class="selector-id">#--</span>&gt;开启边缘端口 </span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置-1"><a href="#使用show查看配置-1" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="S-A-1"><a href="#S-A-1" class="headerlink" title="S-A"></a>S-A</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115336.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115348.png"></p><h3 id="S-B-1"><a href="#S-B-1" class="headerlink" title="S-B"></a>S-B</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115422.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115431.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STP</title>
      <link href="2021/01/17/STP/"/>
      <url>2021/01/17/STP/</url>
      
        <content type="html"><![CDATA[<h1 id="STP"><a href="#STP" class="headerlink" title="STP"></a>STP</h1><h2 id="二层环路的影响"><a href="#二层环路的影响" class="headerlink" title="二层环路的影响"></a>二层环路的影响</h2><p>1）广播风暴：数据帧不断的循环发送，导致需要耗费大量的CPU处理<br>2）MAC地址表的震荡：由于交换机的接口不断地收到同一个数据帧导致MAC地址表项不断被覆盖，交换机需要耗费大量的开销维护MAC地址表</p><blockquote><p>总结：如果不解决环路会大量消耗交换机的设备开销带宽资源，当CPU使用率过高很可能导致交换机开启过热保护，导致交换机断点，业务中断</p></blockquote><h2 id="为什么需要生成树"><a href="#为什么需要生成树" class="headerlink" title="为什么需要生成树"></a>为什么需要生成树</h2><p>1）生成树的出现不是真的需要，而是间接的需要<br>2）二层环境中需要备份和冗余</p><p><strong>在这种环境中没有环路，但是缺少了备份</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111155.png"></p><p><strong>在这种环境中解决了备份，但是不做处理会导致环路，这时STP就有发挥它的作用了</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111306.png"></p><h2 id="STP作用"><a href="#STP作用" class="headerlink" title="STP作用"></a>STP作用</h2><p><strong>STP在保证网络的冗余性的同时，保证交换机网络中不会出现二层环路</strong></p><blockquote><p>原理：通过在逻辑上阻塞某一些端口，使交换机成为树形网络，破除环路在链路上或设备发生故障时，又重新启动阻塞端口，使网络恢复数据转发.</p></blockquote><h2 id="STP如何计算阻塞端口"><a href="#STP如何计算阻塞端口" class="headerlink" title="STP如何计算阻塞端口"></a>STP如何计算阻塞端口</h2><p><strong>STP选举根桥与端口角色的过程都是由交换机自主完成的，交换机选举中都会发送一种包，这种数据包叫做BPDU(Bridge Protocol Data Unit)网桥协议数据单元</strong></p><blockquote><ol><li><p>通过选举根桥</p><ul><li> 根桥是整个交换网络中心的数据转发</li><li>根桥选举通过桥ID+MAC地址<br> 选举规则：先比较优先级，优先级默认为32768.（可以调整，必须是4096的倍数，数值越小的越优先）如果优先级相同，则比较MAC地址的大小，数值小的优先，从左往右比.</li><li>端口ID：端口的优先级+端口号<br> 选举规则：先比较端口的优先级，默认为128，可调整（只能是16的倍数，数值小的优先）如果优先级相同，则才比较端口编号，数值小的优先</li></ul></li><li><p>每个非根选取一个根端口</p><ul><li> 根端口（RP）：在每一个非根桥交换机上都有，且只有一个，接收最优的BPDU，用于转发数据</li><li>通过根路径开销（cost）：以非根桥交换机的端口为出发点，沿途经过链路去访问根桥交换机的开销值进行累加，其中总开销最小的为根路径开销，则被选择成RP端口.<br> 选举规则：非根桥与根桥交换机相连的接口都为RP端口.</li></ul></li><li><p>选举指定端口</p><ul><li>指定端口（DP）：在这段链路上，转发BPDU包给其他接口的叫做指定端口<br>  选举规则：与根桥ID的比较规则完全一致</li></ul></li><li><p>阻塞非指定端口</p><ul><li>用于逻辑上阻塞数据，不转发数据从而破坏环路.<br>  选举规则：一个端口既不是指定端口也不是根端口，则被选为AP端口</li></ul></li></ol></blockquote><h2 id="STP的端口状态"><a href="#STP的端口状态" class="headerlink" title="STP的端口状态"></a>STP的端口状态</h2><blockquote><ol><li>disable：未启用STP的状态，不接收、不发送、不处理、BPDU报文。</li><li>blocking：阻塞状态，在选择根桥交换机时或者当端口被选为AP端口时停留的状态。发送、接受处理BPDU，不传发数据。</li><li>listeningL：侦听状态，选举端口角色。发送、接收、处理BPDU，不转发数据</li><li>learning：学习状态，学习mac地址表。发送、接收、处理BPDU，不转发数据。</li><li>forwarding：转发状态，学习mac地址表，转发数据，发送、接收、处理BPDU。</li></ol></blockquote><h2 id="STP的计时器"><a href="#STP的计时器" class="headerlink" title="STP的计时器"></a>STP的计时器</h2><blockquote><ol><li>hello：更新计时器，更新计时器默认为２S，DP端口会每２S向外泛洪BPDU报文，实时地监控网络的变化情况。</li><li>max age :最大老化时间20S，端口存放BPDU的时间。当端口在20S内未收到对应的BPDU时，会将端口存放的BPDU丢弃，此时STP也认为网络拓扑发生变化。</li><li>message age:信息延时，规定了网络的直径。<br>端口存放BPDU的时间为：maxage - message age 20s -延时</li><li>forward delay：转发延时，默认的时间为15S，作用是为了防止临时环路。<br>意思：交换机抢占了新的根桥。</li></ol></blockquote><h2 id="STP的不足问题"><a href="#STP的不足问题" class="headerlink" title="STP的不足问题"></a>STP的不足问题</h2><p><strong>问题1：初始化状态需要30秒的时间才能收敛</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111900.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111921.png"></p><p><strong>S3与S1的直连链路down掉，AP端口切换成RP端口并进入转发状态至少需要经过30S</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111940.png"></p><p><strong>问题3：S1与S2直连链路down掉，则S3的AP端口切换成DP端口并进入发状态大约需要50s：</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112009.png"></p><p><strong>问题4：交换机连接终端的链路进入转发需要经过30s</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112031.png"></p><p><strong>问题5：STP的拓扑变更机制</strong></p><blockquote><p>TC（Topology change）拓扑改变:先由变更点朝根桥方向发送TCN消息收到该消息的上游交换机就会回复TCA消息进行确认；最后TCN消息到达根桥后，再由根桥发送TC消息通知设备删除桥MAC地址表项，机制复杂，效率低下。</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112111.png"></p><p><strong>问题6：STP的其他不足之处–端口状态</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112130.png"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EVE-NG搭建</title>
      <link href="2021/01/16/EVE-NG%E6%90%AD%E5%BB%BA/"/>
      <url>2021/01/16/EVE-NG%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="EVE模拟器及镜像介绍"><a href="#EVE模拟器及镜像介绍" class="headerlink" title="EVE模拟器及镜像介绍"></a>EVE模拟器及镜像介绍</h1><p>EVE所需的连接工具及镜像.<br><a href="https://pan.baidu.com/s/1KaqNo644ulijjuR4ZWGhFQ">https://pan.baidu.com/s/1KaqNo644ulijjuR4ZWGhFQ</a> 提取码：5571</p><h2 id="EVE-NG介绍"><a href="#EVE-NG介绍" class="headerlink" title="EVE-NG介绍"></a>EVE-NG介绍</h2><p>EVE模拟器跟流行的PacketTracert、GNS3、eNSP安装即可使用的软件不同。EVE本身就是一个系统，和我们日常用的Windows、Mac以及Linux是一个层级的产品，底层使用的是Ubuntu系统，默认账户root，密码eve。默认账户登录进去后，系统开始提示修改密码等，建议密码继续保持eve，其他操作都选默认，有修改需求的后期再改</p><h2 id="镜像简介绍"><a href="#镜像简介绍" class="headerlink" title="镜像简介绍"></a>镜像简介绍</h2><h3 id="Dynamic"><a href="#Dynamic" class="headerlink" title="Dynamic"></a>Dynamic</h3><p>Dynamic用于模拟思科（Cisco）的路由器，基于它演变的模拟器有小凡、工大瑞普、GNS3等。它可以运行标准的IOS镜像，虽然此模拟器比较陈旧，但仍然有很多网工愿意使用。EVE-NG支持Cisco IOS 1710、3725与7206.</p><h3 id="IOL"><a href="#IOL" class="headerlink" title="IOL"></a>IOL</h3><p>IOL为IOS on Linux的简写，IOL是指将思科的路由器、交换机ios系统运行在Linux操作系统之上，二层交换机特性支持丰富，基于它演变的模拟器有WEB-IOU。IOL可以运行在基于x86平台的任意Linux发行版系统上，支持交换机高级特性，占用资源更少，启动快等优点。运行IOL需要两个文件，一个是以bin为后缀的镜像，一个是以iourc为名的license文件，iourc是通过名为CiscoIOUKeygen.py的工具自动生成的</p><h3 id="QEMU"><a href="#QEMU" class="headerlink" title="QEMU"></a>QEMU</h3><p>QEMU（Quick Emulator）是一套开源产品，可以帮助EVE-NG运行更多的虚拟设备，完成复杂实验，越来越多的设备商开始开发并释放出适配KVM环境的系统，EVE-NG可以协助qcow2镜像运行更多设备，提高可玩性。EVE-NG需要QEMU镜像的后缀名为qcow2，该文件本质是一个操作系统的虚拟硬盘文件，正因如此，可以通过自己手动制作镜像几乎可以模拟任何硬件设备</p><h2 id="VM虚拟机的安装"><a href="#VM虚拟机的安装" class="headerlink" title="VM虚拟机的安装"></a>VM虚拟机的安装</h2><p><strong>搭建EVE-NG使用的是VMware虚拟机，本章不会讲解，请自行上网查询安装VMware</strong></p><h2 id="搭建EVE-NG"><a href="#搭建EVE-NG" class="headerlink" title="搭建EVE-NG"></a>搭建EVE-NG</h2><p><strong>右键EVE压缩包，选择打开方式，选择VMware Workstation</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214054316.png"></p><p><strong>选择存储虚拟机的路径，尽量不要安装在C盘，虚拟机名称默认即可，接着选择导入</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214320101.png"></p><p><strong>等待导入进度</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214320101.png"></p><p><strong>选中EVE，右键选择设置</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214354554.png"></p><p><strong>选择内存——按自己的内存情况，8G内存的可以选择4-6G使用，16G可以选择8-12G或更高使用</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214438470.png"></p><p><strong>接着选择处理器——勾选处理器数量（P）:4,每个处理器的内核数量（C）:1–&gt;确保是“虚拟化Intel VT -x/EPT 或 AMD-V/RVI(V)”</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214506948.png"></p><p><strong>设置完成，开启虚拟机</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214525123.png"></p><p><strong>开启虚拟机来到第一个页面</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214542480.png"></p><p><strong>第二个页面输入用户root，密码eve</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214614717.png"></p><p><strong>第三–四个页面，虚拟机会让你重新设置密码，保持密码还是eve即可，回车</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214710186.png"></p><p><strong>第五页面直到最后都选择默认，按下回车即可</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214731206.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103116.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103131.png"></p><p><strong>接着虚拟机会重新启动，等待虚拟器重启完成，再次输入root用户和之前设置的密码就搭建完成</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103407.png"></p><p><strong>重启的完后页面会多出了一个IP地址，这个IP地址我们可以使用浏览器进行浏览，建议使用firefox及Google浏览器访问. 推荐firefox访问</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103431.png"></p><p><strong>输入IP地址，默认用户admin，密码eve，选择html5 conlose（web方式）登录即可以使用，但是并不推荐，因为web方式站不支持对网络设备进行抓包。在这推荐使用Native console（本地登录）但是必须得安装EVE-NG的客户端。安装的客户端已在上面发的网盘连接中，需自行安装，这里不演示，只需要都下一步即可安装</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103455.png"></p><p><strong>登录之后，可以看一些设置，管理，系统，信息.简单说一下</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103518.png"></p><p><strong><code>管理</code>：用户管理，创建用户，一般都不怎么需要创建</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104324.png"></p><p><strong><code>系统</code>：可以查看系统日志和系统状态，状态有CPU，内存，swap和磁盘的使用情况，还有自己运行的多少个节点</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104523.png"></p><p><strong><code>信息</code>：关于和论坛，可以让你了解更多的东西</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104530.png"></p><p><strong><code>主页</code>—&gt;新建一个标签标签并保存</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104611.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104630.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104716.png"></p><p><strong>如果没有右键看不到节点选项为蓝色，说明没有该镜像，需要拉去，下述有讲解传输拉去的方法和软件</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104728.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104738.png"></p><h2 id="安装EVE-NG客户端与使用工具导入镜像"><a href="#安装EVE-NG客户端与使用工具导入镜像" class="headerlink" title="安装EVE-NG客户端与使用工具导入镜像"></a>安装EVE-NG客户端与使用工具导入镜像</h2><p>官方提供了一个自带的客户端安装包集，里面内置了Putty、UltraVNC、Wireshark，导入镜像使用WinSCP工具导入会更简单. 两个工具安装时候选择默认安装即可</p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104805.png"></p><h3 id="什么是-WinSCP"><a href="#什么是-WinSCP" class="headerlink" title="什么是 WinSCP"></a>什么是 WinSCP</h3><p>WinSCP 是一个 Windows 环境下使用的 SSH 的开源化 SFTP 客户端。同时支持 SCP 协议。它的主要功能是在本地与远程计算机间安全地复制文件，并且可以直接编辑文件</p><h3 id="传输镜像和修改权限"><a href="#传输镜像和修改权限" class="headerlink" title="传输镜像和修改权限"></a>传输镜像和修改权限</h3><p>安装完EVE客户端和winSCP之后，打开winSCPU新建一个站点，输入虚拟机EVE的IP地址，账号和密码，点击登录</p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104927.png"></p><p><strong>选择是，连接成功</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104950.png"></p><p><strong>找到放置EVE-NG放置镜像的目录</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105013.png"></p><p><strong>在Windows文件下找到IOL镜像，拖动至EVE-NG文件下的<code>/opt/unetlab/addone/iol/bin</code></strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105056.png"></p><p><strong>L2表示是2层交换机，L3表示三层，L2L3都有很多种，其实都差不多，选择一个即可，重要的是圈起来的两个文件CiscoIOUKeygen.py和iourc，必须得一起放置，否者会导致交换机和路由器开不了机</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105119.png"></p><p><strong>这里选择IOL，原因是因为它不需要耗费太多的内存和CPU，开机速度比一般的镜像要快，普通实验已经够用了</strong></p><p><strong>接着设置IOL镜像所有文件的权限，右键属性，将所有权限勾选，避免搭建时候出现问题</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105155.png"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105218.png"></p><h2 id="通过Native-console登录和使用xshell连接"><a href="#通过Native-console登录和使用xshell连接" class="headerlink" title="通过Native console登录和使用xshell连接"></a>通过Native console登录和使用xshell连接</h2><p><strong>有了EVE-NG客户端，在登录时可以使用Native console模式进行登录，返回登录页面，选择Native console模式</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105325.png"></p><p><strong>可以选择默认的vpcs连接，点击几下交换机就会出现，这是安装了EVE-NG客户端自带的</strong></p><blockquote><p>提示：如果你有安装xshell或SecureCRT软件，此时用firefor浏览会在上方弹出一个选择使用什么连接，这时你可以选择你的xshell或SecureCRT软件就可以连接到交换机了</p></blockquote><p><strong>这里连接EVE-NG模拟器使用的客户端是xshell，点击几下交换机连接到xshell，连接到的名称是ip+端口，可以右键修改自己想要的名称</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105408.png"></p><p><strong>如果使用SecureCRT连接，就不需改名，它会自动修改</strong></p><blockquote><p>注意：这里使用的是firefor做演示，使用firefor的好处是可以弹出直接使用xshell连接，Google的需要自己寻找xshell的位置，各有各的好处。希望能帮到大家</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EVE-NG </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>

<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RSTP</title>
      <link href="2021/01/17/RSTP/"/>
      <url>2021/01/17/RSTP/</url>
      
        <content type="html"><![CDATA[<h1 id="RSTP"><a href="#RSTP" class="headerlink" title="RSTP"></a>RSTP</h1><h2 id="RSTP对STP的改进"><a href="#RSTP对STP的改进" class="headerlink" title="RSTP对STP的改进"></a>RSTP对STP的改进</h2><p><strong>端口角色发生变化</strong></p><blockquote><ol><li><p>新增 AP（预备端口）和 BP（备份端口）</p><ul><li><p>AP（预备端口）：</p><p>a. 当交换机的RP端口down掉时，AP端口会立刻成为AP端口，并且立刻进入forwarding状态。</p></li><li><p>BP（备份端口）：</p><p>a. 当交换机从一个接口收到一份BPDU报文，包含的发送者桥ID为本身交换机的桥ID同时BPDU比本地接口的BPDU优时，则接口会被选为BP端口。</p><p>b. 当DP端口down掉时，BP端口需要等待18s的时间才会成为DP端口。</p></li></ul></li><li><p>新增边缘端口：</p><ul><li><p>边缘端口（EP）：由网络管理员手工配置，配置在交换机链接终端设备（电脑，AP，服务器等）</p></li><li><p>特性：</p><p>a. 一旦端口被设置为边缘端口，端口立刻进入forwarding状态。</p><p>b. 边缘端口UP/down不会引起RSTP的网络拓扑变化。</p><p>c. RSTP的网络拓扑不会影响边缘端口的通信。</p></li></ul></li></ol></blockquote><p><strong>RSTP增加的快速机制：</strong></p><blockquote><ol><li>RSTP快速收敛机制一：当交换机的RP端口down掉时，AP端口会立刻成为AP端口，并且立刻进入forwarding状态。</li><li>RSTP快速收敛机制二：当端口设置为边缘端口，会立刻进入forwarding状态</li></ol></blockquote><h2 id="边缘端口的机制："><a href="#边缘端口的机制：" class="headerlink" title="边缘端口的机制："></a>边缘端口的机制：</h2><blockquote><ol><li>边缘端口会每2s向外泛洪BPDU。</li><li>当边缘端口收到BPDU时，会丧失边缘端口的特性，成为普通的RSTP端口执行计算。</li></ol></blockquote><h2 id="开启BPDU保护功能："><a href="#开启BPDU保护功能：" class="headerlink" title="开启BPDU保护功能："></a>开启BPDU保护功能：</h2><blockquote><ol><li>在接口视图下：spanning-tree bpduguard enable</li><li>在全局试图下：spanning-tree portfast edge bpduguard default<ul><li>只针对边缘端口生效，边缘端口收到BPDU报文时直接进入error-down的状态。同时产生一份告警日志通知网络管理员。</li><li>error-down的接口需要网络管理员手动开启，从新开启边缘端口，断电之后在接口模式下no shutdown</li></ul></li></ol></blockquote><h2 id="RSTP端口状态："><a href="#RSTP端口状态：" class="headerlink" title="RSTP端口状态："></a>RSTP端口状态：</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117113730.png" alt="image-20210117113730470"></p><h2 id="针对问题一：P-A机制（1）"><a href="#针对问题一：P-A机制（1）" class="headerlink" title="针对问题一：P/A机制（1）"></a>针对问题一：P/A机制（1）</h2><p><strong><code>P/A（proposa/Agreement）提议/同意</code></strong></p><p><strong>P/A机制的基本原理</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117113837.png" alt="image-20210117113837722"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114100.png" alt="image-20210117114100608"></p><h2 id="针对问题一：P-A机制（2）"><a href="#针对问题一：P-A机制（2）" class="headerlink" title="针对问题一：P/A机制（2）"></a>针对问题一：P/A机制（2）</h2><p><strong>RSTP选举原理和STP本质上相同：选举根交换机-选举非根交换机上的根端口-选举指定端口-选举预备端口和备份端口</strong></p><blockquote><p>但是RSTP在选举的过程中加入了“发起请求-回复同意”（P/A机制）这种确认机制由于每个步骤有确认就不需要依赖计时器来保证网络拓扑无环才去转发只需要考虑BPDU发送报文并计算无环拓扑的时间（一般都是秒级）。</p></blockquote><h2 id="针对问题二：根端口快速切换机制"><a href="#针对问题二：根端口快速切换机制" class="headerlink" title="针对问题二：根端口快速切换机制"></a>针对问题二：根端口快速切换机制</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114321.png" alt="image-20210117114321159"></p><h2 id="针对问题三：次等BPDU处理机制"><a href="#针对问题三：次等BPDU处理机制" class="headerlink" title="针对问题三：次等BPDU处理机制"></a>针对问题三：次等BPDU处理机制</h2><p><strong>S2与S1的直连链路down掉，SWC的AP端口切换成DP端口并进入转发状态秒级时间内完成.</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114341.png" alt="image-20210117114341873"></p><h2 id="针对问题四：边缘端口的引入"><a href="#针对问题四：边缘端口的引入" class="headerlink" title="针对问题四：边缘端口的引入"></a>针对问题四：边缘端口的引入</h2><p><strong>在RSTP中，交换机连接终端的链路可立即进入转发状态</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114404.png" alt="image-20210117114404154"></p><h2 id="RSTP-BDPU保护"><a href="#RSTP-BDPU保护" class="headerlink" title="RSTP-BDPU保护"></a>RSTP-BDPU保护</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114544.png" alt="image-20210117114544764"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114558.png" alt="image-20210117114558736"></p><h2 id="RSTP-根保护"><a href="#RSTP-根保护" class="headerlink" title="RSTP-根保护"></a>RSTP-根保护</h2><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114616.png" alt="image-20210117114616000"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114625.png" alt="image-20210117114625131"></p><h2 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h2><p><strong>如图所示，S1，S2和S3组成一个环型的交换网络，为了消除环路对网络的影响，交换机都运行了RSTP，最终将环形网络结构修剪成无环路的树形网络结构.</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114714.png" alt="image-20210117114713949"></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PC4：VPCS&gt; ip 192.168.1.1/24</span><br><span class="line">PC5：VPCS&gt; ip 192.168.1.2/24</span><br><span class="line"></span><br><span class="line">S1：</span><br><span class="line">S1(config)<span class="selector-id">#spanning-tree</span> mo rapid-pvst <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line"></span><br><span class="line">S2：</span><br><span class="line">S2(config)<span class="selector-id">#spanning-tree</span> mo rapid-pvst <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> spanning-tree portfast edge     <span class="selector-id">#--</span>&gt;开启边缘端口</span><br><span class="line"> spanning-tree bpduguard enable  <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br><span class="line"></span><br><span class="line">S3：</span><br><span class="line">S3(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst  <span class="selector-id">#--</span>&gt;开启快速生成树</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> spanning-tree portfast edge      <span class="selector-id">#--</span>&gt;开启边缘端口</span><br><span class="line"> spanning-tree bpduguard enable   <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><p><strong><code>思科</code>全局下开启BPDU保护（不建议）</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S2(config)<span class="selector-id">#spanning-tree</span> portfast edge bpduguard default</span><br></pre></td></tr></table></figure><h3 id="使用show查看配置"><a href="#使用show查看配置" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h3><p><strong>在相同优先级情况下，比较MAC地址，S1-MAC地址是三台交换机中最小的，所以S1为根桥，而S3地址最大，它的e0/0接口会成为AP接口</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114837.png" alt="image-20210117114836872"></p><h3 id="S1"><a href="#S1" class="headerlink" title="S1"></a>S1</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114904.png" alt="image-20210117114904672"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114913.png" alt="image-20210117114913537"></p><h3 id="S2"><a href="#S2" class="headerlink" title="S2"></a>S2</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114938.png" alt="image-20210117114938405"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114928.png" alt="image-20210117114928820"></p><h3 id="S3"><a href="#S3" class="headerlink" title="S3"></a>S3</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114951.png" alt="image-20210117114951775"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117114959.png" alt="image-20210117114959392"></p><p><strong>当S3关闭e0/1接口，RSTP很快就切换了e0/0端口，PC2:长ping：VPCS&gt; ping 192.168.1.1 -tS3关闭e0/1接口，RSTP很快就切换了e0/0端口，PC2:长ping：VPCS&gt; ping  192.168.1.1 -t</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115022.png" alt="image-20210117115022170"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115030.png" alt="image-20210117115030174"></p><h2 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h2><p><strong>如图所示，S-A，S-B，S-C，S-D组成一个环型的交换网络，为了消除环路对网络的影响，交换机都运行了RSTP，最终将环形网络结构修剪成无环路的树形网络结构</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115053.png" alt="image-20210117115053624"></p><p><strong>用快速生成树协议实现负载均衡：通过修改桥优先级，控制交换机S-A是人事部的根桥，S-B是人事部的次根桥；控制交换机S-A是研发部的次根桥，S-B是研发部的根桥.</strong></p><p><strong>vlan10-vlan20通过e1/0链路，vlan30-vlan40通过e1/1链路.用快速生成树协议实现负载均衡：通过修改桥优先级，控制交换机S-A是人事部的根桥，S-B是人事部的次根桥；控制交换机S-A是研发部的次根桥，S-B是研发部的根桥，vlan10-vlan20通过e1/0链路，vlan30-vlan40通过e1/1链路.</strong></p><h3 id="开启快速生成树"><a href="#开启快速生成树" class="headerlink" title="开启快速生成树"></a>开启快速生成树</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst <span class="selector-id">#--</span>&gt;配置快速生成树</span><br><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br><span class="line">S-C(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br><span class="line">S-D(config)<span class="selector-id">#spanning-tree</span> mode rapid-pvst </span><br></pre></td></tr></table></figure><h3 id="S-A"><a href="#S-A" class="headerlink" title="S-A"></a>S-A</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vlan</span> 10,20,30,40   </span><br><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vtp</span> mode server     <span class="selector-id">#--</span>&gt;开启VTP模式为服务器，思科私有</span><br><span class="line">S-<span class="selector-tag">A</span>(config)<span class="selector-id">#vtp</span> domain 123456   <span class="selector-id">#--</span>&gt;配置一个名字</span><br><span class="line">！</span><br><span class="line">spanning-tree vlan 10,20 priority 4096 </span><br><span class="line">spanning-tree vlan 30,40 priority 8192</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">！</span><br><span class="line">interface Ethernet1/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet1/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br></pre></td></tr></table></figure><h3 id="S-B"><a href="#S-B" class="headerlink" title="S-B"></a>S-B</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#vtp</span> mode client          <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-<span class="selector-tag">B</span>(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">spanning-tree vlan 10,20 priority 8192</span><br><span class="line">spanning-tree vlan 30,40 priority 4096</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!         </span><br><span class="line">interface Ethernet1/0</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet1/1</span><br><span class="line"> switchport trunk encapsulation dot1q</span><br><span class="line"> switchport mode trunk</span><br><span class="line"> spanning-tree vlan 30,40 port-priority 64</span><br></pre></td></tr></table></figure><h3 id="S-C"><a href="#S-C" class="headerlink" title="S-C"></a>S-C</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">S-C(config)<span class="selector-id">#vtp</span> mode client <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-C(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/1</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！ </span><br><span class="line">interface Ethernet0/0</span><br><span class="line">spanning-tree portfast edge <span class="selector-id">#--</span>&gt;开启边缘端口 </span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><h3 id="S-D"><a href="#S-D" class="headerlink" title="S-D"></a>S-D</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">S-D(config)<span class="selector-id">#vtp</span> mode client <span class="selector-id">#--</span>&gt;开启VTP模式为客户端</span><br><span class="line">S-D(config)<span class="selector-id">#vtp</span> domain 123456</span><br><span class="line">！</span><br><span class="line">interface Ethernet0/0</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line">switchport trunk encapsulation dot1q</span><br><span class="line">switchport mode trunk</span><br><span class="line">！ </span><br><span class="line">interface Ethernet0/0</span><br><span class="line">spanning-tree portfast edge    <span class="selector-id">#--</span>&gt;开启边缘端口 </span><br><span class="line">spanning-tree bpduguard enable <span class="selector-id">#--</span>&gt;开启BPDU保护</span><br></pre></td></tr></table></figure><h2 id="使用show查看配置-1"><a href="#使用show查看配置-1" class="headerlink" title="使用show查看配置"></a>使用show查看配置</h2><h3 id="S-A-1"><a href="#S-A-1" class="headerlink" title="S-A"></a>S-A</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115336.png" alt="image-20210117115336065"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115348.png" alt="image-20210117115348770"></p><h3 id="S-B-1"><a href="#S-B-1" class="headerlink" title="S-B"></a>S-B</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115422.png" alt="image-20210117115422205"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117115431.png" alt="image-20210117115431534"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STP</title>
      <link href="2021/01/17/STP/"/>
      <url>2021/01/17/STP/</url>
      
        <content type="html"><![CDATA[<h1 id="STP"><a href="#STP" class="headerlink" title="STP"></a>STP</h1><h2 id="二层环路的影响"><a href="#二层环路的影响" class="headerlink" title="二层环路的影响"></a>二层环路的影响</h2><p>1）广播风暴：数据帧不断的循环发送，导致需要耗费大量的CPU处理<br>2）MAC地址表的震荡：由于交换机的接口不断地收到同一个数据帧导致MAC地址表项不断被覆盖，交换机需要耗费大量的开销维护MAC地址表</p><blockquote><p>总结：如果不解决环路会大量消耗交换机的设备开销带宽资源，当CPU使用率过高很可能导致交换机开启过热保护，导致交换机断点，业务中断</p></blockquote><h2 id="为什么需要生成树"><a href="#为什么需要生成树" class="headerlink" title="为什么需要生成树"></a>为什么需要生成树</h2><p>1）生成树的出现不是真的需要，而是间接的需要<br>2）二层环境中需要备份和冗余</p><p><strong>在这种环境中没有环路，但是缺少了备份</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111155.png" alt="image-20210117111155513"></p><p><strong>在这种环境中解决了备份，但是不做处理会导致环路，这时STP就有发挥它的作用了</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111306.png" alt="image-20210117111306699"></p><h2 id="STP作用"><a href="#STP作用" class="headerlink" title="STP作用"></a>STP作用</h2><p><strong>STP在保证网络的冗余性的同时，保证交换机网络中不会出现二层环路</strong></p><blockquote><p>原理：通过在逻辑上阻塞某一些端口，使交换机成为树形网络，破除环路在链路上或设备发生故障时，又重新启动阻塞端口，使网络恢复数据转发.</p></blockquote><h2 id="STP如何计算阻塞端口"><a href="#STP如何计算阻塞端口" class="headerlink" title="STP如何计算阻塞端口"></a>STP如何计算阻塞端口</h2><p><strong>STP选举根桥与端口角色的过程都是由交换机自主完成的，交换机选举中都会发送一种包，这种数据包叫做BPDU(Bridge Protocol Data Unit)网桥协议数据单元</strong></p><blockquote><ol><li><p>通过选举根桥</p><ul><li> 根桥是整个交换网络中心的数据转发</li><li>根桥选举通过桥ID+MAC地址<br> 选举规则：先比较优先级，优先级默认为32768.（可以调整，必须是4096的倍数，数值越小的越优先）如果优先级相同，则比较MAC地址的大小，数值小的优先，从左往右比.</li><li>端口ID：端口的优先级+端口号<br> 选举规则：先比较端口的优先级，默认为128，可调整（只能是16的倍数，数值小的优先）如果优先级相同，则才比较端口编号，数值小的优先</li></ul></li><li><p>每个非根选取一个根端口</p><ul><li> 根端口（RP）：在每一个非根桥交换机上都有，且只有一个，接收最优的BPDU，用于转发数据</li><li>通过根路径开销（cost）：以非根桥交换机的端口为出发点，沿途经过链路去访问根桥交换机的开销值进行累加，其中总开销最小的为根路径开销，则被选择成RP端口.<br> 选举规则：非根桥与根桥交换机相连的接口都为RP端口.</li></ul></li><li><p>选举指定端口</p><ul><li>指定端口（DP）：在这段链路上，转发BPDU包给其他接口的叫做指定端口<br>  选举规则：与根桥ID的比较规则完全一致</li></ul></li><li><p>阻塞非指定端口</p><ul><li>用于逻辑上阻塞数据，不转发数据从而破坏环路.<br>  选举规则：一个端口既不是指定端口也不是根端口，则被选为AP端口</li></ul></li></ol></blockquote><h2 id="STP的端口状态"><a href="#STP的端口状态" class="headerlink" title="STP的端口状态"></a>STP的端口状态</h2><blockquote><ol><li>disable：未启用STP的状态，不接收、不发送、不处理、BPDU报文。</li><li>blocking：阻塞状态，在选择根桥交换机时或者当端口被选为AP端口时停留的状态。发送、接受处理BPDU，不传发数据。</li><li>listeningL：侦听状态，选举端口角色。发送、接收、处理BPDU，不转发数据</li><li>learning：学习状态，学习mac地址表。发送、接收、处理BPDU，不转发数据。</li><li>forwarding：转发状态，学习mac地址表，转发数据，发送、接收、处理BPDU。</li></ol></blockquote><h2 id="STP的计时器"><a href="#STP的计时器" class="headerlink" title="STP的计时器"></a>STP的计时器</h2><blockquote><ol><li>hello：更新计时器，更新计时器默认为２S，DP端口会每２S向外泛洪BPDU报文，实时地监控网络的变化情况。</li><li>max age :最大老化时间20S，端口存放BPDU的时间。当端口在20S内未收到对应的BPDU时，会将端口存放的BPDU丢弃，此时STP也认为网络拓扑发生变化。</li><li>message age:信息延时，规定了网络的直径。<br>端口存放BPDU的时间为：maxage - message age 20s -延时</li><li>forward delay：转发延时，默认的时间为15S，作用是为了防止临时环路。<br>意思：交换机抢占了新的根桥。</li></ol></blockquote><h2 id="STP的不足问题"><a href="#STP的不足问题" class="headerlink" title="STP的不足问题"></a>STP的不足问题</h2><p><strong>问题1：初始化状态需要30秒的时间才能收敛</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111900.png" alt="image-20210117111859899"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111921.png" alt="image-20210117111921479"></p><p><strong>S3与S1的直连链路down掉，AP端口切换成RP端口并进入转发状态至少需要经过30S</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117111940.png" alt="image-20210117111940727"></p><p><strong>问题3：S1与S2直连链路down掉，则S3的AP端口切换成DP端口并进入发状态大约需要50s：</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112009.png" alt="image-20210117112009260"></p><p><strong>问题4：交换机连接终端的链路进入转发需要经过30s</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112031.png" alt="image-20210117112031010"></p><p><strong>问题5：STP的拓扑变更机制</strong></p><blockquote><p>TC（Topology change）拓扑改变:先由变更点朝根桥方向发送TCN消息收到该消息的上游交换机就会回复TCA消息进行确认；最后TCN消息到达根桥后，再由根桥发送TC消息通知设备删除桥MAC地址表项，机制复杂，效率低下。</p></blockquote><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112111.png" alt="image-20210117112111201"></p><p><strong>问题6：STP的其他不足之处–端口状态</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117112130.png" alt="image-20210117112130136"></p>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EVE-NG搭建</title>
      <link href="2021/01/16/EVE-NG%E6%90%AD%E5%BB%BA/"/>
      <url>2021/01/16/EVE-NG%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="EVE模拟器及镜像介绍"><a href="#EVE模拟器及镜像介绍" class="headerlink" title="EVE模拟器及镜像介绍"></a>EVE模拟器及镜像介绍</h1><p>EVE所需的连接工具及镜像.<br><a href="https://pan.baidu.com/s/1KaqNo644ulijjuR4ZWGhFQ">https://pan.baidu.com/s/1KaqNo644ulijjuR4ZWGhFQ</a> 提取码：5571</p><h2 id="EVE-NG介绍"><a href="#EVE-NG介绍" class="headerlink" title="EVE-NG介绍"></a>EVE-NG介绍</h2><p>EVE模拟器跟流行的PacketTracert、GNS3、eNSP安装即可使用的软件不同。EVE本身就是一个系统，和我们日常用的Windows、Mac以及Linux是一个层级的产品，底层使用的是Ubuntu系统，默认账户root，密码eve。默认账户登录进去后，系统开始提示修改密码等，建议密码继续保持eve，其他操作都选默认，有修改需求的后期再改</p><h2 id="镜像简介绍"><a href="#镜像简介绍" class="headerlink" title="镜像简介绍"></a>镜像简介绍</h2><h3 id="Dynamic"><a href="#Dynamic" class="headerlink" title="Dynamic"></a>Dynamic</h3><p>Dynamic用于模拟思科（Cisco）的路由器，基于它演变的模拟器有小凡、工大瑞普、GNS3等。它可以运行标准的IOS镜像，虽然此模拟器比较陈旧，但仍然有很多网工愿意使用。EVE-NG支持Cisco IOS 1710、3725与7206.</p><h3 id="IOL"><a href="#IOL" class="headerlink" title="IOL"></a>IOL</h3><p>IOL为IOS on Linux的简写，IOL是指将思科的路由器、交换机ios系统运行在Linux操作系统之上，二层交换机特性支持丰富，基于它演变的模拟器有WEB-IOU。IOL可以运行在基于x86平台的任意Linux发行版系统上，支持交换机高级特性，占用资源更少，启动快等优点。运行IOL需要两个文件，一个是以bin为后缀的镜像，一个是以iourc为名的license文件，iourc是通过名为CiscoIOUKeygen.py的工具自动生成的</p><h3 id="QEMU"><a href="#QEMU" class="headerlink" title="QEMU"></a>QEMU</h3><p>QEMU（Quick Emulator）是一套开源产品，可以帮助EVE-NG运行更多的虚拟设备，完成复杂实验，越来越多的设备商开始开发并释放出适配KVM环境的系统，EVE-NG可以协助qcow2镜像运行更多设备，提高可玩性。EVE-NG需要QEMU镜像的后缀名为qcow2，该文件本质是一个操作系统的虚拟硬盘文件，正因如此，可以通过自己手动制作镜像几乎可以模拟任何硬件设备</p><h2 id="VM虚拟机的安装"><a href="#VM虚拟机的安装" class="headerlink" title="VM虚拟机的安装"></a>VM虚拟机的安装</h2><p><strong>搭建EVE-NG使用的是VMware虚拟机，本章不会讲解，请自行上网查询安装VMware</strong></p><h2 id="搭建EVE-NG"><a href="#搭建EVE-NG" class="headerlink" title="搭建EVE-NG"></a>搭建EVE-NG</h2><p><strong>右键EVE压缩包，选择打开方式，选择VMware Workstation</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214054316.png" alt="image-20210116214054316"></p><p><strong>选择存储虚拟机的路径，尽量不要安装在C盘，虚拟机名称默认即可，接着选择导入</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214320101.png" alt="image-20210116214259412"></p><p><strong>等待导入进度</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214320101.png" alt="image-20210116214320101"></p><p><strong>选中EVE，右键选择设置</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214354554.png" alt="image-20210116214354554"></p><p><strong>选择内存——按自己的内存情况，8G内存的可以选择4-6G使用，16G可以选择8-12G或更高使用</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214438470.png" alt="image-20210116214438470"></p><p><strong>接着选择处理器——勾选处理器数量（P）:4,每个处理器的内核数量（C）:1–&gt;确保是“虚拟化Intel VT -x/EPT 或 AMD-V/RVI(V)”</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214506948.png" alt="image-20210116214506948"></p><p><strong>设置完成，开启虚拟机</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214525123.png" alt="image-20210116214525123"></p><p><strong>开启虚拟机来到第一个页面</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214542480.png" alt="image-20210116214542480"></p><p><strong>第二个页面输入用户root，密码eve</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214614717.png" alt="image-20210116214614717"></p><p><strong>第三–四个页面，虚拟机会让你重新设置密码，保持密码还是eve即可，回车</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214710186.png" alt="image-20210116214710186"></p><p><strong>第五页面直到最后都选择默认，按下回车即可</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zsjmal2316/typora-image/img/image-20210116214731206.png" alt="image-20210116214731206"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103116.png" alt="image-20210116214738947"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103131.png" alt="image-20210116214751606"></p><p><strong>接着虚拟机会重新启动，等待虚拟器重启完成，再次输入root用户和之前设置的密码就搭建完成</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103407.png" alt="image-20210117103407421"></p><p><strong>重启的完后页面会多出了一个IP地址，这个IP地址我们可以使用浏览器进行浏览，建议使用firefox及Google浏览器访问. 推荐firefox访问</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103431.png" alt="image-20210117103431677"></p><p><strong>输入IP地址，默认用户admin，密码eve，选择html5 conlose（web方式）登录即可以使用，但是并不推荐，因为web方式站不支持对网络设备进行抓包。<br>所以推荐使用Native console（本地登录）但是必须得安装EVE-NG的客户端。安装的客户端已在上面发的网盘连接中，需自行安装</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103455.png" alt="image-20210117103455547"></p><p><strong>登录之后，可以看一些设置，管理，系统，信息.简单说一下</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117103518.png" alt="image-20210117103518683"></p><p><strong><code>管理</code>：用户管理，创建用户，一般都不怎么需要创建</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104324.png" alt="image-20210117104324336"></p><p><strong><code>系统</code>：可以查看系统日志和系统状态，状态有CPU，内存，swap和磁盘的使用情况，还有自己运行的多少个节点</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104523.png" alt="image-20210117104523123"></p><p><strong><code>信息</code>：关于和论坛，可以让你了解更多的东西</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104530.png" alt="image-20210117104431839"></p><p><strong><code>主页</code>—&gt;新建一个标签标签并保存</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104611.png" alt="image-20210117104611132"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104630.png" alt="image-20210117104630375"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104716.png" alt="image-20210117104716338"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104728.png" alt="image-20210117104728188"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104738.png" alt="image-20210117104738604"></p><h2 id="安装EVE-NG客户端与使用工具导入镜像"><a href="#安装EVE-NG客户端与使用工具导入镜像" class="headerlink" title="安装EVE-NG客户端与使用工具导入镜像"></a>安装EVE-NG客户端与使用工具导入镜像</h2><p>官方提供了一个自带的客户端安装包集，里面内置了Putty、UltraVNC、Wireshark，导入镜像使用WinSCP工具导入会更简单. 两个工具安装时候选择默认安装即可</p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104805.png" alt="image-20210117104805725"></p><h3 id="什么是-WinSCP"><a href="#什么是-WinSCP" class="headerlink" title="什么是 WinSCP"></a>什么是 WinSCP</h3><p>WinSCP 是一个 Windows 环境下使用的 SSH 的开源化 SFTP 客户端。同时支持 SCP 协议。它的主要功能是在本地与远程计算机间安全地复制文件，并且可以直接编辑文件</p><h3 id="传输镜像"><a href="#传输镜像" class="headerlink" title="传输镜像"></a>传输镜像</h3><p>安装完EVE客户端和winSCP之后，打开winSCPU新建一个站点，输入虚拟机EVE的IP地址，账号和密码，点击登录</p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104927.png" alt="image-20210117104927138"></p><p><strong>选择是，连接成功</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117104950.png" alt="image-20210117104950710"></p><p><strong>找到放置EVE-NG放置镜像的目录</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105013.png" alt="image-20210117105013050"></p><p><strong>在Windows文件下找到IOL镜像，拖动至EVE-NG文件下的<code>/opt/unetlab/addone/iol/bin</code></strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105056.png" alt="image-20210117105056301"></p><p><strong>L2表示是2层交换机，L3表示三层，L2L3都有很多种，其实都差不多，选择一个即可，重要的是圈起来的两个文件，必须得一起放置，否者会导致交换机和路由器开不了机</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105119.png" alt="image-20210117105119672"></p><p><strong><code>为什么导入IOL？</code>原因它不需要耗费太多的内存和CPU，开机速度比一般的镜像要快</strong></p><p><strong>接着设置IOL镜像所有文件的权限，右键属性，将所有权限勾选，避免搭建时候出现问题</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105155.png" alt="image-20210117105155099"></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105218.png" alt="image-20210117105218747"></p><p><strong>有了EVE-NG客户端，在登录时可以使用Native console模式进行登录，返回登录页面，选择Native console模式</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105325.png" alt="image-20210117105325745"></p><p><strong>可以选择默认的vpcs连接，点击几下交换机就会出现，这是安装了EVE-NG客户端自带的</strong></p><blockquote><p>提示：如果你有安装xshell或SecureCRT软件，此时用firefor浏览会在上方弹出一个选择使用什么连接，这时你可以选择你的xshell或SecureCRT软件就可以连接到交换机了</p></blockquote><p><strong>这里连接EVE-NG模拟器使用的客户端是xshell，点击几下交换机连接到xshell，连接到的名称是ip+端口，可以右键修改自己想要的名称</strong></p><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/20210117105408.png" alt="image-20210117105408224"></p><p><strong>如果使用SecureCRT连接，就不需改名，它会自动修改</strong></p><blockquote><p>注意：这里使用的是firefor做演示，使用firefor的好处是可以弹出直接使用xshell连接，Google的需要自己寻找xshell的位置，各有各的好处。希望能帮到大家</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 路由交换 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EVE-NG </tag>
            
            <tag> 模拟器 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>

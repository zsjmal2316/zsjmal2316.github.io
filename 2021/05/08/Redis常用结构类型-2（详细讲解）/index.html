<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Redis常用结构类型-2（详细讲解）"><meta name="keywords" content="Redis"><meta name="author" content="Inaction"><meta name="copyright" content="Inaction"><title>Redis常用结构类型-2（详细讲解） | Inaction's Blog</title><link rel="shortcut icon" href="/imdadul-hussain-u_oLPS_ZYSc-unsplash.jpg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?12b421fdad87d1edf2305ccb7229d2c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-8RMJ1F8ETC', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">Redis结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%9A%84%E5%BA%93"><span class="toc-number">1.1.</span> <span class="toc-text">Redis的库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%9A%845%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">Redis的5中数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#string%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">string（字符串） 数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#string%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">string类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#string-%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">string-设置键值对</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#string-%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">string-设置多个键值对</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#string-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.1.1.3.</span> <span class="toc-text">string-其他命令使用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#int%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">int类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#int-%E7%B1%BB%E5%9E%8B%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">int-类型示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">bitmap（位图）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bitmap%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">bitmap的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bitmap-%E4%BE%8B%E5%AD%90%E7%94%A8%E6%B3%95"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">bitmap-例子用法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93string%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">小结string命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#string%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.2.1.4.1.</span> <span class="toc-text">string类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#int%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">1.2.1.4.2.</span> <span class="toc-text">int类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89-1"><span class="toc-number">1.2.1.4.3.</span> <span class="toc-text">bitmap（位图）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">list（列表）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E9%98%9F%E5%88%97"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">list-队列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E6%A0%88"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">list-栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E6%95%B0%E7%BB%84"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">list-数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E9%98%BB%E5%A1%9E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">list-阻塞使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">list-其他命令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93list%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.6.</span> <span class="toc-text">小结list命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="toc-number">1.2.3.</span> <span class="toc-text">hash（哈希）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hash-%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">hash-命令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hash-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">hash-应用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93hash%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">小结hash命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">set（集合）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E8%AE%BE%E7%BD%AE%E6%88%90%E5%91%98"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">set-设置成员</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">set-集合操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E9%9A%8F%E6%9C%BA%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">set-随机事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">set-其他命令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93SET%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">小结SET命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sorted-set%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">sorted set（有序集合）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#zset-%E8%AE%BE%E7%BD%AE%E6%88%90%E5%91%98"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">zset-设置成员</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zset-%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">zset-集合操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zset-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">zset-其他命令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zset-skip-list%EF%BC%88%E8%B7%B3%E8%B7%83%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">zset-skip list（跳跃列表）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93zset%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.5.5.</span> <span class="toc-text">小结zset命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HyperLogLog%EF%BC%88%E8%AE%A1%E6%95%B0%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">HyperLogLog（计数）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HyperLogLog%E5%85%B6%E4%BB%96%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.3.2.</span> <span class="toc-text">HyperLogLog其他事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GeoHash%EF%BC%88%E5%9C%B0%E7%90%86%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">GeoHash（地理）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GeoHash%E7%AE%97%E6%B3%95"><span class="toc-number">1.4.1.</span> <span class="toc-text">GeoHash算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Geo%E6%8C%87%E4%BB%A4%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">Geo指令的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GeoHash%E5%85%B6%E4%BB%96%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.4.3.</span> <span class="toc-text">GeoHash其他事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%85%A8%E5%B1%80%E6%8C%87%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">Redis全局指令使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#type%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">type命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXPIRE%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.</span> <span class="toc-text">EXPIRE命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXISTS%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.</span> <span class="toc-text">EXISTS命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DEL"><span class="toc-number">1.5.4.</span> <span class="toc-text">DEL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TTL%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.5.</span> <span class="toc-text">TTL命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PERSIST%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.6.</span> <span class="toc-text">PERSIST命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SCAN%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.7.</span> <span class="toc-text">SCAN命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SCAN%E5%9F%BA%E6%9C%AC%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">SCAN基本应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">字典的结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SCAN%E9%81%8D%E5%8E%86%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">SCAN遍历顺序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%BC%96%E7%A0%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">Redis编码模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#embstr-%E4%B8%8E-raw"><span class="toc-number">1.6.1.</span> <span class="toc-text">embstr 与 raw</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/imdadul-hussain-u_oLPS_ZYSc-unsplash.jpg"></div><div class="author-info__name text-center">Inaction</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">54</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">19</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">13</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friend Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://www.ji4n.cn/">Jen</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(img/wuwei.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Inaction's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">Redis常用结构类型-2（详细讲解）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-08</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/">Linux</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/Redis/">Redis</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Redis结构"><a href="#Redis结构" class="headerlink" title="Redis结构"></a>Redis结构</h1><h2 id="Redis的库"><a href="#Redis的库" class="headerlink" title="Redis的库"></a>Redis的库</h2><p>Redis一共有16个库，从0-15，每个库之间是互相隔离的，默认进入是在0库中</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span>&quot; </span><br><span class="line">&gt; <span class="selector-tag">select</span> 1    //切换至1库</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-attr">[1]</span>&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span>   //在<span class="selector-tag">get</span>查询是空的</span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<p><strong>命令行方式进入库</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 10.0.0.50 -n 8  //进入8号库</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span><span class="selector-attr">[8]</span>&gt; </span><br><span class="line"></span><br><span class="line">$ redis-cli --help</span><br><span class="line"><span class="selector-tag">-n</span> &lt;<span class="selector-tag">db</span>&gt;            <span class="selector-tag">Database</span> <span class="selector-tag">number</span>.</span><br></pre></td></tr></table></figure>
<h2 id="Redis的5中数据结构"><a href="#Redis的5中数据结构" class="headerlink" title="Redis的5中数据结构"></a>Redis的5中数据结构</h2><p>Redis有 5 种基础数据结构，分别为：string（字符串）、list（列表）、hash（字典）、set（集合）和sorted set（有序集合，也叫zset）。而不同类型应用于不同的场景，所以我们不仅要学会如果使用，还要知道如何应用在不同的场景。这五种类型在redis中扮演者重要的角色，也是基础最重要部分</p>
<h3 id="string（字符串）-数据结构"><a href="#string（字符串）-数据结构" class="headerlink" title="string（字符串） 数据结构"></a>string（字符串） 数据结构</h3><p>字符串<code>string</code>是Redis最简单的数据结构，Redis所有的数据结构都以唯一的key字符串作为名称，然后通过这个key值来获取相应的value数据。但也不是简单地key-value存储，实际上它是一个数据结构服务器，支持不同类型的值，如还有int（数字类型）、bitmap（位图，二进制类型）</p>
<p>字符串结构使用广泛，常见的用途就是缓存用户信息，将用户信息结构使用JSON序列化成字符串，然后将序列化后的字符串塞进Redis来缓存。同样，取用户信息会经过一次反序列化的过程</p>
<blockquote>
<p>注意：字符串最大长度为512MB</p>
</blockquote>
<p><strong>字符串下的三种类型</strong></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210316140455861.png"></p>
<h4 id="string类型"><a href="#string类型" class="headerlink" title="string类型"></a>string类型</h4><h5 id="string-设置键值对"><a href="#string-设置键值对" class="headerlink" title="string-设置键值对"></a>string-设置键值对</h5><ul>
<li>相当于字典的key和value，支持简单的增删改查操作</li>
<li>通常用SET command和GET command来设置和获取字符串值</li>
</ul>
<p>查看帮助@string可以看到string的所有命令</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="keyword">@string</span></span><br></pre></td></tr></table></figure>
<p>单独查看set命令的帮助，可以看到使用的方法，还有它创建的key的组是属于字符串的</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="selector-tag">set</span></span><br><span class="line">  <span class="selector-tag">SET</span> <span class="selector-tag">key</span> <span class="selector-tag">value</span> <span class="selector-attr">[EX seconds|PX milliseconds]</span> <span class="selector-attr">[NX|XX]</span> <span class="selector-attr">[KEEPTTL]</span></span><br><span class="line">  <span class="selector-tag">summary</span>: <span class="selector-tag">Set</span> <span class="selector-tag">the</span> <span class="selector-tag">string</span> <span class="selector-tag">value</span> <span class="selector-tag">of</span> <span class="selector-tag">a</span> <span class="selector-tag">key</span></span><br><span class="line">  <span class="selector-tag">since</span>: 1.0.0</span><br><span class="line">  <span class="selector-tag">group</span>: <span class="selector-tag">string</span></span><br></pre></td></tr></table></figure>
<p>新建一个key，“k1”是字典key，而value是字符串‘v1’</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k2</span> <span class="selector-tag">v2</span></span><br><span class="line"><span class="selector-tag">OK</span> </span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span>           //<span class="selector-tag">get</span>查看一个<span class="selector-tag">key</span></span><br><span class="line">&quot;<span class="selector-tag">v1</span>&quot; </span><br><span class="line">&gt; <span class="selector-tag">mget</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span>       //<span class="selector-tag">mget</span>可以查看多个</span><br><span class="line">1) &quot;<span class="selector-tag">v1</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">v2</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">keys</span> *           //查看所有键（慎用）</span><br><span class="line">1) &quot;<span class="selector-tag">k1</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>SET命令的NX与XX参数作用</strong></p>
<ul>
<li>NX：判断该key是否存在，存在则不创建，不存在则新建</li>
<li>XX：判断该key是否存在，存在则更新，不存在则不设置</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">vv</span> <span class="selector-tag">nx</span>    </span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span>         </span><br><span class="line">&quot;<span class="selector-tag">v1</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k2</span> <span class="selector-tag">v2</span> <span class="selector-tag">nx</span>   //<span class="selector-tag">k2</span>没有<span class="selector-tag">value</span>，所以可以创建</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k2</span></span><br><span class="line">&quot;<span class="selector-tag">v2</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">vv</span> <span class="selector-tag">xx</span>  </span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">vv</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k3</span> <span class="selector-tag">v3</span> <span class="selector-tag">xx</span></span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<h5 id="string-设置多个键值对"><a href="#string-设置多个键值对" class="headerlink" title="string-设置多个键值对"></a>string-设置多个键值对</h5><p>MSET、MGET 批量增和查看键值对，可以对多个字符串进行批量读写，节省网络耗时开销</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">MSET</span> <span class="selector-tag">key1</span> <span class="selector-tag">v1</span> <span class="selector-tag">key2</span> <span class="selector-tag">v2</span> <span class="selector-tag">key3</span> <span class="selector-tag">v3</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">MGET</span> <span class="selector-tag">key1</span> <span class="selector-tag">key2</span> <span class="selector-tag">key3</span></span><br><span class="line">1) &quot;<span class="selector-tag">v1</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">v2</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">v3</span>&quot;</span><br></pre></td></tr></table></figure>
<p>MESTNX（对多值的原子性操作）有一个失败，就代表都不能成功设置</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">MSET</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span> <span class="selector-tag">k2</span> <span class="selector-tag">v2</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">MGET</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span></span><br><span class="line"><span class="selector-tag">v1</span></span><br><span class="line"><span class="selector-tag">v2</span></span><br><span class="line">&gt; <span class="selector-tag">MSETNX</span> <span class="selector-tag">k1</span> <span class="selector-tag">a</span> <span class="selector-tag">k2</span> <span class="selector-tag">b</span>            //<span class="selector-tag">k1</span>，<span class="selector-tag">k2</span>都有值，所以不能成功，返回0</span><br><span class="line">0</span><br><span class="line">&gt; <span class="selector-tag">MSETNX</span> <span class="selector-tag">k3</span> <span class="selector-tag">v3</span> <span class="selector-tag">k4</span> <span class="selector-tag">v4</span>          //<span class="selector-tag">k3</span>，<span class="selector-tag">k4</span>不用值，设置陈宫，返回1</span><br><span class="line">1</span><br><span class="line">&gt; <span class="selector-tag">MGET</span> <span class="selector-tag">k3</span> <span class="selector-tag">k4</span></span><br><span class="line"><span class="selector-tag">v3</span></span><br><span class="line"><span class="selector-tag">v4</span></span><br><span class="line">&gt; <span class="selector-tag">MSETNX</span> <span class="selector-tag">k3</span> <span class="selector-tag">v3</span> <span class="selector-tag">k4</span> <span class="selector-tag">v4</span> <span class="selector-tag">k5</span> <span class="selector-tag">v5</span>    //设置<span class="selector-tag">k5</span>值，但之前<span class="selector-tag">k3</span>、<span class="selector-tag">k4</span>已经设置过了，所以不能成功，查看<span class="selector-tag">k5</span>是空的</span><br><span class="line">0</span><br><span class="line">&gt; <span class="selector-tag">MGET</span> <span class="selector-tag">k3</span> <span class="selector-tag">k4</span> <span class="selector-tag">k5</span></span><br><span class="line"><span class="selector-tag">v3</span></span><br><span class="line"><span class="selector-tag">v4</span></span><br></pre></td></tr></table></figure>
<h5 id="string-其他命令使用"><a href="#string-其他命令使用" class="headerlink" title="string-其他命令使用"></a>string-其他命令使用</h5><p>APPEND 追加字符创</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">append</span> <span class="selector-tag">k1</span> &quot; <span class="selector-tag">world</span>&quot;</span><br><span class="line">(<span class="selector-tag">integer</span>) 11</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span> <span class="selector-tag">world</span>&quot;</span><br></pre></td></tr></table></figure>
<p>GETRANGE 取值范围值，redis有正反向索引，第一个字符开始是从0位置开始（正向索引），最后的字符从-1开始（反向索引）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span> <span class="selector-tag">world</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">GETRANGE</span> <span class="selector-tag">k1</span> 6 11</span><br><span class="line">&quot;<span class="selector-tag">world</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">GETRANGE</span> <span class="selector-tag">k1</span> 6 <span class="selector-tag">-1</span>       </span><br><span class="line">&quot;<span class="selector-tag">world</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">GETRANGE</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-7</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span>&quot;</span><br></pre></td></tr></table></figure>
<p>SETRANGE 设置范围值，可以将设置的值对之前的值进行覆盖</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span> <span class="selector-tag">world</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SETRANGE</span> <span class="selector-tag">k1</span> 6 <span class="selector-tag">hello</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 11</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span> <span class="selector-tag">hello</span>&quot;</span><br></pre></td></tr></table></figure>
<p>STRLEN 获取值的长度</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span> <span class="selector-tag">hell0</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">STRLEN</span> <span class="selector-tag">k1</span>         </span><br><span class="line">(<span class="selector-tag">integer</span>) 11    //有11个字符</span><br></pre></td></tr></table></figure>
<p>SETEX、SETNX设置过期时间，可以对key设置过期时间，到时间会被自动删除，这个功能常用来控制缓存的失效时间。</p>
<ul>
<li>setex命令，是设置x秒后过期，等同于set+expire，expire是设置时间过期（是在全局范围的命令）</li>
<li>setnx命令，如果key不存在就执行set创建</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setex</span> <span class="selector-tag">key2</span> 5 <span class="selector-tag">v2</span>         </span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key2</span></span><br><span class="line">&quot;<span class="selector-tag">v2</span>&quot;</span><br><span class="line">...........5秒后............</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">setnx</span> <span class="selector-tag">key3</span> <span class="selector-tag">k3</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key3</span></span><br><span class="line">&quot;<span class="selector-tag">k3</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">setnx</span> <span class="selector-tag">key3</span> <span class="selector-tag">k33</span>          //因为<span class="selector-tag">name</span>已经存在，所以<span class="selector-tag">set</span>创建不成功</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">name</span></span><br><span class="line">“<span class="selector-tag">k3</span>”                      //值没有改变</span><br></pre></td></tr></table></figure>
<p>GETSET(将一个旧值刷新为新值)，其实就是减少操作步骤，如果使用这个就不需要先set，在get查看值，而是直接使用一次GETSET，设置并能查看到值，相当于减少了一次IO</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">GETSET</span> <span class="selector-tag">k1</span> <span class="selector-tag">world</span>         //刷新为新值，查看旧值 </span><br><span class="line"><span class="selector-tag">hello</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line"><span class="selector-tag">world</span></span><br></pre></td></tr></table></figure>
<h4 id="int类型"><a href="#int类型" class="headerlink" title="int类型"></a>int类型</h4><p>INCR、INCRBY、INCRBYFLOAT、DECR、DECRBY命令将字符串值解析成整型，但是通过TYPE查看value也还是属于字符串，需要通过命令OBJECT ENCODING 进行查看</p>
<ul>
<li><p>TYPE 查看类型</p>
</li>
<li><p>OBJECT 查看对象</p>
</li>
<li><p>ENCODING 查看对象的编码模式</p>
</li>
</ul>
<p>在字符串结构类型中，不只有string，也有int和bitmap，在使用set设置一个key时，底层会使用encoding进行判断编码模式，对于数值虽然在表面上用TYPE查看是string类型，但使用encoding查看是属于int类型</p>
<p>作用是通过encoding进行判断，减少类型转换的操作，起到加速的作用。当不能使用INCR增加的使用，encoding自然会报错，</p>
<h5 id="int-类型示例"><a href="#int-类型示例" class="headerlink" title="int-类型示例"></a>int-类型示例</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">key1</span> 99</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">TYPE</span> <span class="selector-tag">key1</span></span><br><span class="line"><span class="selector-tag">string</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">OBJECT</span> <span class="selector-tag">help</span>             //查看<span class="selector-tag">OBJECT</span>帮助可以看到<span class="selector-tag">ENCODING</span></span><br><span class="line"><span class="selector-tag">ENCODING</span> &lt;<span class="selector-tag">key</span>&gt; <span class="selector-tag">--</span> <span class="selector-tag">Return</span> <span class="selector-tag">the</span> <span class="selector-tag">kind</span> <span class="selector-tag">of</span> <span class="selector-tag">internal</span> <span class="selector-tag">representation</span> <span class="selector-tag">used</span> <span class="selector-tag">in</span> <span class="selector-tag">order</span> <span class="selector-tag">to</span> <span class="selector-tag">store</span> <span class="selector-tag">the</span> <span class="selector-tag">value</span> <span class="selector-tag">associated</span> <span class="selector-tag">with</span> <span class="selector-tag">a</span> <span class="selector-tag">key</span></span><br><span class="line">意思是：返回用于存储与键关联的值，显示内存表示的种类</span><br><span class="line">.</span><br><span class="line">&gt; <span class="selector-tag">OBJECT</span> <span class="selector-tag">encoding</span> <span class="selector-tag">key1</span></span><br><span class="line">&quot;<span class="selector-tag">int</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">INCR</span> <span class="selector-tag">key1</span>               //加1</span><br><span class="line">(<span class="selector-tag">integer</span>) 100</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">INCRBY</span> <span class="selector-tag">key1</span> 1000       //加多值</span><br><span class="line">(<span class="selector-tag">integer</span>) 1102</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">&quot;1102&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">DECR</span> <span class="selector-tag">key1</span>               //减1</span><br><span class="line">(<span class="selector-tag">integer</span>) 1096 </span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">DECRBY</span> <span class="selector-tag">key1</span> 100         //减100，也可以</span><br></pre></td></tr></table></figure>
<h4 id="bitmap（位图）"><a href="#bitmap（位图）" class="headerlink" title="bitmap（位图）"></a>bitmap（位图）</h4><p>字符串由多个字节组成，每个字节又由8个bit组成，将一个字符串看成很多bit的组合。字节有字节的索引（从0开始），而位（bit）有位的索引（也是从0开始）。在下述内容我称字节索引位=byte索引，位索引=bit索引</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315213803912.png"></p>
<h5 id="bitmap的使用"><a href="#bitmap的使用" class="headerlink" title="bitmap的使用"></a>bitmap的使用</h5><p><strong>SETBIT：设置key的二进制位</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="selector-tag">setbit</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">SETBIT</span> <span class="selector-tag">key</span> <span class="selector-tag">offset</span> <span class="selector-tag">value</span></span><br><span class="line">  <span class="selector-tag">summary</span>: <span class="selector-tag">Sets</span> <span class="selector-tag">or</span> <span class="selector-tag">clears</span> <span class="selector-tag">the</span> <span class="selector-tag">bit</span> <span class="selector-tag">at</span> <span class="selector-tag">offset</span> <span class="selector-tag">in</span> <span class="selector-tag">the</span> <span class="selector-tag">string</span> <span class="selector-tag">value</span> <span class="selector-tag">stored</span> <span class="selector-tag">at</span> <span class="selector-tag">key</span></span><br><span class="line">           设置或清除存储在<span class="selector-tag">key</span>字符串值的二进制位</span><br><span class="line">  <span class="selector-tag">since</span>: 2.2.0</span><br><span class="line">  <span class="selector-tag">group</span>: <span class="selector-tag">string</span></span><br></pre></td></tr></table></figure>
<p>SETBIT的k1值，第一个1是bit索引，第二个1是将bit索引对应的0设置成1。获取到的是”@”，这是根据ASCII码所定义</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 1 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">STRLEN</span> <span class="selector-tag">k1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;@&quot;                 //ASCII码</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315214636807.png"></p>
<p>在设置bit索引第5位设置成1，得到D。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SETBIT</span> <span class="selector-tag">k1</span> 5 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">D</span>&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315215248143.png"></p>
<p>可以通过Linux的（man ascii ）查看ascii表是否正确</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ man ascii</span><br><span class="line"><span class="selector-tag">Oct</span>   <span class="selector-tag">Dec</span>   <span class="selector-tag">Hex</span>   <span class="selector-tag">Char</span>                        <span class="selector-tag">Oct</span>   <span class="selector-tag">Dec</span>   <span class="selector-tag">Hex</span>   <span class="selector-tag">Char</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────</span><br><span class="line">000   0     00    NUL &#x27;\0&#x27;                    100   64    40    @</span><br><span class="line">001   1     01    <span class="selector-tag">SOH</span> (<span class="selector-tag">start</span> <span class="selector-tag">of</span> <span class="selector-tag">heading</span>)      101   65    41    <span class="selector-tag">A</span></span><br><span class="line">002   2     02    <span class="selector-tag">STX</span> (<span class="selector-tag">start</span> <span class="selector-tag">of</span> <span class="selector-tag">text</span>)         102   66    42    <span class="selector-tag">B</span></span><br><span class="line">003   3     03    <span class="selector-tag">ETX</span> (<span class="selector-tag">end</span> <span class="selector-tag">of</span> <span class="selector-tag">text</span>)           103   67    43    <span class="selector-tag">C</span></span><br><span class="line">004   4     04    <span class="selector-tag">EOT</span> (<span class="selector-tag">end</span> <span class="selector-tag">of</span> <span class="selector-tag">transmission</span>)   104   68    44    <span class="selector-tag">D</span></span><br><span class="line">005   5     05    <span class="selector-tag">ENQ</span> (<span class="selector-tag">enquiry</span>)               105   69    45    <span class="selector-tag">E</span></span><br></pre></td></tr></table></figure>
<p>可以看到“D”的Hex（十六进制）是44，拆分换算0100=4，0100=4，合并就是等于44。当然你也可以使用十进制来换算，如上述01000100，换算成十进制就等于64+4=68，刚好对应着”D”的字符</p>
<p>再看看设置k1在bit索引第9位设置成1，9是第二个字节，也就是byte索引1，加起来就是“D@”</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SETBIT</span> <span class="selector-tag">k1</span> 9 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">D</span>@&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315220417905.png"></p>
<p><strong>GETBIT：返回key存储字符串值中偏移量的位值</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 1 1     //<span class="selector-tag">bit</span>索引的1，置为1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0 </span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 8 1     //<span class="selector-tag">bit</span>索引的8，置为1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 1       </span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 8</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 5      //因为没有设置，所以返回0</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<p>还可以通过set设置值，然后通过getbit查找它在bit索引的位置，比如设置一个A。那么通过ascii，它所置为1的bit索引就是1和7（上述的setbit例子可以设置和查看）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">A</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 7</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">getbit</span> <span class="selector-tag">k1</span> 5</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<p><strong>BITPOS：通过字节索引查找第一个bit</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="selector-tag">BITPOS</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">BITPOS</span> <span class="selector-tag">key</span> <span class="selector-tag">bit</span> <span class="selector-attr">[start]</span> <span class="selector-attr">[end]</span>（<span class="selector-tag">start</span> <span class="selector-tag">end</span>字节索引）</span><br><span class="line">  <span class="selector-tag">summary</span>: <span class="selector-tag">Find</span> <span class="selector-tag">first</span> <span class="selector-tag">bit</span> <span class="selector-tag">set</span> <span class="selector-tag">or</span> <span class="selector-tag">clear</span> <span class="selector-tag">in</span> <span class="selector-tag">a</span> <span class="selector-tag">string</span></span><br><span class="line">           查找第一<span class="selector-tag">bit</span>设置或清除字符串</span><br><span class="line">  <span class="selector-tag">since</span>: 2.8.7</span><br><span class="line">  <span class="selector-tag">group</span>: <span class="selector-tag">string</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 1 1</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 9 1</span><br><span class="line"></span><br><span class="line">&gt; BITPOS k1 1 0 0       //查找bit=1，byte索引0到0</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; BITPOS k1 1 1 1       //查找bit=1，byte索引1到1</span><br><span class="line">(<span class="selector-tag">integer</span>) 9</span><br><span class="line">&gt; BITPOS k1 1 0 1       //查找bit=1，byte索引0到1，谁先查找到，则显示该1的bit索引</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315222757007.png"></p>
<p>设置k2和k3值，k2分别在8和16位的bit索引置为1，k3在0和7位置为1</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k2</span> 8 1 </span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k2</span> 16 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k3</span> 0 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k3</span> 7 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line"></span><br><span class="line">&gt; BITPOS k2 1 0 1    //查找字节索引0和1，bit=1的第一个bit</span><br><span class="line">(<span class="selector-tag">integer</span>) 8</span><br><span class="line">&gt; <span class="selector-tag">BITPOS</span> <span class="selector-tag">k2</span> 1 1 2    </span><br><span class="line">(<span class="selector-tag">integer</span>) 8</span><br><span class="line">&gt; BITPOS k2 1 2 2    //查看字节索引2到2，bit=1的第一个bit</span><br><span class="line">(<span class="selector-tag">integer</span>) 16</span><br><span class="line"></span><br><span class="line">&gt; BITPOS k3 1 0 0    //查看字节索引0和0，bit=1的第一个bit</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">BITPOS</span> <span class="selector-tag">k3</span> 1 0 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">BITPOS</span> <span class="selector-tag">k3</span> 1 1 1   //<span class="selector-tag">-1</span>是反向表示，7是<span class="selector-tag">bit</span>索引的最后一个，所以使用了<span class="selector-tag">-1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) <span class="selector-tag">-1</span></span><br></pre></td></tr></table></figure>
<p><strong>BITCOUNT：统计在字节索引中出现的bit数</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="selector-tag">BITCOUNT</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">key</span> <span class="selector-attr">[start end]</span></span><br><span class="line">  <span class="selector-tag">summary</span>: <span class="selector-tag">Count</span> <span class="selector-tag">set</span> <span class="selector-tag">bits</span> <span class="selector-tag">in</span> <span class="selector-tag">a</span> <span class="selector-tag">string</span></span><br><span class="line">           统计字节索引存在的<span class="selector-tag">bit</span>位</span><br><span class="line">  <span class="selector-tag">since</span>: 2.6.0</span><br><span class="line">  <span class="selector-tag">group</span>: <span class="selector-tag">string</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">k2</span> 0 2      //<span class="selector-tag">k2</span>在8和16 <span class="selector-tag">bit</span>索引分别设置了1，所以有两个</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">k3</span> 0 0     //<span class="selector-tag">k3</span>在0和7 <span class="selector-tag">bit</span>索引分别设置了1，所以也有两个</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br></pre></td></tr></table></figure>
<p><strong>bitop：与运算 两者的之间byte索引存在的bit位</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="selector-tag">BITOP</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">BITOP</span> <span class="selector-tag">operation</span> <span class="selector-tag">destkey</span> <span class="selector-tag">key</span> <span class="selector-attr">[key ...]</span></span><br><span class="line">  <span class="selector-tag">summary</span>: <span class="selector-tag">Perform</span> <span class="selector-tag">bitwise</span> <span class="selector-tag">operations</span> <span class="selector-tag">between</span> <span class="selector-tag">strings</span></span><br><span class="line">           在字符索引之间执行按位的 与运算</span><br><span class="line">  <span class="selector-tag">since</span>: 2.6.0</span><br><span class="line">  <span class="selector-tag">group</span>: <span class="selector-tag">string</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 1 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k1</span> 7 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">A</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k2</span> 1 1       </span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">k2</span> 6 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k2</span></span><br><span class="line">&quot;<span class="selector-tag">B</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">BITOP</span> <span class="selector-tag">and</span> <span class="selector-tag">andkey</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span>    //<span class="selector-tag">k1</span>和<span class="selector-tag">k2</span>都将<span class="selector-tag">bit</span>索引1置为1，所以相同的就是“@”</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line">&gt; get andkey</span><br><span class="line"><span class="string">&quot;@&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; BITOP <span class="keyword">or</span> orkey k1 k2     //k1和k2的异或运算，k1得出A=<span class="number">41</span>，k2得出B=<span class="number">42</span>，异或之后得出<span class="number">43</span>=C。可通过ascii查看对应的值</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line">&gt; get orkey</span><br><span class="line"><span class="string">&quot;C&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>bitfield：对字符串执行任意bitfield（位域）整数运算</strong></p>
<p>setbit和getbit指定位的值都是单个位的，如果要操作多个，就必须使用管道处理。在redis的3.2版本之后新增了一个强大的指令，就是bitfield。它可执行多个操作，这样就不需要通过管道来处理</p>
<p>bitfield有三个指令：分别是get、set、incrby，它们都可以对指定位片段进行读写，但是最多只能处理64个连续的位。如果超过64位，就得使用子指令，bitfield可以一次执行多个指令</p>
<p>如下图，可以看到每个字符的对应的二进制位，以及分低位和高位。箭头指向的数字，代表bit索引，框框中代表的就是二进制位</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210420105118132.png"></p>
<p>通过查看man ascii表，可以找到对应字符的八进制、十进制以及十六，你可以选择任意一种推算出二进制，如图</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man ascii</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210420105449838.png"></p>
<p>创建一个key，分别通过bitfield进行查看</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">get</span> <span class="selector-tag">u4</span> 0   // <span class="selector-tag">u4</span>表示(<span class="selector-tag">u</span>)无符号的取值，从第一个位开始取 4 个位</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 6 </span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">get</span> <span class="selector-tag">u3</span> 2   // <span class="selector-tag">u3</span>表示(<span class="selector-tag">u</span>)无符号的取值，从第三个位开始取 3 个位</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">get</span> <span class="selector-tag">i4</span> 0   // <span class="selector-tag">i4</span>表示(<span class="selector-tag">i</span>)有符号的取值，从第一个位开始取 4 个位</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 6</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">get</span> <span class="selector-tag">i3</span> 2   // <span class="selector-tag">i3</span>表示(<span class="selector-tag">i</span>)有符号的取值，从第三个位开始取 3 个位</span><br><span class="line">1) (<span class="selector-tag">integer</span>) <span class="selector-tag">-3</span></span><br></pre></td></tr></table></figure>
<p>所谓有符号数是指获取的位数组中第一个位是符号位，剩下的才是值。如果第一位是1，那就是负数（也就是用负数来表示）。无符号数表示非负数，没有符号位，获取的位数全部都是值（也就是用正数来表示）</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210420165536085.png"></p>
<p>有符号最多可以获取64位，无符号只能获取63位（因为Redis协议中的integer是有符号数，最大64位，不能传递64位无符号值）。如果超出位数限制，redis就会告诉参数错误</p>
<p>bitfield执行多个自指令</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">get</span> <span class="selector-tag">u4</span> 0 <span class="selector-tag">get</span> <span class="selector-tag">u3</span> 2 <span class="selector-tag">get</span> <span class="selector-tag">i4</span> 0 <span class="selector-tag">get</span> <span class="selector-tag">i3</span> 2</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 6</span><br><span class="line">2) (<span class="selector-tag">integer</span>) 5</span><br><span class="line">3) (<span class="selector-tag">integer</span>) 6</span><br><span class="line">4) (<span class="selector-tag">integer</span>) <span class="selector-tag">-3</span></span><br></pre></td></tr></table></figure>
<p>使用set子指令将第二个字符e改成a，a在ASCII码是97（十进制的）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">set</span> <span class="selector-tag">u8</span> 8 97   //从第9个位开始，将接下来的8个位用无符号97替换</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 101</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hallo</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">set</span> <span class="selector-tag">u8</span> 16 109  //从第17个位开始，将接下来的8个位用无符号108替换，108等于<span class="selector-tag">m</span></span><br><span class="line">1) (<span class="selector-tag">integer</span>) 108</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hamlo</span>&quot;</span><br></pre></td></tr></table></figure>
<p>第三个指令incrby，它用来指定范围的位的进行自增操作。提供自增就有可能会出现溢出。如果增加了正数，会出现上溢出，如果增加的是负数，会出现下溢出</p>
<p>Redis默认的处理是折返。如果出现了溢出，就将溢出的符号位丢掉。如果8位无符号数255，加1后就会溢出，会全部变零。如果是8位有符号数127，加1后就会溢出变成-128</p>
<p>接下来我们用incrby实践一下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1    //从第三个位开始，对接下来的4位无符号数+1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 11</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 12</span><br><span class="line">....一直加到15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1   //溢出折返，加到16就会溢出，因为<span class="selector-tag">e</span>的范围是8<span class="selector-tag">-15</span></span><br><span class="line">1) (<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<p>bitfiled指令提供了溢出策略子指令overflow，用户可以选择溢出行为，默认是折返（wrap），也可以选择失败（fail，报错不执行），以及饱和截断（sat，超过了范围就停留在最大或最小值）。overflow指令只影响接下来的第一条指令，这条指令执行完后溢出策略会变成默认值折返（wrap)</p>
<p><strong>饱和截断（sat）</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span> </span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">overflow</span> <span class="selector-tag">sat</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 11</span><br><span class="line">....一直加到15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">overflow</span> <span class="selector-tag">sat</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k1</span> <span class="selector-tag">overflow</span> <span class="selector-tag">sat</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1       //保持最大值</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 15 </span><br></pre></td></tr></table></figure>
<p><strong>失败不执行（fail）</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k2</span> <span class="selector-tag">hello</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k2</span> <span class="selector-tag">overflow</span> <span class="selector-tag">fail</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 11</span><br><span class="line">....一直加到15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k2</span> <span class="selector-tag">overflow</span> <span class="selector-tag">fail</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1</span><br><span class="line">1) (<span class="selector-tag">integer</span>) 15</span><br><span class="line">&gt; <span class="selector-tag">bitfield</span> <span class="selector-tag">k2</span> <span class="selector-tag">overflow</span> <span class="selector-tag">fail</span> <span class="selector-tag">incrby</span> <span class="selector-tag">u4</span> 2 1    //不在执行</span><br><span class="line">1) (<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<h5 id="bitmap-例子用法"><a href="#bitmap-例子用法" class="headerlink" title="bitmap-例子用法"></a>bitmap-例子用法</h5><ul>
<li><p>用户系统，统计用户登录天数，且窗口随机</p>
<p>1）可以使用关系型数据库（mysql），但登录时最少要三个字段（id,name,date），假设一个字段4个字节，那么就要耗费12个字节，一个用户需要12字节（1000个用户 x 12 x 365天 = 4380000字节 约=4G）</p>
<p>2）使用redis，一年365天，一个天计一个二进制位，使用400个二进制位（400 / 8 = 50字节），1000个用户（1000 x 50 = 50000 = 50KB）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">wuwei</span> 1 1       //按<span class="selector-tag">bit</span>索引来看，1<span class="selector-tag">bit</span>索引是第二天，<span class="selector-tag">wuwei</span>在第二天登录了</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">wuwei</span> 2 1       //第三天<span class="selector-tag">wuwei</span>登录了</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> <span class="selector-tag">wuwei</span> 364 1     //第三百六十五天也登录了</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; STRLEN wuwei           //长度365 / 8 == 46</span><br><span class="line">(<span class="selector-tag">integer</span>) 46</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">wuwei</span> 0 10    //统计<span class="selector-tag">wuwei</span>用户第一天(0)到第十一(10) 共登录了多少次</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">wuwei</span> <span class="selector-tag">-2</span> <span class="selector-tag">-1</span>   //统计<span class="selector-tag">wuwei</span>用户第三百六十四天到三百六十五天 共登录了几次</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">wuwei</span> 0 <span class="selector-tag">-1</span>    //统计<span class="selector-tag">wuwei</span>用户第一天到第三百六十五天 共登录了几次</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure></li>
<li><p>某电商，做双11活动，送小礼品，假设该电商用户有1亿人，则需要备货多少礼物，当然需要挑选出僵尸用户、冷/热用户和忠诚用户</p>
<p>活跃用户统计，随机窗口，比如说1号-3号访问了电商，连续登陆的需要去重</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210316112053470.png"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">setbit</span> 202103016 1 1    //2021年3月16号 1用户登陆一次，<span class="selector-tag">bit</span>索引代表用户</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> 202103016 2 1    //2021年3月16号 2用户登陆二次</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> 202103016 10 1   //2021年3月16号 10用户登陆三次</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> 202103017 1 1    //2021年3月17号 1用户登陆一次</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">setbit</span> 202103017 2 1    //2021年3月17号 2用户登陆两次</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> 202103016 0 <span class="selector-tag">-1</span>  //2021年3月16号统计有多少个用户登录</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> 202103017 0 <span class="selector-tag">-1</span>  //2021年3月17号统计有多少个用户登录</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line"></span><br><span class="line">//去重</span><br><span class="line">&gt; <span class="selector-tag">BITOP</span> <span class="selector-tag">or</span> <span class="selector-tag">datekey</span> 202103016 202103017  </span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">BITCOUNT</span> <span class="selector-tag">datekey</span> 0 <span class="selector-tag">-1</span>  //统计有三个不同用户登陆在这两天登录了</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure>
<h4 id="小结string命令"><a href="#小结string命令" class="headerlink" title="小结string命令"></a>小结string命令</h4></li>
</ul>
<h5 id="string类型-1"><a href="#string类型-1" class="headerlink" title="string类型"></a>string类型</h5><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SET [NX|XX]</td>
<td>设置键值 NX(没有则创建)，XX(有值则更新)</td>
</tr>
<tr>
<td>GET</td>
<td>查询键值</td>
</tr>
<tr>
<td>APPEND</td>
<td>追加值到key中</td>
</tr>
<tr>
<td>GETRABGE</td>
<td>取值（范围值）</td>
</tr>
<tr>
<td>SETRANGE</td>
<td>设置（覆盖）选中的范围值</td>
</tr>
<tr>
<td>STRLEN</td>
<td>获取值的长度</td>
</tr>
<tr>
<td>MSET</td>
<td>批量设置键值</td>
</tr>
<tr>
<td>MGET</td>
<td>批量查看键值</td>
</tr>
<tr>
<td>MESTNX</td>
<td>批量设置键值（但有原子性，已创建或错误不能成功设置）</td>
</tr>
<tr>
<td>SETEX</td>
<td>设置过期时间，等同于set+expire</td>
</tr>
<tr>
<td>SETNX</td>
<td>设置过期时间，如果key不存在就执行set创建</td>
</tr>
<tr>
<td>GETSET</td>
<td>将一个旧值刷新为新值</td>
</tr>
</tbody></table>
<h5 id="int类型-1"><a href="#int类型-1" class="headerlink" title="int类型"></a>int类型</h5><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>INCR</td>
<td>对key的值进行+1</td>
</tr>
<tr>
<td>INCRBY</td>
<td>对key的值自由加</td>
</tr>
<tr>
<td>DECR</td>
<td>对key的值进行-1</td>
</tr>
<tr>
<td>DECRBY</td>
<td>对key的值自由减</td>
</tr>
<tr>
<td>INCRBYFLOAT</td>
<td>对key的值+小数</td>
</tr>
</tbody></table>
<h5 id="bitmap（位图）-1"><a href="#bitmap（位图）-1" class="headerlink" title="bitmap（位图）"></a>bitmap（位图）</h5><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SETBIT</td>
<td>设置或清除存储在key字符串值的二进制位</td>
</tr>
<tr>
<td>BITPOS</td>
<td>查找在字节索引的第一bit位</td>
</tr>
<tr>
<td>BITCOUNT</td>
<td>统计在字节索引存在的bit位</td>
</tr>
<tr>
<td>BITOP</td>
<td>与运算两者的之间字符索引存在的bit位</td>
</tr>
</tbody></table>
<h3 id="list（列表）"><a href="#list（列表）" class="headerlink" title="list（列表）"></a>list（列表）</h3><p>Redis的列表插入和删除操作是非常快的，因为它是属于链表，列表中的每个元素都是用双向指针顺序，串联起来可以同时支持前后向的遍历</p>
<p>Redis的列表结构常用来做异步队列使用，将需要延后处理的任务结构体序列化成字符串，塞进Redis的列表，另一个线程从这个列表中轮询数据进行处理</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320211922874.png"></p>
<p><strong>list下的分类</strong></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320223455871.png"></p>
<h4 id="list-队列"><a href="#list-队列" class="headerlink" title="list-队列"></a>list-队列</h4><p>队列是先进先出的数据结构，常用于消息排队和异步逻辑处理，它会确保元素的访问顺序性（反向命令）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="keyword">@list</span></span><br><span class="line"></span><br><span class="line">  RPUSH key element [element ...]</span><br><span class="line">  <span class="attribute">summary:</span> Append one <span class="keyword">or</span> multiple elements to a list</span><br><span class="line">           将一个或多个元素附加到list</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">group:</span> list</span><br><span class="line">    </span><br><span class="line">  LPUSH key element [element ...]</span><br><span class="line">  <span class="attribute">summary:</span> Prepend one <span class="keyword">or</span> multiple elements to a list</span><br><span class="line">          添加一个或多个元素到list</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">  LPOP key</span><br><span class="line">  <span class="attribute">summary:</span> Remove <span class="keyword">and</span> get the first element in a list</span><br><span class="line">           删除并获取list第一个元素</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">  RPOP key</span><br><span class="line">  <span class="attribute">summary:</span> Remove <span class="keyword">and</span> get the last element in a list</span><br><span class="line">           删除并获取list最后一个元素</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">A</span> <span class="selector-tag">B</span> <span class="selector-tag">C</span>   //添加三个元素</span><br><span class="line">&gt; <span class="selector-tag">lpop</span> <span class="selector-tag">list1</span>          //移除右边1个元素</span><br><span class="line">&quot;<span class="selector-tag">A</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">lpop</span> <span class="selector-tag">list1</span></span><br><span class="line">&quot;<span class="selector-tag">B</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">lpop</span> <span class="selector-tag">list1</span></span><br><span class="line">&quot;<span class="selector-tag">C</span>&quot;</span><br></pre></td></tr></table></figure>
<h4 id="list-栈"><a href="#list-栈" class="headerlink" title="list-栈"></a>list-栈</h4><p>栈是先进后出的数据结构，跟队列正好相反（同向命令）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">A</span> <span class="selector-tag">B</span> <span class="selector-tag">C</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">rpop</span> <span class="selector-tag">list1</span>         //移除右边1个元素</span><br><span class="line">&quot;<span class="selector-tag">C</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">rpop</span> <span class="selector-tag">list1</span></span><br><span class="line">&quot;<span class="selector-tag">B</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">rpop</span> <span class="selector-tag">list1</span></span><br><span class="line">&quot;<span class="selector-tag">A</span>&quot;</span><br></pre></td></tr></table></figure>
<h4 id="list-数组"><a href="#list-数组" class="headerlink" title="list-数组"></a>list-数组</h4><p><strong>LINDEX命令</strong></p>
<ul>
<li>lindex需要对链表进行遍历，性能随着参数index增大而变差</li>
</ul>
<ul>
<li>index可以为负数，index=-1表示倒数第一个元素，同理index=-2表示倒数第二个元素</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LINDEX</span> <span class="selector-tag">key</span> <span class="selector-tag">index</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Get</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">from</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span> <span class="selector-tag">by</span> <span class="selector-tag">its</span> <span class="selector-tag">index</span></span><br><span class="line">         通过索引你从列表中获取元素</span><br><span class="line"><span class="selector-tag">since</span>: 1.0.0</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LRANGE</span> <span class="selector-tag">key</span> <span class="selector-tag">start</span> <span class="selector-tag">stop</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Get</span> <span class="selector-tag">a</span> <span class="selector-tag">range</span> <span class="selector-tag">of</span> <span class="selector-tag">elements</span> <span class="selector-tag">from</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span></span><br><span class="line">         从列表中获取一系列元素</span><br><span class="line"><span class="selector-tag">since</span>: 1.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span> <span class="selector-tag">d</span> <span class="selector-tag">e</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">lindex</span> <span class="selector-tag">list1</span> 1           //查看1索引对应的元素</span><br><span class="line">&quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">d</span>&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">e</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>LTRIM命令</strong></p>
<ul>
<li>ltrim的两个参数start_index和end_index定义了一个区间，在这个区间内的值，ltrim要保留，区间之外的则统统删掉</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LTRIM</span> <span class="selector-tag">key</span> <span class="selector-tag">start</span> <span class="selector-tag">stop</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Trim</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span> <span class="selector-tag">to</span> <span class="selector-tag">the</span> <span class="selector-tag">specified</span> <span class="selector-tag">range</span></span><br><span class="line">         将<span class="selector-tag">list</span>修剪到指定范围</span><br><span class="line"><span class="selector-tag">since</span>: 1.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span> <span class="selector-tag">d</span> <span class="selector-tag">e</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">ltrim</span> <span class="selector-tag">list1</span> 1 <span class="selector-tag">-1</span>         //不移除范围1到<span class="selector-tag">-1</span>的，所以移除0索引对应的元素</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span>          </span><br><span class="line">1) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">d</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">e</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">ltrim</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span>         //什么都删不了，因为0到<span class="selector-tag">-1</span>包括了所有元素，所以都保留</span><br><span class="line">&gt; <span class="selector-tag">ltrim</span> <span class="selector-tag">list1</span> 1 1          //不移除1索引对应的元素</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span>       </span><br><span class="line">1) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">ltrim</span> <span class="selector-tag">list1</span> 1 0         //清空整个列表，因为区间范围长度为负，可以为负，所以会清空</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">(<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br></pre></td></tr></table></figure>
<p><strong>LINSERT命令</strong></p>
<p>linsert插入元素，如果有相同得到元素，会先从前面插入，而后面的元素则不会插入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LINSERT key BEFORE|AFTER pivot element</span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Insert</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">before</span> <span class="selector-tag">or</span> <span class="selector-tag">after</span> <span class="selector-tag">another</span> <span class="selector-tag">element</span> <span class="selector-tag">in</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span></span><br><span class="line">         在<span class="selector-tag">list</span>中的另一个元素之前或之后插入一个元素</span><br><span class="line"><span class="selector-tag">since</span>: 2.2.0</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">linsert</span> <span class="selector-tag">list1</span> <span class="selector-tag">after</span> <span class="selector-tag">c</span> <span class="selector-tag">a</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">linsert</span> <span class="selector-tag">list1</span> <span class="selector-tag">before</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> </span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">LPUSH</span> <span class="selector-tag">k2</span> 1 <span class="selector-tag">a</span> 1 <span class="selector-tag">b</span> 1 <span class="selector-tag">c</span> </span><br><span class="line">(<span class="selector-tag">integer</span>) 6</span><br><span class="line">&gt; <span class="selector-tag">LINSERT</span> <span class="selector-tag">k2</span> <span class="selector-tag">after</span> 1 <span class="selector-tag">d</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 7</span><br><span class="line">&gt; <span class="selector-tag">LRANGE</span> <span class="selector-tag">k2</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">d</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">6) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">7) &quot;1&quot;</span><br></pre></td></tr></table></figure>
<h4 id="list-阻塞使用"><a href="#list-阻塞使用" class="headerlink" title="list-阻塞使用"></a>list-阻塞使用</h4><p><strong>BRPOP、LRPOP命令</strong></p>
<p>brpop、lrpop阻塞弹出元素，无论这个key否存在，而且是单播队列（FIFO先进先出，也就是当一个key可以在（窗口）插入值之后，就会解除阻塞，不然就要等待超时时间）</p>
<ul>
<li>BRPOP 删除并获取列表中的第一个元素，或者阻塞值直到一个可用</li>
<li>LRPOP同上，只是方向不同</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="keyword">@list</span></span><br><span class="line">  BLPOP key [key ...] timeout</span><br><span class="line">  <span class="attribute">summary:</span> Remove <span class="keyword">and</span> get the first element in a list, <span class="keyword">or</span> block until one is available</span><br><span class="line">           删除并获取列表中的第一个元素，或者阻塞值直到一个可用</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">2.0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">group:</span> list</span><br><span class="line"></span><br><span class="line">  BRPOP key [key ...] timeout</span><br><span class="line">  <span class="attribute">summary:</span> Remove <span class="keyword">and</span> get the last element in a list, <span class="keyword">or</span> block until one is available</span><br><span class="line">           同上，只是方向不同</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">2.0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">group:</span> list</span><br></pre></td></tr></table></figure>
<p>开启三个窗口，可以多个key，0代表就是一直阻塞</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//窗口1</span><br><span class="line">&gt; <span class="selector-tag">blpop</span> <span class="selector-tag">list1</span> 0    </span><br><span class="line"></span><br><span class="line">//窗口2</span><br><span class="line">&gt; <span class="selector-tag">blpop</span> <span class="selector-tag">list1</span> 0</span><br><span class="line"></span><br><span class="line">//窗口3</span><br><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">hello</span>  </span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p>查看窗口1的反应，会发现已经插入一个值，而窗口2是没有变化的</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">blpop</span> <span class="selector-tag">list1</span> 0</span><br><span class="line">1) &quot;<span class="selector-tag">list1</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">hello</span>&quot;</span><br><span class="line">(73.88<span class="selector-tag">s</span>)</span><br></pre></td></tr></table></figure>
<p>窗口3在插入值，在查看窗口2变化</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//窗口3</span><br><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">world</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line"></span><br><span class="line">//窗口2</span><br><span class="line"> <span class="selector-tag">blpop</span> <span class="selector-tag">list1</span> 0</span><br><span class="line">1) &quot;<span class="selector-tag">list1</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">world</span>&quot;</span><br><span class="line">(44.92<span class="selector-tag">s</span>)</span><br></pre></td></tr></table></figure>
<p>可以看出，阻塞是单播队列的，需要等上一个解除之后，才能解除下一个</p>
<p><strong>BRPOPLPUSH命令</strong></p>
<ul>
<li>BRPOPLPUSH 从list弹出一个元素，将其推送到另一个list并返回，或封住直到一个可用</li>
</ul>
<p>创建list1和list2，list1一个元素，list2三个元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">BRPOPLPUSH</span> <span class="selector-tag">source</span> <span class="selector-tag">destination</span> <span class="selector-tag">timeout</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Pop</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">from</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span>, <span class="selector-tag">push</span> <span class="selector-tag">it</span> <span class="selector-tag">to</span> <span class="selector-tag">another</span> <span class="selector-tag">list</span> <span class="selector-tag">and</span> <span class="selector-tag">return</span> <span class="selector-tag">it</span>; <span class="selector-tag">or</span> <span class="selector-tag">block</span> <span class="selector-tag">until</span> <span class="selector-tag">one</span> <span class="selector-tag">is</span> <span class="selector-tag">available</span></span><br><span class="line">        从<span class="selector-tag">list</span>弹出一个元素，将其推送到另一个<span class="selector-tag">list</span>并返回，或封住知道一个可用</span><br><span class="line"><span class="selector-tag">since</span>: 2.2.0</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; </span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list2</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span> <span class="selector-tag">d</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure>
<p>打开两个窗口，使用BRPOPLPUSH进行追加，时间设定200秒</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//窗口1</span><br><span class="line">&gt; <span class="selector-tag">brpoplpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">list2</span> 200</span><br><span class="line">&quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list2</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">d</span>&quot;</span><br></pre></td></tr></table></figure>
<p>此时list1是没有数据，如果在追加就会起锁，如果在200秒以内插入了数据就会解锁，否则需要等200后解锁</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//窗口1</span><br><span class="line">&gt; <span class="selector-tag">brpoplpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">list2</span> 200</span><br><span class="line"></span><br><span class="line">//窗口2</span><br><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">z</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line"></span><br><span class="line">//窗口1查看</span><br><span class="line">&quot;<span class="selector-tag">z</span>&quot;</span><br><span class="line">(20.59<span class="selector-tag">s</span>)</span><br><span class="line">&gt; <span class="selector-tag">llen</span> <span class="selector-tag">list2</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list2</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">z</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">b</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">d</span>&quot;</span><br></pre></td></tr></table></figure>
<h4 id="list-其他命令使用"><a href="#list-其他命令使用" class="headerlink" title="list-其他命令使用"></a>list-其他命令使用</h4><p><strong>RPOPLPUSH、LLEN命令</strong></p>
<ul>
<li>RPOPLPUSH删除list最后一个元素，将添加到另一个list并返回</li>
<li>LLEN查看list的长度</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="keyword">@list</span></span><br><span class="line"></span><br><span class="line">  RPOPLPUSH source destination</span><br><span class="line">  <span class="attribute">summary:</span> Remove the last element in a list, prepend it to another list <span class="keyword">and</span> return it</span><br><span class="line">           删除list最后一个元素，将添加到另一个list并返回</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.2</span>.<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">  LLEN key</span><br><span class="line">  <span class="attribute">summary:</span> Get the length of a list</span><br><span class="line">           查看list的长度</span><br><span class="line">  <span class="attribute">since:</span> <span class="number">1.0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>创建list1、list2，都添加3个元素，list1移除前两个元素，并将最后一个元素添加到list2，然后查看长度和元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">A</span> <span class="selector-tag">B</span> <span class="selector-tag">C</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list2</span> <span class="selector-tag">D</span> <span class="selector-tag">E</span> <span class="selector-tag">F</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">lpop</span> <span class="selector-tag">list1</span> </span><br><span class="line">&quot;<span class="selector-tag">A</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">lpop</span> <span class="selector-tag">list1</span> </span><br><span class="line">&quot;<span class="selector-tag">B</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">rpoplpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">list2</span>     //将<span class="selector-tag">list1</span>的元素添加到<span class="selector-tag">list2</span></span><br><span class="line">&quot;<span class="selector-tag">C</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">(<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list2</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">C</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">D</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">E</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">F</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">llen</span> <span class="selector-tag">list1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">llen</span> <span class="selector-tag">list2</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br></pre></td></tr></table></figure>
<p><strong>RPUSHX、LPUSHX命令</strong></p>
<ul>
<li>RPUSHX 如果list表存在，则附加元素到list</li>
<li>LPUSHX 如果list表存在，则添加元素到list</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">RPUSHX</span> <span class="selector-tag">key</span> <span class="selector-tag">element</span> <span class="selector-attr">[element ...]</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Append</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">to</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span>, <span class="selector-tag">only</span> <span class="selector-tag">if</span> <span class="selector-tag">the</span> <span class="selector-tag">list</span> <span class="selector-tag">exists</span></span><br><span class="line">         如果<span class="selector-tag">list</span>表存在，则附加元素到<span class="selector-tag">list</span></span><br><span class="line"><span class="selector-tag">since</span>: 2.2.0</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LPUSHX</span> <span class="selector-tag">key</span> <span class="selector-tag">element</span> <span class="selector-attr">[element ...]</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Prepend</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">to</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span>, <span class="selector-tag">only</span> <span class="selector-tag">if</span> <span class="selector-tag">the</span> <span class="selector-tag">list</span> <span class="selector-tag">exists</span></span><br><span class="line"><span class="selector-tag">since</span>: 2.2.0</span><br><span class="line"><span class="selector-tag">group</span>: <span class="selector-tag">list</span></span><br></pre></td></tr></table></figure>
<p><strong>LSET命令</strong></p>
<ul>
<li>通过其设置list中元素的值  </li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LSET</span> <span class="selector-tag">key</span> <span class="selector-tag">index</span> <span class="selector-tag">element</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Set</span> <span class="selector-tag">the</span> <span class="selector-tag">value</span> <span class="selector-tag">of</span> <span class="selector-tag">an</span> <span class="selector-tag">element</span> <span class="selector-tag">in</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span> <span class="selector-tag">by</span> <span class="selector-tag">its</span> <span class="selector-tag">index</span></span><br><span class="line">         通过其索引设置<span class="selector-tag">list</span>中元素的值  </span><br><span class="line"><span class="selector-tag">since</span>: 1.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">RPUSH</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">lset</span> <span class="selector-tag">list1</span> 1 <span class="selector-tag">c</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">c</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>LERM命令</strong></p>
<ul>
<li>从list中移除元素</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LREM</span> <span class="selector-tag">key</span> <span class="selector-tag">count</span> <span class="selector-tag">element</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Remove</span> <span class="selector-tag">elements</span> <span class="selector-tag">from</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span></span><br><span class="line">         从<span class="selector-tag">list</span>中移除元素</span><br><span class="line"><span class="selector-tag">since</span>: 1.0.0</span><br></pre></td></tr></table></figure>
<p>lrem可以移除一个或多个的元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span> <span class="selector-tag">d</span> <span class="selector-tag">d</span> <span class="selector-tag">b</span> </span><br><span class="line">(<span class="selector-tag">integer</span>) 7</span><br><span class="line">&gt; <span class="selector-tag">lrem</span> <span class="selector-tag">list1</span> 2 <span class="selector-tag">d</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">lrem</span> <span class="selector-tag">list1</span> 1 <span class="selector-tag">b</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line"> <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span></span><br><span class="line">&gt; <span class="selector-tag">lrange</span> <span class="selector-tag">list1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">a</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">c</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">b</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>LPOS命令</strong></p>
<ul>
<li>返回list中匹配元素的索引</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LPOS</span> <span class="selector-tag">key</span> <span class="selector-tag">element</span> <span class="selector-attr">[RANK rank]</span> <span class="selector-attr">[COUNT num-matches]</span> <span class="selector-attr">[MAXLEN len]</span></span><br><span class="line"><span class="selector-tag">summary</span>: <span class="selector-tag">Return</span> <span class="selector-tag">the</span> <span class="selector-tag">index</span> <span class="selector-tag">of</span> <span class="selector-tag">matching</span> <span class="selector-tag">elements</span> <span class="selector-tag">on</span> <span class="selector-tag">a</span> <span class="selector-tag">list</span></span><br><span class="line">        返回<span class="selector-tag">list</span>中匹配元素的索引 </span><br><span class="line"><span class="selector-tag">since</span>: 6.0.6</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">rpush</span> <span class="selector-tag">list1</span> 1 <span class="selector-tag">a</span> 2 <span class="selector-tag">b</span> 3 <span class="selector-tag">c</span> 4 <span class="selector-tag">d</span></span><br><span class="line">&gt; <span class="selector-tag">lpos</span> <span class="selector-tag">list1</span> <span class="selector-tag">a</span>    //<span class="selector-tag">a</span>的索引位置</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">lpos</span> <span class="selector-tag">list1</span> <span class="selector-tag">c</span>    //<span class="selector-tag">c</span>的索引位置</span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">lpos</span> <span class="selector-tag">list1</span> <span class="selector-tag">d</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 7</span><br></pre></td></tr></table></figure>
<h4 id="小结list命令"><a href="#小结list命令" class="headerlink" title="小结list命令"></a>小结list命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>RPUSH</td>
<td>将一个或多个元素附加到list</td>
</tr>
<tr>
<td>LPUSH</td>
<td>添加一个或多个元素到list</td>
</tr>
<tr>
<td>LPOP</td>
<td>删除并获取list第一个元素</td>
</tr>
<tr>
<td>RPOP</td>
<td>删除并获取list最后一个元素</td>
</tr>
<tr>
<td>RPOPLPUSH</td>
<td>删除list最后一个元素，将添加到另一个list并返回</td>
</tr>
<tr>
<td>LRANGE</td>
<td>从列表中获取一系列元素</td>
</tr>
<tr>
<td>LLEN</td>
<td>查看list的长度</td>
</tr>
<tr>
<td>RPUSHX</td>
<td>如果list表存在，则附加元素到list</td>
</tr>
<tr>
<td>LPUSHX</td>
<td>跟RPUSHX操作相同，方向不同</td>
</tr>
<tr>
<td>BRPOP</td>
<td>删除并获取列表中的第一个元素，或者阻塞值直到一个可用</td>
</tr>
<tr>
<td>LRPOP</td>
<td>跟BRPOP操作相同，方向不同</td>
</tr>
<tr>
<td>BRPOPLPUSH</td>
<td>从list弹出一个元素，将其推送到另一个list并返回，或封住知道一个可用</td>
</tr>
<tr>
<td>LSET</td>
<td>通过其设置list中元素的值</td>
</tr>
<tr>
<td>LERM</td>
<td>从list中移除元素</td>
</tr>
<tr>
<td>LPOS</td>
<td>返回list中匹配元素的索引</td>
</tr>
<tr>
<td>lindex</td>
<td>通过索引从列表中获取元素</td>
</tr>
<tr>
<td>ltrim</td>
<td>将list修建到指定范围</td>
</tr>
<tr>
<td>linsert</td>
<td>在list中的另一个元素之前或之后插入一个元素</td>
</tr>
</tbody></table>
<h3 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a>hash（哈希）</h3><p>hash是无序字典，内部存储了很多键值对，第一维hash的数组位置碰撞时，就会将碰撞的元素使用链表串联起来</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320214712427.png"></p>
<p>Redis的字典值只能是字符串，hash结构也可以用来存储用户信息，与字符串需要一次性全部序列化整个对象不同，hash可以对用户结构中的每个字段单独存储。这样当需要获取用户信息时可以进行部分获取。而以整个字符串的形式去保存用户信息的话，就只能一次性全部读取，这样就会浪费网络流量</p>
<p>hash缺点：hash结构存储消耗要高于单个字符串，所以到底该使用hash还是字符串，需要根据实际情况使用</p>
<h4 id="hash-命令使用"><a href="#hash-命令使用" class="headerlink" title="hash-命令使用"></a>hash-命令使用</h4><p>hash很多方法同字符串一样，只有前面加了h，hash结构中的单个子key也可以进行计数，它对应的指令是hincrby，和incr的使用方法基本一样，也有hincrybyfloat，所以只列出命令的使用</p>
<p><strong>HSET、HMSET，HGET，HMGET、HGETALL、HVALS、HINCRBY、HINCRBYFLOAT命令</strong></p>
<ul>
<li>HSET和HMSET 设置单个域或多个</li>
<li>HGET和HMGET 查看单个或多个</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span> <span class="selector-tag">username</span> <span class="selector-tag">liu</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">hget</span> <span class="selector-tag">user</span> <span class="selector-tag">username</span></span><br><span class="line">&quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">HMSET</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1000</span> <span class="selector-tag">username</span> <span class="selector-tag">zhang</span> <span class="selector-tag">age</span> 27 <span class="selector-tag">job</span> <span class="selector-tag">it</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">HGET</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1000</span> <span class="selector-tag">username</span></span><br><span class="line">&quot;<span class="selector-tag">zhang</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">HMGET</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1000</span> <span class="selector-tag">username</span> <span class="selector-tag">age</span> <span class="selector-tag">job</span> </span><br><span class="line">1) &quot;<span class="selector-tag">zhang</span>&quot;</span><br><span class="line">2) &quot;27&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">it</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>HGETALL 获取hash中的域和值，间隔出现</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">HGETALL</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1000</span>   </span><br><span class="line">1) &quot;<span class="selector-tag">username</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">zhang</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">age</span>&quot;</span><br><span class="line">4) &quot;27&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">job</span>&quot;</span><br><span class="line">6) &quot;<span class="selector-tag">it</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>HVALS查看key下的所有值</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">hvals</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1000</span></span><br><span class="line">1) &quot;<span class="selector-tag">zhange</span>&quot;</span><br><span class="line">2) &quot;28&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">IT</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>HINCRBY 将hash域的整数值增加给定数字</li>
<li>HINCRBYFLOAT 将hash域的整数值增加给定浮点数</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user-liu</span> <span class="selector-tag">age</span> 20</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">hincrby</span> <span class="selector-tag">user-liu</span> <span class="selector-tag">age</span> 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 21</span><br><span class="line">&gt; <span class="selector-tag">hget</span> <span class="selector-tag">user-liu</span> <span class="selector-tag">age</span></span><br><span class="line">&quot;21&quot;</span><br><span class="line">&gt; <span class="selector-tag">hincrbyfloat</span> <span class="selector-tag">user-list</span> <span class="selector-tag">age</span> 0.5</span><br><span class="line">&quot;21.5&quot;</span><br><span class="line">&gt; <span class="selector-tag">hincrbyfloat</span> <span class="selector-tag">user-list</span> <span class="selector-tag">age</span> <span class="selector-tag">-1</span>.5</span><br><span class="line">&quot;20&quot;</span><br></pre></td></tr></table></figure>
<p><strong>HLEN与HSTRLEN命令</strong></p>
<ul>
<li>HLEN查看字段数</li>
<li>HSTRLEN查看字段值中的字符数</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1</span> <span class="selector-tag">username</span> <span class="selector-tag">liu</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1 </span><br><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span><span class="selector-pseudo">:2</span> <span class="selector-tag">username</span> <span class="selector-tag">wang</span> <span class="selector-tag">age</span> 18</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">hlen</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">hlen</span> <span class="selector-tag">user</span><span class="selector-pseudo">:2</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">hstrlen</span> <span class="selector-tag">user</span><span class="selector-pseudo">:1</span> <span class="selector-tag">username</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">hstrlen</span> <span class="selector-tag">user</span><span class="selector-pseudo">:2</span> <span class="selector-tag">username</span> </span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">hstrlen</span> <span class="selector-tag">user</span><span class="selector-pseudo">:2</span> <span class="selector-tag">age</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br></pre></td></tr></table></figure>
<h4 id="hash-应用场景"><a href="#hash-应用场景" class="headerlink" title="hash-应用场景"></a>hash-应用场景</h4><p>redis是内存的数据库，所有键值的操作速度都非常快，而hash是单元数的，但不能做复杂的文档（但hash恰恰是键值对的，所以说的上是文档类型的数据），只能做一些简单的</p>
<p>场景：点赞、关注、收藏、详情页，总之面向个人和事务的一些小操作都可以使用HASH</p>
<h4 id="小结hash命令"><a href="#小结hash命令" class="headerlink" title="小结hash命令"></a>小结hash命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>参数</th>
</tr>
</thead>
<tbody><tr>
<td>HSET</td>
<td>设置hash域的字符串值</td>
</tr>
<tr>
<td>HMSET</td>
<td>将多个hash域设置为多个值</td>
</tr>
<tr>
<td>HGET</td>
<td>获取hash域的值</td>
</tr>
<tr>
<td>HMGET</td>
<td>获取所有给定hash域的值</td>
</tr>
<tr>
<td>HGETALL</td>
<td>获取hash中的域和值</td>
</tr>
<tr>
<td>HVALS</td>
<td>获取hash域中所有值</td>
</tr>
<tr>
<td>HINCRBY</td>
<td>将hash域整数增加</td>
</tr>
<tr>
<td>HINCRBYFLOAT</td>
<td>将hash域浮点数增加</td>
</tr>
<tr>
<td>HLEN</td>
<td>获取hash中的域数</td>
</tr>
<tr>
<td>HVALS</td>
<td>获取hash中的所有值</td>
</tr>
<tr>
<td>HDEL</td>
<td>删除一个或多个hash域</td>
</tr>
<tr>
<td>HEXISTS</td>
<td>判断hash域是否存在</td>
</tr>
<tr>
<td>HKEYS</td>
<td>获取所有hash域</td>
</tr>
<tr>
<td>HSCAN</td>
<td>递增迭代hash域和关联值</td>
</tr>
<tr>
<td>HSEINX</td>
<td>设置hash域的值，仅当字段不存在的时候</td>
</tr>
<tr>
<td>HSTRLEN</td>
<td>获取hash域值的长度</td>
</tr>
</tbody></table>
<h3 id="set（集合）"><a href="#set（集合）" class="headerlink" title="set（集合）"></a>set（集合）</h3><p>set是字符串的无序列表，是唯一的，它的内部实现相当于一个特殊的字典，字典中所有的value都是一个值NULL。当set最后一个元素被移除之后，数据结构被自动删除，内存被回收</p>
<p>SET结构可以用来存储在某活动中中奖的用户ID，因为有去重功能，可以保证同一个用户不会中奖两次</p>
<ul>
<li>优点：无序（乱序）、去重</li>
</ul>
<p><strong>SET下的分类</strong></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320225104821.png"></p>
<h4 id="set-设置成员"><a href="#set-设置成员" class="headerlink" title="set-设置成员"></a>set-设置成员</h4><p><strong>SADD、SREM、SMEMBERS命令</strong></p>
<ul>
<li>SADD 添加元素，可以看到插入的顺序是乱的，不会进行排序</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k1</span> <span class="selector-tag">aa</span> <span class="selector-tag">bb</span> <span class="selector-tag">dd</span> <span class="selector-tag">cc</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">k1</span></span><br><span class="line">1) &quot;<span class="selector-tag">aa</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">cc</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">dd</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">bb</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>SREM 用来删除一个或多个指定的值</li>
<li>SMEMBERS 查看key中的成员</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">srem</span> <span class="selector-tag">k1</span> <span class="selector-tag">dd</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">k1</span></span><br><span class="line">1) &quot;<span class="selector-tag">aa</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">cc</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">bb</span>&quot;</span><br></pre></td></tr></table></figure>
<h4 id="set-集合操作"><a href="#set-集合操作" class="headerlink" title="set-集合操作"></a>set-集合操作</h4><p><strong>SDIFF、SINTER、SUNION、SDIFFSTORE、SINTERSTORE、SUNIONSTORE命令</strong></p>
<ul>
<li>SDIFF 计算集合的差异，SDIFFSTORE计算差集结果进行存储</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k1</span> 1 3 4 5 6</span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k2</span> 2 3 4 7 6</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">SDIFF</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span>      //去求差集</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">SDIFFSTORE</span> <span class="selector-tag">dest</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span>   //存储差集</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">dest</span>                         //查看<span class="selector-tag">dest</span></span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;5&quot;</span><br></pre></td></tr></table></figure>
<p>SINTER 求出成员的并集，SINTERSTORE计算并集结果进行存储</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SINTER</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span></span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">&gt; <span class="selector-tag">SINTERSTORE</span> <span class="selector-tag">dest</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">dest</span></span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;6&quot;</span><br></pre></td></tr></table></figure>
<p>SUNION 求出成员的合集，SUNIONSTROE计算合集结果进行存储</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SUNION</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span></span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;5&quot;</span><br><span class="line">6) &quot;6&quot;</span><br><span class="line">7) &quot;7&quot;</span><br><span class="line">&gt; <span class="selector-tag">SUNIONSTORE</span> <span class="selector-tag">dest</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span></span><br><span class="line">(<span class="selector-tag">integer</span>)7</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">dest</span></span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;5&quot;</span><br><span class="line">6) &quot;6&quot;</span><br><span class="line">7) &quot;7&quot;</span><br></pre></td></tr></table></figure>
<h4 id="set-随机事件"><a href="#set-随机事件" class="headerlink" title="set-随机事件"></a>set-随机事件</h4><p><strong>SRANDMEMBER命令</strong></p>
<p>SRANDMEMBER 取key值的范围值，而且每次获去都是不一样的</p>
<ul>
<li>正数：取出去重的结果集（不能超过已有集）</li>
<li>负数：取出有重复的结果集</li>
<li>0：则不返回</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k1</span> <span class="selector-tag">wu</span> <span class="selector-tag">liu</span> <span class="selector-tag">wang</span> <span class="selector-tag">chen</span> <span class="selector-tag">li</span> <span class="selector-tag">fan</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 6</span><br><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> 3</span><br><span class="line">1) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> 3</span><br><span class="line">1) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> 3</span><br><span class="line">1) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">fan</span>&quot;</span><br></pre></td></tr></table></figure>
<p>如果count数值是负数，那么就会出现重复的人名</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> <span class="selector-tag">-3</span></span><br><span class="line">1) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> <span class="selector-tag">-3</span></span><br><span class="line">1) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wu</span>&quot;</span><br></pre></td></tr></table></figure>
<p>SRANDMEMBER 还可以用来抽奖，因为正数是不能重复的，而负数是可以重复，所以可以有以下两个抽奖模式</p>
<ul>
<li>可以用于人多礼物少的时候（当然这只能是一次性的，因为在使用命令还会出现同样的名字）</li>
<li>可以用于人少礼物多的时候，每人可以领多件礼物</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> 3         //获取的前三名</span><br><span class="line">1) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SRANDMEMBER</span> <span class="selector-tag">k1</span> <span class="selector-tag">-10</span>    </span><br><span class="line"> 1) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line"> 2) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line"> 3) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line"> 4) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line"> 5) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line"> 6) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line"> 7) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line"> 8) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line"> 9) &quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">10) &quot;<span class="selector-tag">fan</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>SPOP命令</strong></p>
<p>SPOP命令可以解决抽中奖的人不会再出现，就是取出抽中奖品的人，这样在使用命令就不会有重复的名字了</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">chen</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">&quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">SPOP</span> <span class="selector-tag">k1</span> </span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<h4 id="set-其他命令使用"><a href="#set-其他命令使用" class="headerlink" title="set-其他命令使用"></a>set-其他命令使用</h4><p><strong>SCARD、SISMEMBER、SMOVE、SREM命令</strong></p>
<ul>
<li>SCARD 可以获取成员的数值</li>
<li>SISMEMBER 可以确认该set有没有该值，1表示存在，0表示不存在</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k1</span> 1 2 3 4 </span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">scard</span> <span class="selector-tag">k1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">SISMEMBER</span> <span class="selector-tag">k1</span> 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">SISMEMBER</span> <span class="selector-tag">k1</span> 5</span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<ul>
<li>SMOVE 移除成员到另一个set</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k2</span> 5 6 7 8</span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">SMOVE</span> <span class="selector-tag">k1</span> <span class="selector-tag">k2</span> 3</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">smembers</span> <span class="selector-tag">k2</span></span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) &quot;5&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">4) &quot;7&quot;</span><br><span class="line">5) &quot;8&quot;</span><br></pre></td></tr></table></figure>
<h4 id="小结SET命令"><a href="#小结SET命令" class="headerlink" title="小结SET命令"></a>小结SET命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SADD</td>
<td>添加一个或多个成员添加到set</td>
</tr>
<tr>
<td>SCARD</td>
<td>获取set中成员的数</td>
</tr>
<tr>
<td>SDIFF</td>
<td>求出多个set的差集</td>
</tr>
<tr>
<td>SDIFFSTORE</td>
<td>将求出的set差集进行存储</td>
</tr>
<tr>
<td>SINTER</td>
<td>求出多个set的并集</td>
</tr>
<tr>
<td>SINTERSTORE</td>
<td>将求出的set并集进行存储</td>
</tr>
<tr>
<td>SUNION</td>
<td>求出多个set的合集</td>
</tr>
<tr>
<td>SUNIONSTORE</td>
<td>将求出的set合集进行存储</td>
</tr>
<tr>
<td>SISMEMBER</td>
<td>确定给定值是否是set的成员</td>
</tr>
<tr>
<td>SMEMBERS</td>
<td>获取set中所有的成员</td>
</tr>
<tr>
<td>SMOVE</td>
<td>从set中移动成员到另一个set</td>
</tr>
<tr>
<td>SPOP</td>
<td>从set中删除并返回一个或多个随机成员</td>
</tr>
<tr>
<td>SRANDMEMBER</td>
<td>从set中获取一个或多个随机成员</td>
</tr>
<tr>
<td>SREM</td>
<td>从set中移除一个或多个成员</td>
</tr>
<tr>
<td>SSCAN</td>
<td>递增迭代set元素</td>
</tr>
</tbody></table>
<h3 id="sorted-set（有序集合）"><a href="#sorted-set（有序集合）" class="headerlink" title="sorted set（有序集合）"></a>sorted set（有序集合）</h3><p>Redis 有序集合和集合一样也是 string 类型元素的集合，且不允许重复的成员。</p>
<ul>
<li>sorted set也称为zset，因为命令是由z开头，s开头已经被set集合占用了，zset不同的是每个元素都会关联一个double（双重）类型的分数。redis 正是通过分数来为集合中的成员进行从小到大的排序。</li>
</ul>
<ul>
<li>有序集合的成员是唯一的，但分数(score)却可以重复。</li>
</ul>
<ul>
<li>zset是Redis提供的最有特色的数据结构，一方面它是一个set，保证了内部value的唯一性，另一方面它可以给每个value赋予一个score(分数)，代表这个value的排序权重。它的内部实现用的是一种叫做“跳跃列表”的数据结构</li>
</ul>
<ul>
<li>zset中最后一个value被移除后，数据结构被自动删除，内存被回收</li>
</ul>
<ul>
<li>zset可以用来存储粉丝列表，value值是粉丝的用户ID，score是关注事件。可以对粉丝列表按关注时间进行排序</li>
</ul>
<ul>
<li>zset还可以用来存储学生的成绩，value值是学生的ID，score是他的考试成绩，可以对成绩按分数进行排序就可以得到他的名次</li>
</ul>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320225356762.png"></p>
<p><strong>sorted set下的分类</strong></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320230936247.png"></p>
<h4 id="zset-设置成员"><a href="#zset-设置成员" class="headerlink" title="zset-设置成员"></a>zset-设置成员</h4><p><strong>ZADD、ZRANGE、ZRANGEBYSCORE命令</strong></p>
<ul>
<li><p>zadd 添加一个或多个成员到sorted set，或更新其分数（如果已经存在）</p>
</li>
<li><p>zrange 按索引返回sorted set中成员范围</p>
</li>
<li><p>zrangebyscore 按分值返回sorted set中成员范围</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">k1</span> 80 <span class="selector-tag">wu</span> 70 <span class="selector-tag">liu</span> 90 <span class="selector-tag">wang</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">zrange</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-1</span>                 //只显示所有的值，不显示分数</span><br><span class="line">1) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">zrange</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">withscores</span>      //加上<span class="selector-tag">withscores</span>，就同时都显示</span><br><span class="line">1) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">2) &quot;70&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">4) &quot;80&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">6) &quot;90&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zrangebyscore</span> <span class="selector-tag">k1</span> 70 80</span><br><span class="line">1) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">zrangebyscore</span> <span class="selector-tag">k1</span> 70 90</span><br><span class="line">1) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ZREVRANGE、ZREMRANGEBYSCORE命令</strong></p>
<ul>
<li><p>zrevrange 按索引返回sorted set中一组成员，其得分从高到低排序（反向）</p>
</li>
<li><p>zrevrangebyscore 按分数返回sorted set中一组成员，其得分从高到低排序（反向）</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zrevrange</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">zrevrangebyscore</span> <span class="selector-tag">k1</span> 90 70</span><br><span class="line">1) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">liu</span>&quot;</span><br></pre></td></tr></table></figure>
<p><strong>ZSCORE、ZCARD、ZCOUNT</strong></p>
<ul>
<li>zscore 是通过成员获取分数</li>
<li>zcard 是获取成员的数量</li>
<li>zcout 通过分数范围统计有多少成员</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zscore</span> <span class="selector-tag">k1</span> <span class="selector-tag">wu</span></span><br><span class="line">&quot;80&quot;</span><br><span class="line">&gt; <span class="selector-tag">zscore</span> <span class="selector-tag">k1</span> <span class="selector-tag">liu</span></span><br><span class="line">&quot;70&quot;</span><br><span class="line">&gt; <span class="selector-tag">zcard</span> <span class="selector-tag">k1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">zcount</span> <span class="selector-tag">k1</span> 70 90</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">zcount</span> <span class="selector-tag">k1</span> 70 80</span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br></pre></td></tr></table></figure>
<h4 id="zset-集合操作"><a href="#zset-集合操作" class="headerlink" title="zset-集合操作"></a>zset-集合操作</h4><p><strong>ZINTERSTORE、ZUNIONSTORE命令</strong></p>
<ul>
<li><p>ZINTERSTORE计算给定的numkeys有序集合的交集，并且把结果放到destination中，要与多个计算时，必须先给定key个数(numberkeys)，也就是用多少个key进行交集</p>
</li>
<li><p>ZUNIONSTORE计算给定numkeys有限集合的并集</p>
</li>
</ul>
<p>创建language和english两个集合，求ZINTERSTORE的交集</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">language</span> 90 <span class="selector-tag">wu</span> 70 <span class="selector-tag">li</span> 80 <span class="selector-tag">wang</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">english</span> 80 <span class="selector-tag">wu</span> 80 <span class="selector-tag">li</span> 90 <span class="selector-tag">wang</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">ZINTERSTORE</span> <span class="selector-tag">dest</span> 2 <span class="selector-tag">language</span> <span class="selector-tag">english</span> <span class="selector-tag">weights</span> 1 2      //权重会增加分数的值，2表示2*分数值</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">dest</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">withscores</span>        </span><br><span class="line">1) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">2) &quot;230&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">4) &quot;250&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">6) &quot;260&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">ZINTERSTORE</span> <span class="selector-tag">dest2</span> 2 <span class="selector-tag">language</span> <span class="selector-tag">english</span> <span class="selector-tag">aggregate</span> <span class="selector-tag">sum</span>   //还可以求交集的总数</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">dest2</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">withscores</span></span><br><span class="line">1) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">2) &quot;150&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">4) &quot;170&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">6) &quot;170&quot;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">ZINTERSTORE</span> <span class="selector-tag">dest3</span> 2 <span class="selector-tag">language</span> <span class="selector-tag">english</span> <span class="selector-tag">aggregate</span> <span class="selector-tag">min</span>  //求交集中最小的数</span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">10.0.0.50<span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">dest3</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">withscores</span></span><br><span class="line">1) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">2) &quot;70&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">4) &quot;80&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line">6) &quot;80&quot;</span><br></pre></td></tr></table></figure>
<p>创建language和english两个集合，求ZUNIONSTORE的并集</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">k2</span> 70 <span class="selector-tag">liu</span> 80 <span class="selector-tag">wang</span> 50 <span class="selector-tag">li</span> 70 <span class="selector-tag">ke</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">k1</span> 70 <span class="selector-tag">liu</span> 80 <span class="selector-tag">wang</span> 50 <span class="selector-tag">li</span> 70 <span class="selector-tag">wu</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">ZUNIONSTORE</span> <span class="selector-tag">new_key</span> 2 <span class="selector-tag">k1</span> <span class="selector-tag">k2</span> <span class="selector-tag">weights</span> 1 1</span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">&gt; <span class="selector-tag">zrange</span> <span class="selector-tag">new_key</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">withscores</span></span><br><span class="line"> 1) &quot;<span class="selector-tag">ke</span>&quot;</span><br><span class="line"> 2) &quot;70&quot;</span><br><span class="line"> 3) &quot;<span class="selector-tag">wu</span>&quot;</span><br><span class="line"> 4) &quot;70&quot;</span><br><span class="line"> 5) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line"> 6) &quot;100&quot;</span><br><span class="line"> 7) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line"> 8) &quot;140&quot;</span><br><span class="line"> 9) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">10) &quot;160&quot;</span><br></pre></td></tr></table></figure>
<h4 id="zset-其他命令使用"><a href="#zset-其他命令使用" class="headerlink" title="zset-其他命令使用"></a>zset-其他命令使用</h4><p><strong>ZLECOUNT、ZRANGEBYLEX、ZREVRANGEBYLEX、ZREMRANGEBYLEX命令</strong></p>
<ul>
<li>ZLEXCOUNT命令用于计算sorted set中指定成员之间的成员数量，由”-“表示得分最小的成员，”+”表示得分最大值的成员</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">k1</span> 70 <span class="selector-tag">liu</span> 80 <span class="selector-tag">wang</span> 60 <span class="selector-tag">li</span> 100 <span class="selector-tag">fan</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">zlexcount</span> <span class="selector-tag">k1</span> <span class="selector-tag">-</span> +</span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line"> <span class="selector-tag">zrange</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">1) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">fan</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ZRANGEBYLEX 返回指定成员区间内的成员，按成员字典正序排序</p>
</li>
<li><p>ZREVRANGEBYLEX 是反向获取成员区间内的成员，反序排序</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zadd</span> <span class="selector-tag">k1</span> 70 <span class="selector-tag">liu</span> 80 <span class="selector-tag">wang</span> 60 <span class="selector-tag">li</span> 100 <span class="selector-tag">fan</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">ZRANGEBYLEX</span> <span class="selector-tag">k1</span> <span class="selector-tag">-</span> +   //分数大的在最先，正序</span><br><span class="line">1) &quot;<span class="selector-tag">li</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">ZREVRANGEBYLEX</span> <span class="selector-tag">k1</span> + <span class="selector-tag">-</span></span><br><span class="line">1) &quot;<span class="selector-tag">fan</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">wang</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">liu</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">li</span>&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>ZREMRANGEBYLEX是删除成员之间的数量</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">ZREMRANGEBYLEX</span> <span class="selector-tag">k1</span> <span class="selector-tag">-</span> +</span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">zrange</span> <span class="selector-tag">k1</span> 0 <span class="selector-tag">-1</span></span><br><span class="line">(<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br></pre></td></tr></table></figure>
<h4 id="zset-skip-list（跳跃列表）"><a href="#zset-skip-list（跳跃列表）" class="headerlink" title="zset-skip list（跳跃列表）"></a>zset-skip list（跳跃列表）</h4><p>作用：间接跳层，牺牲系统存储空间，换未来的查询速度</p>
<p>zset内部的排序功能是通过“跳跃列表”的数据结构来实现的，因为zset要支持随机的插入和删除，所以它不宜使用数组来表示，看看普通的链表数据结构</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320231318575.png"></p>
<p>链表是按照score值进行排序，当有新元素需要插入时，要定位到特定位置的插入点，来保证链表是有序的，通常会通过二分查找来找到插入点，但是二分查找的对象必须是数组，只有数组才可以支持快速位置定位，但是链表做不到，如果让链表做到快速插入和查询呢，可以看下述这张图</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210320233437814.png"></p>
<p>跳跃列表类似于层级结构，最下面的层所有的元素都会串起来，然后每隔几个元素挑选一个代表，接着再将这几个代表用指针连接起来，接着继续挑选上层代表，最终形成一个倒立的树（跳跃列表采取一个随机策略来决定新元素可以下沉到几层）</p>
<p>当有数据插入列表时，在定位插入点时，会现在顶层定位，然后到下一层定位，一直到最底层找到合适的为止，将新元素插入进列表</p>
<p>位于L0层的概率是100%，而兼到 L1层只有 50% 的概率，到L2层只有 25% 的概率，到 L3 层只有 12.5% 的概率，以此类推， 一直随机到最顶层 L20层 。绝大多数元素都过不了几层，只有极少数元素可以深入到顶层。列表中的元素越多，能够深入的层次就越深，元素能进入到顶层的可能性就会越大。  </p>
<h4 id="小结zset命令"><a href="#小结zset命令" class="headerlink" title="小结zset命令"></a>小结zset命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>ZADD</td>
<td>将一个或多个成添加到sorted set，或更新其分数（如果已存在时）</td>
</tr>
<tr>
<td>ZCARD</td>
<td>获取sorted set中的成员数</td>
</tr>
<tr>
<td>ZCOUNT</td>
<td>用给定值内的分数对sorted set中的成员进行计数</td>
</tr>
<tr>
<td>ZINCRBY</td>
<td>增加sorted set中成员的分数</td>
</tr>
<tr>
<td>ZINTERSTORE</td>
<td>相交多个sorted set并将结果排序后的集存储在新的key中（并集）</td>
</tr>
<tr>
<td>ZLEXCOUNT</td>
<td>计算给定范围之间的sorted set中的成员数</td>
</tr>
<tr>
<td>ZPOPMAX</td>
<td>删除并返回sorted set中得分最高的成员</td>
</tr>
<tr>
<td>ZPOPMIN</td>
<td>删除并返回sorted set中得分最低的成员</td>
</tr>
<tr>
<td>ZRANGE</td>
<td>按索引返回sorted set中的成员范围</td>
</tr>
<tr>
<td>ZRANGEBYLEX</td>
<td>返回按字典顺序排序的一组排序范围内的成员</td>
</tr>
<tr>
<td>ZRANGEBYSCORE</td>
<td>按分值返回sorted set中成员范围</td>
</tr>
<tr>
<td>ZRANK</td>
<td>确定sorted set中成员的索引</td>
</tr>
<tr>
<td>ZREM</td>
<td>从sorted set移除一个或多个程艳</td>
</tr>
<tr>
<td>ZREMRANGEBYLEX</td>
<td>删除给定词典范围之间的sorted set中的所有成员</td>
</tr>
<tr>
<td>ZREMRANGEBYSCORE</td>
<td>在给定的分数内删除sorted set中的所有成员</td>
</tr>
<tr>
<td>ZREMRANGEBYRANK</td>
<td>在给定的索引内删除sorted set中的所以成员</td>
</tr>
<tr>
<td>ZREVRANGE</td>
<td>按索引返回sorted set中一组成员，其得分从高到低排序（反向）</td>
</tr>
<tr>
<td>ZREVRANGEBYLEX</td>
<td>返回按字典顺序排序的一组排序范围内的成员范围，排序高到低（反向）</td>
</tr>
<tr>
<td>ZREVRANGEBYSCORE</td>
<td>按分数返回sorted set中一组成员，其得分从高到低排序（反向）</td>
</tr>
<tr>
<td>ZREVRANK</td>
<td>确定sorted set中成员的索引，其得分从高到低排序（反向）</td>
</tr>
<tr>
<td>ZSCAN</td>
<td>递增迭代sorted sets元素和关联分数</td>
</tr>
<tr>
<td>ZSCORE</td>
<td>获取sorted set中与给定成员关联的分数</td>
</tr>
<tr>
<td>ZUNIONSTORE</td>
<td>添加多个sorted set并将结果sorted set存储在新key中（合集）</td>
</tr>
<tr>
<td>BZPOPMAX</td>
<td>从一个或多个sorted sets中删除得分最高的成员，或者将其阻塞，直到有一个可用的为止</td>
</tr>
<tr>
<td>BZPOPMIN</td>
<td>从一个或多个sorted sets中删除得分最低的成员，或者将其阻塞，直到有一个可用的为止</td>
</tr>
</tbody></table>
<h2 id="HyperLogLog（计数）"><a href="#HyperLogLog（计数）" class="headerlink" title="HyperLogLog（计数）"></a>HyperLogLog（计数）</h2><p>HyperLogLog是Redis的高级数据结构，HyperLogLog用来解决一些统计的问题、它提供不精确的去重计数方案，虽然不精确，但也不是非常不准，标准误差是0.81%</p>
<p>这种精确度可以满足一些统计的需求了。比如统计UV，UV不像PV一样，PV只需要redis的计数器，在这个计数器的key后缀加上当天的时间，执行incrby指令一次就加1就可以了。</p>
<p>但UV需要的是去重，同一天之内的用户多次访问请求只能计数一次。这就要求每个一个网页都需要带上用户的ID，无论是登录用户还是未登录用户都需要一个ID来标识</p>
<p>你可以使用每个页面设置一个独立的set集合来存储所有当天访问过此页面的用户ID。但给一个请求过来时，使用sadd将用户ID丢进去。然后在通过scard可以去除这个集合的大小，这个数据就是这个页面的UV数据。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">sadd</span> 0101 <span class="selector-tag">abc</span> <span class="selector-tag">abd</span> <span class="selector-tag">add</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">sadd</span> 0101 <span class="selector-tag">ade</span> <span class="selector-tag">abb</span> <span class="selector-tag">aee</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">scard</span> 0101</span><br><span class="line">(<span class="selector-tag">integer</span>) 6</span><br></pre></td></tr></table></figure>
<p>但如果访问的页面需求量越来越大，比如一个热点页面可能有几千万个UV，你就需要使用很大的set集合来统计，非常浪费空间。热点的页面越多，那么你耗费的存储空间就越多。现在为了一个去重功能耗费多的存储空间是不值得的，所以redis提供的HyperLogLog数据结构就是用来解决这种统计问题的</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>HyperLogLog提供两个指令pfadd和pfcount，一个是增加计数，一个是获取计数，pfadd跟set集合中的sdd指令用法是一样的，来一个用户ID，就将用户ID丢进去，pfcount跟scard用法也是一样，直接获取数值</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">pfadd</span> <span class="selector-tag">us</span> <span class="selector-tag">user1</span> <span class="selector-tag">user2</span> </span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">pfcount</span> <span class="selector-tag">us</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br><span class="line">&gt; <span class="selector-tag">pfadd</span> <span class="selector-tag">us</span> <span class="selector-tag">user3</span> <span class="selector-tag">user4</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">pfcount</span> <span class="selector-tag">us</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br></pre></td></tr></table></figure>
<p>HyperLogLog除了提供上面的pfadd和pfcount之外，还提供了第三个指令pfmerge，用于将多个pf计数值累加在一起形成一个新的pf值，如下述操作</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">pfadd</span> <span class="selector-tag">us</span> <span class="selector-tag">user1</span> <span class="selector-tag">user2</span> <span class="selector-tag">user3</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">pfadd</span> <span class="selector-tag">ua</span> <span class="selector-tag">user1</span> <span class="selector-tag">user3</span> <span class="selector-tag">user4</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">pfmerge</span> <span class="selector-tag">dest</span> <span class="selector-tag">us</span> <span class="selector-tag">ua</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">pfcount</span> <span class="selector-tag">dest</span>     //合并</span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br></pre></td></tr></table></figure>
<h3 id="HyperLogLog其他事项"><a href="#HyperLogLog其他事项" class="headerlink" title="HyperLogLog其他事项"></a>HyperLogLog其他事项</h3><p>HyperLogLog数据结构的存储结构不是免费，不是要花钱，而是它需要占据12KB的大小存储空间。所以不适合单个用户相关的数据。如果用户是上亿个，那对比set存储方案，HyperLogLog所使用的的空间就不算什么了</p>
<p>对于HyperLogLog的存储，redis也进行了优化。在数值比较小的时，它的存储空间采用稀疏矩阵存储，空间占用很小，仅仅在计数慢慢变大，稀疏矩阵占用空间渐渐超过了阈值时，才会一次性转变稠密矩阵，才会占用12KB的空间</p>
<h2 id="GeoHash（地理）"><a href="#GeoHash（地理）" class="headerlink" title="GeoHash（地理）"></a>GeoHash（地理）</h2><p>Redis在3.2版本后增加的地理位置Geo模块，它可以实现现类似于摩拜单车、美团、饿了么，寻找附近的单车或美食的功能</p>
<h3 id="GeoHash算法"><a href="#GeoHash算法" class="headerlink" title="GeoHash算法"></a>GeoHash算法</h3><p>GeoHash算法将二维的经纬度数据映射到一维的整数，使得所有的元素都将挂载到一条线上</p>
<blockquote>
<p>地图元素的位置数据使用二维的经纬度表示，经度[-180, 180]，纬度范围[-90, 90]，经度正负以本初子午线（英国格林尼治天文台）为界，东正西负；维度正负以赤道为界，北正南负。</p>
</blockquote>
<p>距离靠近的二维坐标映射到一维后的点之间距离就会拉近。当需要计算“附近的人”时，首先将目标位置映射到这条线上，然后在这个一维的线上获取附近的点就可以</p>
<p>GeoHash的映射算法，是将整个地球看成一个二维平面，接着划分了一系列正方形的方格，类似于围棋棋盘的格子。所有的地图元素坐标都将被放置到唯一的方格中，方格越小，就越精确。如下图</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210421155745171.png"></p>
<p>然后对这些方格进行整数编码，越是靠近的方格编码越是接近。这些小正方形会平均分为四块，小正方形可以分别标记为00、01、03、04共四个二进制整数。然后对每一个小正方形继续使用二刀法切割。这时每个小小正方形就可以使用4bit的二进制整数表示。后续还会继续切，正方形会越来越小，二进制整数也会越来越长，精准度就会越来越高（在真实算法中，除了二刀法，还有其他刀法，最终编码出来的整数数字也都不一样）</p>
<p>编码后，每个地图元素的坐标都将变成一个整数，通过这个整数可以还原出元素的坐标。整数越长，还原出来的坐标值的损失程度越小。对于“附近的人”这种功能，一点损失是忽略不计的</p>
<p>GeoHash算法会继续对这个整数做一次base32编码（0 ~ 9，a ~ z，去掉a、i、l、o四个字母）变成一个字符串。在redis里面，经纬度使用52位的整数进行编码，放入zset里面，zset的value是元素的key，score是GeoHash的52位整数值，zset的score虽然是浮点数，但是对52位的整数值，它可以无损存储</p>
<p>在Redis进行Geo查询，可以想到它的内部结构实际上只是一个zset(skiplist)，通过zset的score排序就可以得到坐标附近的其他元素，通过将score还原成坐标值就可以得到元素的原始坐标</p>
<h3 id="Geo指令的基本用法"><a href="#Geo指令的基本用法" class="headerlink" title="Geo指令的基本用法"></a>Geo指令的基本用法</h3><p>Geo有6个指令，它只是一个普通的zset结构，我们设置一下掘进、京东、美团和小米地理位置看看，如下例子</p>
<p><strong>增加掘进、美团、小米的地理位置</strong></p>
<p>geoadd指令携带集合名称以及多个经纬度名称三元组，注意这里可以加入多个三元组</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">geoadd</span> <span class="selector-tag">company</span> 116.48105 39.996794 <span class="selector-tag">juejin</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">geoadd</span> <span class="selector-tag">company</span> 116.489033 40.007669 <span class="selector-tag">meituan</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">geoadd</span> <span class="selector-tag">company</span> 116.562108 39.787602 <span class="selector-tag">jd</span> 116.334255 40.027400 <span class="selector-tag">xiaomi</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p>Redis没有提供Geo元素删除指令，但Geo存储结构上使用的是zset，所以可以使用zset的相关指令来操作Geo数据，使用zrem指令就可以删除</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">zrem</span> <span class="selector-tag">company</span> <span class="selector-tag">jn</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">zrem</span> <span class="selector-tag">company</span> <span class="selector-tag">jy</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p><strong>计算每个地理位置距离</strong></p>
<p>gepdist指令可以用来计算两个元素之间的距离，携带集合名称、两个名称和距离单位。距离单位可以是m、km、ml和ft，分别代表米、千米、英里和尺。<code>默认情况为米</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">geodist</span> <span class="selector-tag">company</span> <span class="selector-tag">jd</span> <span class="selector-tag">xiaomi</span></span><br><span class="line">&quot;33004.6915&quot;</span><br><span class="line">&gt; <span class="selector-tag">geodist</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span> <span class="selector-tag">meituan</span></span><br><span class="line">&quot;13365.8814&quot;</span><br><span class="line">&gt; <span class="selector-tag">geodist</span> <span class="selector-tag">company</span> <span class="selector-tag">meituan</span> <span class="selector-tag">juejin</span></span><br><span class="line">&quot;1387.8166&quot;</span><br></pre></td></tr></table></figure>
<p><strong>获取元素地理位置</strong></p>
<p>geopos指令可以获取集合中任意元素的经纬度坐标，可以一次获取多个</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">geopos</span> <span class="selector-tag">company</span> <span class="selector-tag">jd</span></span><br><span class="line">1) 1) &quot;116.56210631132125854&quot;</span><br><span class="line">   2) &quot;39.78760295130235392&quot;</span><br><span class="line">&gt; <span class="selector-tag">geopos</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span> <span class="selector-tag">meituan</span> <span class="selector-tag">juejin</span></span><br><span class="line">1) 1) &quot;116.33425265550613403&quot;</span><br><span class="line">   2) &quot;40.02740024658161389&quot;</span><br><span class="line">2) 1) &quot;116.48903220891952515&quot;</span><br><span class="line">   2) &quot;40.00766997707732031&quot;</span><br><span class="line">3) 1) &quot;116.48104995489120483&quot;</span><br><span class="line">   2) &quot;39.99679348858259686&quot;</span><br></pre></td></tr></table></figure>
<p>可以看到，我们使用geoadd添加的坐标与geopos查看的坐标还是有一些误差的。原因是GeoHash对二维坐标进行的一维映射是有损的，通过映射还原回来的值会出现较小的差别，但对于使用”附近的人”这种功能还是可以接受的</p>
<p><strong>获取元素的hash值</strong></p>
<p>GeoHash获取元素的经纬度编码字符串，你可以使用这个编码值去：<a target="_blank" rel="noopener" href="http://geohash.org/$%7Bhash%7D%E4%B8%8A%E8%BF%9B%E8%A1%8C%E7%9B%B4%E6%8E%A5%E5%AE%9A%E4%BD%8D%EF%BC%8C%E5%AE%83%E6%98%AF">http://geohash.org/${hash}上进行直接定位，它是</a> GeoHash的标准编码值 </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">geohash</span> <span class="selector-tag">company</span> <span class="selector-tag">meituan</span></span><br><span class="line">1) &quot;<span class="selector-tag">wx4gdg0tx40</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">geohash</span> <span class="selector-tag">company</span> <span class="selector-tag">jd</span></span><br><span class="line">1) &quot;<span class="selector-tag">wx4fk7jgtf0</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">geohash</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span></span><br><span class="line">1) &quot;<span class="selector-tag">wx4exqb0880</span>&quot;</span><br></pre></td></tr></table></figure>
<p> 通过上述网址查询看看，我们查看一下小米的地理位置，然后再右键选择新窗口打开<code>Google地图</code>来查看位置是否正确（多少会有些偏差）</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210421175019693.png"></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210421175141342.png"></p>
<p><strong>对比附近的公司</strong></p>
<p>georadiusbymember指令是最为关键的指令之一，它可以用来查询指定元素附近的其他元素，它的参数非常复杂</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//范围20公里以内最多3个元素按距离正派，它不会排除自身</span><br><span class="line">&gt; <span class="selector-tag">georadiusbymember</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span> 20 <span class="selector-tag">km</span> <span class="selector-tag">count</span> 3 <span class="selector-tag">asc</span></span><br><span class="line">1) &quot;<span class="selector-tag">xiaomi</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">juejin</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">meituan</span>&quot;   </span><br><span class="line"></span><br><span class="line">//范围20公里以内最多3个元素按距离倒序</span><br><span class="line">&gt; <span class="selector-tag">georadiusbymember</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span> 20 <span class="selector-tag">km</span> <span class="selector-tag">count</span> 3 <span class="selector-tag">desc</span></span><br><span class="line">1) &quot;<span class="selector-tag">meituan</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">juejin</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">xiaomi</span>&quot;</span><br><span class="line"></span><br><span class="line">//三个可选参数：<span class="selector-tag">withcoord</span>、<span class="selector-tag">withdist</span>、<span class="selector-tag">withhash</span> 用来携带附加参数，<span class="selector-tag">withdist</span>可以显示距离</span><br><span class="line">&gt; <span class="selector-tag">georadiusbymember</span> <span class="selector-tag">company</span> <span class="selector-tag">xiaomi</span> 20 <span class="selector-tag">km</span> <span class="selector-tag">withcoord</span> <span class="selector-tag">withdist</span> <span class="selector-tag">withhash</span> <span class="selector-tag">count</span> 3 <span class="selector-tag">asc</span></span><br><span class="line">1) 1) &quot;<span class="selector-tag">xiaomi</span>&quot;</span><br><span class="line">   2) &quot;0.0000&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069880904286516</span><br><span class="line">   4) 1) &quot;116.33425265550613403&quot;</span><br><span class="line">      2) &quot;40.02740024658161389&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">juejin</span>&quot;</span><br><span class="line">   2) &quot;12.9606&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069887154388167</span><br><span class="line">   4) 1) &quot;116.48104995489120483&quot;</span><br><span class="line">      2) &quot;39.99679348858259686&quot;</span><br><span class="line">3) 1) &quot;<span class="selector-tag">meituan</span>&quot;</span><br><span class="line">   2) &quot;13.3659&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069887179083478</span><br><span class="line">   4) 1) &quot;116.48903220891952515&quot;</span><br><span class="line">      2) &quot;40.00766997707732031&quot;</span><br></pre></td></tr></table></figure>
<p>除了georadiusbymember指令根据元素查询附近的元素，Redis还提供了根据坐标值查询附近的元素指令georadius。它可以根据用户的定位来计算“附近的人”、“附近的车”等。它的参数和georadiusbymember基本一致，唯一的差别是将目标元素改成经纬度坐标值。比如：下述操作</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">georadius</span> <span class="selector-tag">company</span> 116.514202 39.905409  20 <span class="selector-tag">km</span> <span class="selector-tag">withcoord</span> <span class="selector-tag">withdist</span> <span class="selector-tag">withhash</span> <span class="selector-tag">count</span> 3 <span class="selector-tag">asc</span></span><br><span class="line">1) 1) &quot;<span class="selector-tag">juejin</span>&quot;</span><br><span class="line">   2) &quot;10.5501&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069887154388167</span><br><span class="line">   4) 1) &quot;116.48104995489120483&quot;</span><br><span class="line">      2) &quot;39.99679348858259686&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">meituan</span>&quot;</span><br><span class="line">   2) &quot;11.5748&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069887179083478</span><br><span class="line">   4) 1) &quot;116.48903220891952515&quot;</span><br><span class="line">      2) &quot;40.00766997707732031&quot;</span><br><span class="line">3) 1) &quot;<span class="selector-tag">jd</span>&quot;</span><br><span class="line">   2) &quot;13.7269&quot;</span><br><span class="line">   3) (<span class="selector-tag">integer</span>) 4069154033428715</span><br><span class="line">   4) 1) &quot;116.56210631132125854&quot;</span><br><span class="line">      2) &quot;39.78760295130235392&quot;</span><br></pre></td></tr></table></figure>
<h3 id="GeoHash其他事项"><a href="#GeoHash其他事项" class="headerlink" title="GeoHash其他事项"></a>GeoHash其他事项</h3><p>在一个地图应用中，车的数据、餐馆的数据、人的数据可能会有几百万甚至几千万条。如果使用Geo数据结构，它们将会全部放在一个zset集合中</p>
<p>在Redis的集群环境中，集合可能会从一个节点迁移到另一个节点，如果单个key的数据过大，会对集群的迁移工作造成较大的影响，在集群环境中单个key对应的数据量不宜超过1MB，否则会导致集群迁移出现卡顿状况，影响线上服务的正常运行</p>
<p>所以，建议Geo的数据使用单独的Redis实例部署，不使用集群环境，如果数据量过大，就需要对Geo数据进行拆分，按国家拆分、按省拆分、按市拆分，在人口特大城市甚至可以按区拆分。这样可以降低单个zset集合的大小</p>
<h2 id="Redis全局指令使用"><a href="#Redis全局指令使用" class="headerlink" title="Redis全局指令使用"></a>Redis全局指令使用</h2><p><strong>查看redis的全局所有配置命令</strong></p>
<p>通过help进行查看，下述的表格是挑选一些常用的指令</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">help</span> <span class="keyword">@generic</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>简述</th>
</tr>
</thead>
<tbody><tr>
<td>KEYS pattern</td>
<td>查寻该库下的所有键（慎用，推荐使用SCAN，下述有说明）</td>
</tr>
<tr>
<td>TYPE key</td>
<td>确定该key的类型</td>
</tr>
<tr>
<td>TTL key</td>
<td>超时，可以对key设置一个超时时间，超时之后会过期，将不存在</td>
</tr>
<tr>
<td>EXISTS key [key …]</td>
<td>判断key是否存在</td>
</tr>
<tr>
<td>OBJECT subcommand [arguments [arguments …]]</td>
<td>检查Redis对象内部，如encoding查看使用的编码形式</td>
</tr>
<tr>
<td>DEL key</td>
<td>删除key值</td>
</tr>
<tr>
<td>EXPIRE</td>
<td>设置过期时间</td>
</tr>
<tr>
<td>PERSIST</td>
<td>去除过期时间</td>
</tr>
<tr>
<td>SCAN</td>
<td>用于迭代SET集合中的元素</td>
</tr>
</tbody></table>
<h3 id="type命令"><a href="#type命令" class="headerlink" title="type命令"></a>type命令</h3><ul>
<li>TYPE 查看key的类型</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">hello</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">hello</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">TYPE</span> <span class="selector-tag">k1</span></span><br><span class="line"><span class="selector-tag">string</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">sadd</span> <span class="selector-tag">k1</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">c</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br><span class="line">&gt; <span class="selector-tag">type</span> <span class="selector-tag">k1</span></span><br><span class="line"><span class="selector-tag">set</span></span><br></pre></td></tr></table></figure>
<h3 id="EXPIRE命令"><a href="#EXPIRE命令" class="headerlink" title="EXPIRE命令"></a>EXPIRE命令</h3><ul>
<li>EXPIRE 设置过期时间。上述有说，setex等于set+expire，两种方法都可用</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">key1</span> <span class="selector-tag">v1</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">&quot;<span class="selector-tag">v1</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">expire</span> <span class="selector-tag">key1</span> 5            //设置5秒后过期</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">&quot;<span class="selector-tag">v1</span>&quot;</span><br><span class="line">...........5秒后............</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<h3 id="EXISTS命令"><a href="#EXISTS命令" class="headerlink" title="EXISTS命令"></a>EXISTS命令</h3><ul>
<li>判断值是否存在，exists命令返回1或者0标识给定key的值是否存在</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">key4</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<h3 id="DEL"><a href="#DEL" class="headerlink" title="DEL"></a>DEL</h3><ul>
<li>删除key值，命令返回1或0标识是被删除（值存在）或者没被删除后（key对应的值不存在）</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">del</span> <span class="selector-tag">key3</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">del</span> <span class="selector-tag">key2</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br></pre></td></tr></table></figure>
<h3 id="TTL命令"><a href="#TTL命令" class="headerlink" title="TTL命令"></a>TTL命令</h3><ul>
<li><p>超时，可以对key设置一个超时时间，当这个时间到达后被删除（就像优惠券一样）</p>
<p>integer是-1：永久不过期</p>
<p>integer是-2：没有该键值</p>
<p>integet是1：表示正常</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">TTL</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) <span class="selector-tag">-1</span></span><br><span class="line">&gt; <span class="selector-tag">EXPIRE</span> <span class="selector-tag">key1</span> 10</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">TTL</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 6</span><br><span class="line">&gt; <span class="selector-tag">TTL</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 5</span><br><span class="line">.........一直到0.........</span><br><span class="line">&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">key4</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 0</span><br><span class="line">&gt; <span class="selector-tag">TTL</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) <span class="selector-tag">-2</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">nil</span>)</span><br></pre></td></tr></table></figure>
<h3 id="PERSIST命令"><a href="#PERSIST命令" class="headerlink" title="PERSIST命令"></a>PERSIST命令</h3><ul>
<li>去除过期时间</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">key1</span> <span class="selector-tag">v1</span></span><br><span class="line">&gt; <span class="selector-tag">expire</span> <span class="selector-tag">key1</span> 10</span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">ttl</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 8</span><br><span class="line">&gt; <span class="selector-tag">persist</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 1</span><br><span class="line">&gt; <span class="selector-tag">ttl</span> <span class="selector-tag">key1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) <span class="selector-tag">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="SCAN命令"><a href="#SCAN命令" class="headerlink" title="SCAN命令"></a>SCAN命令</h3><p>在一些线上维护工作中，要从redis实例的成千上万个key中找出特定前缀的key列表来手动处理数据。可能修改它的值，也可能是删除key，但是如果从海量的key中找出满足特定前缀的key列表呢？</p>
<p>redis提供简单粗暴指令keys用来列出所有满足特定正则字符串规则的key</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">a</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line"> <span class="selector-tag">set</span> <span class="selector-tag">k2</span> <span class="selector-tag">b</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k3</span> <span class="selector-tag">c</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k4</span> <span class="selector-tag">d</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k5</span> <span class="selector-tag">e</span></span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">keys</span> *</span><br><span class="line">1) &quot;<span class="selector-tag">k3</span>&quot;</span><br><span class="line">2) &quot;<span class="selector-tag">k5</span>&quot;</span><br><span class="line">3) &quot;<span class="selector-tag">k1</span>&quot;</span><br><span class="line">4) &quot;<span class="selector-tag">k4</span>&quot;</span><br><span class="line">5) &quot;<span class="selector-tag">k2</span>&quot;</span><br></pre></td></tr></table></figure>
<p>keys指令使用非常简单，也只提供一个简单的正则字符串，但有两个弊端</p>
<ul>
<li>keys没有offset、limit参数，一次性显示所有满足的条件key，如果是实例中有几百万个key满足条件，就会看到满屏的字符串，看的不舒服</li>
<li>keys算法是遍历算法，复杂度是O(n)。如果实例中有几百万个key，就会影响redis的性能，照成服务的卡顿，而且所有读写redis的其他指令都会被延后甚至会超时报错。因为Redis是单进程结构，顺序执行所有命令，其他指令必须等keys*执行完后才能继续运行</li>
</ul>
<blockquote>
<p>PS：O(n)表示时间复杂度，是线性阶。随着问题规模n的不断增大，上述时间复杂度不断增大，算法的执行效率越低</p>
</blockquote>
<p>Redis为了解决这个问题，在2.8版本中加入了一个SCAN命令，它是一个基于游标的迭代器，用命令每次被调用都需要使用上一次这个调用返回的游标作为该调用的游标参数，当SCAN游标参数被设置为0时，服务器将开始一次新的迭代。它相比keys具备以下特点</p>
<ul>
<li>复杂度也是O(n)，但它是通过游标分布进行，不会阻塞线程</li>
<li>提供limit参数，可以控制每次返回结果的最大条数</li>
<li>同keys一样，也具备模式匹配功能</li>
<li>服务器不需要为游标保存状态，游标的唯一状态就是scan返回给客户端的游标整数</li>
<li>返回的结果可能会有重复，需要客户端去重（重要）</li>
<li>遍历的过程中如果有数据修改，改动后的数据能不能遍历到时不确定的</li>
<li>单次返回的结果是空的，并不意味着遍历结束，而是看返回的游标值是否为零</li>
</ul>
<h4 id="SCAN基本应用"><a href="#SCAN基本应用" class="headerlink" title="SCAN基本应用"></a>SCAN基本应用</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//创建十几个<span class="selector-tag">key</span></span><br><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span><span class="selector-pseudo">:2</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span></span><br><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span><span class="selector-pseudo">:7</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span></span><br><span class="line">................</span><br><span class="line">&gt; <span class="selector-tag">hset</span> <span class="selector-tag">user</span><span class="selector-pseudo">:22</span> <span class="selector-tag">k1</span> <span class="selector-tag">v1</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">scan</span> 0</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2)  1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:21&quot;</span></span><br><span class="line">    2) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:22&quot;</span></span><br><span class="line">    3) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:1&quot;</span></span><br><span class="line">    4) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:4&quot;</span></span><br><span class="line">    5) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:6&quot;</span></span><br><span class="line">    6) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:8&quot;</span></span><br><span class="line">    7) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:5&quot;</span></span><br><span class="line">    8) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:7&quot;</span></span><br><span class="line">    9) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:28&quot;</span></span><br><span class="line">   10) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:17&quot;</span></span><br><span class="line">   11) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:10&quot;</span></span><br><span class="line">   12) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:2&quot;</span></span><br><span class="line">&gt; <span class="selector-tag">scan</span> 3</span><br><span class="line">1) &quot;0&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:15&quot;</span></span><br><span class="line">   2) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:9&quot;</span></span><br><span class="line">   3) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:12&quot;</span></span><br><span class="line">   4) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:3&quot;</span></span><br></pre></td></tr></table></figure>
<p>第一个词迭代使用0作为游标，表示开始一次新的迭代，第二次迭代使用的是第一个迭代时返回的游标<code>3</code>，作为新的迭代参数</p>
<p>SCAN命令的返回值是一个包含两个元素的数据，第一个数组元素是用于进行下一次迭代的新游标，而第二个数组元素是一个数组，这个数组中包含了所有被迭代的元素</p>
<p>以0作为游标开始一次新的迭代，一直调用SCAN命令，直到命令返回游标0，我们成这个过程为一次完整遍历</p>
<p><strong>COUNT选项</strong></p>
<p>对于增量式迭代命令不保证每次迭代所返回的元素数据，可以使用COUNT选项，对命令的行为进行一定程度上的调整。COUNT选项的作用就是让用户告知迭代命令，在每次迭代中应该从数据集里返回多少元素</p>
<ul>
<li><p>COUNT参数的默认值为10</p>
</li>
<li><p>数据集比较大时，如果没有使用MATCH选项，那么命令返回的元素量通常和COUTN选项指定的一样，或者比COUTN选项指定的数量多</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">scan</span> 0 <span class="selector-tag">count</span> 5</span><br><span class="line">1) &quot;2&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:21&quot;</span></span><br><span class="line">   2) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:22&quot;</span></span><br><span class="line">   3) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:1&quot;</span></span><br><span class="line">   4) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:4&quot;</span></span><br><span class="line">   5) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:6&quot;</span></span><br><span class="line">   6) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:8&quot;</span></span><br><span class="line">&gt; <span class="selector-tag">scan</span> 2 <span class="selector-tag">count</span> 5</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:5&quot;</span></span><br><span class="line">   2) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:7&quot;</span></span><br><span class="line">   3) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:119&quot;</span></span><br><span class="line">   4) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:17&quot;</span></span><br><span class="line">   5) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:10&quot;</span></span><br><span class="line">   6) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:2&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>MATCH选项</strong></p>
<p>类似于KEYS命令，让命令只返回匹配的元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">scan</span> 0 <span class="selector-tag">match</span> <span class="selector-tag">user</span><span class="selector-pseudo">:7</span></span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:7&quot;</span> </span><br><span class="line">&gt; <span class="selector-tag">scan</span> 3 <span class="selector-tag">match</span> <span class="selector-tag">user</span>:*     /<span class="comment">/*号贪婪匹配</span></span><br><span class="line"><span class="comment">1) &quot;0&quot;</span></span><br><span class="line"><span class="comment">2) 1) &quot;user:15&quot;</span></span><br><span class="line"><span class="comment">   2) &quot;user:9&quot;</span></span><br><span class="line"><span class="comment">   3) &quot;user:12&quot;</span></span><br><span class="line"><span class="comment">   4) &quot;user:3&quot;</span></span><br></pre></td></tr></table></figure>
<p>MATCH功能对元素的模式匹配工作，是命令从数据集中取出元素后和向客户端返回元素前的这段时间内进行的。所以如果被迭代的数据集中只有少量元素和模式相匹配，那么迭代命令或许会在多次执行中都不返回任何元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">scan</span> 0 <span class="selector-tag">match</span> *12* </span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) (<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br><span class="line">&gt; <span class="selector-tag">scan</span> 3 <span class="selector-tag">match</span> *12* </span><br><span class="line">1) &quot;0&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">user</span><span class="selector-pseudo">:12&quot;</span></span><br></pre></td></tr></table></figure>
<p>这样可能不太清除的知道，我们使用python往Redis里插入10000条数据来进行测试</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">redis</span></span><br><span class="line"></span><br><span class="line">client = redis.StrictRedis()</span><br><span class="line"><span class="selector-tag">for</span> <span class="selector-tag">i</span> <span class="selector-tag">in</span> <span class="selector-tag">range</span>(10000):</span><br><span class="line">    <span class="selector-tag">client</span><span class="selector-class">.set</span>(&quot;<span class="selector-tag">key</span>%<span class="selector-tag">d</span>&quot; % <span class="selector-tag">i</span>, <span class="selector-tag">i</span>)</span><br></pre></td></tr></table></figure>
<p>插入之后，Redis有了10000条数据，接下来我们找出以key99开头的key列表。通过match匹配<code>key99*</code>，count统计<code>1000</code>数据</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">scan</span> 0 <span class="selector-tag">match</span> <span class="selector-tag">key99</span>* <span class="selector-tag">count</span> 1000</span><br><span class="line">1) &quot;6808&quot;</span><br><span class="line">2)  1) &quot;<span class="selector-tag">key9901</span>&quot;</span><br><span class="line">    2) &quot;<span class="selector-tag">key9995</span>&quot;</span><br><span class="line">    3) &quot;<span class="selector-tag">key9930</span>&quot;</span><br><span class="line">    4) &quot;<span class="selector-tag">key9918</span>&quot;</span><br><span class="line">    5) &quot;<span class="selector-tag">key9923</span>&quot;</span><br><span class="line">    6) &quot;<span class="selector-tag">key9978</span>&quot;</span><br><span class="line">    7) &quot;<span class="selector-tag">key9987</span>&quot;</span><br><span class="line">    8) &quot;<span class="selector-tag">key9936</span>&quot;</span><br><span class="line">    9) &quot;<span class="selector-tag">key996</span>&quot;</span><br><span class="line">   10) &quot;<span class="selector-tag">key9956</span>&quot;</span><br><span class="line">   11) &quot;<span class="selector-tag">key9962</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">scan</span> 6808 <span class="selector-tag">match</span> <span class="selector-tag">key99</span>* <span class="selector-tag">count</span> 1000</span><br><span class="line">1) &quot;4940&quot;</span><br><span class="line">2)  1) &quot;<span class="selector-tag">key9980</span>&quot;</span><br><span class="line">    2) &quot;<span class="selector-tag">key9973</span>&quot;</span><br><span class="line">    3) &quot;<span class="selector-tag">key9950</span>&quot;</span><br><span class="line">    4) &quot;<span class="selector-tag">key9969</span>&quot;</span><br><span class="line">    5) &quot;<span class="selector-tag">key991</span>&quot;</span><br><span class="line">    6) &quot;<span class="selector-tag">key9934</span>&quot;</span><br><span class="line">    7) &quot;<span class="selector-tag">key9922</span>&quot;</span><br><span class="line">    8) &quot;<span class="selector-tag">key9951</span>&quot;</span><br><span class="line">    9) &quot;<span class="selector-tag">key9988</span>&quot;</span><br><span class="line">   10) &quot;<span class="selector-tag">key9924</span>&quot;</span><br><span class="line">   11) &quot;<span class="selector-tag">key9989</span>&quot;</span><br><span class="line">   12) &quot;<span class="selector-tag">key9982</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">scan</span> 4904 <span class="selector-tag">match</span> <span class="selector-tag">key99</span>* <span class="selector-tag">count</span> 1000</span><br><span class="line">1) &quot;14452&quot;</span><br><span class="line">2) 1) &quot;<span class="selector-tag">key9962</span>&quot;</span><br><span class="line">   2) &quot;<span class="selector-tag">key9980</span>&quot;</span><br><span class="line">   3) &quot;<span class="selector-tag">key9973</span>&quot;</span><br><span class="line">   4) &quot;<span class="selector-tag">key9950</span>&quot;</span><br><span class="line">   5) &quot;<span class="selector-tag">key9969</span>&quot;</span><br><span class="line">   6) &quot;<span class="selector-tag">key991</span>&quot;</span><br><span class="line">   7) &quot;<span class="selector-tag">key9934</span>&quot;</span><br><span class="line">   8) &quot;<span class="selector-tag">key9922</span>&quot;</span><br><span class="line">.....................</span><br></pre></td></tr></table></figure>
<p>SCAN提供了是哪个参数，第一个是cursor整数值（初始为0），第二个是key的正则模式（match），第三个是遍历的limit hint（count）。第一次遍历时，cursor值为0，然后将返回结果中第一个整数值作为下一次遍历的cursor，一直遍历到返回的cursor值为0时结束</p>
<p>上面的过程中可以看出，虽然提供的limit是1000，但是返回的结果却只有10个左右。因为这个limit不是限定返回结果的数量，而是限定服务器单词遍历的字典槽位数量（约等于）。如果将limit设置为10，你会发现返回的结果是空的，但是游标值不为0，意味着遍历还没有结束</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">scan</span> 0 <span class="selector-tag">match</span> <span class="selector-tag">key99</span>* <span class="selector-tag">count</span> 10</span><br><span class="line">1) &quot;8704&quot;</span><br><span class="line">2) (<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br><span class="line">&gt; <span class="selector-tag">scan</span> 8704 <span class="selector-tag">match</span> <span class="selector-tag">key99</span>* <span class="selector-tag">count</span> 10</span><br><span class="line">1) &quot;3584&quot;</span><br><span class="line">2) (<span class="selector-tag">empty</span> <span class="selector-tag">array</span>)</span><br></pre></td></tr></table></figure>
<h4 id="字典的结构"><a href="#字典的结构" class="headerlink" title="字典的结构"></a>字典的结构</h4><p>在Redis中所有的key都存储在一个很大的字典中。如下图所示，它是一维数组，是二维链表结构。第一维数组的大小总是2^n(n&gt;=0)。扩容一次数组，大小空间加倍，也就是2^n+1</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210430155001069.png"></p>
<p>scan指令返回的游标就是第一维数组的位置索引，我们将这个位置索引称为槽（slot）。如果不考虑字典的扩容缩容，直接按数组下标一个一个遍历。limit参数就表示需要遍历的槽位数，之所以返回的结果可能多可能少，是因为不是所有的槽位上都会挂接链表，有些槽位可能是空的，还有些槽位上挂接的链表上的元素可能会有多个。每一次遍历都会将limit数量的槽位上挂接的所有链表元素进行模式匹配过滤后，一次性返回给客户端</p>
<h4 id="SCAN遍历顺序"><a href="#SCAN遍历顺序" class="headerlink" title="SCAN遍历顺序"></a>SCAN遍历顺序</h4><p>scan的遍历顺序，它不是从第一维数组的第0位一直遍历到末尾，而是采用了高位进位加法来遍历。之所以使用这样特殊的方式进行遍历，是考虑到字典的扩容和缩容时避免槽位的遍历重复和遗漏</p>
<p>如下图，普通加法和高位进位加法的区别</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210430155928566.png"></p>
<p>从图中可以看出高位进位加法从左边加，进位往右边移动，同普通加法正好相反。但是最终它们都会遍历所有的槽位并且没有重复</p>
<h2 id="Redis编码模式"><a href="#Redis编码模式" class="headerlink" title="Redis编码模式"></a>Redis编码模式</h2><p>redis是二进制安全的，分两种流：字节流和字符流，redis从socket拿去的数据是字节流，不是字符流，在客户端选择不同的字符集，redis就会根据客户端的字符集进行应用。所以一定要在客户端沟通好使用的数据编码，这样数据才是稳定安全的</p>
<p>设置一个中文字符，get查看是16进制的，长度是3</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> 中</span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;\<span class="selector-tag">xe4</span>\<span class="selector-tag">xb8</span>\<span class="selector-tag">xad</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">STRLEN</span> <span class="selector-tag">k1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 3</span><br></pre></td></tr></table></figure>
<p>这是由我客户端xshell使用的编码模式为定的，为UTF-8</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315172828338.png"></p>
<p>换成GBK编码模式，测试看看</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210315172922135.png"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> 中</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">get</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;\<span class="selector-tag">xd6</span>\<span class="selector-tag">xd0</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">STRLEN</span> <span class="selector-tag">k1</span></span><br><span class="line">(<span class="selector-tag">integer</span>) 2</span><br></pre></td></tr></table></figure>
<p>很明显，编码模式改变之后，字符的数量也改变了，GBK一个中文等于两个字节，UTF8一个中文等于三个字节，redis使用的编码模式，取决于客户端的使用</p>
<h3 id="embstr-与-raw"><a href="#embstr-与-raw" class="headerlink" title="embstr 与 raw"></a>embstr 与 raw</h3><p>Redis的字符串有两种存储方式，在长度特别短时，使用embstr形式存储（embeded），而当长度超过44字节时，使用raw形式存储</p>
<p>这两种类型有什么区别呢？为什么分界线是44字节？我们先操作下述的例子看看</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> <span class="selector-tag">abcdefghijklnmopqrstuvwxyz012345678901234567</span>     // 44字符串</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">debug</span> <span class="selector-tag">object</span> <span class="selector-tag">k1</span></span><br><span class="line"><span class="selector-tag">Value</span> <span class="selector-tag">at</span><span class="selector-pseudo">:0x7ff7b4545b40</span> <span class="selector-tag">refcount</span><span class="selector-pseudo">:1</span> <span class="selector-tag">encoding</span><span class="selector-pseudo">:embstr</span> <span class="selector-tag">serializedlength</span><span class="selector-pseudo">:45</span> <span class="selector-tag">lru</span><span class="selector-pseudo">:8990472</span> <span class="selector-tag">lru_seconds_idle</span><span class="selector-pseudo">:3</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k2</span> <span class="selector-tag">abcdefghijklnmopqrstuvwxyz0123456789012345678</span>   // 45字符串</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">debug</span> <span class="selector-tag">object</span> <span class="selector-tag">k2</span></span><br><span class="line"><span class="selector-tag">Value</span> <span class="selector-tag">at</span><span class="selector-pseudo">:0x7ff7b447fc20</span> <span class="selector-tag">refcount</span><span class="selector-pseudo">:1</span> <span class="selector-tag">encoding</span><span class="selector-pseudo">:raw</span> <span class="selector-tag">serializedlength</span><span class="selector-pseudo">:46</span> <span class="selector-tag">lru</span><span class="selector-pseudo">:8990505</span> <span class="selector-tag">lru_seconds_idle</span><span class="selector-pseudo">:2</span></span><br></pre></td></tr></table></figure>
<p>上面debug object输出encoding字段，由一个字符的差别，存储形式就发生了变化</p>
<p>先看下图，了解Redis对象头的结构，所有的Redis对象都有下面的这个头结构</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210430162905271.png"></p>
<p>不同的对象具有不同的类型type(4bit)。同一个类型的type会有不同的存储形式encoding（4bit）比如string还会有int存储形式。为了记录记录对象的LRU信息，使用24个bit来记录LRU信息。每个对象有个引用计数（refcount），当引用计数为零时，对象就会被摧毁，内存被收回。ptr指针将指向对象内容（body）的具体存储位置。这一个RedisOBJECT对象头结构需要占据16字节的存储空间</p>
<p>接着是SDS结构体的大小，在字符串比较小时，SDS对象头结构的大小是capacity+3，至少是3个字节。分配一个字符串的最小空间占用为19（即16+3）字节</p>
<blockquote>
<p>PS：SDS是Redis字符串，英文全写为：Simple Dynamic String。它的结构是一个带长度信息的字节数组</p>
</blockquote>
<p>embstr存储形式，是将RedisOBJECT对象头结构和SDS对象连续存在一起，使用malloc方法一次分配。而raw存储形式不一样，它需要使用两次malloc方法，两个对象头在内存地址上一般是不连续的。如下图</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/redis-pages/image-20210430164547825.png"></p>
<p>而内存分配中其jemalloc、tcmalloc等分配内存大小的单位都是2/4/8/16/32/64字节等，为了能容纳一个完整的embstr对象，jemalloc最少会分配32字节的空间。如果字符串再稍微长一点，那就是64字节的空间。如果字符串总体超出了64字节，Redis认为它是一个大字符串，不再适合使用emdstr形式存储，而该使用raw形式</p>
<p>content的长度最多只有45（即64-19）字节。从上面结构图可以看出。而字符串有会以NULL结尾，减去结尾的字节，所以embstr形式最大能容纳的字符串长度就是44字节</p>
<p>redis的raw格式，当使用APPENG进行追加的使用也会转换成raw格式，这是redis的特性</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">set</span> <span class="selector-tag">k1</span> 9</span><br><span class="line"><span class="selector-tag">OK</span></span><br><span class="line">&gt; <span class="selector-tag">OBJECT</span> <span class="selector-tag">encoding</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">int</span>&quot;</span><br><span class="line">&gt; <span class="selector-tag">APPEND</span> <span class="selector-tag">k1</span> 999</span><br><span class="line">(<span class="selector-tag">integer</span>) 4</span><br><span class="line">&gt; <span class="selector-tag">OBJECT</span> <span class="selector-tag">encoding</span> <span class="selector-tag">k1</span></span><br><span class="line">&quot;<span class="selector-tag">raw</span>&quot;</span><br></pre></td></tr></table></figure>






</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Inaction</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://myboke.ink/2021/05/08/Redis常用结构类型-2（详细讲解）/">https://myboke.ink/2021/05/08/Redis常用结构类型-2（详细讲解）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="social-share pull-right"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/05/08/Redis%E6%8C%81%E4%B9%85%E5%8C%96-3%EF%BC%88RDB%E4%B8%8EAOF%EF%BC%89/"><i class="fa fa-chevron-left">  </i><span>Redis持久化-3（RDB与AOF）</span></a></div><div class="next-post pull-right"><a href="/2021/05/08/Redis%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"><span>Redis概述与安装部署-1</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6cea6a646bff1a0d5f5b',
  clientSecret: '6e9ef08f31f505d416bc0afe2d304808e9063627',
  repo: 'zsjmal2316.github.io',
  owner: 'zsjmal2316',
  admin: 'zsjmal2316',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(img/wuwei.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By Inaction</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">粤ICP备20067869号<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="120" alpha="0.3" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>
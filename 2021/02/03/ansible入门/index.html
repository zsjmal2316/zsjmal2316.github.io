<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ansible入门"><meta name="keywords" content="ansible"><meta name="author" content="Inaction"><meta name="copyright" content="Inaction"><title>ansible入门 | Inaction's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?12b421fdad87d1edf2305ccb7229d2c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-8RMJ1F8ETC', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="Inaction's Blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">Ansible自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">Ansible介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">1.2.</span> <span class="toc-text">Ansible是如何工作的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%80%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">使用者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible%E5%B7%A5%E5%85%B7%E9%9B%86"><span class="toc-number">1.2.2.</span> <span class="toc-text">Ansible工具集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">作用对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1%EF%BC%8C%E7%BB%84%E4%BB%B6%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="toc-number">1.2.4.</span> <span class="toc-text">Ansible执行任务，组件相互调用关系图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.</span> <span class="toc-text">Ansible通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible-SSH%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text">Ansible SSH工作机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Essh%E5%AF%86%E9%92%A5%E5%AF%B9%E5%AE%9E%E7%8E%B0%E5%85%8D%E4%BA%A4%E4%BA%92%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">基于ssh密钥对实现免交互连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E7%9A%84%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.</span> <span class="toc-text">Ansible的安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pip%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">pip方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">yum方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apt-get"><span class="toc-number">1.4.3.</span> <span class="toc-text">Apt-get</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">Git安装方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%85%83%E7%B4%A0%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.</span> <span class="toc-text">Ansible元素介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.1.</span> <span class="toc-text">Ansible目录结构介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.2.</span> <span class="toc-text">Ansible配置文件解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E7%B3%BB%E5%88%97%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.</span> <span class="toc-text">Ansible系列命令用法详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible-galaxy"><span class="toc-number">1.6.1.</span> <span class="toc-text">ansible-galaxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible-doc"><span class="toc-number">1.6.2.</span> <span class="toc-text">ansible-doc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible-vault"><span class="toc-number">1.6.3.</span> <span class="toc-text">ansible-vault</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible-console"><span class="toc-number">1.6.4.</span> <span class="toc-text">ansible-console</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%BB%E6%9C%BA%E5%92%8C%E7%BB%84"><span class="toc-number">1.7.</span> <span class="toc-text">定义主机和组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%88%86%E7%BB%84%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.1.</span> <span class="toc-text">简单分组配置主机信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%AC%A6%E5%8F%B7%E5%8C%B9%E9%85%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">主机名符号匹配配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E4%B8%8A%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">加上远程端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E4%BD%BF%E7%94%A8%E7%89%B9%E6%AE%8A%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.4.</span> <span class="toc-text">主机使用特殊的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%90%8D%E5%B5%8C%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.5.</span> <span class="toc-text">主机名嵌入配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible%E4%B8%8E%E6%AD%A3%E5%88%99"><span class="toc-number">1.7.6.</span> <span class="toc-text">Ansible与正则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ad-Hoc"><span class="toc-number">1.8.</span> <span class="toc-text">Ad-Hoc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible%E6%A8%A1%E5%9D%97%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">1.8.1.</span> <span class="toc-text">ansible模块语法说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping%EF%BC%88%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97%EF%BC%89"><span class="toc-number">1.8.2.</span> <span class="toc-text">ping（检测模块）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#command-%E9%BB%98%E8%AE%A4%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.3.</span> <span class="toc-text">command(默认模块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell-%E4%B8%87%E8%83%BD%E6%A8%A1%E5%9D%97%EF%BC%89"><span class="toc-number">1.8.4.</span> <span class="toc-text">shell(万能模块）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#script-%E8%84%9A%E6%9C%AC%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.5.</span> <span class="toc-text">script(脚本模块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.6.</span> <span class="toc-text">copy(文件类型模块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.7.</span> <span class="toc-text">file(文件类型模块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fetch-%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.8.</span> <span class="toc-text">fetch(文件内容模块)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.9.</span> <span class="toc-text">yum模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.10.</span> <span class="toc-text">service模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.11.</span> <span class="toc-text">cron模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.12.</span> <span class="toc-text">mount模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.13.</span> <span class="toc-text">user模块</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/melody-favicon.ico"></div><div class="author-info__name text-center">Inaction</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">40</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friend Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://www.ji4n.cn/">Jen</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(img/beijing2.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Inaction's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">ansible入门</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-02-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/">Linux</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/ansible/">ansible</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Ansible自动化"><a href="#Ansible自动化" class="headerlink" title="Ansible自动化"></a>Ansible自动化</h1><h2 id="Ansible介绍"><a href="#Ansible介绍" class="headerlink" title="Ansible介绍"></a><strong>Ansible介绍</strong></h2><p>Ansible是一款运维自动化工具，其主要功能是帮助运维实现IT工作的自动化，降低人为操作失误，提高业务自动化率、提升运维工作效率，常用于软件部署自动化、配置自动化、管理自动化、系统化系统任务、持续集成、零宕机平滑升级等，它有丰富的内置模块（如：<code>acl、command、shell、cron、yum、copy、file、user</code>等，多大5-6百个）和开放的API接口，同时任何遵循GPL协议的企业或个人都可以随意修改和发布自己的版本。</p>
<p><strong>Ansible的模块应用范围：</strong></p>
<blockquote>
<ul>
<li>系统层：支持的系统有Linux、Windows、AIX等，对应模块有acl、cron、pip、easy install、yum、authorized key等大量的内置模块</li>
<li>知名第三方平台支持：支持的平台有AWS、Azure、Cloudflare、OpenStack、Google、Linode、Digital、Ocean等，对应的模块有ec2、azure_rm_deployment、couldflare_dns、clc_aa_policy、glance_image、gc_storage、digital_ocean等</li>
<li>虚拟化：VMware、Docker、Cloudstack、LXC、OpenStack等，对应的模块有vmware_vmkernel、docker、cs_account、lxc_container、glance_image等</li>
<li>商业化硬件：F5、ASA、Citrix、EOS等，对应的模块有bigip_facts、asa_acl、netscaler、eos_command等</li>
<li>系统应用层：Apache、Zabbix、Rabbitmq、SVN、GIT等，对应的模块有apache2_module、zabbix_groupreabbimq_binding、subversion、git等</li>
</ul>
</blockquote>
<h2 id="Ansible是如何工作的"><a href="#Ansible是如何工作的" class="headerlink" title="Ansible是如何工作的"></a><strong>Ansible是如何工作的</strong></h2><p>Ansible没有客户端，因此底层通信依赖于系统软件，Linux系统下基本OpenSSH通信，window系统下基于PowerShell，管理端必须是Linux系统，管理者认证通过在管理节点通过Ansible工具调用各应用模块将指令推送至被管理端执行，并在执行完毕后自动删除产生的临时文件。</p>
<p><strong>根据Ansible使用过程中不同角色，其分为：</strong></p>
<blockquote>
<ul>
<li>使用者</li>
<li>Ansible工具集</li>
<li>作用对象</li>
</ul>
</blockquote>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201212151925936.png"></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201212155517979.png"></p>
<h3 id="使用者"><a href="#使用者" class="headerlink" title="使用者"></a>使用者</h3><blockquote>
<ul>
<li>第一种方法：CMDB（Configuretion Management Database，配置管理数据库），CMDB存储和管理者企业IT架构中的各项配置信息，是构建ITIL项目的核心工具，可以组合CMDB和Ansible，通过CMDB直接下发指令调用Ansible工具集完成相应的工作</li>
<li>第二种方法：PUBLIC/PRIVATE方式，Ansible除了丰富的内置模块外，同时提供丰富的API语言接口，如PHP、Python、Perl等多种语言，基于PUBLIC（公有云）/PRIVATE（私有云，Ansible以API调用的方式运行）</li>
<li>第三种方法：运维人员直接使用Ad-Hoc临时命令集调用Ansible工具集来完整任务执行</li>
<li>第四种方法：运维人员预先编写好的Ansible Playbook，通过执行Playbook中预先编排好的任务集按序完成任务执行</li>
</ul>
</blockquote>
<h3 id="Ansible工具集"><a href="#Ansible工具集" class="headerlink" title="Ansible工具集"></a>Ansible工具集</h3><p>Ansible命令是Ansible的核心工具，Ansible命令并非自身完整所有的功能集，其只是Ansible执行任务的调用入口，所有命令通过工具集来最终完整。如：上图绿色框框中的内容</p>
<blockquote>
<ul>
<li>Ansible Playbooks：任务剧本，编排定义Ansible任务集的配置我呢间，由Ansible顺序依次执行，通常是JSON格式的YML文件</li>
<li>INVENTORY：Ansible管理主机的清单</li>
<li>MODULES：Ansible执行的功能模块，多数为内置的核心模块，也可自定义</li>
<li>PLUGINS：模块功能的补充，如连接类型插件，循环插件、变量插件、过滤插件等</li>
<li>API：供第三方程序调用的应用程序编程接口</li>
</ul>
<p><strong>Ansible：组合INVENTORY、API、MODULES、PLUGINS，其为核心执行工具</strong></p>
</blockquote>
<h3 id="作用对象"><a href="#作用对象" class="headerlink" title="作用对象"></a>作用对象</h3><p>Ansible的作用对象，不仅仅是Linux和非Linux操作系统的主机，同样也可以作用于各类公有云/私有云，商业和非商业设备的网络设施</p>
<h3 id="Ansible执行任务，组件相互调用关系图"><a href="#Ansible执行任务，组件相互调用关系图" class="headerlink" title="Ansible执行任务，组件相互调用关系图"></a>Ansible执行任务，组件相互调用关系图</h3><p>使用Ansible或Ansible-playbook时，在灌流单输入Ansible的Ad-Hoc命令激活Playbook后，Ansible会遵循预先编排的规则将Playbook逐条拆解为Play，再将<code>Play</code>组成Ansible可识别的任务<code>Task</code>，随后调用任务涉及的所有模块<code>Module</code>和插件<code>Plugin</code>，根据<code>Inventory</code>中定义的主机列表通过SSH将任务集以临时文件或命令的形式传输到远程客户端执行并返回执行结果，如果是临时文件则执行完毕后自动删除</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201212154930371.png"></p>
<h2 id="Ansible通信"><a href="#Ansible通信" class="headerlink" title="Ansible通信"></a><strong>Ansible通信</strong></h2><p>Ansible特点就是无需任务<code>Daemon</code>维护进程即可显示相互间的通信，且通信方式是基于业内统一标准的安全可靠的SSh安全连接。同时因为SSH是每台Linux主机系统必装的软件，所以Ansible无需再远程主机端安装任务额外的进程。实现<code>Agentless</code>（无客户端），以及稳定、快速、安全的SSH连接是Ansible通信negligible的核心</p>
<h3 id="Ansible-SSH工作机制"><a href="#Ansible-SSH工作机制" class="headerlink" title="Ansible SSH工作机制"></a>Ansible SSH工作机制</h3><p>Ansible执行命令时，通过其底层传输连接模块，将一个或数个文件，或者定义个Play或Command命令传输到远程服务器<code>/tmp</code>目录的临时文件，并在远程执行这些Play/Command命令，然后又删除这些临时文件，同时回传整体命令执行结果。</p>
<p><strong>Ansible特点总结：</strong></p>
<blockquote>
<ul>
<li>无客户端，只需要安装SSH、Python即可</li>
<li>基于OpenSSH通信，底层基于SSH协议</li>
<li>支持密码和SSH认证，可通过密码认证和密钥对认证</li>
<li>支持Windows，但仅支持被客户端，服务端必须是Linux系统</li>
<li>通过YAML语法，基于管理，API简单明了</li>
<li>能快速入手，设置简单，无需任务第三方软件</li>
<li>丰富的内置模块，满足日常功能所需，配置管理、应用部署、任务编排等功能集于一身</li>
<li>没有额外软件包消耗系统性能（高效）</li>
<li>基于OpenSSH，保证通信的安全可靠性</li>
</ul>
</blockquote>
<h3 id="基于ssh密钥对实现免交互连接"><a href="#基于ssh密钥对实现免交互连接" class="headerlink" title="基于ssh密钥对实现免交互连接"></a>基于ssh密钥对实现免交互连接</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t 秘钥对（dsa|rsa）                            //服务端</span><br><span class="line">$ ssh-copy-id -i /root/.ssh/id_dsa.pub root@10.0.0.211     //发送被动端</span><br></pre></td></tr></table></figure>
<h2 id="Ansible的安装部署"><a href="#Ansible的安装部署" class="headerlink" title="Ansible的安装部署"></a><strong>Ansible的安装部署</strong></h2><p>Ansible被RedHAT红帽官方收购后，其安装源被收录在<code>epel</code>中，如果已经安装<code>epel</code>可直接使用yum或apt安装，也可以通过pip和easy_install的Python第三方包管理器安装Ansible</p>
<h3 id="pip方式"><a href="#pip方式" class="headerlink" title="pip方式"></a>pip方式</h3><p>Ansible底层基于Python编写，通过pip方式安装Ansible：</p>
<blockquote>
<p>//安装python-pip3程序包及Python-devel</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install python-pip python-devel -y</span><br></pre></td></tr></table></figure>

<p>//安装前确保服务器的gcc、glibc开发环境均已安装，系统几乎所有的软件包编译环境均基于gcc。如果不确认可先执行如下命令：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install gcc glibc-devel zlib-devel rpm-build openssl-devel -y</span><br></pre></td></tr></table></figure>

<p>//升级本地pip至最新版本</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>//安装Ansible服务</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install ansible --upgrade</span><br></pre></td></tr></table></figure>

<p>//执行命令ansible –version，查看安装的版本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible --version</span><br><span class="line">ansible 2<span class="selector-class">.10</span><span class="selector-class">.3</span></span><br><span class="line">  config file = None</span><br><span class="line">  configured module search path = [&#x27;/root/.ansible/plugins/modules&#x27;, &#x27;/usr/share/ansible/plugins/modules&#x27;]</span><br><span class="line">  ansible python module location = /usr/local/lib/python3.6/site-packages/ansible</span><br><span class="line">  executable location = /usr/local/bin/ansible</span><br><span class="line">  python version = 3.6.8 (default, Nov 16 2020, 16:55:22) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="yum方式"><a href="#yum方式" class="headerlink" title="yum方式"></a>yum方式</h3><p>Yum（Yellow dog Updater，Modified）是一个在Fedora和RedHAT以及CentOS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无需繁琐地下载依赖。</p>
<blockquote>
<p>//事先要安装epel源，才能找到并安装Ansible（Centos7）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<p>//安装Ansible</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y ansible</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Apt-get"><a href="#Apt-get" class="headerlink" title="Apt-get"></a>Apt-get</h3><p>全程是Advand Package Tool，是一款适合于UNIX和Linux系统的应用程序管理器，适用于Ubuntu、Debian等deb包管理式的操作系统，主要用于自动地从互联网的软件仓库中搜索、安装、升级、卸载软件或操作系统。</p>
<blockquote>
<p>//添加Ansible源</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-add-repository -y ppa:ansible/ansible</span><br></pre></td></tr></table></figure>

<p>//升级库我呢见</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get update</span><br></pre></td></tr></table></figure>

<p>//安装Ansible</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install -y ansible</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Git安装方式"><a href="#Git安装方式" class="headerlink" title="Git安装方式"></a>Git安装方式</h3><p>Pip、Yum、Apt-get都是二进制的安装方式，源码安装比较难，但学会源码安装软件方式是一项非常重要的技能。</p>
<blockquote>
<p>//安装git客户端，一般服务器都会自带git，如果没有则安装</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y git</span><br></pre></td></tr></table></figure>

<p>//使用git将拉去指定的Ansible版本至本地当前目录</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/ansible/ansible.git</span><br></pre></td></tr></table></figure>

<p>//切换至程序包目录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ./ansible</span><br></pre></td></tr></table></figure>

<p>//执行env-setup脚本，安装Ansible软件包</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ./hacking/env-setup</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Ansible元素介绍"><a href="#Ansible元素介绍" class="headerlink" title="Ansible元素介绍"></a><strong>Ansible元素介绍</strong></h2><h3 id="Ansible目录结构介绍"><a href="#Ansible目录结构介绍" class="headerlink" title="Ansible目录结构介绍"></a>Ansible目录结构介绍</h3><p>Ansible是开源工具，整个开发过程或二次开发均遵循GPL协议，所以所有源码均可见。</p>
<blockquote>
<p>//查看ansible配置文件目录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -ql ansible|egrep -v &quot;/usr/share|/usr/lib|/usr/bin&quot; </span><br><span class="line">/etc/ansible             	//配置文件目录</span><br><span class="line">/etc/ansible/ansible.cfg 	//ansible服务配置文件</span><br><span class="line">/etc/ansible/hosts       	//主机清单文件，定义可以管理的主机信息</span><br><span class="line">/etc/ansible/roles       	//角色目录</span><br></pre></td></tr></table></figure>

<p>//其他目录文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin        						   //执行文件目录</span><br><span class="line">/usr/lib/python2.7/site-packages/ansible   //lib库依赖目录</span><br><span class="line">/usr/share/doc/ansible-xx/                 //help文档目录</span><br><span class="line">/usr/share/man/man1                        //man文档目录</span><br></pre></td></tr></table></figure>

</blockquote>
<blockquote>
<ul>
<li>配置文件目录/etc/ansible/，主要功能为：Inventory主机信息配置、Ansible工具集配置等。所有Ansible的配置均存放在该目录下。</li>
<li>执行文件目录/usr/bin/，主要功能为：Ansiblle系列命令默认存放目录。Ansible所有的可执行文件存放在该目录下</li>
<li>在/usr/lib/python.xxx/site-packages/下，该目录时系统当前默认的Python路径，因为ansible是基于Python编写的，所有ansible的所有lib库文件和模块文件也均存放于该目录下</li>
</ul>
</blockquote>
<h3 id="Ansible配置文件解析"><a href="#Ansible配置文件解析" class="headerlink" title="Ansible配置文件解析"></a>Ansible配置文件解析</h3><p>Inventory用于定义Ansible的主机（hosts）列表配置，Ansible的自身配置文件只有一个，即ansible.cfg，ansible.cfg配置文件可以存在多个地方。</p>
<p><strong>Ansible读取配置文件的顺序依次当前命令执行目录——&gt;用户家目录下的.ansible.cfg——&gt;/etc/ansible.cfg，先找到哪个就使用哪个的配置</strong></p>
<blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/ansible/</span><br><span class="line">/etc/ansible/</span><br><span class="line">├── ansible<span class="selector-class">.cfg</span></span><br><span class="line">├── ansible-playbook</span><br><span class="line">│   └── rsync_service<span class="selector-class">.yaml</span></span><br><span class="line">├── hosts</span><br><span class="line">└── roles</span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>查看/etc/ansible/ansible.cfg文件内容</strong></p>
<blockquote>
<p>//[default]，日常可能用到的配置，多数保持默认即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[defaults]</span></span><br><span class="line"></span><br><span class="line">#inventory      = /etc/ansible/hosts                    //定义Inventory</span><br><span class="line">#library        = /usr/share/my_modules/                //自定义lib库存放目录</span><br><span class="line">#module_utils   = /usr/share/my_module_utils/</span><br><span class="line">#remote_tmp     = ~/.ansible/tmp                        //远程临时文件本地存放目录</span><br><span class="line">#local_tmp      = ~/.ansible/tmp                        //本地临时文件本地存放目录</span><br><span class="line">#plugin_filters_cfg = /etc/ansible/plugin_filters.yml   //定义插件的yml文件 </span><br><span class="line">#forks          = 5                                     //默认开启的并发数</span><br><span class="line">#poll_interval  = 15                                    //默认轮询时间间隔</span><br><span class="line">#sudo_user      = root                                  //默认sudo用户</span><br><span class="line">#ask_sudo_pass = True                                   //是否需要sudo密码</span><br><span class="line">#ask_pass      = True                                   //是否需要密码</span><br><span class="line">#transport      = smart                                 //传输端口类型                          </span><br><span class="line">#remote_port    = 22                                    //默认远程的端口                       </span><br><span class="line">#module_set_locale = False                              //首次连接是否需要检查key认证，建议设为FALSE</span><br><span class="line">#timeout = 10</span><br><span class="line">#remote_user = root                                     //默认远程用户</span><br><span class="line">#log_path = /var/log/ansible.log                        //存放日志的路径</span><br><span class="line">#module_name = command                                  //默认执行的模块</span><br><span class="line">#action_plugins     = /usr/share/ansible/plugins/action  //action插件的存放目录</span><br><span class="line">#become_plugins     = /usr/share/ansible/plugins/become  //become插件的存放目录</span><br><span class="line">#cache_plugins      = /usr/share/ansible/plugins/cache   //下列插件都是类似</span><br><span class="line">#callback_plugins   = /usr/share/ansible/plugins/callback</span><br><span class="line">#connection_plugins = /usr/share/ansible/plugins/connection</span><br><span class="line">#lookup_plugins     = /usr/share/ansible/plugins/lookup</span><br><span class="line">#inventory_plugins  = /usr/share/ansible/plugins/inventory</span><br><span class="line">#vars_plugins       = /usr/share/ansible/plugins/vars</span><br><span class="line">#filter_plugins     = /usr/share/ansible/plugins/filter</span><br><span class="line">#test_plugins       = /usr/share/ansible/plugins/test</span><br><span class="line">#terminal_plugins   = /usr/share/ansible/plugins/terminal</span><br><span class="line">#strategy_plugins   = /usr/share/ansible/plugins/strategy</span><br><span class="line">#fact_caching = memory                                         //getfact缓存的主机信息存放方式</span><br><span class="line">#fact_caching_connection=/tmp                                  //getfact缓存的主机信息存放目录</span><br><span class="line">#retry_files_enabled = False</span><br><span class="line">#retry_files_save_path = ~/.ansible-retry                      //错误重启文件存放目录         </span><br></pre></td></tr></table></figure>

<p>//[privilege_escalation]，安全角度考虑，部分公司不希望直接以root的高级管理员权限直接部署应用，往往会开放普通用户权限并给予sudo的权限，该部分配置主要针对sudo用户提权的配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#become=True                   //是否sudo</span><br><span class="line">#become_method=sudo            //sudo方式</span><br><span class="line">#become_user=root              //sudo后变成root用户</span><br><span class="line">#become_ask_pass=False         //sudo后是否验证密码</span><br></pre></td></tr></table></figure>

<p>//[paramiko_connection]，不常用，了解即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#record_host_keys=False        //不记录新主机的key以提升效率</span><br><span class="line">#pty=False                     //禁用sudo功能</span><br></pre></td></tr></table></figure>

<p>//[ssh_connection]，默认使用SSH协议连接对端主机，多数保持默认即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pipelining = False            //管道加速功能，需配置requiretty使用方可生效</span><br></pre></td></tr></table></figure>

<p>//[accelerate]，连接加速相关配置。多数保持默认即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#accelerate_port = 5099               //加速连接端口</span><br><span class="line">#accelerate_timeout = 30              //命令执行超时时间，单位秒</span><br><span class="line">#accelerate_connect_timeout = 5.0     //连接超时时间，单位秒</span><br><span class="line">#accelerate_daemon_timeout = 30       //上一个活动连接的时间，单位分钟</span><br><span class="line">#accelerate_multi_key = yes           </span><br></pre></td></tr></table></figure>

<p>//[selinux]，保持默认配置即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#libvirt_lxc_noseclabel = yes</span><br></pre></td></tr></table></figure>

<p>//[colors]，对于输出结果的颜色，保持默认即可</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#highlight = white</span><br><span class="line">#verbose = blue               //蓝色，显示ansible命令的执行过程 </span><br><span class="line">#warn = bright purple         //亮紫色，显示忠告信息  </span><br><span class="line">#error = red                  //红色，报错信息  </span><br><span class="line">#debug = dark gray            //深灰色，调试</span><br><span class="line">#deprecate = purple           //紫色，不在使用</span><br><span class="line">#skip = cyan                  //青色，跳过</span><br><span class="line">#unreachable = red            //红色，不可达</span><br><span class="line">#ok = green                   //绿色，查看主机信息/对主机未作改动</span><br><span class="line">#changed = yellow             //黄色，对主机信息做了改变   </span><br><span class="line">#diff_add = green             //绿色，对比之后添加</span><br><span class="line">#diff_remove = red            //红色，对比之后移除</span><br><span class="line">#diff_lines = cyan            //青色，对比每一行</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Ansible系列命令用法详解"><a href="#Ansible系列命令用法详解" class="headerlink" title="Ansible系列命令用法详解"></a><strong>Ansible系列命令用法详解</strong></h2><h3 id="ansible-galaxy"><a href="#ansible-galaxy" class="headerlink" title="ansible-galaxy"></a>ansible-galaxy</h3><p>通过ansible-galaxy命令，可以根据下载量和关注量等信息，查找和安装优秀的Roles。Roles是Ansible非常重要的一项功能。</p>
<p><strong>ansible-galaxy命令使用格式如下：</strong></p>
<blockquote>
<p>ansible-galaxy [-h] [–version] [-v] TYPE</p>
</blockquote>
<p><strong>ansible-galaxy命令分三大部分：</strong></p>
<blockquote>
<p>init：初始化本地的Roles配置，以备上传Roles至galaxy</p>
<ul>
<li>info：列表指定Role的详细信息</li>
<li>install：下载并安装galaxy指定的Roles到本地</li>
<li>list：列出本地已下载的Roles</li>
<li>remove：删除本地已下载的Roles</li>
</ul>
</blockquote>
<p><strong>输入<a target="_blank" rel="noopener" href="https://galaxy.ansible.com/%E7%BD%91%E5%9D%80%EF%BC%8C%E9%80%89%E6%8B%A9web%E7%9A%84Roles%EF%BC%8C%E9%80%9A%E8%BF%87ansible-galaxy%E5%91%BD%E4%BB%A4%E4%B8%8B%E8%BD%BD%E5%B7%B2%E7%BB%8F%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84nginx%EF%BC%88Roles%EF%BC%89">https://galaxy.ansible.com/网址，选择web的Roles，通过ansible-galaxy命令下载已经打包好的nginx（Roles）</a></strong></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201213211107478.png"></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201213211214732.png"></p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201213211333420.png"></p>
<blockquote>
<p>//下载</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-galaxy install geerlingguy<span class="selector-class">.nginx</span></span><br><span class="line">- downloading role &#x27;nginx&#x27;, owned by geerlingguy</span><br><span class="line">- downloading role from https://github.com/geerlingguy/ansible-role-nginx/archive/<span class="number">2.8</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">- extracting geerlingguy.nginx to /root/.ansible/roles/geerlingguy.nginx</span><br><span class="line">- geerlingguy.nginx (<span class="number">2.8</span>.<span class="number">0</span>) was installed successfully</span><br></pre></td></tr></table></figure>

<p>//默认Roles存放在</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/.ansible/roles/geerlingguy.nginx</span><br></pre></td></tr></table></figure>

<p>//配置roles执行文件安装部署nginx</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd /root/.ansible/roles</span><br><span class="line">$ vim nginx_site<span class="selector-class">.yml</span></span><br><span class="line">- hosts: rsync_server</span><br><span class="line">  roles:</span><br><span class="line">    - &#123; role: geerlingguy.nginx &#125;</span><br></pre></td></tr></table></figure>

<p>//检查并执行roles文件</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook --syntax-check nginx_site<span class="selector-class">.yml</span>    <span class="comment">//检查语法</span></span><br><span class="line">$ ansible-playbook  nginx_site<span class="selector-class">.yml</span> </span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h3><p>ansible-doc是Ansible 模块文档说明，针对每个模块都有详细的用法说明及应用案例介绍，功能和Linux系统man命令类似。</p>
<p><strong>该命令使用方式如下：</strong></p>
<blockquote>
<p>ansible-doc [-h] [–version] [-v] [-M MODULE_PATH]</p>
</blockquote>
<p><strong>具体示例如下：</strong></p>
<blockquote>
<p>//列出支持的模块</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-doc -l</span><br></pre></td></tr></table></figure>

<p>//模块功能说明</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-doc ping</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ansible-vault"><a href="#ansible-vault" class="headerlink" title="ansible-vault"></a>ansible-vault</h3><p>ansible-vault主要用于配置文件加密，如编写的Playbook配置文件中包含敏感信息，不希望其他人随意查看，ansible-vault可加密/解密这个配置文件</p>
<p><strong>具体使用方法：</strong></p>
<blockquote>
<p>ansible-vault [-h] [–version] [-v]<br>              {create,decrypt,edit,view,encrypt,encrypt_string,rekey}</p>
</blockquote>
<p><strong>具体示例如下：</strong></p>
<blockquote>
<p>//设置如下密码，加密a.yml文件</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-vault encrypt anaconda-ks<span class="selector-class">.cfg</span> </span><br></pre></td></tr></table></figure>

<p>//会有以下输入加密密码提示</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">New Vault password: </span><br><span class="line">Confirm New Vault password: </span><br><span class="line">Encryption successful</span><br></pre></td></tr></table></figure>

<p>//这时，再打开a.yml文件后会发现该文件已经加密，只有通过命令才能进行解密</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-vault decrypt anaconda-ks<span class="selector-class">.cfg</span> </span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="ansible-console"><a href="#ansible-console" class="headerlink" title="ansible-console"></a>ansible-console</h3><p>ansible-console是Ansible为用户提供的一款交换式工具，用户可以在ansible-console虚拟出来的终端上像Shell一样使用Ansible内置的各种命令</p>
<p><strong>输入ansible-console的显示：</strong></p>
<blockquote>
<p>root@all (3)[f:5]$ 是提示符，该提示符表示“当前的使用用户@当前所在的Inventory中定义的组，默认是all分组（Inventory中all组所有主机的数量）[forks:线程数]$”</p>
</blockquote>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img/image-20201213213914724.png"></p>
<p><strong>使用cd命令可切换至指定Hosts或分组，同时提示符也会相应改变，显示如下：</strong></p>
<blockquote>
<p>cd切换至rsync-server分组后，在输入命令cat /etc/hosts命令，就能使用shell方式控制分组的主机了。</p>
</blockquote>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201213214238077.png"></p>
<p><strong>如果需要启动rsyncd服务，可以输入该命令：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ root@rsync_server (1)[f:5]$ service name=rsyncd state=started</span><br></pre></td></tr></table></figure>
<h2 id="定义主机和组"><a href="#定义主机和组" class="headerlink" title="定义主机和组"></a><strong>定义主机和组</strong></h2><p>Inventory配置文件遵循INI文件风格，中括号中的字符为组名，其支持将同一个主机他同时归并到多个不同的组中，分组的功能能大大提供便利，另外如果主机使用了非默认的SSH端口，可以在主机名之后使用冒号端口号来表明</p>
<h3 id="简单分组配置主机信息"><a href="#简单分组配置主机信息" class="headerlink" title="简单分组配置主机信息"></a>简单分组配置主机信息</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[web]</span></span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.7</span></span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.8</span></span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.9</span></span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data]</span></span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.31</span></span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.41</span></span><br></pre></td></tr></table></figure>
<p><strong>操作过程</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible web -a &quot;hostname&quot;</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line"></span><br><span class="line">$ ansible data -a &quot;hostname&quot;</span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">nfs01</span></span><br></pre></td></tr></table></figure>
<h3 id="主机名符号匹配配置"><a href="#主机名符号匹配配置" class="headerlink" title="主机名符号匹配配置"></a>主机名符号匹配配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[web]</span>         </span><br><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.1</span>.<span class="selector-attr">[7:9]</span>   <span class="comment">//以地址方式</span></span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[web]</span></span><br><span class="line">web<span class="selector-attr">[01:03]</span>       <span class="comment">//以主机名方式</span></span><br></pre></td></tr></table></figure>
<p><strong>操作过程</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible web01  -a &quot;hostname&quot;      </span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line"></span><br><span class="line">$ ansible web  -a &quot;hostname&quot;</span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br></pre></td></tr></table></figure>
<h3 id="加上远程端口"><a href="#加上远程端口" class="headerlink" title="加上远程端口"></a>加上远程端口</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[web]</span></span><br><span class="line"> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.7</span>:<span class="number">52113</span></span><br><span class="line"> web01:<span class="number">52113</span></span><br></pre></td></tr></table></figure>
<p><strong>操作过程</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ansible web01  -a &quot;hostname&quot;</span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line"></span><br><span class="line">$ ansible 172.16.1.7  -a &quot;hostname&quot;</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line"></span><br><span class="line">$ ansible web  -a &quot;hostname&quot;</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br></pre></td></tr></table></figure>
<h3 id="主机使用特殊的变量"><a href="#主机使用特殊的变量" class="headerlink" title="主机使用特殊的变量"></a>主机使用特殊的变量</h3><p><strong>这种方式不需要使用ssh密钥，可以在主机清单中使用参数指定</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[web]</span></span><br><span class="line">172.16.1.7 ansible_ssh_port=52113 ansible_ssh_user=root ansible_ssh_pass=123456</span><br><span class="line"></span><br><span class="line">//增添了主机名</span><br><span class="line"><span class="selector-attr">[web]</span></span><br><span class="line">web01 ansible_ssh_host=172.16.1.7 ansible_ssh_port=52113 ansible_ssh_user=root ansible_ssh_pass=123456</span><br></pre></td></tr></table></figure>
<p><strong>操作过程</strong></p>
<blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;$ ansible 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.7</span>  -<span class="selector-tag">a</span> &quot;hostname&quot;</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web01</span><br><span class="line"></span><br><span class="line">$ ansible web -<span class="selector-tag">a</span> &quot;hostname&quot;</span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web01</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="主机名嵌入配置"><a href="#主机名嵌入配置" class="headerlink" title="主机名嵌入配置"></a>主机名嵌入配置</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[rsync:children]</span>  <span class="comment">//包括服务端和客户端端</span></span><br><span class="line">rsync_server</span><br><span class="line">rsync_client</span><br><span class="line"> </span><br><span class="line"><span class="selector-attr">[rsync_client]</span>    <span class="comment">//客户端主机清单</span></span><br><span class="line"> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.31</span></span><br><span class="line"> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.7</span></span><br><span class="line"> <span class="selector-id">#172</span><span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.8</span></span><br><span class="line"> <span class="selector-id">#172</span><span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.9</span></span><br><span class="line"> </span><br><span class="line"><span class="selector-attr">[rsync_server]</span>    <span class="comment">//服务端主机清单</span></span><br><span class="line"> 172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.41</span></span><br></pre></td></tr></table></figure>
<p><strong>操作过程</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ansible rsync_server -a &quot;hostname&quot;</span><br><span class="line">172.16.1.41 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">backup</span></span><br><span class="line"></span><br><span class="line">$ ansible rsync_client -a &quot;hostname&quot;</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">nfs01</span></span><br><span class="line"></span><br><span class="line">$ ansible rsync:children -a &quot;hostname&quot;</span><br><span class="line"><span class="selector-attr">[WARNING]</span>: <span class="selector-tag">Could</span> <span class="selector-tag">not</span> <span class="selector-tag">match</span> <span class="selector-tag">supplied</span> <span class="selector-tag">host</span> <span class="selector-tag">pattern</span>, <span class="selector-tag">ignoring</span>: <span class="selector-tag">children</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">web01</span></span><br><span class="line">172.16.1.41 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">backup</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="selector-tag">nfs01</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>//嵌入式变量信息 </p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[web:vars]</span>   </span><br><span class="line"> ansible_ssh_host=172.16.1.7 </span><br><span class="line"> ansible_ssh_port=22</span><br><span class="line">ansible_ssh_user=root </span><br><span class="line">ansible_ssh_pass=123456</span><br><span class="line"> </span><br><span class="line"> <span class="selector-attr">[web]</span></span><br><span class="line"> web01</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Ansible与正则"><a href="#Ansible与正则" class="headerlink" title="Ansible与正则"></a>Ansible与正则</h3><p>正则表达式（Patterns）是各类高级语言的必定支持的方法一直，Ansible也不例外。其Patterns功能等同于正则表达式，语法使用也和正则类同，大大的提高了Ansible的灵活性。同时也支持Ansible-playbook</p>
<p><strong>1. ALL（全量）匹配</strong></p>
<blockquote>
<p>//匹配所有主机，all或*号功能系统</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m ping</span><br><span class="line">$ ansible &quot;*&quot; -m ping</span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>2. ‘:’逻辑或（or）匹配</strong></p>
<blockquote>
<p>//使用方法</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible &quot;rsync_server:rsync_client<span class="string">&quot; -m ping</span></span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>3. 逻辑非(!)匹配</strong></p>
<blockquote>
<p>//所有在rsync_server组但不在nfs_clien组的主机</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible &quot;rsync_server!nfs_client&quot; -m ping</span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>4. 逻辑与（&amp;）匹配</strong></p>
<blockquote>
<p>//rsync_server组合nfs_client组中同时存在的主机</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible &quot;rsync_server:&amp;nfs_client<span class="string">&quot; -m ping</span></span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>5. 多条件组合</strong></p>
<blockquote>
<p>//rsync_server和nginx两个组中的所有主机，在dbserver组中存在，且在nfs_client组中不存在</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible &quot;rsync_server:ngxin:&amp;dbserver:!nfs_client<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>6. 模糊匹配</strong></p>
<blockquote>
<p>//所以.myboke.com结尾的主机均符合</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*<span class="selector-class">.myboke</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>7. 与切割</strong></p>
<blockquote>
<p>//通过[0:1]即可获取数值1</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[webserver]</span></span><br><span class="line">webpong</span><br><span class="line">webping</span><br><span class="line">webclient</span><br></pre></td></tr></table></figure>

<p>//通过截取数值下标可以获取对应变量值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webservers[0]   # == webpong</span><br><span class="line">webservers[0:1] # == webservers[0],webservers[1]</span><br><span class="line">webservers[-1]  # == webclient</span><br><span class="line">webservers[1:]  # == webpong,webping</span><br></pre></td></tr></table></figure>

</blockquote>
<p><strong>8. 正则匹配</strong></p>
<blockquote>
<p>//“~”开始表示正则匹配</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~(web|db).*\.example\.com</span><br><span class="line"><span class="comment">//匹配web或db后的所有字符.example.com的域名</span></span><br></pre></td></tr></table></figure>

<p>//检测beta.example.com、web.example.com、gree.example.com、beta.example.org、web.example.org、green.example.org的存活</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible &quot;~(beat|web|greem)\.example.(com|org)&quot; -m ping</span><br></pre></td></tr></table></figure>

<p>//检测Inventory中所有以192.168开头的服务器存活信息</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible ~192\<span class="selector-class">.168</span>\.<span class="selector-attr">[0-9]</span>\&#123;\2&#125;.<span class="selector-attr">[0-9]</span>\&#123;2,&#125; -m ping</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Ad-Hoc"><a href="#Ad-Hoc" class="headerlink" title="Ad-Hoc"></a>Ad-Hoc</h2><p>Ad-Hoc，是ansible的一种“临时命令”，英文中作为形容词有“特别的，临时”的含义。Ad-Hoc只是官方对Ansible命令的一种称谓。</p>
<p><strong>其命令用法如下：</strong></p>
<blockquote>
<p>ansible [-h] [–version] [-v] [-b] [–become-method BECOME_METHOD]</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-v,–verbose</td>
<td>输出更详细的执行过程信息，-vvv可得到执行过程所有信息</td>
</tr>
<tr>
<td>-i PATH，–Inventory=PATH</td>
<td>指定Inventory信息，默认/etc/ansible/hosts</td>
</tr>
<tr>
<td>-f NUM，–forks=NUM</td>
<td>并发线程数，默认5个线程</td>
</tr>
<tr>
<td>–private-key=PRIVATE_KEY_FILE</td>
<td>指定密钥文件</td>
</tr>
<tr>
<td>-m MODULE_NAME, –module-name MODULE_NAME</td>
<td>指定执行使用的模块</td>
</tr>
<tr>
<td>–M MODULE_PATH, –module-path MODULE_PATH</td>
<td>指定模块存放路径，默认/usr/share/ansible</td>
</tr>
<tr>
<td>-a MODULE_ARGS，–args MODULE_ARGS</td>
<td>模块参数</td>
</tr>
<tr>
<td>-o, –one-line</td>
<td>标准输出至一行</td>
</tr>
<tr>
<td>-s，–sudo</td>
<td>相当于Linux系统下的sudo命令</td>
</tr>
<tr>
<td>-t TREE, –tree TREE</td>
<td>输出信息至Directory目录下，结果文件以远程主机命名</td>
</tr>
<tr>
<td>-T TIMEOUT, –timeout TIMEOUT</td>
<td>指定连接远程主机的最大超时，单位是秒</td>
</tr>
<tr>
<td>-B SECONDS, –background</td>
<td>后台执行命令，超NUM秒后中止正在执行的任务</td>
</tr>
<tr>
<td>-P POLL_INTERVAL</td>
<td>定期返回后台任务进度</td>
</tr>
<tr>
<td>-u REMOTE_USER, –user REMOTE_USER</td>
<td>在孤独不过远程主机以Username运行命令</td>
</tr>
<tr>
<td>-c CONNECTION, –connection CONNECTION</td>
<td>指定连接方式，可用选项paramiko（ssh)、ssh、local方式</td>
</tr>
<tr>
<td>-l SUBSET, –limit SUBSET</td>
<td>指定运行主机</td>
</tr>
<tr>
<td>–syntax-check</td>
<td>检查语法是否出错</td>
</tr>
<tr>
<td>–list-hosts</td>
<td>列出符合条件的主机列表，不执行任何命令</td>
</tr>
</tbody></table>
<h3 id="ansible模块语法说明"><a href="#ansible模块语法说明" class="headerlink" title="ansible模块语法说明"></a>ansible模块语法说明</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">The <span class="selector-tag">command</span> module takes the <span class="selector-tag">command</span> name followed by <span class="selector-tag">a</span> list of space-delimited arguments.</span><br><span class="line"><span class="comment">//命令模块采用命令名,后面要有空格分隔的参数</span></span><br><span class="line"></span><br><span class="line">The given <span class="selector-tag">command</span> will be executed on all selected nodes.</span><br><span class="line"><span class="comment">//给定的命令将在所有选定的节点上执行</span></span><br><span class="line"></span><br><span class="line">The command(s) will not be processed through the shell, so variables like $HOME and operations like &quot;&lt;&quot;, &quot;&gt;&quot;, &quot;|&quot;, &quot;;&quot; and &quot;&amp;&quot; will not work. Use the shell module if you need these features.</span><br><span class="line"><span class="comment">//输出的命令不会通过shell处理,所以变量名和一些符号将不起作用,如果需要这些特性,请使用shell模块</span></span><br><span class="line"> </span><br><span class="line">To create <span class="selector-tag">command</span> tasks that are easier to read than the ones using space-delimited arguments, pass parameters using the args task keyword or use cmd parameter.</span><br><span class="line"><span class="comment">//若要创建比使用空格分隔的参数更易于读取的命令任务,请使用args task关键字传递参数或使用cmd参数</span></span><br><span class="line"> </span><br><span class="line">Either <span class="selector-tag">a</span> free <span class="selector-tag">form</span> <span class="selector-tag">command</span> or cmd parameter is required, see the examples.</span><br><span class="line"><span class="comment">//需要自由格式命令或cmd输出,请参见示例</span></span><br><span class="line"> </span><br><span class="line">For Windows targets, use the win_command module instead.</span><br><span class="line"><span class="comment">//对Window对象,可以使 用win_command模块代替</span></span><br></pre></td></tr></table></figure>
<h3 id="ping（检测模块）"><a href="#ping（检测模块）" class="headerlink" title="ping（检测模块）"></a>ping（检测模块）</h3><p><strong>描述</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">Try</span> <span class="selector-tag">to</span> <span class="selector-tag">connect</span> <span class="selector-tag">to</span> <span class="selector-tag">host</span>, <span class="selector-tag">verify</span> <span class="selector-tag">a</span> <span class="selector-tag">usable</span> <span class="selector-tag">python</span> <span class="selector-tag">and</span> <span class="selector-tag">return</span> <span class="selector-tag">pong</span> <span class="selector-tag">on</span> <span class="selector-tag">success</span>  //测试连接的主机，验证一个可用的<span class="selector-tag">python</span>，染回<span class="selector-tag">pong</span>则表示成功</span><br></pre></td></tr></table></figure>
<p><strong>执行命令：</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ansible rsync_server -f 5 -m ping</span><br><span class="line">10.0.0.212 | SUCCESS =&gt; &#123;</span><br><span class="line"> &quot;<span class="selector-tag">ansible_facts</span>&quot;: &#123;</span><br><span class="line">     &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line"> &#125;, </span><br><span class="line"> &quot;<span class="selector-tag">changed</span>&quot;: <span class="selector-tag">false</span>, </span><br><span class="line"> &quot;<span class="selector-tag">ping</span>&quot;: &quot;<span class="selector-tag">pong</span>&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>执行的详细结果</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible rsync_server -f 5 -m ping -vvv</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行命令——&gt;ssh连接——&gt;生成临时目录——&gt;将/tmp临时脚本移动至$HOME/.ansible/tmp/ansible-tmp-数字/目录下——&gt;执行命令——&gt;返回结果给控制机——&gt;END</p>
</blockquote>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20201214133539759.png"></p>
<h3 id="command-默认模块"><a href="#command-默认模块" class="headerlink" title="command(默认模块)"></a>command(默认模块)</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">command</span> – Execute commands on targets  <span class="comment">//在目标上执行命令</span></span><br></pre></td></tr></table></figure>
<p><strong>简单用法</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.211</span> -m <span class="selector-tag">command</span> -<span class="selector-tag">a</span> &quot;hostname&quot;</span><br><span class="line">10.0.0.211 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">nfs</span><br></pre></td></tr></table></figure>
<p><strong>扩展应用</strong></p>
<blockquote>
<ol>
<li><p>chdir Change into this directory before running the command.</p>
<p>//在执行这个命令前对目录进行切换</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m command -a &quot;chdir=/tmp touch wuwei1.txt&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>creates A filename or (since 2.0) glob pattern. If it already exists, this step won’t be run.</p>
<p>//一个文件名称或全局模式，如果这个文件已经存在，不会运行下一步    </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m command -a &quot;creates=/tmp/hosts.bak touch wuwei.txt&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>removes If it already exists, this step will be run.  </p>
<p>//如果文件已经存在，可以运行下一步(相反不存在，则不运行)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m command -a &quot;removes=/tmp/hosts.bak chdir=/tmp touch wuwei3.txt&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>free_form(required）</p>
<p>The command module takes a free form command to run. </p>
<p>There is no actual parameter named ‘free form’.</p>
<p>//使用command模块的时候，-a参数后面必须写上一个合法Linux命令信息。如果不加合法的Linux命令信息，则显示报错。</p>
</li>
</ol>
</blockquote>
<h3 id="shell-万能模块）"><a href="#shell-万能模块）" class="headerlink" title="shell(万能模块）"></a>shell(万能模块）</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell  Execute shell commands on targets   <span class="comment">//在目标上执行shell命令</span></span><br></pre></td></tr></table></figure>
<p><strong>简单用法</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.211</span> -m shell-<span class="selector-tag">a</span> &quot;hostname&quot;</span><br><span class="line">  172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">  nfs01</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤信息shell模块可以，command模块也可以</span></span><br><span class="line">$ ansible 172.16.1.41 -m shell -a &quot;grep -E &#x27;nfs01|lb01&#x27; /etc/hosts&quot;</span><br><span class="line">  172.16.1.41 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">  172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.5</span>      lb01</span><br><span class="line">  172<span class="selector-class">.16</span><span class="selector-class">.1</span><span class="selector-class">.31</span>     nfs01</span><br></pre></td></tr></table></figure>
<p><strong>扩展应用</strong></p>
<blockquote>
<ol>
<li><p>chdir Change into this directory before running the command.</p>
<p>//在执行这个命令前对目录进行切换</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m shell -a &quot;chdir=/tmp touch wuwei.txt&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>creates A filename  If it already exists, this step won’t be run.</p>
<p>//一个文件名称或全局模式,如果这个文件已经存在,不会运行下一步     </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m shell -a &quot;creates=/tmp/hosts.bak touch wuwei.txt&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>removes A filename, when it does not exist, this step will not be run.</p>
<p>//如果文件已经存在,可以运行下一步</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m shell -a &quot;removes=/tmp/hosts.bak chdir=/tmp touch wuwei.txt&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</blockquote>
<p><strong>实践应用：利用shell执行脚本</strong></p>
<blockquote>
<p>步骤： </p>
<ol>
<li>第一个步骤：编写一个脚本</li>
<li>第二个步骤：将脚本发送到远程主机</li>
<li>第三个步骤：将脚本权限进行修改（添加执行权限）</li>
<li>第四个步骤：运行ansible命令执行脚本</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li><p>编写一个脚本（ansible端）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim yum_install_software.sh</span><br><span class="line">  #!/<span class="selector-tag">bin</span>/<span class="selector-tag">bash</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#install</span> <span class="selector-tag">top</span> <span class="selector-tag">extend</span> <span class="selector-tag">software</span></span><br><span class="line">  <span class="selector-tag">yum</span> <span class="selector-tag">install</span> <span class="selector-tag">-y</span> <span class="selector-tag">htop</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改脚本的权限为执行权限</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod a+x yum_install_software.sh</span><br><span class="line">$ ll yum_install_software.sh </span><br><span class="line">  <span class="selector-tag">-rwxr-xr-x</span> 1 <span class="selector-tag">root</span> <span class="selector-tag">root</span> 62 <span class="selector-tag">May</span>  3 20<span class="selector-pseudo">:36</span> <span class="selector-tag">yum_install_software</span><span class="selector-class">.sh</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将脚本发送到远程主机</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp -rp yum_install_software.sh 10.0.0.211:/server/scripts/</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行ansible命令执行脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m shell -a &quot;/bin/sh /server/scripts/yum_install_software.sh&quot;</span><br><span class="line">  10.0.0.211 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>被动端检查</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -qa|grep htop</span><br><span class="line">  <span class="selector-tag">htop-2</span>.2.0<span class="selector-tag">-3</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</blockquote>
<h3 id="script-脚本模块"><a href="#script-脚本模块" class="headerlink" title="script(脚本模块)"></a>script(脚本模块)</h3><p><strong>实践应用：利用script执行脚本</strong></p>
<blockquote>
<p>步骤</p>
<ol>
<li>第一个步骤：编写一个脚本</li>
<li>第二个步骤：运行ansible命令执行脚本</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li><p>编写脚本</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim yum_install_software.txt</span><br><span class="line">  #!/<span class="selector-tag">bin</span>/<span class="selector-tag">bash</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#install</span> <span class="selector-tag">top</span> <span class="selector-tag">extend</span> <span class="selector-tag">software</span></span><br><span class="line">  <span class="selector-tag">yum</span> <span class="selector-tag">install</span> <span class="selector-tag">-y</span> <span class="selector-tag">httpd</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用ansible命令执行脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m script -a &quot;/server/scripts/yum_install_software.txt&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>#PS：script模块参数功能和command模块类似</strong></p>
</blockquote>
<p><strong><code>提示：相比shell模块而言，script模块步骤更简单，所以不要依靠shell的模块</code></strong></p>
<h3 id="copy-文件类型模块"><a href="#copy-文件类型模块" class="headerlink" title="copy(文件类型模块)"></a>copy(文件类型模块)</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># copy Copy files to remote locations   <span class="comment">//复制文件信息到远端位置</span></span><br></pre></td></tr></table></figure>
<p><strong>简单用法</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m copy -a &quot;src=/etc/hosts dest=/etc/&quot;</span><br><span class="line">  10.0.0.211 | CHANGED =&gt; &#123;                                     //对那台主机进行变动</span><br><span class="line">     &quot;ansible_facts&quot;: &#123;        		                        //找到ansible,发现解释器Python</span><br><span class="line">         <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">     &#125;, </span><br><span class="line">     <span class="string">&quot;changed&quot;</span>: true,                       	                //是否对主机信息进行改变,true改变,false不改变</span><br><span class="line">     <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;8e84ecc450e3d3174259bbd67f342f0986f30c2f&quot;</span>,    //生成一个文件校验码==MD5值</span><br><span class="line">     <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/etc/hosts&quot;</span>,    	                                //显示目录路径信息 </span><br><span class="line">     <span class="string">&quot;gid&quot;</span>: <span class="number">0</span>,   					        //显示复制后文件gid信息</span><br><span class="line">     <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>,  				                //显示复制后文件的属组</span><br><span class="line">     <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;82f4f9d946109b47ab4942e8b1b079fa&quot;</span>,		//生成一个文件校验码==MD5值 </span><br><span class="line">     <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>,   			                        //显示复制后文件的权限</span><br><span class="line">     <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, 				                //显示复制后属主信息</span><br><span class="line">     <span class="string">&quot;size&quot;</span>: <span class="number">392</span>, 					        //显示复制后的大小信息</span><br><span class="line">     <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1588510756.79-14298-168554630180666/source&quot;</span>, </span><br><span class="line">     <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>,  		                                //显示文件类型	</span><br><span class="line">     <span class="string">&quot;uid&quot;</span>: <span class="number">0</span>						        //显示复制否的uid信息</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展用法</strong></p>
<blockquote>
<ol>
<li><p>在传输文件时修改文件的属主和属组信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;src=/file/rsync/rsync.password dest=/data/ owner=wuwei group=wuwei&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在传输文件时修改文件的权限信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;src=/file/rsync/rsync.password dest=/data/ owner=wuwei group=wuwei mode=1777&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在传输文件信息时对远程主机源文件进行备份</p>
<p>管理端</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;src=/file/rsync/rsync.password dest=/wuwei/ backup=yes&quot;</span><br></pre></td></tr></table></figure>

<p>被管理端</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ll /oldboy/</span><br><span class="line"> <span class="selector-tag">-rwxrwxrwt</span> 1 <span class="selector-tag">oldboy</span> <span class="selector-tag">oldboy</span> 7 <span class="selector-tag">May</span>  3 21<span class="selector-pseudo">:18</span> <span class="selector-tag">rsync</span><span class="selector-class">.password</span></span><br><span class="line"> -rwxrwxrwt 1 oldboy oldboy 0 May  3 21:16 rsync.password.10810.2020-05-03@21:18:19~</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个文件并直接编辑文件的信息</p>
<p>管理端：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;content=&#x27;wuwei123&#x27; dest=/dat/wuwei01.txt&quot;    </span><br></pre></td></tr></table></figure>

<p>被管理端：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /data/wuwei.txt </span><br><span class="line"> <span class="selector-tag">wuwei123</span><span class="selector-attr">[root@nfs01 ~]</span>#     //这里已经成功,不过没有换行显示</span><br></pre></td></tr></table></figure>
</li>
<li><p>remote_src参数的用法：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">remote_src</span> <span class="selector-tag">directory_mode</span> <span class="selector-tag">local_follow</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">If</span> <span class="selector-tag">no</span>, <span class="selector-tag">it</span> <span class="selector-tag">will</span> <span class="selector-tag">search</span> <span class="selector-tag">for</span> <span class="selector-tag">src</span> <span class="selector-tag">at</span> <span class="selector-tag">originating</span>/<span class="selector-tag">master</span> <span class="selector-tag">machine</span>.</span><br><span class="line">  <span class="selector-tag">src</span>参数指定文件信息,会在本地管理端服务进行查找</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">If</span> <span class="selector-tag">yes</span> <span class="selector-tag">it</span> <span class="selector-tag">will</span> <span class="selector-tag">go</span> <span class="selector-tag">to</span> <span class="selector-tag">the</span> <span class="selector-tag">remote</span>/<span class="selector-tag">target</span> <span class="selector-tag">machine</span> <span class="selector-tag">for</span> <span class="selector-tag">the</span> <span class="selector-tag">src</span>.</span><br><span class="line">  <span class="selector-tag">src</span>参数指定文件信息,会从远程主机上进行查找</span><br></pre></td></tr></table></figure>

<p>管理端：第一个no的情况：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ echo 123 &gt;/wuwei/wuwei01.txt     //no的情况会将管理端文件的内容信息进行传输</span><br><span class="line">$ cat /wuwei/wuwei01.txt </span><br><span class="line"> 123</span><br><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;src=/wuwei/wuwei01.txt dest=/data&quot; </span><br></pre></td></tr></table></figure>

<p>被管理端：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /data</span><br><span class="line">$ cat /oldgirl/oldboy01.txt </span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>管理端：第二个yes的情况</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m copy -a &quot;src=/data/wuwei01.txt dest=/wuwei remote_src=yes&quot;   </span><br><span class="line">$ cat /wuwei/wuwei01.txt         //yes的情况会将被管理端文件的内容信息进行传输</span><br><span class="line">123 </span><br></pre></td></tr></table></figure>

<p>被管理端：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo 456 &gt; /data/wuwei01.txt </span><br><span class="line">$ cat /data/wuwei01.txt</span><br><span class="line">456</span><br></pre></td></tr></table></figure>

</li>
</ol>
</blockquote>
<blockquote>
<p><strong>PS：ansible软件copy模块复制目录信息</strong><br> ansible 172.16.1.31 -m copy -a “src=/data dest=/“<br> //src后面目录没有/：将目录本身以及目录下面的内容都进行远程传输复制</p>
<p> ansible 172.16.1.31 -m copy -a “src=/data/ dest=/wuwei”<br> //src后面目录有/：将目录下面的内容都进行远程传输复制</p>
</blockquote>
<h3 id="file-文件类型模块"><a href="#file-文件类型模块" class="headerlink" title="file(文件类型模块)"></a>file(文件类型模块)</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># file  Manage files and file properties  <span class="comment">//管理文件和文件属性、</span></span><br></pre></td></tr></table></figure>
<p><strong>简单用法</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改被动端的属主属组和读写执行权限</span></span><br><span class="line">$ ansible 172.16.1.31 -m file -a &quot;dest=/data/wuwei01.txt owner=wuwei group=wuwei mode=666&quot;</span><br></pre></td></tr></table></figure>
<p><strong>扩展用用法</strong></p>
<p>可以利用file模块创建数据信息（文件 目录 链接文件）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">state</span>  参数</span><br><span class="line"> <span class="selector-tag">a</span>. <span class="selector-tag">absent</span>      //缺席/删除数据信息</span><br><span class="line"> <span class="selector-tag">b</span>. <span class="selector-tag">directory</span>	//创建一个目录信息</span><br><span class="line"> <span class="selector-tag">c</span>. <span class="selector-tag">file</span>        //检查创建的数据信息是否存在 绿色存在 红色不存在</span><br><span class="line"> <span class="selector-tag">d</span>. <span class="selector-tag">link</span>        //创建一个软链接文件</span><br><span class="line"> <span class="selector-tag">e</span>. <span class="selector-tag">hard</span>        //创建一个硬链接文件</span><br><span class="line"> <span class="selector-tag">f</span>. <span class="selector-tag">touch</span>       //创建一个文件信息</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><p>创建目录信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m file -a &quot;dest=/wuwei/ state=directory&quot;</span><br><span class="line">$ ansible 172.16.1.31 -m file -a &quot;dest=/wuwei/wuwei1/wuwei2/ state=directory&quot;  </span><br></pre></td></tr></table></figure>
</li>
<li><p>创建文件信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m file -a &quot;dest=/wuwei/wuwei001.txt state=touch&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建链接文件信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m file -a &quot;src=/wuwei/wuwei001.txt dest=/wuwei/wuwei001_hard.txt state=hard&quot;</span><br><span class="line">$ ansible 172.16.1.31 -m file -a &quot;src=/wuwei/wuwei001.txt dest=/wuwei/wuwei001_link.txt state=link&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>递归修改文件属性 </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Recursively</span> <span class="selector-tag">set</span> <span class="selector-tag">the</span> <span class="selector-tag">specified</span> <span class="selector-tag">file</span> <span class="selector-tag">attributes</span> <span class="selector-tag">on</span> <span class="selector-tag">directory</span> <span class="selector-tag">contents</span>.</span><br><span class="line"><span class="selector-tag">This</span> <span class="selector-tag">applies</span> <span class="selector-tag">only</span> <span class="selector-tag">when</span> <span class="selector-tag">state</span> <span class="selector-tag">is</span> <span class="selector-tag">set</span> <span class="selector-tag">to</span> <span class="selector-tag">directory</span>.</span><br><span class="line">//递归地对目录内容设置指定的文件属性，仅在当前状态设置目录</span><br></pre></td></tr></table></figure>

<p>管理端：yes的情况：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m file -a &quot;dest=/wuwei/ owner=www group=www recurse=yes&quot;</span><br></pre></td></tr></table></figure>

<p>被管理端：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//没改变之前</span><br><span class="line">$ ll /wuwei/</span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">root</span> <span class="selector-tag">root</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 01<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">root</span> <span class="selector-tag">root</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 02<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">root</span> <span class="selector-tag">root</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 03<span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//改变之后</span><br><span class="line">$ ll /wuwei/ </span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">www</span> <span class="selector-tag">www</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 01<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">www</span> <span class="selector-tag">www</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 02<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span> 1 <span class="selector-tag">www</span> <span class="selector-tag">www</span> 0 <span class="selector-tag">May</span>  3 22<span class="selector-pseudo">:02</span> 03<span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>#PS：recurse参数对目录和文件进行递归的改变权限和属性</strong></p>
</blockquote>
<h3 id="fetch-文件内容模块"><a href="#fetch-文件内容模块" class="headerlink" title="fetch(文件内容模块)"></a>fetch(文件内容模块)</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Fetch files from remote nodes  <span class="comment">//从远程节点获取文件</span></span><br></pre></td></tr></table></figure>
<p><strong>简单用法</strong></p>
<blockquote>
<p>#PS：注意一点的是fetsh无法拉去目录到管理端</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m fetch -a &quot;src=/data/1.txt dest=/aini/&quot;</span><br><span class="line"><span class="comment">//将被动端目录/data/1.txt拿去到管理端的/aini目录中，/aini目录不需要创建</span></span><br></pre></td></tr></table></figure>
<h3 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a>yum模块</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Manages packages with teh yum package mangager  <span class="comment">//管理yum仓库的安装</span></span><br><span class="line"></span><br><span class="line"># name <span class="comment">//指定安装软件名很</span></span><br><span class="line"># state <span class="comment">//指定是否安装软件（状态）</span></span><br><span class="line">         install <span class="comment">//安装软件</span></span><br><span class="line">         present <span class="comment">//确保软件安装</span></span><br><span class="line">         latest  <span class="comment">//更新最新安装包</span></span><br><span class="line">         absent  <span class="comment">//卸载软禁</span></span><br><span class="line">         remove  <span class="comment">//移除        </span></span><br></pre></td></tr></table></figure>
<p><strong>使用方法</strong></p>
<blockquote>
<p>#PS：iotop软件可以查看IO的消耗</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m yum -a &quot;name=iotop state=installed&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被管理端查看</span></span><br><span class="line">$ rpm -qa|grep iotop</span><br><span class="line">iotop-0<span class="selector-class">.6-4</span><span class="selector-class">.el7</span><span class="selector-class">.noarch</span></span><br></pre></td></tr></table></figure>
<h3 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a>service模块</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Manage services <span class="comment">//管理服务器的运行状态，停止，开启，重启</span></span><br><span class="line"></span><br><span class="line"># name   <span class="comment">//指定管理的服务名称</span></span><br><span class="line"># state  <span class="comment">//指定服务状态</span></span><br><span class="line">      started <span class="comment">//启动</span></span><br><span class="line">      stoped  <span class="comment">//停止</span></span><br><span class="line">      restarted <span class="comment">//重启</span></span><br><span class="line"># enabled <span class="comment">//指定服务开机是否重启</span></span><br></pre></td></tr></table></figure>
<p><strong>使用方法</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m service -a &quot;name=httpd state=started&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被动检查</span></span><br><span class="line">$ systemctl status httpd</span><br></pre></td></tr></table></figure>
<h3 id="cron模块"><a href="#cron模块" class="headerlink" title="cron模块"></a>cron模块</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Manage cron<span class="selector-class">.d</span> and crontab entries   <span class="comment">//管理定时任务</span></span><br><span class="line"></span><br><span class="line">minute：Minute when the job should run ( 0-59, *, */2, etc )</span><br><span class="line"><span class="comment">//设置分钟信息</span></span><br><span class="line"></span><br><span class="line">hour：Hour when the job should run ( 0-23, *, */2, etc )</span><br><span class="line"><span class="comment">//设置小时信息</span></span><br><span class="line"></span><br><span class="line">day：Day of the month the job should run ( 1-31, *, */2, etc )</span><br><span class="line"><span class="comment">//设置日期信息</span></span><br><span class="line"></span><br><span class="line">month：Month of the year the job should run ( 1-12, *, */2, etc )</span><br><span class="line"><span class="comment">//设置月份信息</span></span><br><span class="line"></span><br><span class="line">weekday：Day of the week that the job should run ( 0-6 for Sunday-Saturday, *, etc )</span><br><span class="line"><span class="comment">//设置星期信息</span></span><br><span class="line"> </span><br><span class="line">job ：The <span class="selector-tag">command</span> to execute or, if env is set, the value of environment variable.</span><br><span class="line">      The <span class="selector-tag">command</span> should not contain line breaks.</span><br><span class="line"><span class="comment">//用于定义定时任务需要干的事情</span></span><br></pre></td></tr></table></figure>
<p><strong>基本用法</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m cron -a &quot;minute=0 hour=2 job=&#x27;/usr/bin/netstat ntp1.aliyun.com  &amp;&gt;/dev/null&#x27;&quot;</span><br></pre></td></tr></table></figure>
<p><strong>扩展用法</strong></p>
<blockquote>
<ol>
<li><p>给定时任务设置注释信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m cron -a &quot;name=&#x27;sync tiem info&#x27; minute=0 hour=2 job=&#x27;/usr/bin/netstat ntp1.aliyun.com  &amp;&gt;/dev/null&#x27;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何删除指定定时任务</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m cron -a &quot;name=&#x27;sync tiem info&#x27; minute=0 hour=2 job=&#x27;/usr/bin/netstat ntp1.aliyun.com  &amp;&gt;/dev/null&#x27; state=absent&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何批量注释定时任务</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.41 -m cron -a &quot;name=&#x27;sync tiem info&#x27; minute=0 hour=2 job=&#x27;/usr/bin/netstat nep1.aliyun.com  &amp;&gt;/dev/null&#x27; disabled=yes&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h3 id="mount模块"><a href="#mount模块" class="headerlink" title="mount模块"></a>mount模块</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Control active and configured mount points <span class="comment">//管理挂载节点</span></span><br><span class="line"></span><br><span class="line"># mount：   <span class="comment">//批量进行挂载操作</span></span><br><span class="line">     <span class="attribute">src</span>：  <span class="comment">//需要挂载的源设备或文件信息</span></span><br><span class="line">	 path： <span class="comment">//指定目标挂载点目录</span></span><br><span class="line">	 fstype：<span class="comment">//指定挂载时的文件系统类型</span></span><br><span class="line">	 state：<span class="comment">//状态</span></span><br><span class="line">	 present/mounted：	//进行挂载</span><br><span class="line">	 present：<span class="comment">//不会实现立即挂载,而是修改fstab文件,实现开机自动挂载</span></span><br><span class="line">	 mounted：<span class="comment">//会实现立即挂载,并且会修改fstab文件,实现开机自动挂载*****</span></span><br><span class="line">	 </span><br><span class="line">	 absent/umounted：//进行挂载</span><br><span class="line">	 absent：<span class="comment">//会实现立即挂载,并且会删除fstab文件信息,禁止开机自动挂载</span></span><br><span class="line">	 unmounted：<span class="comment">//会实现立即卸载,但是不会删除fstab文件信息</span></span><br></pre></td></tr></table></figure>
<p><strong>基本用法</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.41 -m mount -a &quot;src=172.16.1.31:/data path=/mnt fstype=nfs state=present&quot; </span><br><span class="line"><span class="comment">//不会立即挂载,会在文件fstab开机自动挂载</span></span><br><span class="line"></span><br><span class="line">$ ansible 172.16.1.41 -m mount -a &quot;src=172.16.1.31:/data path=/mnt fstype=nfs state=absent&quot;</span><br><span class="line"><span class="comment">//立即卸载,文件fstab内容也会删除,禁止开机自动挂载</span></span><br><span class="line"></span><br><span class="line">$ ansible 172.16.1.41 -m mount -a &quot;src=172.16.1.31:/data path=/mnt fstype=nfs state=mounted&quot;</span><br><span class="line"><span class="comment">//立即挂载,并会在文件fstab实现开机自动挂载</span></span><br><span class="line"></span><br><span class="line">$ ansible 172.16.1.41 -m mount -a &quot;src=172.16.1.31:/data path=/mnt fstype=nfs state=unmounted&quot;</span><br><span class="line"><span class="comment">//卸载挂载,但不会删除文件fstab的开机自动挂载</span></span><br></pre></td></tr></table></figure>
<h3 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h3><p><strong>描述</strong></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Manage user acconts         <span class="comment">//用户管理</span></span><br></pre></td></tr></table></figure>
<p><strong>基本用法</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 10.0.0.211 -m user -a &quot;name=wuwei01&quot;</span><br></pre></td></tr></table></figure>
<p><strong>扩展用法</strong></p>
<blockquote>
<ol>
<li><p>指定用户uid信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31  -m user -a &quot;name=wuwei02 uid=6666&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定用户组信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &quot;name=wuwei02 group=wuwei01&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>改变用户组信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &quot;name=wuwei02 groups=wuwei01&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建虚拟用户</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &quot;name=rsync create_home=no shell=/sbin/nologin&quot;</span><br><span class="line">  <span class="selector-tag">create_home</span>  // 指定家目录<span class="selector-tag">yes</span>为有家目录,<span class="selector-tag">no</span>取消家目录</span><br><span class="line">  <span class="selector-tag">shell</span>        // 指定登录方式</span><br></pre></td></tr></table></figure>
</li>
<li><p>给指定用户创建密码(直接定义密码信息,只会显示明文的密码)</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &quot;name=wuwei04 password=123456&quot;</span><br><span class="line">$ tail -1 /etc/shadow</span><br><span class="line"><span class="selector-tag">wuwei04</span><span class="selector-pseudo">:123456</span><span class="selector-pseudo">:18386</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:99999</span><span class="selector-pseudo">:7</span>:::</span><br></pre></td></tr></table></figure>

</li>
</ol>
</blockquote>
<p>利用ansible程序user模块设置用户密码信息,需要将密码明文信息转换成密文信息进行设置生成密文密码信息方法：</p>
<blockquote>
<ul>
<li><p>方法一：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -i localhost, -m debug -a &quot;msg=&#123;&#123; &#x27;mypassword&#x27; | password_hash(&#x27;sha512&#x27;, &#x27;mysecretsalt&#x27;) &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">$ ansible all -i localhost, -m debug -a &quot;msg=&#123;&#123; &#x27;123456&#x27; | password_hash(&#x27;sha512&#x27;, &#x27;mysecretsalt&#x27;) &#125;&#125;&quot;</span><br><span class="line">localhost | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;$6$mysecretsalt$ZB9R8AirQYAXhtfhOo2qdJz52FyNI6v3L6Uc3KNRP.arBKIYpcuEyQewT5qBAHoyQFwHkW6Z551Ql.cZ53GeY0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//参数说明</span><br><span class="line"> mypassword == 密码信息 == 123456 </span><br><span class="line"> sha512 == 加密的方式</span><br><span class="line"> mysecretsalt == 校验码信息（防止密码被反推）</span><br><span class="line"> &quot;msg&quot;：xxxx == 生成的密码 </span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y expect</span><br><span class="line">$ mkpasswd -l 20 -d 5 -s 3 -C 5</span><br><span class="line"><span class="keyword">@qIf7</span>&#x27;1&#x27;CioAsH38Q4ye</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y python-pip</span><br><span class="line">$ pip install passlib</span><br><span class="line">$ python -c &quot;from passlib.hash import sha512_crypt; import getpass; print(sha512_crypt.using(rounds=5000).hash(getpass.getpass()))&quot;</span><br><span class="line"> <span class="selector-tag">Password</span>: </span><br><span class="line"> $6$iHeFVbjorAtftiCG$hFYJueDj61FN3HkTULjlI1uwegJ74RmJpHz7EfWrZWmhZHVX2Z3ir9j9i4IkeFtUMXjh5rQcCBn9w9G2sWzNE1</span><br></pre></td></tr></table></figure>

</li>
</ul>
</blockquote>
<p>添加用户，使用密文</p>
<blockquote>
<ul>
<li><p>错误传输方式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &quot;name=wuwei05 password=$6$iHeFVbjorAtftiCG$hFYJueDj61FN3HkTULjlI1uwegJ74RmJpHz7EfWrZWmhZHVX2Z3ir9j9i4IkeFtUMXjh5rQcCBn9w9G2sWzNE1&quot;</span><br><span class="line">$ tail -1 /etc/shadow</span><br><span class="line"><span class="selector-tag">wuwei05</span><span class="selector-pseudo">::18386</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:99999</span><span class="selector-pseudo">:7</span>:::</span><br></pre></td></tr></table></figure>
</li>
<li><p>正确的传输方式：需要使’’单引号括起来,不能使用””双引号（在shell命令行中,使用””里面有$符号，就转换成变量，执行时候是显示空）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ansible 172.16.1.31 -m user -a &#x27;name=wuwei06 password=$6$iHeFVbjorAtftiCG$hFYJueDj61FN3HkTULjlI1uwegJ74RmJpHz7EfWrZWmhZHVX2Z3ir9j9i4IkeFtUMXjh5rQcCBn9w9G2sWzNE1&#x27;</span><br><span class="line"> $ tail -1 /etc/shadow</span><br><span class="line"> wuwei:$6$iHeFVbjorAtftiCG$hFYJueDj61FN3HkTULjlI1uwegJ74RmJpHz7EfWrZWmhZHVX2Z3ir9j9i4IkeFtUMXjh5rQcCBn9w9G2sWzNE1:18386:0:99999:7:::</span><br></pre></td></tr></table></figure>
</li>
<li><p>登录</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ su - wuwei</span><br><span class="line"> $ su - wuwei06</span><br><span class="line"> <span class="selector-tag">Password</span>: </span><br><span class="line"> [wuwei@nfs01 ~]$ </span><br></pre></td></tr></table></figure>

</li>
</ul>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Inaction</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://myboke.ink/2021/02/03/ansible入门/">https://myboke.ink/2021/02/03/ansible入门/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a></div><div class="social-share pull-right"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/02/03/ansible-playbook/"><i class="fa fa-chevron-left">  </i><span>ansible-playbook(剧本)</span></a></div><div class="next-post pull-right"><a href="/2021/01/26/zabbix%E6%9C%8D%E5%8A%A1%E6%B7%B1%E5%85%A5%E6%89%A9%E5%B1%95/"><span>zabbix服务深入扩展</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6cea6a646bff1a0d5f5b',
  clientSecret: '6e9ef08f31f505d416bc0afe2d304808e9063627',
  repo: 'zsjmal2316.github.io',
  owner: 'zsjmal2316',
  admin: 'zsjmal2316',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(img/beijing2.png)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By Inaction</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="120" alpha="0.3" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>
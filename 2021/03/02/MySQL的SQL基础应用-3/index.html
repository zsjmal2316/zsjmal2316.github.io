<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="MySQL的SQL基础应用-3"><meta name="keywords" content="MySQL"><meta name="author" content="Inaction"><meta name="copyright" content="Inaction"><title>MySQL的SQL基础应用-3 | Inaction's Blog</title><link rel="shortcut icon" href="/imdadul-hussain-u_oLPS_ZYSc-unsplash.jpg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?12b421fdad87d1edf2305ccb7229d2c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-8RMJ1F8ETC', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">SQL基础应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL"><span class="toc-number">1.1.</span> <span class="toc-text">SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">SQL介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">数据类型介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">整数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">小数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">字符串类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">MySQL日期类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.5.</span> <span class="toc-text">JSON类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E7%9A%84%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83"><span class="toc-number">1.3.</span> <span class="toc-text">库的定义规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%EF%BC%88%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8SQLyog%E5%BB%BA%E7%AB%8B%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">建表（这里使用SQLyog建立）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%B1%9E%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="toc-number">1.3.2.</span> <span class="toc-text">列属性说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E5%8F%A5%E5%88%9B%E5%BB%BA"><span class="toc-number">1.3.3.</span> <span class="toc-text">语句创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E7%9A%84%E8%A7%84%E8%8C%83"><span class="toc-number">1.3.4.</span> <span class="toc-text">建表的规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E5%BB%BA%E8%A1%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.5.</span> <span class="toc-text">查询、删除、建表信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.6.</span> <span class="toc-text">修改表的信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL%EF%BC%88%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">DDL（数据的定义语句）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">库的定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCL%EF%BC%88%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">DCL（数据控制语句）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">权限管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DML%EF%BC%88%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E5%8F%A5%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">DML（数据操作语句）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E6%8F%92%E5%85%A5"><span class="toc-number">1.6.1.</span> <span class="toc-text">insert插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E6%9B%B4%E6%96%B0"><span class="toc-number">1.6.2.</span> <span class="toc-text">update更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DQL%EF%BC%88%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">DQL（数据查询语句）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E6%9C%89%E4%B8%A4%E7%A7%8D"><span class="toc-number">1.7.1.</span> <span class="toc-text">查询语言有两种</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.2.</span> <span class="toc-text">show常用语句总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-number">1.7.3.</span> <span class="toc-text">select单独使用情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E9%80%9A%E7%94%A8%E8%AF%AD%E6%B3%95%EF%BC%88%E5%8D%95%E8%A1%A8%EF%BC%89"><span class="toc-number">1.7.4.</span> <span class="toc-text">select通用语法（单表）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#world%E8%A1%A8%E7%BB%83%E4%B9%A0"><span class="toc-number">1.8.</span> <span class="toc-text">world表练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E9%85%8D%E7%BD%AEfrom%E5%AD%90%E5%8F%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.1.</span> <span class="toc-text">select配置from子句使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E9%85%8D%E7%BD%AE-where%E5%AD%90%E5%8F%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.2.</span> <span class="toc-text">select 配置 where子句使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GROUP-BY"><span class="toc-number">1.8.3.</span> <span class="toc-text">GROUP BY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E9%85%8D%E7%BD%AE-having%E5%AD%90%E5%8F%A5"><span class="toc-number">1.8.4.</span> <span class="toc-text">select 配置 having子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E9%85%8D%E5%90%88-order-by%E5%AD%90%E5%8F%A5"><span class="toc-number">1.8.5.</span> <span class="toc-text">select 配合 order by子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E9%85%8D%E7%BD%AE-limit%E5%AD%90%E5%8F%A5"><span class="toc-number">1.8.6.</span> <span class="toc-text">select 配置 limit子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="toc-number">1.8.7.</span> <span class="toc-text">练习题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E5%B0%8F%E7%BB%93"><span class="toc-number">1.8.8.</span> <span class="toc-text">select小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union%E5%92%8Cunion-all"><span class="toc-number">1.8.9.</span> <span class="toc-text">union和union all</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.8.10.</span> <span class="toc-text">多表连接查询(内连接)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E7%BB%83%E4%B9%A0"><span class="toc-number">1.9.</span> <span class="toc-text">多表连接练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%87%86%E5%A4%87"><span class="toc-number">1.9.1.</span> <span class="toc-text">创建表准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.9.2.</span> <span class="toc-text">表的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.9.3.</span> <span class="toc-text">多表连接示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E5%BA%94%E7%94%A8"><span class="toc-number">1.9.4.</span> <span class="toc-text">别名应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E5-7%E7%89%88%E6%9C%AC%E7%9A%84group-by%E4%B8%AD%E7%9A%84sql-mode%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.</span> <span class="toc-text">关于5.7版本的group by中的sql_mode使用 </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.10.1.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%ADsql-mode%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">关闭sql_mode使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group-concat-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.11.</span> <span class="toc-text">group_concat()使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#concat-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.12.</span> <span class="toc-text">concat()使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#distinst-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.13.</span> <span class="toc-text">distinst()使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.</span> <span class="toc-text">视图的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#information-schema%E5%85%83%E6%95%B0%E6%8D%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">1.15.</span> <span class="toc-text">information_schema元数据使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E7%9A%84%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8"><span class="toc-number">1.15.1.</span> <span class="toc-text">information_schema的基础应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.15.2.</span> <span class="toc-text">information_schema应用示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E9%85%8D%E7%BD%AEconcat-%E5%87%BD%E6%95%B0%E6%8B%BC%E6%8E%A5%E8%AF%AD%E5%8F%A5%E6%88%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.15.3.</span> <span class="toc-text">information_schema配置concat()函数拼接语句或命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sys-Schema%E5%85%83%E6%95%B0%E6%8D%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">1.16.</span> <span class="toc-text">sys Schema元数据使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sys-Schema%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.16.1.</span> <span class="toc-text">sys Schema的意义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%88%86%E5%B8%83%E6%83%85%E5%86%B5"><span class="toc-number">1.16.2.</span> <span class="toc-text">sys下的对象分布情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E5%94%AF%E4%B8%80%E8%A1%A8"><span class="toc-number">1.16.3.</span> <span class="toc-text">sys下唯一表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84session%E8%A7%86%E5%9B%BE"><span class="toc-number">1.16.4.</span> <span class="toc-text">sys下的session视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%E5%88%86%E7%B1%BB"><span class="toc-number">1.16.5.</span> <span class="toc-text">sys下的数据字典分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84InnoDB%E8%A7%86%E5%9B%BE"><span class="toc-number">1.16.6.</span> <span class="toc-text">sys下的InnoDB视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84schema%E8%A7%86%E5%9B%BE"><span class="toc-number">1.16.7.</span> <span class="toc-text">sys下的schema视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E4%B8%8B%E7%9A%84statement%E8%A7%86%E5%9B%BE"><span class="toc-number">1.16.8.</span> <span class="toc-text">sys下的statement视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys%E7%9A%84%E5%A4%87%E4%BB%BD%E5%92%8C%E9%87%8D%E5%BB%BA"><span class="toc-number">1.16.9.</span> <span class="toc-text">sys的备份和重建</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/melody-favicon.ico"></div><div class="author-info__name text-center">Inaction</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">40</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friend Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://www.ji4n.cn/">Jen</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(img/beijing2.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Inaction's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">MySQL的SQL基础应用-3</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-02</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/">Linux</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Linux/MySQL/">MySQL</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="SQL基础应用"><a href="#SQL基础应用" class="headerlink" title="SQL基础应用"></a>SQL基础应用</h1><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="SQL介绍"><a href="#SQL介绍" class="headerlink" title="SQL介绍"></a>SQL介绍</h3><p>SQL（结构化的查询语句），是关系型数据通用的命令，遵循SQL92标准的（SQL_MODE）</p>
<p><strong>SQL常用种类</strong></p>
<blockquote>
<ul>
<li>DDL：数据定义语句</li>
<li>DCL：数据控制语句</li>
<li>DML：数据操作语句</li>
<li>DQL：数据查询语句</li>
</ul>
</blockquote>
<h2 id="数据类型介绍"><a href="#数据类型介绍" class="headerlink" title="数据类型介绍"></a>数据类型介绍</h2><h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><p>对于整数类型数据，是通过区分有符号和无符号的</p>
<table>
<thead>
<tr>
<th>类名称</th>
<th>有符号（signed)</th>
<th>无符号数（Unsigned）</th>
<th>存储空间</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>-129~127</td>
<td>0-255</td>
<td>1字节</td>
<td>极小整数数据类型</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>-32768~32767</td>
<td>0-65535</td>
<td>2字节</td>
<td>较小整数数据类型</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>-8388608~8388607</td>
<td>0-16777215</td>
<td>3字节</td>
<td>中型整数数据类型</td>
</tr>
<tr>
<td>INT</td>
<td>-2147483648~2147483647</td>
<td>0-4294967295</td>
<td>4字节</td>
<td>常规数据整数类型</td>
</tr>
<tr>
<td>bigint</td>
<td>-9223372036854775808~9223372036854775807</td>
<td>0-18446744073709551615</td>
<td>8字节</td>
<td>超大数据整数类型</td>
</tr>
</tbody></table>
<h3 id="小数类型"><a href="#小数类型" class="headerlink" title="小数类型"></a>小数类型</h3><p>使用浮点数的几个建议</p>
<blockquote>
<ul>
<li>浮点数存在数据误差</li>
<li>对货币等对精度敏感的数据，应该用定点数表示或存储，推荐是decimal</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="left">类</th>
<th>类名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">浮点数</td>
<td>FLOAT</td>
<td>小型单精度（4个字节）浮点数</td>
</tr>
<tr>
<td align="left">浮点数</td>
<td>DOUBLE</td>
<td>常规双精度（8个字节）浮点数</td>
</tr>
<tr>
<td align="left">定点数</td>
<td>DECIMAL</td>
<td>包含整数部分、小数部分或同事包括二者的精确值数值</td>
</tr>
</tbody></table>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><p>字符串类型是比较通用的数据类型，对于字符串类型不要过多的使用这些文本，因为它们本不属于关系型数据，是关系型数据库（包括MySQL）不擅长的</p>
<table>
<thead>
<tr>
<th>类型名称</th>
<th>大小</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR</td>
<td>0-255字节</td>
<td>定长字符串类型，不管字符串长度多长，都立即分配字符长度的存储空间，未占满的空间使用“空格”填充</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>0-255字节</td>
<td>变长字符串类型，每次存储数据之前，都要判断长度，按需分配字符空间，会单独申请一个字符长度的空间存储字符长度（少于255，如果超过255以上，会占用两个存储空间）</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255字节</td>
<td>不超过255个字符的二进制字符串</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255字节</td>
<td>短文本字符串</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65535字节</td>
<td>二进制形式的长文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65535字节</td>
<td>长文本数据</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0-16777215字节</td>
<td>二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0-16777215字节</td>
<td>中等长度文本数据</td>
</tr>
<tr>
<td>LOGNGBLOB</td>
<td>0-4294976295字节</td>
<td>二进制形式的极大文本数据</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0-4294976295字节</td>
<td>极大文本数据</td>
</tr>
</tbody></table>
<h3 id="MySQL日期类型"><a href="#MySQL日期类型" class="headerlink" title="MySQL日期类型"></a>MySQL日期类型</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>大小</th>
<th>范围</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>DATATIME</td>
<td>8字节</td>
<td>1000-01-01 00:00:00.000000 至 9999-12-31 23:59:59.999999</td>
<td>混合日期和时间值</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4字节</td>
<td>1970-01-01 00:00:00.000000 至 2038-01-19 11:14:07.999999</td>
<td>混合日期和时间值，时间戳</td>
</tr>
<tr>
<td>DATA</td>
<td>3字节</td>
<td>1000-01-01/9999-12-31</td>
<td>日期值</td>
</tr>
</tbody></table>
<p>对于日期类型，最常用的三个类型：data、datatime和timestamp，创建一张表来模拟一下，并插入一行数据</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">table</span> <span class="selector-tag">time1</span>(<span class="selector-tag">data1</span> <span class="selector-tag">datetime</span>,<span class="selector-tag">data2</span> <span class="selector-tag">timestamp</span>,<span class="selector-tag">date3</span> <span class="selector-tag">date</span>);</span><br><span class="line">&gt; <span class="selector-tag">insert</span> <span class="selector-tag">into</span> <span class="selector-tag">time1</span> <span class="selector-tag">values</span>(<span class="selector-tag">current_date</span>,<span class="selector-tag">current_timestamp</span>,<span class="selector-tag">current_date</span>);</span><br><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">time1</span>;</span><br><span class="line">+<span class="selector-tag">---------------------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">------------</span>+</span><br><span class="line">| data1               | data2               | date3      |</span><br><span class="line">+<span class="selector-tag">---------------------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">------------</span>+</span><br><span class="line">| 2021-02-20 00:00:00 | 2021-02-20 20:35:13 | 2021-02-20 |</span><br><span class="line">+<span class="selector-tag">---------------------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">------------</span>+</span><br></pre></td></tr></table></figure>
<p>datetime和timestamp精确到秒，date是精确到日，datetime占用8个字节，timestamp占用了4个字节，所以timestamp时间范围要短一些</p>
<h3 id="JSON类型"><a href="#JSON类型" class="headerlink" title="JSON类型"></a>JSON类型</h3><p>JSON类型是5.7版本中推出的，创建一张json_ta表，然后插入两行记录看看</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">table</span> <span class="selector-tag">json_ta</span> (<span class="selector-tag">uid</span> <span class="selector-tag">int</span> <span class="selector-tag">auto_increment</span>,<span class="selector-tag">data</span> <span class="selector-tag">json</span>,<span class="selector-tag">primary</span> <span class="selector-tag">key</span>(<span class="selector-tag">uid</span>));</span><br><span class="line">&gt; insert into json_ta values(NULL,&#x27;&#123;&quot;name&quot;:&quot;old&quot;,&quot;age&quot;:20&#125;&#x27;);</span><br><span class="line">&gt; insert into json_ta values(NULL,&#x27;&#123;&quot;name&quot;:&quot;old&quot;,&quot;age&quot;:20&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>如果要查询数据，可以使用类似引用的语法“-&gt;”即可</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; select data-&gt;&quot;$.name&quot; as name,(data-&gt;&quot;$.age&quot;) from json_ta group by name;</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">-----------------</span>+</span><br><span class="line">| name  | (data-&gt;&quot;$.age&quot;) |</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">-----------------</span>+</span><br><span class="line">| &quot;old&quot; | 20              |</span><br><span class="line">| &quot;wu&quot;  | 18              |</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">-----------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="库的定义规范"><a href="#库的定义规范" class="headerlink" title="库的定义规范"></a>库的定义规范</h2><h3 id="建表（这里使用SQLyog建立）"><a href="#建表（这里使用SQLyog建立）" class="headerlink" title="建表（这里使用SQLyog建立）"></a>建表（这里使用SQLyog建立）</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207141849767.png"></p>
<h3 id="列属性说明"><a href="#列属性说明" class="headerlink" title="列属性说明"></a>列属性说明</h3><blockquote>
<p>PS：最好值不为空，如果不知道填什么，则可以填0</p>
</blockquote>
<table>
<thead>
<tr>
<th>列名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>PRIMARY KEY（主键）</td>
<td>主键约束，表中只能由一个，非空且唯一，一般用于数字</td>
</tr>
<tr>
<td>UNIQUE KEY（唯一键约束）</td>
<td>不允许重复值</td>
</tr>
<tr>
<td>NOT NULL（非空）</td>
<td>非空约束，不允许空值</td>
</tr>
<tr>
<td>DEFAULT（默认）</td>
<td>一般配置NOT NULL使用</td>
</tr>
<tr>
<td>UNSIGNED（无符号）</td>
<td>一般是配置数字列，非负数</td>
</tr>
<tr>
<td>AUTO_INCREMENT（自增长）</td>
<td>自增长的列</td>
</tr>
<tr>
<td>COMMENT（注释）</td>
<td>注释</td>
</tr>
</tbody></table>
<h3 id="语句创建"><a href="#语句创建" class="headerlink" title="语句创建"></a>语句创建</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">stu</span>(</span><br><span class="line">id INT PRIMARY KEY NOT NULL AUTO_INCREMENT COMMENT &#x27;学号&#x27;,</span><br><span class="line">sname VARCHAR(255) NOT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line">age TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT &#x27;年龄&#x27;,</span><br><span class="line">gender ENUM(&#x27;m&#x27;,&#x27;f&#x27;,&#x27;n&#x27;) NOT NULL DEFAULT &#x27;n&#x27; COMMENT &#x27;性别&#x27;,</span><br><span class="line">intime DATETIME NOT NULL DEFAULT NOW() COMMENT &#x27;入学时间&#x27;</span><br><span class="line">)<span class="selector-tag">ENGINE</span> <span class="selector-tag">INNODB</span> <span class="selector-tag">CHARSET</span> <span class="selector-tag">utf8mb4</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207143749041.png"></p>
<h3 id="建表的规范"><a href="#建表的规范" class="headerlink" title="建表的规范"></a>建表的规范</h3><blockquote>
<ol>
<li>表名小写字符，不能数字开头</li>
<li>创建表，使用和业务有关的表名</li>
<li>选择合适的数据类型及长度</li>
<li>每个列设置not null + default，不知道填什么，则使用0填充，对于字符串有效字符串填充</li>
<li>每个列设置注释</li>
<li>表必须设置存储引擎和字符集</li>
<li>主键列尽量使无关列数字列，最好是自增长</li>
<li>enum类型不要保存数字，使用字符串，当然也不建议使用，可使用TINYINT来代替</li>
<li>存储精确浮点数必须使用 DECIMAL 替代 FLOAT 和 DOUBLE</li>
</ol>
</blockquote>
<h3 id="查询、删除、建表信息"><a href="#查询、删除、建表信息" class="headerlink" title="查询、删除、建表信息"></a>查询、删除、建表信息</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">tables</span>;</span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">create</span> <span class="selector-tag">table</span> <span class="selector-tag">stu</span>;</span><br><span class="line">&gt; <span class="selector-tag">desc</span> <span class="selector-tag">stu</span>;                         //查看表格</span><br><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">table</span> <span class="selector-tag">tese</span> <span class="selector-tag">like</span> <span class="selector-tag">stu</span>;       //创建一个表结构一样的表</span><br><span class="line">&gt; <span class="selector-tag">drop</span> <span class="selector-tag">table</span> <span class="selector-tag">test</span>;</span><br></pre></td></tr></table></figure>
<h3 id="修改表的信息"><a href="#修改表的信息" class="headerlink" title="修改表的信息"></a>修改表的信息</h3><p><strong>上述创建的stu表中添加qq列</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE stu ADD qq VARCHAR(20) NOT NULL COMMENT &#x27;qq信息&#x27;</span><br><span class="line"><span class="selector-tag">DESC</span> <span class="selector-tag">stu</span></span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207144106227.png"></p>
<p><strong>在sname后添加链接列</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE stu ADD wechat VARCHAR(64) NOT NULL UNIQUE COMMENT &#x27;微信&#x27; AFTER sname</span><br><span class="line"><span class="selector-tag">DESC</span> <span class="selector-tag">stu</span></span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207144823970.png"></p>
<p><strong>删除刚才添加的表（测试使用，不建议工作使用）</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ALTER</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">stu</span> <span class="selector-tag">DROP</span> <span class="selector-tag">qq</span>;</span><br><span class="line"><span class="selector-tag">ALTER</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">stu</span> <span class="selector-tag">DROP</span> <span class="selector-tag">link</span>;</span><br><span class="line"><span class="selector-tag">desc</span> <span class="selector-tag">stu</span>;</span><br></pre></td></tr></table></figure>
<p><strong>修改sname数据类型的属性</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE stu MODIFY sname VARCHAR(64) NOT NULL COMMENT &#x27;性别&#x27;;</span><br><span class="line"><span class="selector-tag">DESC</span> <span class="selector-tag">stu</span>;</span><br></pre></td></tr></table></figure>
<p><strong>修改gender改为sex数据类型改为char类型</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE stu MODIFY gender CHAR(10) NOT NULL COMMENT &#x27;性别&#x27;;</span><br><span class="line"><span class="selector-tag">DESC</span> <span class="selector-tag">stu</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207145525183.png"></p>
<h2 id="DDL（数据的定义语句）"><a href="#DDL（数据的定义语句）" class="headerlink" title="DDL（数据的定义语句）"></a>DDL（数据的定义语句）</h2><h3 id="库的定义"><a href="#库的定义" class="headerlink" title="库的定义"></a>库的定义</h3><p><strong>创建数据库，并设置字符集</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">database</span> <span class="selector-tag">word</span> <span class="selector-tag">charset</span> <span class="selector-tag">utf8mb4</span> <span class="selector-tag">collate</span> <span class="selector-tag">utf8mb4_bin</span>;</span><br></pre></td></tr></table></figure>
<p><strong>查询数据库</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">databases</span>;</span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">create</span> <span class="selector-tag">database</span> <span class="selector-tag">word</span>;</span><br></pre></td></tr></table></figure>
<p><strong>删除数据库</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">drop</span> <span class="selector-tag">database</span> <span class="selector-tag">word</span>;</span><br></pre></td></tr></table></figure>
<p><strong>修改数据库字符集</strong></p>
<blockquote>
<p>注意：修改字符集，一定要从小往大修改，比如utf-8 –&gt; utfmb4，否则无法设置</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">database</span> <span class="selector-tag">boy</span>;</span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">create</span> <span class="selector-tag">database</span> <span class="selector-tag">boy</span>;</span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">----------------------------------------------------------------</span>+</span><br><span class="line">| Database | Create Database                                                |</span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">----------------------------------------------------------------</span>+</span><br><span class="line">| boy      | CREATE DATABASE `boy` /*!40100 DEFAULT CHARACTER SET latin1 */ |</span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">----------------------------------------------------------------</span>+</span><br><span class="line"></span><br><span class="line">//修改</span><br><span class="line">&gt; <span class="selector-tag">alter</span> <span class="selector-tag">database</span> <span class="selector-tag">boy</span> <span class="selector-tag">charset</span> <span class="selector-tag">utf8mb4</span>;</span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">create</span> <span class="selector-tag">database</span> <span class="selector-tag">boy</span>; </span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">-----------------------------------------------------------------</span>+</span><br><span class="line">| Database | Create Database                                                 |</span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">-----------------------------------------------------------------</span>+</span><br><span class="line">| boy      | CREATE DATABASE `boy` /*!40100 DEFAULT CHARACTER SET utf8mb4 */ |</span><br><span class="line">+<span class="selector-tag">----------</span>+<span class="selector-tag">-----------------------------------------------------------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="DCL（数据控制语句）"><a href="#DCL（数据控制语句）" class="headerlink" title="DCL（数据控制语句）"></a>DCL（数据控制语句）</h2><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p><strong>登录MySQL和管理MySQL</strong></p>
<blockquote>
<ol>
<li><p>用户定义白名单：用户名@‘白名单(网段)’</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">word</span>@’%’ 		 	           //允许全部用户</span><br><span class="line">word@’localhost’ 	           //只允许本地用户</span><br><span class="line">word@’<span class="number">10.0</span>.<span class="number">0</span>.%’ 	           //只允许<span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">24</span>的网段</span><br><span class="line">word@’<span class="number">10.0</span>.<span class="number">0.5%</span>’ 	           //只允许<span class="number">10.0</span>.<span class="number">0.50</span>-<span class="number">59</span>的网段</span><br><span class="line">word@’<span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">255.255</span>.<span class="number">254.0%</span>’ //只允许<span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">23</span>的网段</span><br><span class="line">word@’<span class="number">10.0</span>.%’ 				   //只允许<span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">16</span>的网段</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建用户，并添加密码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">create</span> <span class="selector-tag">user</span> <span class="selector-tag">word</span>@&#x27;localhost&#x27; identified by <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询用户</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">host</span> <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span>; </span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| user          | host      |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| workd        | localhost |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改密码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">alter</span> <span class="selector-tag">user</span> <span class="selector-tag">word</span>@&#x27;localhost&#x27; identified by <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除用户</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">drop</span> <span class="selector-tag">user</span> <span class="selector-tag">word</span>@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><blockquote>
<ol>
<li><p>ALL（all代表有下面所有的权限）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">SELECT</span>,<span class="selector-tag">INSERT</span>, <span class="selector-tag">UPDATE</span>, <span class="selector-tag">DELETE</span>, <span class="selector-tag">CREATE</span>, <span class="selector-tag">DROP</span>, <span class="selector-tag">RELOAD</span>, <span class="selector-tag">SHUTDOWN</span>, <span class="selector-tag">PROCESS</span>, <span class="selector-tag">FILE</span>, <span class="selector-tag">REFERENCES</span>, <span class="selector-tag">INDEX</span>, <span class="selector-tag">ALTER</span>, <span class="selector-tag">SHOW</span> <span class="selector-tag">DATABASES</span>, <span class="selector-tag">SUPER</span>, <span class="selector-tag">CREATE</span> <span class="selector-tag">TEMPORARY</span> <span class="selector-tag">TABLES</span>, <span class="selector-tag">LOCK</span> <span class="selector-tag">TABLES</span>, <span class="selector-tag">EXECUTE</span>, <span class="selector-tag">REPLICATION</span> <span class="selector-tag">SLAVE</span>, <span class="selector-tag">REPLICATION</span> <span class="selector-tag">CLIENT</span>, <span class="selector-tag">CREATE</span> <span class="selector-tag">VIEW</span>, <span class="selector-tag">SHOW</span> <span class="selector-tag">VIEW</span>, <span class="selector-tag">CREATE</span> <span class="selector-tag">ROUTINE</span>, <span class="selector-tag">ALTER</span> <span class="selector-tag">ROUTINE</span>, <span class="selector-tag">CREATE</span> <span class="selector-tag">USER</span>, <span class="selector-tag">EVENT</span>, <span class="selector-tag">TRIGGER</span>, <span class="selector-tag">CREATE</span> <span class="selector-tag">TABLESPACE</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>with grant option（授权可以管理其他用户）</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//<span class="selector-tag">grant</span> 权限  <span class="selector-tag">on</span> 作用目标 <span class="selector-tag">to</span> 用户 <span class="selector-tag">identified</span> <span class="selector-tag">by</span> 密码 <span class="selector-tag">with</span> <span class="selector-tag">grant</span> <span class="selector-tag">option</span>;</span><br><span class="line"><span class="selector-tag">mysql</span>&gt; <span class="selector-tag">grant</span> <span class="selector-tag">all</span> <span class="selector-tag">on</span> *.* <span class="selector-tag">to</span> <span class="selector-tag">word</span>@&#x27;localhost&#x27; identified by <span class="string">&#x27;123&#x27;</span> with grant option;</span><br><span class="line"></span><br><span class="line">//设置<span class="selector-tag">word</span>用户可以使用<span class="selector-tag">mysql</span>库中的所有表，可以操作的选项有<span class="selector-tag">select</span>,<span class="selector-tag">insert</span>,<span class="selector-tag">delete</span>,<span class="selector-tag">create</span></span><br><span class="line"><span class="selector-tag">mysql</span>&gt; <span class="selector-tag">grant</span> <span class="selector-tag">select</span>,<span class="selector-tag">insert</span>,<span class="selector-tag">delete</span>,<span class="selector-tag">create</span> <span class="selector-tag">on</span> <span class="selector-tag">word</span>.* <span class="selector-tag">to</span> <span class="selector-tag">word</span>@&#x27;10.0.0.%&#x27; identified by <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上述作用目标</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*.*            //表示所有目录文件(即所有的库)</span><br><span class="line"><span class="selector-tag">word</span>.*         //<span class="selector-tag">word</span>目录下的全部文件</span><br><span class="line"><span class="selector-tag">word</span>.*<span class="selector-tag">t1</span>       //<span class="selector-tag">word</span>目录的<span class="selector-tag">t1</span>表</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看权限</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">grants</span> <span class="selector-tag">for</span> <span class="selector-tag">word</span>@&#x27;10.0.0.%&#x27;;</span><br><span class="line">+<span class="selector-tag">-----------------------------------------------------------------------</span>+</span><br><span class="line">| Grants for word@10.0.0.%                                              |</span><br><span class="line">+<span class="selector-tag">-----------------------------------------------------------------------</span>+</span><br><span class="line">| GRANT USAGE ON *.* TO &#x27;word&#x27;@&#x27;10.0.0.%&#x27;                               |</span><br><span class="line">| GRANT SELECT, INSERT, DELETE, CREATE ON `word`.* TO &#x27;word&#x27;@&#x27;10.0.0.%&#x27; |</span><br></pre></td></tr></table></figure>
</li>
<li><p>回收权限</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">revoke</span> <span class="selector-tag">select</span>,<span class="selector-tag">delete</span> <span class="selector-tag">on</span> <span class="selector-tag">word</span>.* <span class="selector-tag">from</span> <span class="selector-tag">word</span>@&#x27;10.0.0.%&#x27;;</span><br><span class="line"></span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">grants</span> <span class="selector-tag">for</span> <span class="selector-tag">word</span>@&#x27;10.0.0.%&#x27;;</span><br><span class="line">+<span class="selector-tag">-------------------------------------------------------</span>+</span><br><span class="line">| Grants for word@10.0.0.%                              |</span><br><span class="line">+<span class="selector-tag">-------------------------------------------------------</span>+</span><br><span class="line">| GRANT USAGE ON *.* TO &#x27;word&#x27;@&#x27;10.0.0.%&#x27;               |</span><br><span class="line">| GRANT INSERT, CREATE ON `word`.* TO &#x27;word&#x27;@&#x27;10.0.0.%&#x27; |</span><br><span class="line">+<span class="selector-tag">-------------------------------------------------------</span>+</span><br></pre></td></tr></table></figure>

</li>
</ol>
</blockquote>
<h2 id="DML（数据操作语句）"><a href="#DML（数据操作语句）" class="headerlink" title="DML（数据操作语句）"></a>DML（数据操作语句）</h2><h3 id="insert插入"><a href="#insert插入" class="headerlink" title="insert插入"></a>insert插入</h3><p><strong>insert语法</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">INSERT</span> <span class="selector-attr">[LOW_PRIORITY | DELAYED | HIGH_PRIORITY]</span> <span class="selector-attr">[IGNORE]</span></span><br><span class="line">    <span class="selector-attr">[INTO]</span> <span class="selector-tag">tbl_name</span></span><br><span class="line">    <span class="selector-attr">[PARTITION (partition_name [, partition_name]</span> ...)]</span><br><span class="line">    <span class="selector-attr">[(col_name [, col_name]</span> ...)]</span><br><span class="line">    &#123;VALUES | VALUE&#125; (value_list) [, (value_list)] ...</span><br><span class="line">    <span class="selector-attr">[ON DUPLICATE KEY UPDATE assignment_list]</span></span><br></pre></td></tr></table></figure>
<p><strong>偷懒插入</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; INSERT stu VALUES(1,&#x27;zs&#x27;,&#x27;18&#x27;,&#x27;m&#x27;,NOW()) </span><br><span class="line">&gt; <span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> <span class="selector-tag">stu</span>; </span><br></pre></td></tr></table></figure>
<p><strong>标准插入</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; INSERT INTO stu(id,sname,age,sex,intime) VALUES(2,&#x27;ls&#x27;,&#x27;19&#x27;,&#x27;m&#x27;,NOW()); </span><br></pre></td></tr></table></figure>
<p><strong>针对性的录入数据</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; INSERT INTO stu(sname,age,sex) VALUES(&#x27;li&#x27;,&#x27;20&#x27;,&#x27;n&#x27;); </span><br></pre></td></tr></table></figure>
<p><strong>一次性录入</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; INSERT INTO stu(sname,age,sex)  VALUES(&#x27;aa&#x27;,11,&#x27;n&#x27;),(&#x27;bb&#x27;,12,&#x27;m&#x27;),(&#x27;cc&#x27;,13,&#x27;f&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="update更新"><a href="#update更新" class="headerlink" title="update更新"></a>update更新</h3><p><strong>update语法</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">UPDATE</span> <span class="selector-attr">[LOW_PRIORITY]</span> <span class="selector-attr">[IGNORE]</span> <span class="selector-tag">table_reference</span></span><br><span class="line">    <span class="selector-tag">SET</span> <span class="selector-tag">assignment_list</span></span><br><span class="line">    <span class="selector-attr">[WHERE where_condition]</span></span><br><span class="line">    <span class="selector-attr">[ORDER BY ...]</span></span><br><span class="line">    <span class="selector-attr">[LIMIT row_count]</span></span><br></pre></td></tr></table></figure>
<p><strong>指定序列更新</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; update test set k1=&#x27;bb&#x27; where id=3;</span><br></pre></td></tr></table></figure>
<p><strong>更新多个字段</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; update test set k1=&#x27;cc&#x27;,k2=&#x27;中国&#x27; </span><br></pre></td></tr></table></figure>
<h2 id="DQL（数据查询语句）"><a href="#DQL（数据查询语句）" class="headerlink" title="DQL（数据查询语句）"></a>DQL（数据查询语句）</h2><h3 id="查询语言有两种"><a href="#查询语言有两种" class="headerlink" title="查询语言有两种"></a>查询语言有两种</h3><blockquote>
<ul>
<li>show</li>
<li>select</li>
</ul>
</blockquote>
<h3 id="show常用语句总结"><a href="#show常用语句总结" class="headerlink" title="show常用语句总结"></a>show常用语句总结</h3><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>show databases;</td>
<td>查看数据库名</td>
</tr>
<tr>
<td>show tables;</td>
<td>查看表名</td>
</tr>
<tr>
<td>show create database xx;</td>
<td>查看建库语句</td>
</tr>
<tr>
<td>show create table xx;</td>
<td>查看建表语句</td>
</tr>
<tr>
<td>show processlist;</td>
<td>查看所有用户连接情况</td>
</tr>
<tr>
<td>show charset;</td>
<td>查看字符集</td>
</tr>
<tr>
<td>show collation;</td>
<td>查看所有支持的校队规则</td>
</tr>
<tr>
<td>show grants for xx;</td>
<td>查看用户的权限信息</td>
</tr>
<tr>
<td>show variables like ‘%xx%’</td>
<td>模糊匹配查看参数</td>
</tr>
<tr>
<td>show engines;</td>
<td>查看所有支持的存储引擎</td>
</tr>
<tr>
<td>show index from xxx;</td>
<td>查看表的索引信息</td>
</tr>
<tr>
<td>show engine innodb status\G</td>
<td>查看innoDB引擎详细状态信息</td>
</tr>
<tr>
<td>show binary logs;</td>
<td>查看二进制日志的列表信息</td>
</tr>
<tr>
<td>show binary events in;</td>
<td>查看二进制日志的事件信息</td>
</tr>
<tr>
<td>show master status;</td>
<td>查看mysql主库的状态</td>
</tr>
<tr>
<td>show slave status\G</td>
<td>查看从库状态信息</td>
</tr>
<tr>
<td>show relaylog events in；</td>
<td>查看数据库整体状态</td>
</tr>
</tbody></table>
<h3 id="select单独使用情况"><a href="#select单独使用情况" class="headerlink" title="select单独使用情况"></a>select单独使用情况</h3><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>select @@basedir;</td>
<td>查询软件路径</td>
</tr>
<tr>
<td>select @@port;</td>
<td>查询端口</td>
</tr>
<tr>
<td>select @@server_id;</td>
<td>查询服务id</td>
</tr>
<tr>
<td>select @@innodb_flush_log_at_trx_commit;</td>
<td>查询是否将事务日志从innodb log buffer写入到redo log中</td>
</tr>
<tr>
<td>select @@sync_binlog;</td>
<td>查询是否将二进制日志刷新到磁盘上，0不刷新，1刷新</td>
</tr>
<tr>
<td>select database();</td>
<td>查看当前库</td>
</tr>
<tr>
<td>select now();</td>
<td>查询时间</td>
</tr>
</tbody></table>
<h3 id="select通用语法（单表）"><a href="#select通用语法（单表）" class="headerlink" title="select通用语法（单表）"></a>select通用语法（单表）</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span>  列   </span><br><span class="line"><span class="selector-tag">from</span>  表   </span><br><span class="line"><span class="selector-tag">where</span> 条件  </span><br><span class="line"><span class="selector-tag">group</span> <span class="selector-tag">by</span>  条件 </span><br><span class="line"><span class="selector-tag">having</span>   条件 </span><br><span class="line"><span class="selector-tag">order</span> <span class="selector-tag">by</span> 条件</span><br><span class="line"><span class="selector-tag">limit</span>     </span><br></pre></td></tr></table></figure>
<h2 id="world表练习"><a href="#world表练习" class="headerlink" title="world表练习"></a>world表练习</h2><blockquote>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1PTTUhh1MjYz_hpiQeYr8MA">https://pan.baidu.com/s/1PTTUhh1MjYz_hpiQeYr8MA</a><br>提取码：9f5v </p>
</blockquote>
<p><strong>world数据库中的表</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">use</span> <span class="selector-tag">world</span>         //使用该数据库</span><br><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">tabales</span>;     //查看该数据库的表</span><br><span class="line">+<span class="selector-tag">-----------------</span>+</span><br><span class="line">| Tables_in_world |</span><br><span class="line">+<span class="selector-tag">-----------------</span>+</span><br><span class="line">| city            |      //城市表</span><br><span class="line">| country         |      //国家表</span><br><span class="line">| countrylanguage |      //国家的语言</span><br><span class="line">+<span class="selector-tag">-----------------</span>+</span><br></pre></td></tr></table></figure>
<p><strong>查看city的结构</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">desc</span> <span class="selector-tag">city</span>；    </span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">----------------</span>+</span><br><span class="line">| Field       | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">----------------</span>+</span><br><span class="line">| ID          | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| Name        | char(35) | NO   |     |         |                |</span><br><span class="line">| CountryCode | char(3)  | NO   | MUL |         |                |</span><br><span class="line">| District    | char(20) | NO   |     |         |                |</span><br><span class="line">| Population  | int(11)  | NO   |     | 0       |                |</span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">----------------</span>+</span><br></pre></td></tr></table></figure>
<p><strong>查看city的一些内容</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">limit</span> 5;</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">------------</span>+</span><br><span class="line">| ID | Name           | CountryCode | District      | Population |</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">------------</span>+</span><br><span class="line">|  1 | Kabul          | AFG         | Kabol         |    1780000 |</span><br><span class="line">|  2 | Qandahar       | AFG         | Qandahar      |     237500 |</span><br><span class="line">|  3 | Herat          | AFG         | Herat         |     186800 |</span><br><span class="line">|  4 | Mazar-e-Sharif | AFG         | Balkh         |     127800 |</span><br><span class="line">|  5 | Amsterdam      | NLD         | Noord-Holland |     731200 |</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">------------</span>+</span><br></pre></td></tr></table></figure>
<h3 id="select配置from子句使用"><a href="#select配置from子句使用" class="headerlink" title="select配置from子句使用"></a>select配置from子句使用</h3><p><strong>select 列，列，列 from 表</strong></p>
<blockquote>
<ul>
<li><p>查询表中所有的内容</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">use</span> <span class="selector-tag">world</span>;</span><br><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">id</span>,<span class="selector-tag">name</span>,<span class="selector-tag">countrycode</span>,<span class="selector-tag">district</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span>;</span><br><span class="line"></span><br><span class="line">//或</span><br><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">city</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询表中name和population的值</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">name</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="select-配置-where子句使用"><a href="#select-配置-where子句使用" class="headerlink" title="select 配置 where子句使用"></a>select 配置 where子句使用</h3><p><strong>select 列，列，列 from 表 where 过滤条件（where相当于一个Linux中的grep,就是进行过滤的）</strong></p>
<blockquote>
<ol>
<li><p>where等值条件查询</p>
<ul>
<li><p>查询中国所有的城市名和人口数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select name,population from  city where countrycode=&#x27;CHN&#x27;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>where配合比较判断查询（&lt; &gt; &gt;= &lt;=)</p>
<ul>
<li><p>世界上小于100人的城市名和人口数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span>  <span class="selector-tag">name</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">where</span> <span class="selector-tag">populaction</span>&lt;100;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>where配合逻辑连接符（and  or）</p>
<ul>
<li><p>查询中国人口数量大于1000w的城市名和人口</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select name,population from city where countrycode=&#x27;CHN&#x27; and population&gt;10000000;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询中国或美国的城市名和人口数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select name,population from city where countrycode=&#x27;CHN&#x27; or countrycode=&#x27;USA&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询人口数量在500w到600w之间的城市名和人口数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">name</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">where</span> <span class="selector-tag">population</span>&gt;5000000 <span class="selector-tag">and</span> <span class="selector-tag">population</span>&lt;6000000;</span><br><span class="line"></span><br><span class="line">//或者</span><br><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">name</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">where</span> <span class="selector-tag">population</span> <span class="selector-tag">between</span> 5000000 <span class="selector-tag">and</span> 6000000;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>where配合like子句模糊查询</p>
<ul>
<li><p>查询一下countrycode中带有CH开头城市信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select * from city where countrycode like &#x27;CH%&#x27;;</span><br></pre></td></tr></table></figure>

<p> #注意：不要出现类似于%CH%前后都有百分号的语句，因为不走索引，性能极差</p>
</li>
</ul>
</li>
<li><p>where配合in语句</p>
<ul>
<li><p>查询中国或美国的城市名和人口信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; select name,population from city where countrycode=&#x27;CHN&#x27; and countrycode=&#x27;USA&#x27;</span><br><span class="line"></span><br><span class="line">//或者</span><br><span class="line">&gt; select name,population from city where countrycode in (&#x27;CHN&#x27;,&#x27;USA&#x27;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</blockquote>
<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>下述的个别语句需要关闭SQL_MODE规范的一个模式（ONLY_FULL_GROUP_BY），在5.7版本之后功能依赖检测功能，所以启动这个模式MySQL将拒绝选择列表，解决办法去是去掉这个模式</p>
<p>在配置下添加该配置，然后重启mysql</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/my.cnf</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure>
<p><strong>groub by 将某列中有共同条件的数据行，分成一组，然后在进行聚合函数操作</strong></p>
<blockquote>
<ul>
<li><p>统计每个国家，城市的个数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">count</span>(<span class="selector-tag">id</span>) <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">countrycode</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计每个国家的总人口数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">sum</span>(<span class="selector-tag">population</span>)  <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">population</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计每个国家省的个数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">COUNT</span>(<span class="selector-tag">DISTINCT</span> <span class="selector-tag">district</span>)<span class="selector-tag">FROM</span> <span class="selector-tag">city</span> <span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">countrycode</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计中国每个省的总人口数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select district,sum(population) from city where countrycode=&#x27;CHN&#x27; group by district;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计中国每个省城市的个数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select  district,count(name) from city where countrycode=&#x27;CHN&#x27; group by district;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计中国每个省城市的名字列表（group_concat())</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select  district,group_concat(name) from city where countrycode=&#x27;CHN&#x27; group by district;</span><br></pre></td></tr></table></figure>
</li>
<li><p>小扩展=显示的结果为guangdong：shenzheng,guangzhou,qingyuan……</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT CONCAT(district,&quot;：&quot;, GROUP_CONCAT(NAME)) FROM city WHERE countrycode=&#x27;CHN&#x27; GROUP BY district;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="select-配置-having子句"><a href="#select-配置-having子句" class="headerlink" title="select 配置 having子句"></a>select 配置 having子句</h3><blockquote>
<ul>
<li><p>统计所有国家的总人口数量，将总人口大于1亿的过滤出来</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">sum</span>(<span class="selector-tag">population</span>) <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">countrycode</span> <span class="selector-tag">having</span> <span class="selector-tag">sum</span>(<span class="selector-tag">population</span>)&gt;100000000; </span><br></pre></td></tr></table></figure>

<p>#注意：如果group by子句，后面要接having，因为要遵循DQL语句的顺序</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">form</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">where</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">having</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">order</span> <span class="selector-tag">--</span>&gt; <span class="selector-tag">limit</span></span><br></pre></td></tr></table></figure>

<p>#如果使用where子句就会报错，因为where子句要使用在group by子句的前面，逻辑不能打乱，所以只能使用having进行过滤</p>
</li>
</ul>
</blockquote>
<h3 id="select-配合-order-by子句"><a href="#select-配合-order-by子句" class="headerlink" title="select 配合 order by子句"></a>select 配合 order by子句</h3><blockquote>
<ul>
<li><p>统计所有国家的总人口数量，将总人口数大于5000w的过滤出来，并且按照从大到小顺序排列</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">city</span> <span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">countrycode</span> <span class="selector-tag">HAVING</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>)&gt;50000000 <span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">DESC</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="select-配置-limit子句"><a href="#select-配置-limit子句" class="headerlink" title="select 配置 limit子句"></a>select 配置 limit子句</h3><blockquote>
<ul>
<li><p>统计所有国家的总人口数量,将总人口数大于5000w的过滤出来,并且按照从大到小顺序排列,只显示前三名</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">city</span> <span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">countrycode</span> <span class="selector-tag">HAVING</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>)&gt;50000000 <span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">DESC</span> <span class="selector-tag">limit</span> 3; //<span class="selector-tag">offset</span> 0 跳过0行，显示3行</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计所有国家的总人口数量,将总人口数大于5000w的过滤出来,并且按照从大到小顺序排列,只显示后三名</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">city</span> <span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">countrycode</span> <span class="selector-tag">HAVING</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>)&gt;50000000 <span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">population</span>) <span class="selector-tag">DESC</span> <span class="selector-tag">limit</span> 3 <span class="selector-tag">offset</span> 3; //<span class="selector-tag">offset</span> 3 跳过三行，显示3行</span><br></pre></td></tr></table></figure>

<p>//limit m,n：跳过m行，显示一共n行<br>//limit y offset x：跳过x行，显示一共y行</p>
</li>
</ul>
</blockquote>
<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><blockquote>
<ul>
<li><p>统计中国每个省的总人口数量，只打印总人口数小于100</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select district,sum(population) from city where countrycode=&#x27;CHN&#x27; group by district having sum(population)&lt;1000000;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看中国所有的城市，并按人口数进行排行（从大到小）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select name,population from city where countrycode=&#x27;CHN&#x27; order by population desc;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计中国各个省的总人口数量，按照总人口从大到小排序</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT district,SUM(population) FROM city WHERE countrycode=&#x27;CHN&#x27; GROUP BY district order by sum(population) DESC;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计中国，每个省的总人口，找出总人口大于500W的，并按总人口从大到小排序，只显示前三名</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select district,sum(population) from city where countrycode=&#x27;CHN&#x27; group by district having sum(population)&gt;5000000 order by sum(population) desc limit 3;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="select小结"><a href="#select小结" class="headerlink" title="select小结"></a>select小结</h3><p><strong>select是查看表中的那个列，select等所有子句执行完成之后，才会执行显示，from实现查询那张表</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">district</span>,<span class="selector-tag">count</span>(<span class="selector-tag">name</span>) <span class="selector-tag">from</span> <span class="selector-tag">city</span>;</span><br></pre></td></tr></table></figure>
<p><strong>where == 过滤器</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where countrycode=&#x27;CHN&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>将某列中有共同条件的数据行，分成一组，然后在进行聚合函数操作</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">district</span> </span><br></pre></td></tr></table></figure>
<p><strong>过滤</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">having</span>  <span class="selector-tag">count</span>(<span class="selector-tag">name</span>) &gt;10</span><br></pre></td></tr></table></figure>
<p><strong>排序，不加desc等于从小到达</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">order</span> <span class="selector-tag">by</span>  <span class="selector-tag">count</span>(<span class="selector-tag">name</span>) <span class="selector-tag">desc</span> </span><br></pre></td></tr></table></figure>
<p><strong>限制查看的行数据</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">limit</span> 3;</span><br></pre></td></tr></table></figure>
<h3 id="union和union-all"><a href="#union和union-all" class="headerlink" title="union和union all"></a>union和union all</h3><p><strong>作用：多个结果集合并查询的功能</strong></p>
<blockquote>
<ul>
<li><p>查询中国或者美国的城市信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; select * from city where countrycode=&#x27;CHN&#x27; and countrycode=&#x27;USA&#x27;;</span><br><span class="line"></span><br><span class="line">//或</span><br><span class="line">&gt; select * from city where countrycode in (&#x27;CHN&#x27;,&#x27;USA&#x27;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改写为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; select * from city where countrycode = &#x27;CHN&#x27;</span><br><span class="line"><span class="selector-tag">union</span> <span class="selector-tag">all</span></span><br><span class="line">select * from city where countrycode=&#x27;USA&#x27;;</span><br></pre></td></tr></table></figure>

<p>#union all查询由于上面第一种查询，只是会有更多的字符</p>
</li>
<li><p>union和union all的区别   </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">union</span>：//会去重复操作</span><br><span class="line"><span class="selector-tag">union</span> <span class="selector-tag">all</span>：//不会去重复</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="多表连接查询-内连接"><a href="#多表连接查询-内连接" class="headerlink" title="多表连接查询(内连接)"></a>多表连接查询(内连接)</h3><p><strong>作用：单表数据不能满足查询需求时</strong></p>
<blockquote>
<ul>
<li><p>查询世界上小于100人的城市，所在的国家名，国土面积，城市名，人口数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//最核心的是，找到多张表之前的关联条件列</span><br><span class="line">//列数显示，必须是：表名，列</span><br><span class="line">//所有涉及到的查询列，都放在<span class="selector-tag">select</span>后</span><br><span class="line">//将所有的过滤，分组，排序等条件按顺序写在<span class="selector-tag">on</span>的后面</span><br></pre></td></tr></table></figure>

<p>#注意：对多表连接汇总，驱动表选择数据行少的表，后续所有表的关联列尽量是主键或唯一键。</p>
</li>
<li><p>驱动表就是from后面的第一张表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">countrycode</span>,<span class="selector-tag">district</span>,<span class="selector-tag">population</span> <span class="selector-tag">from</span> <span class="selector-tag">city</span> <span class="selector-tag">where</span> <span class="selector-tag">population</span>&gt;100; //<span class="selector-tag">city</span>表能够查询的</span><br><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">name</span>,<span class="selector-tag">SurfaceArea</span> <span class="selector-tag">from</span> <span class="selector-tag">country</span>                                   //<span class="selector-tag">country</span>表能够查询的</span><br><span class="line">city.countrycode = country.code         //城市表中的countrycode参数和国家表中的code是一个样的，所有可以关联在一起</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select country.name,country.SurfaceArea,city.name,city.population from city join country on city.countrycode=country.code where city.population&lt;1000000;</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联，去重国家名称以及国土面积，将城市和人口连接为一列</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">country</span><span class="selector-class">.name</span>,<span class="selector-tag">country</span><span class="selector-class">.SurfaceArea</span>,</span><br><span class="line"><span class="selector-tag">CONCAT</span>(<span class="selector-tag">city</span><span class="selector-class">.district</span>,&quot;：&quot;,<span class="selector-tag">city</span><span class="selector-class">.population</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">country</span> </span><br><span class="line">JOIN city ON country.code=city.countrycode </span><br><span class="line"><span class="selector-tag">WHERE</span> <span class="selector-tag">city</span><span class="selector-class">.population</span>&lt;1000000</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">country</span><span class="selector-class">.name</span>,<span class="selector-tag">country</span><span class="selector-class">.SurfaceArea</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</blockquote>
<h2 id="多表连接练习"><a href="#多表连接练习" class="headerlink" title="多表连接练习"></a>多表连接练习</h2><h3 id="创建表准备"><a href="#创建表准备" class="headerlink" title="创建表准备"></a>创建表准备</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CREATE</span> <span class="selector-tag">DATABASE</span> <span class="selector-tag">school</span> <span class="selector-tag">CHARSET</span> <span class="selector-tag">utf8mb4</span>;</span><br><span class="line"><span class="selector-tag">USE</span> <span class="selector-tag">school</span>;</span><br><span class="line"></span><br><span class="line"># 创建学生表</span><br><span class="line"> <span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">student</span>(</span><br><span class="line"> snum INT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;学号&#x27;,</span><br><span class="line"> sname VARCHAR(20) NOT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line"> sage TINYINT UNSIGNED  NOT NULL COMMENT &#x27;年龄&#x27;,</span><br><span class="line"> ssex  ENUM(&#x27;f&#x27;,&#x27;m&#x27;) NOT NULL DEFAULT &#x27;m&#x27; COMMENT &#x27;性别&#x27;</span><br><span class="line"> )ENGINE=INNODB CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"># 创建课程表</span><br><span class="line"> <span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">course</span>(</span><br><span class="line"> cnum INT NOT NULL PRIMARY KEY COMMENT &#x27;课程编号&#x27;,</span><br><span class="line"> cname VARCHAR(20) NOT NULL COMMENT &#x27;课程名字&#x27;,</span><br><span class="line"> tnum INT NOT NULL COMMENT &#x27;教师编号&#x27;</span><br><span class="line"> )ENGINE=INNODB CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"># 创建成绩表</span><br><span class="line"> <span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">sc</span>(</span><br><span class="line"> snum INT NOT NULL COMMENT &#x27;学号&#x27;,</span><br><span class="line"> cnum INT NOT NULL COMMENT &#x27;课程编号&#x27;,</span><br><span class="line"> score TINYINT UNSIGNED  NOT NULL COMMENT &#x27;成绩&#x27;</span><br><span class="line"> )ENGINE=INNODB CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line"># 创建教师表</span><br><span class="line"> <span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> <span class="selector-tag">teacher</span>(</span><br><span class="line"> tnum INT NOT NULL PRIMARY KEY COMMENT &#x27;教师编号&#x27;,</span><br><span class="line"> tname VARCHAR(20) NOT NULL COMMENT &#x27;教师名字&#x27;</span><br><span class="line"> )ENGINE=INNODB CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line"># 插入数据到<span class="selector-tag">student</span></span><br><span class="line">INSERT INTO student(snum,sname,sage,ssex) VALUES(1,&#x27;wuwei&#x27;,18,&#x27;m&#x27;);</span><br><span class="line">INSERT INTO student(snum,sname,sage,ssex) VALUES(2,&#x27;liu&#x27;,18,&#x27;m&#x27;),(3,&#x27;fu&#x27;,18,&#x27;m&#x27;),(4,&#x27;jie&#x27;,18,&#x27;m&#x27;);</span><br><span class="line">INSERT INTO student(sname,sage,ssex) VALUES(&#x27;jia&#x27;,18,&#x27;m&#x27;),(&#x27;hong&#x27;,18,&#x27;m&#x27;),(&#x27;zeng&#x27;,18,&#x27;m&#x27;);</span><br><span class="line"></span><br><span class="line"># 插入数据到<span class="selector-tag">teacher</span> </span><br><span class="line">INSERT INTO teacher(tnum,tname) VALUES(101,&#x27;bin&#x27;),(102,&#x27;hesw&#x27;),(103,&#x27;ren&#x27;),(104,&#x27;gou&#x27;);</span><br><span class="line"></span><br><span class="line"># 插入数据到<span class="selector-tag">course</span></span><br><span class="line">INSERT INTO course(cnum,cname,tnum) VALUES(11,&#x27;linux&#x27;,101),(12,&#x27;python&#x27;,102),(13,&#x27;mysql&#x27;,103),(14,&#x27;php&#x27;,104),(15,&#x27;go&#x27;,105);</span><br><span class="line"> </span><br><span class="line"># 插入数据到<span class="selector-tag">sc</span></span><br><span class="line"><span class="selector-tag">INSERT</span> <span class="selector-tag">INTO</span> <span class="selector-tag">sc</span>(<span class="selector-tag">snum</span>,<span class="selector-tag">cnum</span>,<span class="selector-tag">score</span>) <span class="selector-tag">VALUES</span></span><br><span class="line">(1,11,80),</span><br><span class="line">(1,12,59),</span><br><span class="line">(2,12,90),</span><br><span class="line">(2,13,100),</span><br><span class="line">(3,11,99),</span><br><span class="line">(3,13,40),</span><br><span class="line">(4,11,79),</span><br><span class="line">(4,12,61),</span><br><span class="line">(4,15,99),</span><br><span class="line">(5,13,40),</span><br><span class="line">(6,15,89),</span><br><span class="line">(6,13,77),</span><br><span class="line">(7,14,67),</span><br><span class="line">(7,13,82),</span><br><span class="line">(8,11,70),</span><br><span class="line">(9,14,80),</span><br><span class="line">(10,13,96);</span><br></pre></td></tr></table></figure>
<p><strong>查看创建的表</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> <span class="selector-tag">student</span>;</span><br><span class="line">&gt; <span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span>;</span><br><span class="line">&gt; <span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> <span class="selector-tag">course</span>;</span><br><span class="line">&gt; <span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> <span class="selector-tag">sc</span>;</span><br></pre></td></tr></table></figure>
<h3 id="表的关系"><a href="#表的关系" class="headerlink" title="表的关系"></a>表的关系</h3><p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207193144349.png"></p>
<h3 id="多表连接示例"><a href="#多表连接示例" class="headerlink" title="多表连接示例"></a>多表连接示例</h3><p><strong>1. 统计wuwei，学习了几门课</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">student</span><span class="selector-class">.sname</span>,<span class="selector-tag">COUNT</span>(<span class="selector-tag">sc</span><span class="selector-class">.cnum</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">student</span></span><br><span class="line"><span class="selector-tag">JOIN</span></span><br><span class="line">sc ON student.snum=sc.snum</span><br><span class="line">WHERE student.sname=&#x27;wuwei&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207194225120.png"></p>
<p><strong>2. 查询wuwei，学习的课程名称有哪些?</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">student</span><span class="selector-class">.sname</span>,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">course</span><span class="selector-class">.cname</span>) </span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">student</span></span><br><span class="line">JOIN sc ON student.snum=sc.snum </span><br><span class="line">JOIN course ON sc.cnum=course.cnum</span><br><span class="line">WHERE student.sname=&#x27;wuwei&#x27;</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">student</span><span class="selector-class">.sname</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207194200567.png"></p>
<p><strong>3. 查询bin老师教的学生名和个数</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">student</span><span class="selector-class">.sname</span>),<span class="selector-tag">COUNT</span>(<span class="selector-tag">student</span><span class="selector-class">.sname</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span></span><br><span class="line">JOIN course ON teacher.tnum=course.tnum </span><br><span class="line">JOIN sc ON course.cnum=sc.cnum</span><br><span class="line">JOIN student ON student.snum=sc.snum</span><br><span class="line">WHERE student.sname=&#x27;bin&#x27;</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207195212313.png"></p>
<p><strong>4. 查询bin所教课程的平均分数</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span>,<span class="selector-tag">AVG</span>(<span class="selector-tag">sc</span><span class="selector-class">.score</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span> </span><br><span class="line">JOIN course ON teacher.tnum=course.tnum</span><br><span class="line">JOIN sc ON course.cnum=sc.cnum</span><br><span class="line">WHERE teacher.tname=&#x27;bin&#x27;</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207195547750.png"></p>
<p><strong>5. 每位老师所教课程的平均分，并按平均分排序</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span>,<span class="selector-tag">AVG</span>(<span class="selector-tag">sc</span><span class="selector-class">.score</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span> </span><br><span class="line">JOIN course ON teacher.tnum=course.tnum</span><br><span class="line">JOIN sc ON course.cnum=sc.cnum</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span></span><br><span class="line"><span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">AVG</span>(<span class="selector-tag">sc</span><span class="selector-class">.score</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210207195755445.png"></p>
<p><strong>6. 查看ren所教的不及格的学生姓名</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">student</span><span class="selector-class">.sname</span>,<span class="selector-tag">sc</span><span class="selector-class">.score</span></span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span></span><br><span class="line">JOIN course ON course.tnum=teacher.tnum</span><br><span class="line">JOIN sc ON sc.cnum=course.cnum</span><br><span class="line">JOIN student ON student.snum=sc.snum</span><br><span class="line">WHERE teacher.tname=&#x27;ren&#x27; AND sc.score&lt;60;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208142518208.png"></p>
<p><strong>7. 查询所有老师教学生不及格的信息</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">CONCAT</span>(<span class="selector-tag">student</span><span class="selector-class">.sname</span>,&quot;：&quot;,<span class="selector-tag">sc</span><span class="selector-class">.score</span>))</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span></span><br><span class="line">JOIN course ON course.tnum=teacher.tnum</span><br><span class="line">JOIN sc ON sc.cnum=course.cnum</span><br><span class="line">JOIN student ON student.snum=sc.snum</span><br><span class="line"><span class="selector-tag">WHERE</span> <span class="selector-tag">sc</span><span class="selector-class">.score</span>&lt;60</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tnum</span>;</span><br></pre></td></tr></table></figure>
<h3 id="别名应用"><a href="#别名应用" class="headerlink" title="别名应用"></a>别名应用</h3><p><strong>表别名</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">t</span><span class="selector-class">.tname</span>,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">CONCAT</span>(<span class="selector-tag">st</span><span class="selector-class">.sname</span>,&quot;：&quot;,<span class="selector-tag">sc</span><span class="selector-class">.score</span>))</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span> <span class="selector-tag">as</span> <span class="selector-tag">t</span></span><br><span class="line">JOIN course as c ON t.tnum=c.tnum</span><br><span class="line">JOIN sc ON c.cnum=sc.cnum</span><br><span class="line">JOIN student as st ON sc.snum=st.snum</span><br><span class="line"><span class="selector-tag">WHERE</span> <span class="selector-tag">sc</span><span class="selector-class">.score</span>&lt;60</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">t</span><span class="selector-class">.tnum</span>;</span><br></pre></td></tr></table></figure>
<p><strong>列表名</strong></p>
<blockquote>
<p>列别名可以被用在having和order by调用</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span> <span class="selector-tag">AS</span> 老师名 ,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">CONCAT</span>(<span class="selector-tag">student</span><span class="selector-class">.sname</span>,&quot;：&quot;,<span class="selector-tag">sc</span><span class="selector-class">.score</span>)) <span class="selector-tag">AS</span> 不及格学生成绩</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span> </span><br><span class="line">JOIN course ON teacher.tnum=course.tnum</span><br><span class="line">JOIN sc ON course.cnum=sc.cnum</span><br><span class="line">JOIN student ON sc.snum=student.snum</span><br><span class="line"><span class="selector-tag">WHERE</span> <span class="selector-tag">sc</span><span class="selector-class">.score</span>&lt;60</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tnum</span>;</span><br></pre></td></tr></table></figure>
<h2 id="关于5-7版本的group-by中的sql-mode使用"><a href="#关于5-7版本的group-by中的sql-mode使用" class="headerlink" title="关于5.7版本的group by中的sql_mode使用 "></a>关于5.7版本的group by中的sql_mode使用 </h2><p>上述在group by章节有说，这里再做补充示例</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><strong>不加group by的正常查询用户表</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">host</span> <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| user          | host      |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| root          | 10.0.0.%  |</span><br><span class="line">| word          | 10.0.0.%  |</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| root          | localhost |</span><br><span class="line">| word          | localhost |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br></pre></td></tr></table></figure>
<p><strong>使用group by的错误查询</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mysql</span>&gt; <span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">host</span> <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">user</span>; </span><br><span class="line">//ERROR 1055 (42000): Expression #2 of SELECT list is not in GROUP BY clause and contains nonaggregated column &#x27;mysql.user.Host&#x27; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在带有group by子句的select中，select后的条件列（非主键列），要么是group by后的列，要么需要在函数中包裹</p>
<p>如这条件语句：select后面user在后面使用group by，而host使用了函数包裹（group_concat)，这样才可以正确使用</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">group_concat</span>(<span class="selector-tag">host</span>) <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">user</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="关闭sql-mode使用"><a href="#关闭sql-mode使用" class="headerlink" title="关闭sql_mode使用"></a>关闭sql_mode使用</h3><p><strong>查询出sql_mode使用的参数，去掉前面的ONLY_FULL_GROUP_BY</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> @<span class="keyword">@sql_mode</span>;</span><br><span class="line"><span class="selector-tag">ONLY_FULL_GROUP_BY</span>,<span class="selector-tag">STRICT_TRANS_TABLES</span>,<span class="selector-tag">NO_ZERO_IN_DATE</span>,<span class="selector-tag">NO_ZERO_DATE</span>,<span class="selector-tag">ERROR_FOR_DIVISION_BY_ZERO</span>,<span class="selector-tag">NO_AUTO_CREATE_USER</span>,<span class="selector-tag">NO_ENGINE_SUBSTITUTION</span></span><br></pre></td></tr></table></figure>
<p><strong>编辑配置my.cnf文件，然后重启</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/my.cnf</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure>
<p><strong>在重新测试</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">host</span> <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">user</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| user          | host      |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| root          | 10.0.0.%  |</span><br><span class="line">| word          | 10.0.0.%  |</span><br></pre></td></tr></table></figure>
<h2 id="group-concat-使用"><a href="#group-concat-使用" class="headerlink" title="group_concat()使用"></a>group_concat()使用</h2><p>列转行聚合函数</p>
<blockquote>
<p>使用该子句，可以对比上述的没有使用了group by和没有使用group by的比较。</p>
<p>很明显，没有加group_concat参数会少了localhost地址，只有10.0.0.%范围的地址</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">user</span>,<span class="selector-tag">group_concat</span>(<span class="selector-tag">host</span>) <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">user</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">--------------------</span>+</span><br><span class="line">| user          | group_concat(host) |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">--------------------</span>+</span><br><span class="line">| mysql.session | localhost          |</span><br><span class="line">| mysql.sys     | localhost          |</span><br><span class="line">| root          | localhost,10.0.0.% |</span><br><span class="line">| word          | localhost,10.0.0.% |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">--------------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="concat-使用"><a href="#concat-使用" class="headerlink" title="concat()使用"></a>concat()使用</h2><p>对列值进行拼接</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">concat</span>(<span class="selector-tag">user</span>,&quot;<span class="selector-pseudo">::&quot;</span>,<span class="selector-tag">host</span>) <span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span> <span class="selector-tag">group</span> <span class="selector-tag">by</span> <span class="selector-tag">user</span>;</span><br><span class="line">+<span class="selector-tag">--------------------------</span>+</span><br><span class="line">| concat(user,&quot;::&quot;,host)   |</span><br><span class="line">+<span class="selector-tag">--------------------------</span>+</span><br><span class="line">| mysql.session::localhost |</span><br><span class="line">| mysql.sys::localhost     |</span><br><span class="line">| root::10.0.0.%           |</span><br><span class="line">| word::10.0.0.%           |</span><br><span class="line">+<span class="selector-tag">-------------------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="distinst-使用"><a href="#distinst-使用" class="headerlink" title="distinst()使用"></a>distinst()使用</h2><p>单独去重复</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">distinct</span>(<span class="selector-tag">user</span>)<span class="selector-tag">from</span> <span class="selector-tag">mysql</span><span class="selector-class">.user</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+</span><br><span class="line">| user          |</span><br><span class="line">+<span class="selector-tag">---------------</span>+</span><br><span class="line">| root          |</span><br><span class="line">| word          |</span><br><span class="line">| mysql.session |</span><br><span class="line">| mysql.sys     |</span><br><span class="line">+<span class="selector-tag">---------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="视图的使用"><a href="#视图的使用" class="headerlink" title="视图的使用"></a>视图的使用</h2><p><strong>创建一个视图，并设置视图别名</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">CREATE</span> <span class="selector-tag">VIEW</span> <span class="selector-tag">vv</span> <span class="selector-tag">AS</span></span><br><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span>,<span class="selector-tag">AVG</span>(<span class="selector-tag">sc</span><span class="selector-class">.score</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">teacher</span> </span><br><span class="line">JOIN course ON teacher.tnum=course.tnum</span><br><span class="line">JOIN sc ON course.cnum=sc.cnum</span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">teacher</span><span class="selector-class">.tname</span>,<span class="selector-tag">course</span><span class="selector-class">.cname</span></span><br><span class="line"><span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">AVG</span>(<span class="selector-tag">sc</span><span class="selector-class">.score</span>)</span><br></pre></td></tr></table></figure>
<p><strong>查询vv视图</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">vv</span>;</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">--------</span>+<span class="selector-tag">---------------</span>+</span><br><span class="line">| tname | cname  | AVG(sc.score) |</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">--------</span>+<span class="selector-tag">---------------</span>+</span><br><span class="line">| hesw  | python |       70.0000 |</span><br><span class="line">| ren   | mysql  |       72.5000 |</span><br><span class="line">| gou   | php    |       73.5000 |</span><br><span class="line">| bin   | linux  |       82.0000 |</span><br><span class="line">+<span class="selector-tag">-------</span>+<span class="selector-tag">--------</span>+<span class="selector-tag">---------------</span>+</span><br></pre></td></tr></table></figure>
<h2 id="information-schema元数据使用"><a href="#information-schema元数据使用" class="headerlink" title="information_schema元数据使用"></a>information_schema元数据使用</h2><p>元数据是存储在“基表”中，通过专用的DDL语句，DCL语句进行修改，information_schema中保存了大量元数据查询的视图，而show命令是封装好的功能，提供元数据查询基础功能</p>
<h3 id="information-schema的基础应用"><a href="#information-schema的基础应用" class="headerlink" title="information_schema的基础应用"></a>information_schema的基础应用</h3><p><strong>tables视图的引用</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">use</span> <span class="selector-tag">information_schema</span>;</span><br></pre></td></tr></table></figure>
<p><strong>查看重要的参数</strong></p>
<blockquote>
<p>TABLE_SCHEMA    //表所载的库名<br>TABLE_NAME      //表名<br>ENGINE            //存储引擎<br>TABLE_ROWS      //数据行<br>AVG_ROW_LENGTH    //平均行长度<br>INDEX_LENGTH    //索引长度</p>
</blockquote>
<h3 id="information-schema应用示例"><a href="#information-schema应用示例" class="headerlink" title="information_schema应用示例"></a>information_schema应用示例</h3><p><strong>显示所有的库和表的信息</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">table_name</span> <span class="selector-tag">from</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span>;</span><br></pre></td></tr></table></figure>
<p><strong>以以下模式 显示所有的库和表的信息</strong></p>
<blockquote>
<p>#world     city,country,countrylanguage</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">GROUP_CONCAT</span>(<span class="selector-tag">table_name</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span></span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">table_schema</span></span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208153948255.png"></p>
<p><strong>查询所有innodb引擎的表</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">table_name</span>,<span class="selector-tag">ENGINE</span> <span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span></span><br><span class="line">WHERE ENGINE=&#x27;innodb&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208154120059.png"></p>
<p><strong>统计world下的city表占用空间大小</strong></p>
<blockquote>
<p>#表的数据量=平均行长度 * 行数 + 索引长度 AVG_ROW_LENGTH * TABLE_ROWS + INDEX_LENGTH</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">table_name</span>,(<span class="selector-tag">AVG_ROW_LENGTH</span>*<span class="selector-tag">TABLE_ROWS</span>+<span class="selector-tag">INDEX_LENGTH</span>)/1024  //除以1024代表是<span class="selector-tag">kb</span>单位，否则以字节为单位</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span> </span><br><span class="line">WHERE table_schema=&#x27;world&#x27; AND table_name=&#x27;city&#x27;;</span><br></pre></td></tr></table></figure>
<p><strong>统计world库数据量总大小</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">SUM</span>(<span class="selector-tag">AVG_ROW_LENGTH</span>*<span class="selector-tag">TABLE_ROWS</span>+<span class="selector-tag">INDEX_LENGTH</span>)</span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span></span><br><span class="line">WHERE table_schema=&#x27;world&#x27;;</span><br></pre></td></tr></table></figure>
<p><strong>统计所有库的总大小</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">SUM</span>(<span class="selector-tag">AVG_ROW_LENGTH</span>*<span class="selector-tag">TABLE_ROWS</span>+<span class="selector-tag">INDEX_LENGTH</span>) <span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span></span><br></pre></td></tr></table></figure>
<p><strong>统计每个库的数据量大小，并按数据量从大到小排序</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">table_schema</span>,<span class="selector-tag">SUM</span>(<span class="selector-tag">AVG_ROW_LENGTH</span>*<span class="selector-tag">TABLE_ROWS</span>+<span class="selector-tag">INDEX_LENGTH</span>) <span class="selector-tag">AS</span> <span class="selector-tag">total</span></span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span></span><br><span class="line"><span class="selector-tag">GROUP</span> <span class="selector-tag">BY</span> <span class="selector-tag">table_schema</span></span><br><span class="line"><span class="selector-tag">ORDER</span> <span class="selector-tag">BY</span> <span class="selector-tag">total</span> <span class="selector-tag">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208154816961.png"></p>
<h3 id="information-schema配置concat-函数拼接语句或命令"><a href="#information-schema配置concat-函数拼接语句或命令" class="headerlink" title="information_schema配置concat()函数拼接语句或命令"></a>information_schema配置concat()函数拼接语句或命令</h3><p><strong>模仿以下语句,进行数据库的分库分表备份</strong></p>
<blockquote>
<p>#mysqldump -uroot -p123 world city &gt;/bak/world_city.sql</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">CONCAT</span>(&quot;<span class="selector-tag">mysqldump</span> <span class="selector-tag">-uroot</span> <span class="selector-tag">-p123</span> &quot;,<span class="selector-tag">table_schema</span>,&quot; &quot;,<span class="selector-tag">table_name</span>,&quot; &gt;/<span class="selector-tag">bak</span>/&quot;,<span class="selector-tag">table_schema</span>,&quot;_&quot;,<span class="selector-tag">table_name</span>,&quot;<span class="selector-class">.sql</span>&quot;) </span><br><span class="line"><span class="selector-tag">FROM</span> <span class="selector-tag">information_schema</span><span class="selector-class">.tables</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208155249328.png"></p>
<p><strong>模仿以下语句，进行批量生成对world库下所有表进行操作</strong></p>
<blockquote>
<p>#ALTER TABLE world.city DISCARD TABLESPACE;</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">SELECT</span> <span class="selector-tag">CONCAT</span>(&quot;<span class="selector-tag">ALTER</span> <span class="selector-tag">TABLE</span> &quot;,<span class="selector-tag">table_schema</span>,&quot;.&quot;,<span class="selector-tag">table_name</span>,&quot; <span class="selector-tag">DISCARD</span> <span class="selector-tag">TABLESPACE</span>;&quot;)</span><br><span class="line">FROM information_schema.tables WHERE table_schema=&#x27;world&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210208155613881.png"></p>
<h2 id="sys-Schema元数据使用"><a href="#sys-Schema元数据使用" class="headerlink" title="sys Schema元数据使用"></a>sys Schema元数据使用</h2><p>MySQL4.1版本提供了information_schema数据字典，一些基础元数据可以通过SQL查询得到</p>
<p>MySQL5.5版本提供了performance_schema性能引擎，可以通过参数performance_schema来开启/关闭</p>
<p>MySQL5.7版本提供了sys Schema，这个新特性包含了一系列的存储过程、自定义函数以及视图来帮助我们快速地了解系统的元数据信息</p>
<h3 id="sys-Schema的意义"><a href="#sys-Schema的意义" class="headerlink" title="sys Schema的意义"></a>sys Schema的意义</h3><p>原本需要结合information_schema，performance_schema查询的方式，现在有了sysd的视图方式，把一些优化和诊断信息通过视图的方式汇总起来，更加直观</p>
<p>如果能好好掌握这些视图的内涵，可以随时查看表的关联关系，对于理解MySQL的运行原理和问题的分析会有很大的帮助</p>
<h3 id="sys下的对象分布情况"><a href="#sys下的对象分布情况" class="headerlink" title="sys下的对象分布情况"></a>sys下的对象分布情况</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">use</span> <span class="selector-tag">sys</span></span><br><span class="line">&gt; select * from schema_object_overview where db=&#x27;sys&#x27;;</span><br><span class="line">+<span class="selector-tag">-----</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------</span>+</span><br><span class="line">| db  | object_type   | count |</span><br><span class="line">+<span class="selector-tag">-----</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------</span>+</span><br><span class="line">| sys | FUNCTION      |    22 |</span><br><span class="line">| sys | PROCEDURE     |    26 |</span><br><span class="line">| sys | VIEW          |   100 |</span><br><span class="line">| sys | BASE TABLE    |     1 |</span><br><span class="line">| sys | INDEX (BTREE) |     1 |</span><br><span class="line">| sys | TRIGGER       |     2 |</span><br><span class="line">+<span class="selector-tag">-----</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------</span>+</span><br></pre></td></tr></table></figure>
<h3 id="sys下唯一表"><a href="#sys下唯一表" class="headerlink" title="sys下唯一表"></a>sys下唯一表</h3><p>sys_config是sys的唯一表，使用命令show tables显示出来这个表，其他的都是视图</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">sys_config</span>;</span><br><span class="line">+<span class="selector-tag">--------------------------------------</span>+<span class="selector-tag">-------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">--------</span>+</span><br><span class="line">| variable                             | value | set_time            | set_by |</span><br><span class="line">+<span class="selector-tag">--------------------------------------</span>+<span class="selector-tag">-------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">--------</span>+</span><br><span class="line">| diagnostics.allow_i_s_tables         | OFF   | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">| diagnostics.include_raw              | OFF   | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">| ps_thread_trx_info.max_length        | 65535 | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">| statement_performance_analyzer.limit | 100   | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">| statement_performance_analyzer.view  | NULL  | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">| statement_truncate_len               | 64    | 2021-02-06 03:56:55 | NULL   |</span><br><span class="line">+<span class="selector-tag">--------------------------------------</span>+<span class="selector-tag">-------</span>+<span class="selector-tag">---------------------</span>+<span class="selector-tag">--------</span>+</span><br></pre></td></tr></table></figure>
<p>可以看到里面是一个基础参数的设置 ， 比如一些范围、基数的设置。而且值得一提的是这个表里设置了几个触发器，对这个表的 DML 操作都会触发里面的数据级联变化，继续查看，还是使用 show tables 来看，会看到整个sys下的表／视图有101个，其中 x$开头的对象有 48 个，简单换算一下，里面 的表／视图有53 个</p>
<h3 id="sys下的session视图"><a href="#sys下的session视图" class="headerlink" title="sys下的session视图"></a>sys下的session视图</h3><p>抽取一个视图来看，输出和show processlist命令如出一辙  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">session</span>\<span class="selector-tag">G</span>;</span><br><span class="line">*************************** 1. <span class="selector-tag">row</span> ***************************</span><br><span class="line">                <span class="selector-tag">thd_id</span>: 44</span><br><span class="line">               <span class="selector-tag">conn_id</span>: 19</span><br><span class="line">                  <span class="selector-tag">user</span>: <span class="selector-tag">root</span><span class="keyword">@localhost</span></span><br><span class="line">                    <span class="attribute">db:</span> sys</span><br><span class="line">               <span class="attribute">command:</span> Query</span><br><span class="line">                 <span class="attribute">state:</span> Sending data</span><br><span class="line">                  <span class="attribute">time:</span> <span class="number">0</span></span><br><span class="line">。。。。。。。。。。。。。。。略。。。。。。。。。。。。。。。</span><br></pre></td></tr></table></figure>
<p>对比一下show processlist;</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">show</span> <span class="selector-tag">processlist</span>;</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------------------</span>+</span><br><span class="line">| Id | User | Host      | db   | Command | Time | State    | Info             |</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------------------</span>+</span><br><span class="line">| 19 | root | localhost | sys  | Query   |    0 | starting | show processlist |</span><br><span class="line">+<span class="selector-tag">----</span>+<span class="selector-tag">------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">------</span>+<span class="selector-tag">----------</span>+<span class="selector-tag">------------------</span>+</span><br></pre></td></tr></table></figure>
<p>在MySQL中使用的是单进程多线程，所以会有独立的$session和$processlist两个视图，两者通过内存地址的方式映射，所有在专用服务器模式下，就可以通过进程找到会话，或者通过会话找到进程，对于排查性能问题大有裨益</p>
<p><img src="https://my-oss-image.oss-cn-guangzhou.aliyuncs.com/img1/image-20210220212626134.png"></p>
<h3 id="sys下的数据字典分类"><a href="#sys下的数据字典分类" class="headerlink" title="sys下的数据字典分类"></a>sys下的数据字典分类</h3><blockquote>
<p>host_summary ： 这个是服务器层面的，比如里面的视图 host_s ummary_by_file io;<br>user summary ： 这个是用户层级的，比如里面的视图 user_summary_by_fi le一io;<br>InnoDB ：这个是 InnoDB 层面的，比如 innodb_buffer_stats_by_schema;<br>memoy：关于内存的使用情况，比如视图 memory_by_host_by_current_bytes;<br>schema：关于 schema 级别的统计信息，比如 schema_table_lock_waits;<br>session ： 关于会话级别的，这个视图少一些，只有 session 和 session_ssl_status 两个；<br>statement ： 关于语句级别的，比如 statements_with_errors_or_warnings;<br>wait：关于等待的，这个还是处于起步阶段，等待模型有待完善 ，目前只有基于io/file, lock/table 和 io/table 这三个方面，提升空间还很大</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">wait_classes_global_by_avg_latency</span>\<span class="selector-tag">g</span>;</span><br><span class="line">+<span class="selector-tag">-----------------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+</span><br><span class="line">| event_class     | total   | total_latency | min_latency | avg_latency | max_latency |</span><br><span class="line">+<span class="selector-tag">-----------------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+</span><br><span class="line">| wait/io/file    |   10385 | 12.88 s       | 0 ps        | 1.24 ms     | 398.63 ms   |</span><br><span class="line">| wait/io/table   | 8284387 | 30.45 s       | 11.46 us    | 3.68 us     | 10.91 s     |</span><br><span class="line">| wait/lock/table |      86 | 115.48 us     | 62.56 ns    | 1.34 us     | 74.79 us    |</span><br><span class="line">+<span class="selector-tag">-----------------</span>+<span class="selector-tag">---------</span>+<span class="selector-tag">---------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-------------</span>+</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="sys下的InnoDB视图"><a href="#sys下的InnoDB视图" class="headerlink" title="sys下的InnoDB视图"></a>sys下的InnoDB视图</h3><p>InnoDB部分关于锁的视图innodb_lock_waits；</p>
<p><strong>通过下述命令照成锁机制</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//第一个会话</span><br><span class="line">&gt; <span class="selector-tag">start</span> <span class="selector-tag">transaction</span>;</span><br><span class="line">&gt; update test set id=100;</span><br><span class="line"></span><br><span class="line">//第二个会话</span><br><span class="line">&gt; update test set id=102;</span><br></pre></td></tr></table></figure>
<p>如果没有sys，只能通过这两条信息查询，当然也可以使用show engine innodb status来得到一些信息，但是上述情况查询到了却不知怎么处理，是否要杀掉，很难决策</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">information_schema</span><span class="selector-class">.innodb_locks</span>\<span class="selector-tag">G</span>;</span><br><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">information_schema</span><span class="selector-class">.innodb_trx</span>\<span class="selector-tag">G</span>;</span><br></pre></td></tr></table></figure>
<p>这时可以看看sys的innodb_lock_waits的结果，这里的过程语句都给准备好，有三行信息阻塞，可以使用kill的方式终止会话，kill语句都准备好了，显示如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">sys</span><span class="selector-class">.innodb_lock_waits</span>\<span class="selector-tag">G</span>;</span><br><span class="line">*************************** 1. <span class="selector-tag">row</span> ***************************</span><br><span class="line">                <span class="selector-tag">wait_started</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:36</span><span class="selector-pseudo">:21</span></span><br><span class="line">                    <span class="selector-tag">wait_age</span>: 00<span class="selector-pseudo">:00</span><span class="selector-pseudo">:07</span></span><br><span class="line">               <span class="selector-tag">wait_age_secs</span>: 7</span><br><span class="line">                <span class="selector-tag">locked_table</span>: `<span class="selector-tag">test</span>`.`<span class="selector-tag">test</span>`</span><br><span class="line">                <span class="selector-tag">locked_index</span>: <span class="selector-tag">GEN_CLUST_INDEX</span></span><br><span class="line">                 <span class="selector-tag">locked_type</span>: <span class="selector-tag">RECORD</span></span><br><span class="line">              <span class="selector-tag">waiting_trx_id</span>: 4896</span><br><span class="line">         <span class="selector-tag">waiting_trx_started</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:28</span><span class="selector-pseudo">:46</span></span><br><span class="line">             <span class="selector-tag">waiting_trx_age</span>: 00<span class="selector-pseudo">:07</span><span class="selector-pseudo">:42</span></span><br><span class="line">     <span class="selector-tag">waiting_trx_rows_locked</span>: 2</span><br><span class="line">   <span class="selector-tag">waiting_trx_rows_modified</span>: 0</span><br><span class="line">                 <span class="selector-tag">waiting_pid</span>: 19</span><br><span class="line">               waiting_query: update test set id=100</span><br><span class="line">             <span class="selector-tag">waiting_lock_id</span>: 4896<span class="selector-pseudo">:53</span><span class="selector-pseudo">:3</span><span class="selector-pseudo">:2</span></span><br><span class="line">           <span class="selector-tag">waiting_lock_mode</span>: <span class="selector-tag">X</span></span><br><span class="line">             <span class="selector-tag">blocking_trx_id</span>: 4895</span><br><span class="line">                <span class="selector-tag">blocking_pid</span>: 20</span><br><span class="line">              <span class="selector-tag">blocking_query</span>: <span class="selector-tag">NULL</span></span><br><span class="line">            <span class="selector-tag">blocking_lock_id</span>: 4895<span class="selector-pseudo">:53</span><span class="selector-pseudo">:3</span><span class="selector-pseudo">:2</span></span><br><span class="line">          <span class="selector-tag">blocking_lock_mode</span>: <span class="selector-tag">X</span></span><br><span class="line">        <span class="selector-tag">blocking_trx_started</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:24</span><span class="selector-pseudo">:41</span></span><br><span class="line">            <span class="selector-tag">blocking_trx_age</span>: 00<span class="selector-pseudo">:11</span><span class="selector-pseudo">:47</span></span><br><span class="line">    <span class="selector-tag">blocking_trx_rows_locked</span>: 3</span><br><span class="line">  <span class="selector-tag">blocking_trx_rows_modified</span>: 4</span><br><span class="line">     <span class="selector-tag">sql_kill_blocking_query</span>: <span class="selector-tag">KILL</span> <span class="selector-tag">QUERY</span> 20</span><br><span class="line"><span class="selector-tag">sql_kill_blocking_connection</span>: <span class="selector-tag">KILL</span> 20</span><br><span class="line">1 <span class="selector-tag">row</span> <span class="selector-tag">in</span> <span class="selector-tag">set</span>, 3 <span class="selector-tag">warnings</span> (0.00 <span class="selector-tag">sec</span>)</span><br></pre></td></tr></table></figure>
<p>当然默认事务还有有超时时间设置，可以看到确实阻塞了</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; update test set id=100;</span><br><span class="line"><span class="selector-tag">ERROR</span> 1205 (<span class="selector-tag">HY000</span>): <span class="selector-tag">Lock</span> <span class="selector-tag">wait</span> <span class="selector-tag">timeout</span> <span class="selector-tag">exceeded</span>; <span class="selector-tag">try</span> <span class="selector-tag">restarting</span> <span class="selector-tag">transaction</span></span><br></pre></td></tr></table></figure>
<h3 id="sys下的schema视图"><a href="#sys下的schema视图" class="headerlink" title="sys下的schema视图"></a>sys下的schema视图</h3><p><strong>schema的所有视图</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">schema_auto_increment_columns</span>      </span><br><span class="line"><span class="selector-tag">schema_index_statistics</span>            </span><br><span class="line"><span class="selector-tag">schema_object_overview</span>             </span><br><span class="line"><span class="selector-tag">schema_redundant_indexes</span>           </span><br><span class="line"><span class="selector-tag">schema_table_lock_waits</span>            </span><br><span class="line"><span class="selector-tag">schema_table_statistics</span>            </span><br><span class="line"><span class="selector-tag">schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="selector-tag">schema_tables_with_full_table_scans</span></span><br><span class="line"><span class="selector-tag">schema_unused_indexes</span>              </span><br></pre></td></tr></table></figure>
<p>如何查看一个列值溢出的情况，比如列的自增长是否会超出数据类型的限制，使用视图schema_auto_increment_columns</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">schema_auto_increment_columns</span>;</span><br><span class="line">+<span class="selector-tag">--------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">----------------------</span>+</span><br><span class="line">| table_schema | table_name | column_name | data_type | column_type | is_signed | is_unsigned | max_value  | auto_increment | auto_increment_ratio |</span><br><span class="line">+<span class="selector-tag">--------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">----------------------</span>+</span><br><span class="line">| school       | student    | snum        | int       | int(11)     |         1 |           0 | 2147483647 |              8 |               0.0000 |</span><br><span class="line">| world        | city       | ID          | int       | int(11)     |         1 |           0 | 2147483647 |           4080 |               0.0000 |</span><br><span class="line">+<span class="selector-tag">--------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">-----------</span>+<span class="selector-tag">-------------</span>+<span class="selector-tag">------------</span>+<span class="selector-tag">----------------</span>+<span class="selector-tag">----------------------</span>+</span><br></pre></td></tr></table></figure>
<p>如果一个表的索引没有使用到，以前用PT工具也可以做分析，现在查个视图就可以搞定了，当然索引的部分，和采样率也有关系，不是一个绝对的结果，视图schema_unused_indexes可查看</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">schema_unused_indexes</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------</span>+</span><br><span class="line">| object_schema | object_name     | index_name  |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------</span>+</span><br><span class="line">| test          | t100w           | id_x        |</span><br><span class="line">| test          | test            | id_x        |</span><br><span class="line">| world         | city            | CountryCode |</span><br><span class="line">| world         | city            | idx_dis     |</span><br><span class="line">| world         | countrylanguage | CountryCode |</span><br><span class="line">| world         | t100            | id_k        |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------</span>+</span><br></pre></td></tr></table></figure>
<p>如果要查看哪些表走了全表扫描以及性能情况，可以使用schema_tables_with_full_table_scans视图，如果数据量本身量很大，这个结果就会被放大</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">schema_tables_with_full_table_scans</span>;</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| object_schema | object_name     | rows_full_scanned | latency   |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------------</span>+<span class="selector-tag">-----------</span>+</span><br><span class="line">| world         | t100            |           7212415 | 22.12 s   |</span><br><span class="line">| test          | t100w           |           1030345 | 7.95 s    |</span><br><span class="line">| world         | city            |             32632 | 110.45 ms |</span><br><span class="line">| world         | countrylanguage |              6888 | 19.15 ms  |</span><br><span class="line">| world         | country         |              1912 | 81.39 ms  |</span><br><span class="line">| world         | test1           |                56 | 600.68 us |</span><br><span class="line">| world         | pp              |                42 | 9.80 ms   |</span><br><span class="line">| world         | test            |                42 | 528.82 us |</span><br><span class="line">| test          | test            |                28 | 2.56 m    |</span><br><span class="line">| school        | sc              |                17 | 35.13 ms  |</span><br><span class="line">| sys           | sys_config      |                12 | 102.70 ms |</span><br><span class="line">| school        | teacher         |                 8 | 2.48 ms   |</span><br><span class="line">| school        | student         |                 7 | 18.36 us  |</span><br><span class="line">| school        | course          |                 5 | 11.64 ms  |</span><br><span class="line">| binlog        | t1              |                 2 | 786.14 us |</span><br><span class="line">+<span class="selector-tag">---------------</span>+<span class="selector-tag">-----------------</span>+<span class="selector-tag">-------------------</span>+<span class="selector-tag">-----------</span>+</span><br></pre></td></tr></table></figure>
<p>如果查看一些冗余的索引，可以使用视图schema_redundant_indexes;，删除的SQL语句会提供好给你</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">schema_redundant_indexes</span>\<span class="selector-tag">G</span>;</span><br><span class="line">*************************** 1. <span class="selector-tag">row</span> ***************************</span><br><span class="line">              <span class="selector-tag">table_schema</span>: <span class="selector-tag">world</span></span><br><span class="line">                <span class="selector-tag">table_name</span>: <span class="selector-tag">countrylanguage</span></span><br><span class="line">      <span class="selector-tag">redundant_index_name</span>: <span class="selector-tag">CountryCode</span></span><br><span class="line">   <span class="selector-tag">redundant_index_columns</span>: <span class="selector-tag">CountryCode</span></span><br><span class="line"><span class="selector-tag">redundant_index_non_unique</span>: 1</span><br><span class="line">       <span class="selector-tag">dominant_index_name</span>: <span class="selector-tag">PRIMARY</span></span><br><span class="line">    <span class="selector-tag">dominant_index_columns</span>: <span class="selector-tag">CountryCode</span>,<span class="selector-tag">Language</span></span><br><span class="line"> <span class="selector-tag">dominant_index_non_unique</span>: 0</span><br><span class="line">            <span class="selector-tag">subpart_exists</span>: 0</span><br><span class="line">            <span class="selector-tag">sql_drop_index</span>: <span class="selector-tag">ALTER</span> <span class="selector-tag">TABLE</span> `<span class="selector-tag">world</span>`.`<span class="selector-tag">countrylanguage</span>` <span class="selector-tag">DROP</span> <span class="selector-tag">INDEX</span> `<span class="selector-tag">CountryCode</span>`</span><br></pre></td></tr></table></figure>
<h3 id="sys下的statement视图"><a href="#sys下的statement视图" class="headerlink" title="sys下的statement视图"></a>sys下的statement视图</h3><p><strong>statement的所有视图</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">statement_analysis</span>                         </span><br><span class="line"><span class="selector-tag">statements_with_errors_or_warnings</span>         </span><br><span class="line"><span class="selector-tag">statements_with_full_table_scans</span>           </span><br><span class="line"><span class="selector-tag">statements_with_runtimes_in_95th_percentile</span></span><br><span class="line"><span class="selector-tag">statements_with_sorting</span>                    </span><br><span class="line"><span class="selector-tag">statements_with_temp_tables</span>                </span><br></pre></td></tr></table></figure>
<p>这部分内容对于分析语句的性能还是很有用的，比如查看语句的排序情况，资源使用情况和延时等都会提供出来</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">statements_with_sorting</span>\<span class="selector-tag">G</span>;</span><br><span class="line">*************************** 1. <span class="selector-tag">row</span> ***************************</span><br><span class="line">            <span class="selector-tag">query</span>: <span class="selector-tag">SELECT</span> `<span class="selector-tag">substring_index</span>` ( `<span class="selector-tag">pe</span> ... ` <span class="selector-tag">FROM</span> `<span class="selector-tag">performance_schema</span>` . </span><br><span class="line">               <span class="selector-tag">db</span>: <span class="selector-tag">sys</span></span><br><span class="line">       <span class="selector-tag">exec_count</span>: 1</span><br><span class="line">    <span class="selector-tag">total_latency</span>: 664.65 <span class="selector-tag">ms</span></span><br><span class="line"><span class="selector-tag">sort_merge_passes</span>: 0</span><br><span class="line">  <span class="selector-tag">avg_sort_merges</span>: 0</span><br><span class="line"><span class="selector-tag">sorts_using_scans</span>: 1</span><br><span class="line"> <span class="selector-tag">sort_using_range</span>: 0</span><br><span class="line">      <span class="selector-tag">rows_sorted</span>: 3</span><br><span class="line">  <span class="selector-tag">avg_rows_sorted</span>: 3</span><br><span class="line">       <span class="selector-tag">first_seen</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:04</span><span class="selector-pseudo">:07</span></span><br><span class="line">        <span class="selector-tag">last_seen</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:04</span><span class="selector-pseudo">:07</span></span><br><span class="line">           <span class="selector-tag">digest</span>: <span class="selector-tag">bd301608bc81fec1eaab29b42f839b8b</span></span><br><span class="line">*************************** 2. <span class="selector-tag">row</span> ***************************</span><br><span class="line">            <span class="selector-tag">query</span>: <span class="selector-tag">SELECT</span> `<span class="selector-tag">t</span>` . `<span class="selector-tag">THREAD_ID</span>` <span class="selector-tag">AS</span> `<span class="selector-tag">t</span> ... _<span class="selector-tag">NUMBER_OF_BYTES_USED</span>` ) <span class="selector-tag">DESC</span> </span><br><span class="line">               <span class="selector-tag">db</span>: <span class="selector-tag">sys</span></span><br><span class="line">       <span class="selector-tag">exec_count</span>: 5</span><br><span class="line">    <span class="selector-tag">total_latency</span>: 573.00 <span class="selector-tag">ms</span></span><br><span class="line"><span class="selector-tag">sort_merge_passes</span>: 0</span><br><span class="line">  <span class="selector-tag">avg_sort_merges</span>: 0</span><br><span class="line"><span class="selector-tag">sorts_using_scans</span>: 10</span><br><span class="line"> <span class="selector-tag">sort_using_range</span>: 0</span><br><span class="line">      <span class="selector-tag">rows_sorted</span>: 260</span><br><span class="line">  <span class="selector-tag">avg_rows_sorted</span>: 52</span><br><span class="line">       <span class="selector-tag">first_seen</span>: 2021<span class="selector-tag">-02-18</span> 20<span class="selector-pseudo">:55</span><span class="selector-pseudo">:55</span></span><br><span class="line">        <span class="selector-tag">last_seen</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:00</span><span class="selector-pseudo">:18</span></span><br><span class="line">           <span class="selector-tag">digest</span>: <span class="selector-tag">b3ea91361b876a2dba55fdce3df2ee23</span></span><br></pre></td></tr></table></figure>
<p>在这里SQL语句做了删减，不过语句的信息、执行次数和延时都可以看到</p>
<p>对于SQL语句中生成的临时表，可以通过视图statement_with_temp_tables，比如某一个语句生成的临时表情况，都做了统计</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">statements_with_temp_tables</span>\<span class="selector-tag">G</span>;</span><br><span class="line">*************************** 1. <span class="selector-tag">row</span> ***************************</span><br><span class="line">                   <span class="selector-tag">query</span>: <span class="selector-tag">SELECT</span> `<span class="selector-tag">performance_schema</span>` .  ... <span class="selector-tag">name</span>` . `<span class="selector-tag">SUM_TIMER_WAIT</span>` <span class="selector-tag">DESC</span> </span><br><span class="line">                      <span class="selector-tag">db</span>: <span class="selector-tag">sys</span></span><br><span class="line">              <span class="selector-tag">exec_count</span>: 6</span><br><span class="line">           <span class="selector-tag">total_latency</span>: 231.41 <span class="selector-tag">ms</span></span><br><span class="line">       <span class="selector-tag">memory_tmp_tables</span>: 1157</span><br><span class="line">         <span class="selector-tag">disk_tmp_tables</span>: 96</span><br><span class="line"><span class="selector-tag">avg_tmp_tables_per_query</span>: 193</span><br><span class="line">  <span class="selector-tag">tmp_tables_to_disk_pct</span>: 8</span><br><span class="line">              <span class="selector-tag">first_seen</span>: 2021<span class="selector-tag">-02-18</span> 20<span class="selector-pseudo">:54</span><span class="selector-pseudo">:17</span></span><br><span class="line">               <span class="selector-tag">last_seen</span>: 2021<span class="selector-tag">-02-18</span> 21<span class="selector-pseudo">:45</span><span class="selector-pseudo">:47</span></span><br><span class="line">                  <span class="selector-tag">digest</span>: 0777<span class="selector-tag">f5fb19c1c948f63a61c7df1778a2</span></span><br><span class="line">*************************** 2. <span class="selector-tag">row</span> ***************************</span><br><span class="line">                   <span class="selector-tag">query</span>: <span class="selector-tag">SELECT</span> `<span class="selector-tag">information_schema</span>` .  ... <span class="selector-tag">SELECT</span> `<span class="selector-tag">information_schema</span>` . </span><br><span class="line">                      <span class="selector-tag">db</span>: <span class="selector-tag">sys</span></span><br><span class="line">              <span class="selector-tag">exec_count</span>: 2</span><br><span class="line">           <span class="selector-tag">total_latency</span>: 287.82 <span class="selector-tag">ms</span></span><br><span class="line">       <span class="selector-tag">memory_tmp_tables</span>: 390</span><br><span class="line">         <span class="selector-tag">disk_tmp_tables</span>: 66</span><br><span class="line"><span class="selector-tag">avg_tmp_tables_per_query</span>: 195</span><br><span class="line">  <span class="selector-tag">tmp_tables_to_disk_pct</span>: 17</span><br><span class="line">              <span class="selector-tag">first_seen</span>: 2021<span class="selector-tag">-02-18</span> 20<span class="selector-pseudo">:42</span><span class="selector-pseudo">:48</span></span><br><span class="line">               <span class="selector-tag">last_seen</span>: 2021<span class="selector-tag">-02-18</span> 20<span class="selector-pseudo">:42</span><span class="selector-pseudo">:50</span></span><br><span class="line">                  <span class="selector-tag">digest</span>: 86784014<span class="selector-tag">e7e812cb054332f64e8e75a0</span></span><br></pre></td></tr></table></figure>
<h3 id="sys的备份和重建"><a href="#sys的备份和重建" class="headerlink" title="sys的备份和重建"></a>sys的备份和重建</h3><p>如果查看sys的版本，可以使用视图version来得到</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">version</span>;</span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+</span><br><span class="line">| sys_version | mysql_version |</span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+</span><br><span class="line">| 1.5.1       | 5.7.26-log    |</span><br><span class="line">+<span class="selector-tag">-------------</span>+<span class="selector-tag">---------------</span>+</span><br></pre></td></tr></table></figure>
<p>如果要导出，可以使用 mysqlpump sys&gt; sys_dump.sql 或者 mysqldump –databases –routines sys &gt; sys_dump . sql 来得到 sys 的创建语旬，如果需要重建则更简单，使用 mysql&lt;sys_dump .sql即可</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Inaction</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://myboke.ink/2021/03/02/MySQL的SQL基础应用-3/">https://myboke.ink/2021/03/02/MySQL的SQL基础应用-3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="social-share pull-right"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/03/02/MySQL%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92-4/"><i class="fa fa-chevron-left">  </i><span>MySQL索引与执行计划-4</span></a></div><div class="next-post pull-right"><a href="/2021/02/20/MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%A1%E7%90%86-2/"><span>MySQL体系结构与管理-2</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6cea6a646bff1a0d5f5b',
  clientSecret: '6e9ef08f31f505d416bc0afe2d304808e9063627',
  repo: 'zsjmal2316.github.io',
  owner: 'zsjmal2316',
  admin: 'zsjmal2316',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(img/beijing2.png)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By Inaction</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="120" alpha="0.3" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>